"use strict";
/*
 * Copyright 2019 Amazon.com, Inc. or its affiliates. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License").
 * You may not use this file except in compliance with the License.
 * A copy of the License is located at
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * or in the "license" file accompanying this file. This file is distributed
 * on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either
 * express or implied. See the License for the specific language governing
 * permissions and limitations under the License.
 */
Object.defineProperty(exports, "__esModule", { value: true });
exports.Control = void 0;
const ArrayUtils_1 = require("../utils/ArrayUtils");
class Control {
    constructor(id) {
        this.id = id;
    }
    /**
     * Determines if the value is ready for use by other parts of the skill.
     *
     * @param input Input object.
     * @returns `true` if the Control or one of its children can take the initiative, false otherwise.
     */
    async isReady(input) {
        return !(await this.canTakeInitiative(input));
    }
    /**
     * Gets the Control's state as an object that is serializable.
     *
     * Only durable state should be included and the object should be serializable with a
     * straightforward application of `JSON.stringify(object)`.
     *
     * Default:
     *  `{return this.state;}`
     *
     * Usage:
     *  * The default is sufficient for Controls that use the `.state` variable and only store simple data.
     *    * Non-simple data includes functions, and objects with functions, as these will not survive the round trip.
     *    * Other non-simple data include types with non-enumerable properties.
     *  * It is safe to pass the actual state object as the framework guarantees to not mutate it.
     *  * Functions that operate on the Control's state should be defined as members of the Control
     *
     * Framework behavior:
     *  * The framework serializes the data use a simple application of `JSON.stringify`.
     *  * On the subsequent turn the control tree is re-established and the state objects
     *    are re-attached to each Control via `control.setSerializableState(serializedState)`.
     *
     * @returns Serializable object defining the state of the Control
     */
    getSerializableState() {
        return this.state;
    }
    /**
     * Sets the state from a serialized state object
     *
     * Default:
     * `{this.state = serializedState;}`
     *
     * Usage:
     *  * It is safe to use serializedState without copying as the framework guarantees to not mutate it.
     *
     * Framework behavior:
     *  * After the control tree is re-established, the state objects
     *    are re-attached to each Control via `control.setSerializableState(serializedState)`.
     *
     * @param serializedState Serializable object defining the state of the Control
     */
    setSerializableState(serializedState) {
        this.state = serializedState;
    }
    /**
     * Add response content for a system act produced by this control.
     *
     * This is intended to be used with the default ControlManager.render() which implements a
     * simple concatenation strategy to form a complete response from multiple result items.
     *
     * @param act
     * @param context
     */
    renderAct(act, input, responseBuilder) {
        // The default is to let the act render itself
        return act.render(input, responseBuilder);
    }
    // TODO: remove and/or create a new class... class UnhandledActError extends Error.
    throwUnhandledActError(act) {
        throw new Error(`No NLG for ${act}`);
    }
    /**
     * Produce prompt for an act.
     * @param act Act.
     * @param propValue Constant or function producing String or List-of-Strings
     * @param input The input object
     */
    evaluatePromptProp(act, propValue, input) {
        const stringOrList = (typeof propValue === 'function') ? propValue.call(this, act, input) : propValue;
        if (typeof stringOrList === 'string') {
            return stringOrList;
        }
        return ArrayUtils_1.randomlyPick(stringOrList);
    }
    /**
     * Produce prompt for an act.
     * @param propValue Constant or function producing boolean
     * @param input The input object
     */
    evaluateBooleanProp(propValue, input) {
        return (typeof propValue === 'function') ? propValue.call(this, input) : propValue;
    }
}
exports.Control = Control;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiQ29udHJvbC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9jb250cm9scy9Db250cm9sLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQTs7Ozs7Ozs7Ozs7R0FXRzs7O0FBS0gsb0RBQW1EO0FBeUJuRCxNQUFzQixPQUFPO0lBSXpCLFlBQVksRUFBVTtRQUNsQixJQUFJLENBQUMsRUFBRSxHQUFHLEVBQUUsQ0FBQztJQUNqQixDQUFDO0lBbUVEOzs7OztPQUtHO0lBQ0gsS0FBSyxDQUFDLE9BQU8sQ0FBQyxLQUFtQjtRQUM3QixPQUFPLENBQUMsQ0FBQyxNQUFNLElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDO0lBQ2xELENBQUM7SUFFRDs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztPQXNCRztJQUNJLG9CQUFvQjtRQUN2QixPQUFPLElBQUksQ0FBQyxLQUFLLENBQUM7SUFDdEIsQ0FBQztJQUVEOzs7Ozs7Ozs7Ozs7OztPQWNHO0lBQ0ksb0JBQW9CLENBQUMsZUFBb0I7UUFDNUMsSUFBSSxDQUFDLEtBQUssR0FBRyxlQUFlLENBQUM7SUFDakMsQ0FBQztJQUVEOzs7Ozs7OztPQVFHO0lBQ0gsU0FBUyxDQUFDLEdBQWMsRUFBRSxLQUFtQixFQUFFLGVBQXVDO1FBQ2xGLDhDQUE4QztRQUM5QyxPQUFPLEdBQUcsQ0FBQyxNQUFNLENBQUMsS0FBSyxFQUFFLGVBQWUsQ0FBQyxDQUFDO0lBQzlDLENBQUM7SUFFRCxtRkFBbUY7SUFDbkYsc0JBQXNCLENBQUMsR0FBYztRQUNqQyxNQUFNLElBQUksS0FBSyxDQUFDLGNBQWMsR0FBRyxFQUFFLENBQUMsQ0FBQztJQUN6QyxDQUFDO0lBR0Q7Ozs7O09BS0c7SUFDSCxrQkFBa0IsQ0FBQyxHQUFjLEVBQUUsU0FBZ0YsRUFBRSxLQUFtQjtRQUNwSSxNQUFNLFlBQVksR0FBRyxDQUFDLE9BQU8sU0FBUyxLQUFLLFVBQVUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxTQUFTLENBQUMsSUFBSSxDQUFDLElBQUksRUFBRSxHQUFHLEVBQUUsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLFNBQVMsQ0FBQztRQUN0RyxJQUFJLE9BQU8sWUFBWSxLQUFLLFFBQVEsRUFBRTtZQUNsQyxPQUFPLFlBQVksQ0FBQztTQUN2QjtRQUNELE9BQU8seUJBQVksQ0FBUyxZQUFZLENBQUMsQ0FBQztJQUM5QyxDQUFDO0lBRUQ7Ozs7T0FJRztJQUNILG1CQUFtQixDQUFDLFNBQXVELEVBQUUsS0FBbUI7UUFDNUYsT0FBTyxDQUFDLE9BQU8sU0FBUyxLQUFLLFVBQVUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxTQUFTLENBQUMsSUFBSSxDQUFDLElBQUksRUFBRSxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsU0FBUyxDQUFDO0lBQ3ZGLENBQUM7Q0FDSjtBQTNLRCwwQkEyS0MiLCJzb3VyY2VzQ29udGVudCI6WyIvKlxuICogQ29weXJpZ2h0IDIwMTkgQW1hem9uLmNvbSwgSW5jLiBvciBpdHMgYWZmaWxpYXRlcy4gQWxsIFJpZ2h0cyBSZXNlcnZlZC5cbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIikuXG4gKiBZb3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBBIGNvcHkgb2YgdGhlIExpY2Vuc2UgaXMgbG9jYXRlZCBhdFxuICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBvciBpbiB0aGUgXCJsaWNlbnNlXCIgZmlsZSBhY2NvbXBhbnlpbmcgdGhpcyBmaWxlLiBUaGlzIGZpbGUgaXMgZGlzdHJpYnV0ZWRcbiAqIG9uIGFuIFwiQVMgSVNcIiBCQVNJUywgV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlclxuICogZXhwcmVzcyBvciBpbXBsaWVkLiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmdcbiAqIHBlcm1pc3Npb25zIGFuZCBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuXG5cbmltcG9ydCB7IENvbnRyb2xSZXNwb25zZUJ1aWxkZXIgfSBmcm9tICcuLi9yZXNwb25zZUdlbmVyYXRpb24vQ29udHJvbFJlc3BvbnNlQnVpbGRlcic7XG5pbXBvcnQgeyBTeXN0ZW1BY3QgfSBmcm9tICcuLi9zeXN0ZW1BY3RzL1N5c3RlbUFjdCc7XG5pbXBvcnQgeyByYW5kb21seVBpY2sgfSBmcm9tICcuLi91dGlscy9BcnJheVV0aWxzJztcbmltcG9ydCB7IFN0cmluZ09yTGlzdCB9IGZyb20gJy4uL3V0aWxzL0Jhc2ljVHlwZXMnO1xuaW1wb3J0IHsgQ29udHJvbElucHV0IH0gZnJvbSAnLi9Db250cm9sSW5wdXQnO1xuaW1wb3J0IHsgQ29udHJvbFJlc3VsdEJ1aWxkZXIgfSBmcm9tICcuL0NvbnRyb2xSZXN1bHQnO1xuaW1wb3J0IHsgSUNvbnRyb2wgfSBmcm9tICcuL2ludGVyZmFjZXMvSUNvbnRyb2wnO1xuXG5leHBvcnQgaW50ZXJmYWNlIENvbnRyb2xQcm9wcyB7XG4gICAgaWQ6IHN0cmluZztcbn1cblxuZXhwb3J0IGludGVyZmFjZSBDb250cm9sU3RhdGUge1xuICAgIC8qKlxuICAgICAqIFRoZSBwdWJsaWMgdmFsdWUgb2YgdGhpcyBjb250cm9sLlxuICAgICAqXG4gICAgICogVGhlIHZhbHVlIGlzIG5vdCBuZWNlc3NhcmlseSB2YWxpZCBvciBjb25maXJtZWQuIENvbnN1bWVycyBzaG91bGRcbiAgICAgKiBjYWxsIGBjb250cm9sLmlzUmVhZHkoKWAgdG8gZGV0ZXJtaW5lIGlmIHRoZSB2YWx1ZSBpcyByZWFkeSBmb3IgdXNlLlxuICAgICAqXG4gICAgICogVXNhZ2U6XG4gICAgICogLSBDb250cm9scyBzaG91bGQgZW5zdXJlIHRoYXQgdGhlaXIgYHZhbHVlYCBpcyB1cC10by1kYXRlIGFmdGVyIGV2ZXJ5IGNhbGxcbiAgICAgKiB0byBgY29udHJvbC5oYW5kbGUoKWAuIFBhcmVudCBjb250cm9scyBzaG91bGQgZ2F0aGVyIHRoZSB2YWx1ZXMgZnJvbVxuICAgICAqIHRoZWlyIGNoaWxkcmVuIGFuZCBtYWtlIHRoZW0gYXZhaWxhYmxlIGFzIGEgUE9KTyBpbiBgLnN0YXRlLnZhbHVlYC5cbiAgICAgKi9cbiAgICB2YWx1ZT86IGFueTtcbn1cblxuZXhwb3J0IGFic3RyYWN0IGNsYXNzIENvbnRyb2wgaW1wbGVtZW50cyBJQ29udHJvbCB7XG4gICAgcmVhZG9ubHkgaWQ6IHN0cmluZztcbiAgICBzdGF0ZTogQ29udHJvbFN0YXRlO1xuXG4gICAgY29uc3RydWN0b3IoaWQ6IHN0cmluZykge1xuICAgICAgICB0aGlzLmlkID0gaWQ7XG4gICAgfVxuXG5cbiAgICAvKipcbiAgICAgKiBEZXRlcm1pbmVzIGlmIHRoZSBDb250cm9sIG9yIG9uZSBvZiBpdHMgY2hpbGRyZW4gY2FuIGNvbnN1bWUgdGhlIHJlcXVlc3QgZGVzY3JpYmVkIGJ5IHRoZSBpbnB1dCBvYmplY3RcbiAgICAgKlxuICAgICAqIFVzYWdlOlxuICAgICAqICogVGhlIGhhbmRsaW5nIG9mIGEgcmVxdWVzdCBjYW4gYW5kIHNob3VsZCBiZSBjb250ZXh0dWFsLiBUaGF0IGlzLCBhIGNvbnRyb2wgc2hvdWxkIG9ubHkgcmV0dXJuXG4gICAgICogYGNhbkhhbmRsZSA9IHRydWVgIGlmIHRoZSByZXF1ZXN0IG1ha2VzIHNlbnNlIGZvciB0aGUgY3VycmVudCBzdGF0ZSBvZiB0aGUgY29udHJvbC5cbiAgICAgKlxuICAgICAqICogQSBAc2VlIENvbnRhaW5lckNvbnRyb2wgc2hvdWxkIHJldHVybiB0cnVlIGlmIG9uZSBvciBtb3JlIG9mIGl0cyBjaGlsZHJlbiByZXR1cm5zIGBjYW5IYW5kbGUgPSB0cnVlYC4gVGh1c1xuICAgICAqIHRoZSByb290IG9mIGEgQ29udHJvbCB0cmVlIHNob3VsZCByZXR1cm4gYGNhbkhhbmRsZSA9IHRydWVgIHVubGVzcyB0aGUgcmVxdWVzdCBjYW5ub3QgYmUgbWVhbmluZ2Z1bGx5IGNvbnN1bWVkXG4gICAgICogYnkgYW55IENvbnRyb2wgaW4gdGhlIHRyZWUuXG4gICAgICpcbiAgICAgKiAqIFRoZSBpbXBsZW1lbnRhdGlvbiBzaG91bGQgYmUgZGV0ZXJtaW5pc3RpYyBhbmQgZWZmZWN0aXZlbHkgbWVtb3J5bGVzcy4gaS5lLiBubyBzdGF0ZSBjaGFuZ2VzIHNob3VsZCBiZSBtYWRlIHRoYXQgd291bGRcbiAgICAgKiBiZSBleHBvc2VkIGJ5IGBnZXRTZXJpYWxpemFibGVTdGF0ZSgpYC5cbiAgICAgKlxuICAgICAqIEBwYXJhbSBpbnB1dCBJbnB1dCBvYmplY3QuIGBpbnB1dC5yZXF1ZXN0YCBjb250YWlucyB0aGUgcmVxdWVzdCB0byBiZSBoYW5kbGVkLlxuICAgICAqIEByZXR1cm5zIGB0cnVlYCBpZiB0aGUgQ29udHJvbCBvciBvbmUgb2YgaXRzIGNoaWxkcmVuIGNhbiBjb25zdW1lIHRoZSBlbnRpcmUgcmVxdWVzdCwgYGZhbHNlYCBvdGhlcndpc2UuXG4gICAgICovXG4gICAgYWJzdHJhY3QgY2FuSGFuZGxlKGlucHV0OiBDb250cm9sSW5wdXQpOiBib29sZWFuIHwgUHJvbWlzZTxib29sZWFuPjtcblxuXG4gICAgLyoqXG4gICAgICogSGFuZGxlcyB0aGUgcmVxdWVzdCBkZXNjcmliZWQgYnkgdGhlIGlucHV0IG9iamVjdC5cbiAgICAgKlxuICAgICAqIEhhbmRsaW5nIGEgcmVxdWVzdCBpbnZvbHZlcyBvcmNoZXN0cmF0aW5nIHN0YXRlIGNoYW5nZXMgdG8gdGhlIENvbnRyb2wgKGFuZCBpdHMgY2hpbGRyZW4pIGFuZCBhZGRpbmcgcmVzcG9uc2VcbiAgICAgKiBpdGVtcyB0byB0aGUgQ29udHJvbFJlc3VsdEJ1aWxkZXIuXG4gICAgICpcbiAgICAgKiBAcGFyYW0gaW5wdXQgSW5wdXQgb2JqZWN0LiBgaW5wdXQucmVxdWVzdGAgY29udGFpbnMgdGhlIHJlcXVlc3QgdG8gYmUgaGFuZGxlZC5cbiAgICAgKiBAcGFyYW0gcmVzdWx0QnVpbGRlciBSZXN1bHRCdWlsZGVyLiBDb2xsZWN0IGBTeXN0ZW1BY3RzYCB0aGF0IHJlcHJlc2VudCB0aGUgc3lzdGVtIG91dHB1dC5cbiAgICAgKi9cbiAgICBhYnN0cmFjdCBoYW5kbGUoaW5wdXQ6IENvbnRyb2xJbnB1dCwgcmVzdWx0QnVpbGRlcjogQ29udHJvbFJlc3VsdEJ1aWxkZXIpOiB2b2lkIHwgUHJvbWlzZTx2b2lkPjtcblxuICAgIC8qKlxuICAgICAqIERldGVybWluZXMgaWYgdGhlIENvbnRyb2wgY2FuIHRha2UgdGhlIGluaXRpYXRpdmUuXG4gICAgICpcbiAgICAgKiBUYWtpbmcgaW5pdGlhdGl2ZSBjYW4gYW5kIHNob3VsZCBiZSBjb250ZXh0dWFsLCBpLmUuIEEgY29udHJvbCBzaG91bGQgb25seSByZXR1cm5cbiAgICAgKiBgY2FuVGFrZUluaXRpYXRpdmUgPSB0cnVlYCBpZiB0aGUgY29udHJvbCwgaW4gaXRzIGN1cnJlbnQgc3RhdGUsIGhhcyBzb21ldGhpbmcgaW1wb3J0YW50IHRvIGFzayBvZiB0aGUgdXNlci5cbiAgICAgKlxuICAgICAqIEZyYW1ld29yayBiZWhhdmlvcjpcbiAgICAgKiAqIFRoZSBpbml0aWF0aXZlIHBoYXNlIHJ1bnMgaWYgdGhlIGhhbmRsaW5nIHBoYXNlIGRpZCBub3QgcHJvZHVjZSBhIHJlc3BvbnNlSXRlbSB0aGF0IGhhcyBgLnRha2VzSW5pdGlhdGl2ZSA9IHRydWVgLlxuICAgICAqXG4gICAgICogVXNhZ2U6XG4gICAgICogKiBBIEBzZWUgQ29udGFpbmVyQ29udHJvbCBzaG91bGQgcmV0dXJuIHRydWUgaWYgb25lIG9yIG1vcmUgb2YgaXRzIGNoaWxkcmVuIHJldHVybnMgYGNhblRha2VJbml0aWF0aXZlID0gdHJ1ZWAuIFRodXNcbiAgICAgKiAgIHRoZSByb290IG9mIGEgQ29udHJvbCB0cmVlIHNob3VsZCByZXR1cm4gYGNhblRha2VJbml0aWF0aXZlID0gdHJ1ZWAgdW5sZXNzIHRoZXJlIGlzIG5vIGNvbnRyb2wgaW4gdGhlIGVudGlyZSB0cmVlXG4gICAgICogICB0aGF0IGNhbiB0YWtlIHRoZSBpbml0aWF0aXZlLlxuICAgICAqXG4gICAgICogKiBUaGUgaW1wbGVtZW50YXRpb24gc2hvdWxkIGJlIGRldGVybWluaXN0aWMgYW5kIGVmZmVjdGl2ZWx5IG1lbW9yeWxlc3MuIGkuZS4gbm8gc3RhdGUgY2hhbmdlcyBzaG91bGQgYmUgbWFkZSB0aGF0IHdvdWxkXG4gICAgICogYmUgZXhwb3NlZCBieSBgZ2V0U2VyaWFsaXphYmxlU3RhdGUoKWAuXG4gICAgICpcbiAgICAgKiBAcGFyYW0gaW5wdXQgSW5wdXQgb2JqZWN0LlxuICAgICAqIEByZXR1cm5zIGB0cnVlYCBpZiB0aGUgQ29udHJvbCBvciBvbmUgb2YgaXRzIGNoaWxkcmVuIGNhbiB0YWtlIHRoZSBpbml0aWF0aXZlLCBgZmFsc2VgIG90aGVyd2lzZS5cbiAgICAgKi9cbiAgICBhYnN0cmFjdCBjYW5UYWtlSW5pdGlhdGl2ZShpbnB1dDogQ29udHJvbElucHV0KTogYm9vbGVhbiB8IFByb21pc2U8Ym9vbGVhbj47XG5cbiAgICAvKipcbiAgICAgKiBUYWtlcyBpbml0aWF0aXZlIGJ5IGFkZGluZyBhbiBJbml0aWF0aXZlQWN0IHRvIHRoZSByZXN1bHQuXG4gICAgICpcbiAgICAgKiBGcmFtZXdvcmsgYmVoYXZpb3I6XG4gICAgICogKiBUaGUgaW5pdGlhdGl2ZSBwaGFzZSBydW5zIGlmIHRoZSBoYW5kbGluZyBwaGFzZSBkaWQgbm90IHByb2R1Y2UgYSByZXNwb25zZUl0ZW0gdGhhdCBoYXMgYC50YWtlc0luaXRpYXRpdmUgPSB0cnVlYC5cbiAgICAgKlxuICAgICAqIEBwYXJhbSBpbnB1dCBJbnB1dCBvYmplY3QuXG4gICAgICogQHBhcmFtIHJlc3VsdEJ1aWxkZXIgUmVzdWx0QnVpbGRlci4gQ29sbGVjdCBgU3lzdGVtQWN0c2AgdGhhdCByZXByZXNlbnQgdGhlIHN5c3RlbSBvdXRwdXQuXG4gICAgICovXG4gICAgYWJzdHJhY3QgdGFrZUluaXRpYXRpdmUoaW5wdXQ6IENvbnRyb2xJbnB1dCwgcmVzdWx0QnVpbGRlcjogQ29udHJvbFJlc3VsdEJ1aWxkZXIpOiB2b2lkIHwgUHJvbWlzZTx2b2lkPjtcblxuICAgIC8qKlxuICAgICAqIERldGVybWluZXMgaWYgdGhlIHZhbHVlIGlzIHJlYWR5IGZvciB1c2UgYnkgb3RoZXIgcGFydHMgb2YgdGhlIHNraWxsLlxuICAgICAqXG4gICAgICogQHBhcmFtIGlucHV0IElucHV0IG9iamVjdC5cbiAgICAgKiBAcmV0dXJucyBgdHJ1ZWAgaWYgdGhlIENvbnRyb2wgb3Igb25lIG9mIGl0cyBjaGlsZHJlbiBjYW4gdGFrZSB0aGUgaW5pdGlhdGl2ZSwgZmFsc2Ugb3RoZXJ3aXNlLlxuICAgICAqL1xuICAgIGFzeW5jIGlzUmVhZHkoaW5wdXQ6IENvbnRyb2xJbnB1dCk6IFByb21pc2U8Ym9vbGVhbj4ge1xuICAgICAgICByZXR1cm4gIShhd2FpdCB0aGlzLmNhblRha2VJbml0aWF0aXZlKGlucHV0KSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogR2V0cyB0aGUgQ29udHJvbCdzIHN0YXRlIGFzIGFuIG9iamVjdCB0aGF0IGlzIHNlcmlhbGl6YWJsZS5cbiAgICAgKlxuICAgICAqIE9ubHkgZHVyYWJsZSBzdGF0ZSBzaG91bGQgYmUgaW5jbHVkZWQgYW5kIHRoZSBvYmplY3Qgc2hvdWxkIGJlIHNlcmlhbGl6YWJsZSB3aXRoIGFcbiAgICAgKiBzdHJhaWdodGZvcndhcmQgYXBwbGljYXRpb24gb2YgYEpTT04uc3RyaW5naWZ5KG9iamVjdClgLlxuICAgICAqXG4gICAgICogRGVmYXVsdDpcbiAgICAgKiAgYHtyZXR1cm4gdGhpcy5zdGF0ZTt9YFxuICAgICAqXG4gICAgICogVXNhZ2U6XG4gICAgICogICogVGhlIGRlZmF1bHQgaXMgc3VmZmljaWVudCBmb3IgQ29udHJvbHMgdGhhdCB1c2UgdGhlIGAuc3RhdGVgIHZhcmlhYmxlIGFuZCBvbmx5IHN0b3JlIHNpbXBsZSBkYXRhLlxuICAgICAqICAgICogTm9uLXNpbXBsZSBkYXRhIGluY2x1ZGVzIGZ1bmN0aW9ucywgYW5kIG9iamVjdHMgd2l0aCBmdW5jdGlvbnMsIGFzIHRoZXNlIHdpbGwgbm90IHN1cnZpdmUgdGhlIHJvdW5kIHRyaXAuXG4gICAgICogICAgKiBPdGhlciBub24tc2ltcGxlIGRhdGEgaW5jbHVkZSB0eXBlcyB3aXRoIG5vbi1lbnVtZXJhYmxlIHByb3BlcnRpZXMuXG4gICAgICogICogSXQgaXMgc2FmZSB0byBwYXNzIHRoZSBhY3R1YWwgc3RhdGUgb2JqZWN0IGFzIHRoZSBmcmFtZXdvcmsgZ3VhcmFudGVlcyB0byBub3QgbXV0YXRlIGl0LlxuICAgICAqICAqIEZ1bmN0aW9ucyB0aGF0IG9wZXJhdGUgb24gdGhlIENvbnRyb2wncyBzdGF0ZSBzaG91bGQgYmUgZGVmaW5lZCBhcyBtZW1iZXJzIG9mIHRoZSBDb250cm9sXG4gICAgICpcbiAgICAgKiBGcmFtZXdvcmsgYmVoYXZpb3I6XG4gICAgICogICogVGhlIGZyYW1ld29yayBzZXJpYWxpemVzIHRoZSBkYXRhIHVzZSBhIHNpbXBsZSBhcHBsaWNhdGlvbiBvZiBgSlNPTi5zdHJpbmdpZnlgLlxuICAgICAqICAqIE9uIHRoZSBzdWJzZXF1ZW50IHR1cm4gdGhlIGNvbnRyb2wgdHJlZSBpcyByZS1lc3RhYmxpc2hlZCBhbmQgdGhlIHN0YXRlIG9iamVjdHNcbiAgICAgKiAgICBhcmUgcmUtYXR0YWNoZWQgdG8gZWFjaCBDb250cm9sIHZpYSBgY29udHJvbC5zZXRTZXJpYWxpemFibGVTdGF0ZShzZXJpYWxpemVkU3RhdGUpYC5cbiAgICAgKlxuICAgICAqIEByZXR1cm5zIFNlcmlhbGl6YWJsZSBvYmplY3QgZGVmaW5pbmcgdGhlIHN0YXRlIG9mIHRoZSBDb250cm9sXG4gICAgICovXG4gICAgcHVibGljIGdldFNlcmlhbGl6YWJsZVN0YXRlKCk6IGFueSB7XG4gICAgICAgIHJldHVybiB0aGlzLnN0YXRlO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFNldHMgdGhlIHN0YXRlIGZyb20gYSBzZXJpYWxpemVkIHN0YXRlIG9iamVjdFxuICAgICAqXG4gICAgICogRGVmYXVsdDpcbiAgICAgKiBge3RoaXMuc3RhdGUgPSBzZXJpYWxpemVkU3RhdGU7fWBcbiAgICAgKlxuICAgICAqIFVzYWdlOlxuICAgICAqICAqIEl0IGlzIHNhZmUgdG8gdXNlIHNlcmlhbGl6ZWRTdGF0ZSB3aXRob3V0IGNvcHlpbmcgYXMgdGhlIGZyYW1ld29yayBndWFyYW50ZWVzIHRvIG5vdCBtdXRhdGUgaXQuXG4gICAgICpcbiAgICAgKiBGcmFtZXdvcmsgYmVoYXZpb3I6XG4gICAgICogICogQWZ0ZXIgdGhlIGNvbnRyb2wgdHJlZSBpcyByZS1lc3RhYmxpc2hlZCwgdGhlIHN0YXRlIG9iamVjdHNcbiAgICAgKiAgICBhcmUgcmUtYXR0YWNoZWQgdG8gZWFjaCBDb250cm9sIHZpYSBgY29udHJvbC5zZXRTZXJpYWxpemFibGVTdGF0ZShzZXJpYWxpemVkU3RhdGUpYC5cbiAgICAgKlxuICAgICAqIEBwYXJhbSBzZXJpYWxpemVkU3RhdGUgU2VyaWFsaXphYmxlIG9iamVjdCBkZWZpbmluZyB0aGUgc3RhdGUgb2YgdGhlIENvbnRyb2xcbiAgICAgKi9cbiAgICBwdWJsaWMgc2V0U2VyaWFsaXphYmxlU3RhdGUoc2VyaWFsaXplZFN0YXRlOiBhbnkpOiB2b2lkIHtcbiAgICAgICAgdGhpcy5zdGF0ZSA9IHNlcmlhbGl6ZWRTdGF0ZTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBBZGQgcmVzcG9uc2UgY29udGVudCBmb3IgYSBzeXN0ZW0gYWN0IHByb2R1Y2VkIGJ5IHRoaXMgY29udHJvbC5cbiAgICAgKlxuICAgICAqIFRoaXMgaXMgaW50ZW5kZWQgdG8gYmUgdXNlZCB3aXRoIHRoZSBkZWZhdWx0IENvbnRyb2xNYW5hZ2VyLnJlbmRlcigpIHdoaWNoIGltcGxlbWVudHMgYVxuICAgICAqIHNpbXBsZSBjb25jYXRlbmF0aW9uIHN0cmF0ZWd5IHRvIGZvcm0gYSBjb21wbGV0ZSByZXNwb25zZSBmcm9tIG11bHRpcGxlIHJlc3VsdCBpdGVtcy5cbiAgICAgKlxuICAgICAqIEBwYXJhbSBhY3RcbiAgICAgKiBAcGFyYW0gY29udGV4dFxuICAgICAqL1xuICAgIHJlbmRlckFjdChhY3Q6IFN5c3RlbUFjdCwgaW5wdXQ6IENvbnRyb2xJbnB1dCwgcmVzcG9uc2VCdWlsZGVyOiBDb250cm9sUmVzcG9uc2VCdWlsZGVyKTogdm9pZCB7XG4gICAgICAgIC8vIFRoZSBkZWZhdWx0IGlzIHRvIGxldCB0aGUgYWN0IHJlbmRlciBpdHNlbGZcbiAgICAgICAgcmV0dXJuIGFjdC5yZW5kZXIoaW5wdXQsIHJlc3BvbnNlQnVpbGRlcik7XG4gICAgfVxuXG4gICAgLy8gVE9ETzogcmVtb3ZlIGFuZC9vciBjcmVhdGUgYSBuZXcgY2xhc3MuLi4gY2xhc3MgVW5oYW5kbGVkQWN0RXJyb3IgZXh0ZW5kcyBFcnJvci5cbiAgICB0aHJvd1VuaGFuZGxlZEFjdEVycm9yKGFjdDogU3lzdGVtQWN0KTogbmV2ZXIge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYE5vIE5MRyBmb3IgJHthY3R9YCk7XG4gICAgfVxuXG5cbiAgICAvKipcbiAgICAgKiBQcm9kdWNlIHByb21wdCBmb3IgYW4gYWN0LlxuICAgICAqIEBwYXJhbSBhY3QgQWN0LlxuICAgICAqIEBwYXJhbSBwcm9wVmFsdWUgQ29uc3RhbnQgb3IgZnVuY3Rpb24gcHJvZHVjaW5nIFN0cmluZyBvciBMaXN0LW9mLVN0cmluZ3NcbiAgICAgKiBAcGFyYW0gaW5wdXQgVGhlIGlucHV0IG9iamVjdFxuICAgICAqL1xuICAgIGV2YWx1YXRlUHJvbXB0UHJvcChhY3Q6IFN5c3RlbUFjdCwgcHJvcFZhbHVlOiBTdHJpbmdPckxpc3QgfCAoKGFjdDogYW55LCBpbnB1dDogQ29udHJvbElucHV0KSA9PiBzdHJpbmcgfCBzdHJpbmdbXSksIGlucHV0OiBDb250cm9sSW5wdXQpOiBzdHJpbmcge1xuICAgICAgICBjb25zdCBzdHJpbmdPckxpc3QgPSAodHlwZW9mIHByb3BWYWx1ZSA9PT0gJ2Z1bmN0aW9uJykgPyBwcm9wVmFsdWUuY2FsbCh0aGlzLCBhY3QsIGlucHV0KSA6IHByb3BWYWx1ZTtcbiAgICAgICAgaWYgKHR5cGVvZiBzdHJpbmdPckxpc3QgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgICByZXR1cm4gc3RyaW5nT3JMaXN0O1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiByYW5kb21seVBpY2s8c3RyaW5nPihzdHJpbmdPckxpc3QpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFByb2R1Y2UgcHJvbXB0IGZvciBhbiBhY3QuXG4gICAgICogQHBhcmFtIHByb3BWYWx1ZSBDb25zdGFudCBvciBmdW5jdGlvbiBwcm9kdWNpbmcgYm9vbGVhblxuICAgICAqIEBwYXJhbSBpbnB1dCBUaGUgaW5wdXQgb2JqZWN0XG4gICAgICovXG4gICAgZXZhbHVhdGVCb29sZWFuUHJvcChwcm9wVmFsdWU6IGJvb2xlYW4gfCAoKGlucHV0OiBDb250cm9sSW5wdXQpID0+IGJvb2xlYW4pLCBpbnB1dDogQ29udHJvbElucHV0KTogYm9vbGVhbiB7XG4gICAgICAgIHJldHVybiAodHlwZW9mIHByb3BWYWx1ZSA9PT0gJ2Z1bmN0aW9uJykgPyBwcm9wVmFsdWUuY2FsbCh0aGlzLCBpbnB1dCkgOiBwcm9wVmFsdWU7XG4gICAgfVxufVxuIl19