"use strict";
/*
 * Copyright 2019 Amazon.com, Inc. or its affiliates. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License").
 * You may not use this file except in compliance with the License.
 * A copy of the License is located at
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * or in the "license" file accompanying this file. This file is distributed
 * on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either
 * express or implied. See the License for the specific language governing
 * permissions and limitations under the License.
 */
Object.defineProperty(exports, "__esModule", { value: true });
exports.DateRangeControl = exports.DateRangeChangedAct = exports.DateRangeSetAct = exports.DateControlTarget = exports.TargetCategory = exports.DateRangeControlState = exports.DateRangeControlValidations = void 0;
const tslib_1 = require("tslib");
const lodash_1 = tslib_1.__importDefault(require("lodash"));
const i18next_1 = tslib_1.__importDefault(require("i18next"));
const ContentActs_1 = require("../../systemActs/ContentActs");
const ConjunctionControlIntent_1 = require("../../intents/ConjunctionControlIntent");
const DateRangeControlIntent_1 = require("../../intents/DateRangeControlIntent");
const GeneralControlIntent_1 = require("../../intents/GeneralControlIntent");
const DateHelper_1 = require("./DateHelper");
const InitiativeActs_1 = require("../../systemActs/InitiativeActs");
const DateRangeNLUHelper_1 = require("./DateRangeNLUHelper");
const Predicates_1 = require("../../utils/Predicates");
const ModelTypes_1 = require("../../interactionModelGeneration/ModelTypes");
const ContainerControl_1 = require("../../controls/ContainerControl");
const DateControl_1 = require("../DateControl");
const SingleValueControlIntent_1 = require("../../intents/SingleValueControlIntent");
const AmazonBuiltInSlotType_1 = require("../../intents/AmazonBuiltInSlotType");
const Logger_1 = require("../../logging/Logger");
const __1 = require("../..");
const DateControlIntent_1 = require("../../intents/DateControlIntent");
const Strings_1 = require("../../constants/Strings");
const log = new Logger_1.Logger('AskSdkControls:DateRangeControl');
var DateRangeControlValidations;
(function (DateRangeControlValidations) {
    DateRangeControlValidations.START_BEFORE_END = (state, input) => {
        const startDate = DateHelper_1.alexaDateFormatToDate(state.startDate);
        const endDate = DateHelper_1.alexaDateFormatToDate(state.endDate);
        if (startDate > endDate) {
            return { reasonCode: 'startBeforeEnd', renderedReason: i18next_1.default.t('DATE_RANGE_CONTROL_DEFAULT_PROMPT_VALIDATION_FAIL_START_AFTER_END') };
        }
        return true;
    };
})(DateRangeControlValidations = exports.DateRangeControlValidations || (exports.DateRangeControlValidations = {}));
class DateRangeControlState extends ContainerControl_1.ContainerControlState {
    constructor() {
        super(...arguments);
        this.openQuestion = false;
        this.onFocus = true;
    }
}
exports.DateRangeControlState = DateRangeControlState;
var TargetCategory;
(function (TargetCategory) {
    TargetCategory["StartDate"] = "startDate";
    TargetCategory["EndDate"] = "endDate";
    TargetCategory["Both"] = "both";
    TargetCategory["Neither"] = "neither";
    TargetCategory["Either"] = "either";
})(TargetCategory = exports.TargetCategory || (exports.TargetCategory = {}));
var DateControlTarget;
(function (DateControlTarget) {
    DateControlTarget["StartDate"] = "startDate";
    DateControlTarget["EndDate"] = "endDate";
})(DateControlTarget = exports.DateControlTarget || (exports.DateControlTarget = {}));
class DateRangeSetAct extends ContentActs_1.ContentAct {
    constructor(control, start, end) {
        super(control);
        this.startDate = start;
        this.endDate = end;
    }
    render(input, responseBuilder) {
        throw new Error('This is not intended to be called. Rendering is controlled by the Control itself.');
    }
}
exports.DateRangeSetAct = DateRangeSetAct;
class DateRangeChangedAct extends ContentActs_1.ContentAct {
    constructor(control, start, end, priorStart, priorEnd) {
        super(control);
        this.startDate = start;
        this.priorStartDate = priorStart;
        this.endDate = end;
        this.priorEndDate = priorEnd;
    }
    render(input, responseBuilder) {
        throw new Error('This is not intended to be called. Rendering is controlled by the Control itself.');
    }
}
exports.DateRangeChangedAct = DateRangeChangedAct;
class DateRangeControl extends ContainerControl_1.ContainerControl {
    constructor(props) {
        super(props);
        this.state = new DateRangeControlState();
        this.props = DateRangeControl.mergeWithDefaultProps(props);
        this.startDateControl = new DateControl_1.DateControl({
            id: `${this.props.id}_startDate`,
            interactionModel: {
                targets: this.props.interactionModel.targets.startDate
            },
            prompts: this.props.prompts.startDate,
            validation: this.props.validation.startDateValid,
            required: this.props.required,
        });
        this.endDateControl = new DateControl_1.DateControl({
            id: `${this.props.id}_endDate`,
            interactionModel: {
                targets: this.props.interactionModel.targets.endDate
            },
            prompts: this.props.prompts.endDate,
            validation: this.props.validation.endDateValid,
            required: this.props.required,
        });
        this.addChild(this.startDateControl)
            .addChild(this.endDateControl);
    }
    static mergeWithDefaultProps(props) {
        const defaults = {
            id: 'uninitialized',
            validation: {
                startDateValid: [],
                endDateValid: [],
                rangeValid: []
            },
            required: true,
            interactionModel: {
                targets: {
                    startDate: ['startDate', 'date', Strings_1.Strings.Target.It],
                    endDate: ['endDate', 'date', Strings_1.Strings.Target.It],
                    self: ['date', 'dateRange', Strings_1.Strings.Target.It]
                },
                actions: {
                    set: [Strings_1.Strings.Action.Set],
                    change: [Strings_1.Strings.Action.Change]
                },
            },
            // TODO: review all default prompts
            prompts: {
                startDate: {
                    confirmValue: (act) => i18next_1.default.t('DATE_RANGE_CONTROL_DEFAULT_PROMPT_CONFIRM_START_DATE', { value: act.payload.value }),
                    valueAffirmed: i18next_1.default.t('DATE_RANGE_CONTROL_DEFAULT_PROMPT_START_DATE_AFFIRMED'),
                    valueDisaffirmed: i18next_1.default.t('DATE_RANGE_CONTROL_DEFAULT_PROMPT_START_DATE_DISAFFIRMED'),
                    valueSet: (act) => i18next_1.default.t('DATE_RANGE_CONTROL_DEFAULT_PROMPT_START_DATE_SET', { value: act.payload.value }),
                    valueChanged: (act) => i18next_1.default.t('DATE_RANGE_CONTROL_DEFAULT_PROMPT_START_DATE_CHANGED', { value: act.payload.value }),
                    invalidValue: (act) => {
                        if (act.payload.renderedReason !== undefined) {
                            return i18next_1.default.t('DATE_RANGE_CONTROL_DEFAULT_PROMPT_INVALID_START_WITH_REASON', { reason: act.payload.renderedReason });
                        }
                        return i18next_1.default.t('DATE_RANGE_CONTROL_DEFAULT_PROMPT_GENERAL_INVALID_DATE');
                    },
                    requestValue: i18next_1.default.t('DATE_RANGE_CONTROL_DEFAULT_PROMPT_REQUEST_START_DATE'),
                    requestChangedValue: i18next_1.default.t('DATE_RANGE_CONTROL_DEFAULT_PROMPT_REQUEST_CHANGED_START_DATE'),
                },
                endDate: {
                    confirmValue: (act) => i18next_1.default.t('DATE_RANGE_CONTROL_DEFAULT_PROMPT_CONFIRM_END_DATE', { value: act.payload.value }),
                    valueAffirmed: i18next_1.default.t('DATE_RANGE_CONTROL_DEFAULT_PROMPT_END_DATE_AFFIRMED'),
                    valueDisaffirmed: i18next_1.default.t('DATE_RANGE_CONTROL_DEFAULT_PROMPT_END_DATE_DISAFFIRMED'),
                    valueSet: (act) => i18next_1.default.t('DATE_RANGE_CONTROL_DEFAULT_PROMPT_END_DATE_SET', { value: act.payload.value }),
                    valueChanged: (act) => i18next_1.default.t('DATE_RANGE_CONTROL_DEFAULT_PROMPT_END_DATE_CHANGED', { value: act.payload.value }),
                    invalidValue: (act) => {
                        if (act.payload.renderedReason !== undefined) {
                            return i18next_1.default.t('DATE_RANGE_CONTROL_DEFAULT_PROMPT_INVALID_END_WITH_REASON', { reason: act.payload.renderedReason });
                        }
                        return i18next_1.default.t('DATE_RANGE_CONTROL_DEFAULT_PROMPT_GENERAL_INVALID_DATE');
                    },
                    requestValue: i18next_1.default.t('DATE_RANGE_CONTROL_DEFAULT_PROMPT_REQUEST_END_DATE'),
                    requestChangedValue: i18next_1.default.t('DATE_RANGE_CONTROL_DEFAULT_PROMPT_REQUEST_CHANGED_END_DATE'),
                },
                requestRange: (act) => i18next_1.default.t('DATE_RANGE_CONTROL_DEFAULT_PROMPT_REQUEST_RANGE'),
                rangeSet: (act) => i18next_1.default.t('DATE_RANGE_CONTROL_DEFAULT_PROMPT_RANGE_SET', { start: act.startDate, end: act.endDate }),
                rangeChanged: (act) => i18next_1.default.t('DATE_RANGE_CONTROL_DEFAULT_PROMPT_RANGE_CHANGED', { start: act.startDate, end: act.endDate }),
                invalidRange: (act) => {
                    if (act.payload.renderedReason !== undefined) {
                        return i18next_1.default.t('DATE_RANGE_CONTROL_DEFAULT_PROMPT_INVALID_RANGE_WITH_REASON', { reason: act.payload.renderedReason });
                    }
                    return i18next_1.default.t('DATE_RANGE_CONTROL_DEFAULT_PROMPT_GENERAL_INVALID_RANGE');
                }
            },
            reprompts: {
                startDate: {
                    confirmValue: (act) => i18next_1.default.t('DATE_RANGE_CONTROL_DEFAULT_REPROMPT_CONFIRM_START_DATE', { value: act.payload.value }),
                    valueAffirmed: i18next_1.default.t('DATE_RANGE_CONTROL_DEFAULT_REPROMPT_START_DATE_AFFIRMED'),
                    valueDisaffirmed: i18next_1.default.t('DATE_RANGE_CONTROL_DEFAULT_REPROMPT_START_DATE_DISAFFIRMED'),
                    valueSet: (act) => i18next_1.default.t('DATE_RANGE_CONTROL_DEFAULT_REPROMPT_START_DATE_SET', { value: act.payload.value }),
                    valueChanged: (act) => i18next_1.default.t('DATE_RANGE_CONTROL_DEFAULT_REPROMPT_START_DATE_CHANGED', { value: act.payload.value }),
                    invalidValue: (act) => {
                        if (act.payload.reasonCode !== undefined) {
                            return i18next_1.default.t('DATE_RANGE_CONTROL_DEFAULT_REPROMPT_INVALID_START_WITH_REASON', { reason: act.payload.reasonCode });
                        }
                        return i18next_1.default.t('DATE_RANGE_CONTROL_DEFAULT_REPROMPT_GENERAL_INVALID_DATE');
                    },
                    requestValue: i18next_1.default.t('DATE_RANGE_CONTROL_DEFAULT_REPROMPT_REQUEST_START_DATE'),
                    requestChangedValue: i18next_1.default.t('DATE_RANGE_CONTROL_DEFAULT_REPROMPT_REQUEST_CHANGED_START_DATE'),
                },
                endDate: {
                    confirmValue: (act) => i18next_1.default.t('DATE_RANGE_CONTROL_DEFAULT_REPROMPT_CONFIRM_END_DATE', { value: act.payload.value }),
                    valueAffirmed: i18next_1.default.t('DATE_RANGE_CONTROL_DEFAULT_REPROMPT_END_DATE_AFFIRMED'),
                    valueDisaffirmed: i18next_1.default.t('DATE_RANGE_CONTROL_DEFAULT_REPROMPT_END_DATE_DISAFFIRMED'),
                    valueSet: (act) => i18next_1.default.t('DATE_RANGE_CONTROL_DEFAULT_REPROMPT_END_DATE_SET', { value: act.payload.value }),
                    valueChanged: (act) => i18next_1.default.t('DATE_RANGE_CONTROL_DEFAULT_REPROMPT_END_DATE_CHANGED', { value: act.payload.value }),
                    invalidValue: (act) => {
                        if (act.payload.reasonCode !== undefined) {
                            return i18next_1.default.t('DATE_RANGE_CONTROL_DEFAULT_REPROMPT_INVALID_END_WITH_REASON', { reason: act.payload.reasonCode });
                        }
                        return i18next_1.default.t('DATE_RANGE_CONTROL_DEFAULT_REPROMPT_GENERAL_INVALID_DATE');
                    },
                    requestValue: i18next_1.default.t('DATE_RANGE_CONTROL_DEFAULT_REPROMPT_REQUEST_END_DATE'),
                    requestChangedValue: i18next_1.default.t('DATE_RANGE_CONTROL_DEFAULT_REPROMPT_REQUEST_CHANGED_END_DATE'),
                },
                requestRange: (act) => i18next_1.default.t('DATE_RANGE_CONTROL_DEFAULT_REPROMPT_REQUEST_RANGE'),
                rangeSet: (act) => i18next_1.default.t('DATE_RANGE_CONTROL_DEFAULT_REPROMPT_RANGE_SET', { start: act.startDate, end: act.endDate }),
                rangeChanged: (act) => i18next_1.default.t('DATE_RANGE_CONTROL_DEFAULT_REPROMPT_RANGE_CHANGED', { start: act.startDate, end: act.endDate }),
                invalidRange: (act) => {
                    if (act.payload.reasonCode !== undefined) {
                        return i18next_1.default.t('DATE_RANGE_CONTROL_DEFAULT_REPROMPT_INVALID_RANGE_WITH_REASON', { reason: act.payload.reasonCode });
                    }
                    return i18next_1.default.t('DATE_RANGE_CONTROL_DEFAULT_REPROMPT_GENERAL_INVALID_RANGE');
                }
            },
        };
        return lodash_1.default.mergeWith(defaults, props);
    }
    async canHandle(input) {
        return await this.canHandleForFocus(input) || this.canHandleForNoFocus(input);
    }
    async handle(input, resultBuilder) {
        log.debug(`DateRangeControl[${this.id}]: handle(). Entering`);
        // update the priorStartDate and priorEndDate before new operation
        this.updatePrior();
        // Calling handle function to make changes to state values
        if (this.handleFunc) {
            return this.handleFunc(input, resultBuilder);
        }
        // If can't handle by DateRangeControl itself, let children handle it and update state values
        await this.handleByChild(input, resultBuilder);
        const newStartDate = this.getStartDateFromChild();
        const newEndDate = this.getEndDateFromChild();
        this.setStartDate(newStartDate);
        this.setEndDate(newEndDate);
        this.state.onFocus = false;
        // After child handle the request and child has no question
        // ask DateRangeControl whether the value is ready
        if (!resultBuilder.hasInitiativeAct() && await this.canTakeInitiative(input)) {
            if (this.takeInitiativeFunc !== undefined) {
                this.takeInitiativeFunc(input, resultBuilder);
            }
        }
    }
    updateInteractionModel(generator, imData) {
        generator.addControlIntent(new GeneralControlIntent_1.GeneralControlIntent(), imData);
        generator.addControlIntent(new DateControlIntent_1.DateControlIntent(), imData);
        generator.addControlIntent(new ConjunctionControlIntent_1.ConjunctionControlIntent(), imData);
        generator.addControlIntent(new DateRangeControlIntent_1.DateRangeControlIntent(), imData);
        if (this.props.interactionModel.targets.self.includes('date')) {
            generator.addValuesToSlotType(ModelTypes_1.SharedSlotType.TARGET, i18next_1.default.t('DATE_CONTROL_DEFAULT_SLOT_VALUES_TARGET_DATE', { returnObjects: true }));
        }
        if (this.props.interactionModel.targets.self.includes('dateRange')) {
            generator.addValuesToSlotType(ModelTypes_1.SharedSlotType.TARGET, i18next_1.default.t('DATE_RANGE_CONTROL_DEFAULT_SLOT_VALUES_TARGET_DATE_RANGE', { returnObjects: true }));
        }
        if (this.props.interactionModel.targets.startDate.includes('startDate')) {
            generator.addValuesToSlotType(ModelTypes_1.SharedSlotType.TARGET, i18next_1.default.t('DATE_RANGE_CONTROL_DEFAULT_SLOT_VALUES_TARGET_START_DATE', { returnObjects: true }));
        }
        if (this.props.interactionModel.targets.endDate.includes('endDate')) {
            generator.addValuesToSlotType(ModelTypes_1.SharedSlotType.TARGET, i18next_1.default.t('DATE_RANGE_CONTROL_DEFAULT_SLOT_VALUES_TARGET_END_DATE', { returnObjects: true }));
        }
    }
    getTargetIds() {
        return this.props.interactionModel.targets.self;
    }
    getStartDateFromChild() {
        return this.startDateControl.state.value;
    }
    getEndDateFromChild() {
        return this.endDateControl.state.value;
    }
    setStartDate(date) {
        this.startDateControl.state.value = date;
        this.state.startDate = date;
        // Clean open question once a value set
        this.state.openQuestion = false;
    }
    setEndDate(date) {
        this.endDateControl.state.value = date;
        this.state.endDate = date;
        // Clean open question once a value set
        this.state.openQuestion = false;
    }
    async canHandleForFocus(input) {
        try {
            Predicates_1.okIf(this.state.onFocus === true);
            // When the focus is on parent itself
            // give the parent priority to handle the request
            return this.isTwoValueInput(input)
                || this.isDateInterpretedAsDateRange(input)
                || this.isChangeBoth(input)
                || this.isChangeRange(input)
                || this.canHandleByChild(input);
        }
        catch (e) {
            return Predicates_1.falseIfGuardFailed(e);
        }
    }
    async canHandleForNoFocus(input) {
        try {
            Predicates_1.okIf(this.state.onFocus === false);
            // When the focus is on children
            // give children priority to handle the request
            return await this.canHandleByChild(input)
                || this.isTwoValueInput(input)
                || this.isDateInterpretedAsDateRange(input)
                || this.isChangeBoth(input)
                || this.isChangeRange(input);
        }
        catch (e) {
            return Predicates_1.falseIfGuardFailed(e);
        }
    }
    /**
     * Test if the input has both start date and end date provided
     * @param input
     */
    isTwoValueInput(input) {
        try {
            Predicates_1.okIf(__1.InputUtil.isIntent(input, DateRangeControlIntent_1.DateRangeControlIntent.name));
            const intent = input.request.intent;
            const unpackedSlots = DateRangeControlIntent_1.unpackDateRangeControlIntent(intent);
            if (unpackedSlots.target !== undefined) {
                Predicates_1.okIf(__1.InputUtil.targetIsMatchOrUndefined(unpackedSlots.target, this.props.interactionModel.targets.self));
            }
            else {
                Predicates_1.okIf(__1.InputUtil.targetIsMatchOrUndefined(unpackedSlots["target.a"], this.props.interactionModel.targets.startDate) || __1.InputUtil.targetIsMatchOrUndefined(unpackedSlots["target.a"], this.props.interactionModel.targets.endDate));
                Predicates_1.okIf(__1.InputUtil.targetIsMatchOrUndefined(unpackedSlots["target.b"], this.props.interactionModel.targets.startDate) || __1.InputUtil.targetIsMatchOrUndefined(unpackedSlots["target.b"], this.props.interactionModel.targets.endDate));
            }
            const inputGroups = DateRangeNLUHelper_1.generateDatesInputGroups(this.props, unpackedSlots);
            for (const inputGroup of inputGroups) {
                Predicates_1.okIf(__1.InputUtil.valueStrDefined(inputGroup.value));
                Predicates_1.okIf(__1.InputUtil.actionIsSetOrUndefined(inputGroup.action, this.props.interactionModel.actions.set) || __1.InputUtil.actionIsMatch(inputGroup.action, this.props.interactionModel.actions.change));
                Predicates_1.okIf(inputGroup.target === TargetCategory.StartDate || inputGroup.target === TargetCategory.EndDate);
            }
            this.handleFunc = this.handleTwoValueInput;
            return true;
        }
        catch (e) {
            return Predicates_1.falseIfGuardFailed(e);
        }
    }
    handleTwoValueInput(input, resultBuilder) {
        const intent = input.request.intent;
        const unpackedSlots = DateRangeControlIntent_1.unpackDateRangeControlIntent(intent);
        const inputGroups = DateRangeNLUHelper_1.generateDatesInputGroups(this.props, unpackedSlots);
        for (const inputGroup of inputGroups) {
            if (inputGroup.target === TargetCategory.StartDate) {
                this.setStartDate(DateHelper_1.findEdgeDateOfDateRange(inputGroup.value, true));
            }
            else if (inputGroup.target === TargetCategory.EndDate) {
                this.setEndDate(DateHelper_1.findEdgeDateOfDateRange(inputGroup.value, false));
            }
        }
        this.ackDateRangeValueChanges(resultBuilder);
        if (this.wantsToCorrectRange(input)) {
            this.correctRange(input, resultBuilder);
        }
        this.state.onFocus = true;
    }
    /**
     * Determine whether the input single date value should be considered as date range
     *
     * The DateRangeControl will regard a single value input as date range when there's no clear target and
     * when the DateRangeControl itself is under focus
     * E.G. 'set range to 2018', where 2018 will be regarded as a range and both start date and end date will be set to 2018
     * @param input
     */
    isDateInterpretedAsDateRange(input) {
        try {
            Predicates_1.okIf(__1.InputUtil.isSingleValueControlIntent(input, AmazonBuiltInSlotType_1.AmazonBuiltInSlotType.DATE));
            const intent = input.request.intent;
            const unpackedSlots = SingleValueControlIntent_1.unpackSingleValueControlIntent(intent);
            Predicates_1.okIf(__1.InputUtil.targetIsMatchOrUndefined(unpackedSlots.target, this.props.interactionModel.targets.self));
            Predicates_1.okIf(__1.InputUtil.actionIsMatchOrUndefined(unpackedSlots.action, this.props.interactionModel.actions.set) || __1.InputUtil.actionIsMatchOrUndefined(unpackedSlots.action, this.props.interactionModel.actions.change));
            this.handleFunc = this.handleDateRangeInput;
            return true;
        }
        catch (e) {
            return Predicates_1.falseIfGuardFailed(e);
        }
    }
    handleDateRangeInput(input, resultBuilder) {
        const intent = input.request.intent;
        const { valueStr } = SingleValueControlIntent_1.unpackSingleValueControlIntent(intent);
        this.setStartDate(DateHelper_1.findEdgeDateOfDateRange(valueStr, true));
        this.setEndDate(DateHelper_1.findEdgeDateOfDateRange(valueStr, false));
        this.ackDateRangeValueChanges(resultBuilder);
        if (this.wantsToCorrectRange(input)) {
            this.correctRange(input, resultBuilder);
        }
        this.state.onFocus = true;
    }
    /**
     * Determine whether the input action is targeting both start date and end date
     *
     * E.G. 'Change start date and end date'
     * @param input
     */
    isChangeBoth(input) {
        try {
            Predicates_1.okIf(__1.InputUtil.isIntent(input, ConjunctionControlIntent_1.ConjunctionControlIntent.name));
            const intent = input.request.intent;
            const unpackedSlots = ConjunctionControlIntent_1.unpackConjunctionControlIntent(intent);
            Predicates_1.okIf(__1.InputUtil.feedbackIsMatchOrUndefined(unpackedSlots.feedback, [Strings_1.Strings.Feedback.Affirm, Strings_1.Strings.Feedback.Disaffirm]));
            const inputs = ConjunctionControlIntent_1.generateActionTaskPairs(unpackedSlots);
            for (const input of inputs) {
                Predicates_1.okIf(__1.InputUtil.targetIsMatchOrUndefined(input.target, this.props.interactionModel.targets.startDate) || __1.InputUtil.targetIsMatchOrUndefined(input.target, this.props.interactionModel.targets.endDate));
                Predicates_1.okIf(__1.InputUtil.actionIsSetOrUndefined(input.action, this.props.interactionModel.actions.set) || __1.InputUtil.actionIsMatch(input.action, this.props.interactionModel.actions.change));
            }
            this.handleFunc = this.handleChangeValue;
            return true;
        }
        catch (e) {
            return Predicates_1.falseIfGuardFailed(e);
        }
    }
    /**
     * Determine whether the input action is targeting date range
     *
     * E.G. 'Change', 'Change date'
     * @param input
     */
    isChangeRange(input) {
        try {
            Predicates_1.okIf(__1.InputUtil.isIntent(input, GeneralControlIntent_1.GeneralControlIntent.name));
            const intent = input.request.intent;
            const unpackedSlots = GeneralControlIntent_1.unpackGeneralControlIntent(intent);
            Predicates_1.okIf(__1.InputUtil.feedbackIsMatchOrUndefined(unpackedSlots.feedback, [Strings_1.Strings.Feedback.Affirm, Strings_1.Strings.Feedback.Disaffirm]));
            Predicates_1.okIf(__1.InputUtil.targetIsMatchOrUndefined(unpackedSlots.target, this.props.interactionModel.targets.self));
            this.handleFunc = this.handleChangeValue;
            return true;
        }
        catch (e) {
            return Predicates_1.falseIfGuardFailed(e);
        }
    }
    handleChangeValue(input, resultBuilder) {
        this.state.openQuestion = true;
        this.state.onFocus = true;
        resultBuilder.addAct(new InitiativeActs_1.RequestValueAct(this));
    }
    // Update priorEndDate & priorStartDate
    updatePrior() {
        this.state.priorEndDate = this.state.endDate;
        this.state.priorStartDate = this.state.startDate;
    }
    ackDateRangeValueChanges(resultBuilder) {
        // The DateRangeControl only ack date range changes
        // Only start date change or end date change will be handled by Child controls
        if (this.state.startDate !== undefined && this.state.endDate !== undefined && this.state.startDate !== this.state.priorStartDate && this.state.endDate !== this.state.priorEndDate) {
            // If it's the first time to set the value, DateRangeControl will send DateRangeSetAct
            // And when there's an old value exist, DateRangeControl will send DateRangeChangedAct
            this.state.priorStartDate !== undefined && this.state.priorEndDate !== undefined ?
                resultBuilder.addAct(new DateRangeChangedAct(this, this.state.startDate, this.state.endDate, this.state.priorStartDate, this.state.priorEndDate)) :
                resultBuilder.addAct(new DateRangeSetAct(this, this.state.startDate, this.state.endDate));
        }
    }
    validateDateRange(input) {
        const listOfValidationFunc = typeof (this.props.validation.rangeValid) === 'function' ? [this.props.validation.rangeValid] : this.props.validation.rangeValid;
        for (const validationFunction of listOfValidationFunc) {
            const validationResult = validationFunction(this.state, input);
            if (validationResult !== true) {
                log.debug(`DateRangeControl.validate(): validation failed. Reason: ${JSON.stringify(validationResult, null, 2)}.`);
                return validationResult;
            }
        }
        return true;
    }
    renderAct(act, input, builder) {
        if (act instanceof InitiativeActs_1.RequestValueAct) {
            builder.addPromptFragment(this.evaluatePromptProp(act, this.props.prompts.requestRange, input));
            builder.addRepromptFragment(this.evaluatePromptProp(act, this.props.reprompts.requestRange, input));
        }
        else if (act instanceof DateRangeSetAct) {
            builder.addPromptFragment(this.evaluatePromptProp(act, this.props.prompts.rangeSet, input));
            builder.addRepromptFragment(this.evaluatePromptProp(act, this.props.reprompts.rangeSet, input));
        }
        else if (act instanceof DateRangeChangedAct) {
            builder.addPromptFragment(this.evaluatePromptProp(act, this.props.prompts.rangeChanged, input));
            builder.addRepromptFragment(this.evaluatePromptProp(act, this.props.reprompts.rangeChanged, input));
        }
        else if (act instanceof ContentActs_1.InvalidValueAct) {
            builder.addPromptFragment(this.evaluatePromptProp(act, this.props.prompts.invalidRange, input));
            builder.addRepromptFragment(this.evaluatePromptProp(act, this.props.reprompts.invalidRange, input));
        }
        else {
            this.throwUnhandledActError(act);
        }
    }
    async canTakeInitiative(input) {
        return this.needsValue(input)
            || await this.canTakeInitiativeByChild(input)
            || this.hasOpenQuestion()
            || this.wantsToCorrectRange(input);
    }
    async takeInitiative(input, resultBuilder) {
        log.debug(`DateRangeControl[${this.id}]: takeInitiative(). Entering`);
        if (this.takeInitiativeFunc !== undefined) {
            this.takeInitiativeFunc(input, resultBuilder);
        }
    }
    needsValue(input) {
        try {
            Predicates_1.okIf(this.evaluateBooleanProp(this.props.required, input));
            Predicates_1.okIf(this.state.startDate === undefined && this.state.endDate === undefined);
            this.takeInitiativeFunc = this.requestDateRange;
            return true;
        }
        catch (e) {
            return Predicates_1.falseIfGuardFailed(e);
        }
    }
    requestDateRange(input, resultBuilder) {
        this.state.onFocus = true;
        resultBuilder.addAct(new InitiativeActs_1.RequestValueAct(this));
    }
    hasOpenQuestion() {
        try {
            Predicates_1.okIf(this.state.openQuestion === true);
            this.takeInitiativeFunc = this.requestDateRange;
            return true;
        }
        catch (e) {
            return Predicates_1.falseIfGuardFailed(e);
        }
    }
    wantsToCorrectRange(input) {
        try {
            // Only fix range when range is set and there's no open question
            Predicates_1.okIf(!this.needsValue(input) && !this.hasOpenQuestion());
            const rangeValidationResult = this.validateDateRange(input);
            Predicates_1.okIf(rangeValidationResult !== true);
            this.takeInitiativeFunc = this.correctRange;
            return true;
        }
        catch (e) {
            return Predicates_1.falseIfGuardFailed(e);
        }
    }
    correctRange(input, resultBuilder) {
        const rangeValidationResult = this.validateDateRange(input);
        this.state.onFocus = true;
        if (rangeValidationResult !== true) {
            const stateValue = i18next_1.default.t('DATE_RANGE_CONTROL_DEFAULT_STATE_VALUE_FOR_START_AND_END', { start: this.state.startDate, end: this.state.endDate });
            resultBuilder.addAct(new ContentActs_1.InvalidValueAct(this, { value: stateValue, reasonCode: rangeValidationResult.reasonCode, renderedReason: rangeValidationResult.renderedReason }));
            // if the range-validation failure is due to one date changing, only request that one
            if (this.state.startDate !== this.state.priorStartDate && this.state.endDate !== this.state.priorEndDate) {
                resultBuilder.addAct(new InitiativeActs_1.RequestValueAct(this));
            }
            else if (this.state.startDate !== this.state.priorStartDate) {
                resultBuilder.addAct(new InitiativeActs_1.RequestValueAct(this.startDateControl));
            }
            else {
                resultBuilder.addAct(new InitiativeActs_1.RequestValueAct(this.endDateControl));
            }
            return;
        }
    }
    async canTakeInitiativeByChild(input) {
        try {
            Predicates_1.okIf(await super.canTakeInitiativeByChild(input));
            this.state.onFocus = false;
            this.takeInitiativeFunc = this.takeInitiativeByChild;
            return true;
        }
        catch (e) {
            return Predicates_1.falseIfGuardFailed(e);
        }
    }
}
exports.DateRangeControl = DateRangeControl;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiRGF0ZVJhbmdlQ29udHJvbC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9jb21tb25Db250cm9scy9kYXRlUmFuZ2VDb250cm9sL0RhdGVSYW5nZUNvbnRyb2wudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBOzs7Ozs7Ozs7OztHQVdHOzs7O0FBSUgsNERBQXVCO0FBQ3ZCLDhEQUE4QjtBQUM5Qiw4REFBMkU7QUFDM0UscUZBQTBKO0FBQzFKLGlGQUE0RztBQUM1Ryw2RUFBc0c7QUFFdEcsNkNBQThFO0FBQzlFLG9FQUFrRTtBQUtsRSw2REFBNkY7QUFDN0YsdURBQWtFO0FBR2xFLDRFQUF3RjtBQUN4RixzRUFBaUg7QUFDakgsZ0RBQTZGO0FBQzdGLHFGQUF3RjtBQUN4RiwrRUFBNEU7QUFDNUUsaURBQThDO0FBQzlDLDZCQUFnRDtBQUVoRCx1RUFBb0U7QUFDcEUscURBQXVEO0FBS3ZELE1BQU0sR0FBRyxHQUFHLElBQUksZUFBTSxDQUFDLGlDQUFpQyxDQUFDLENBQUM7QUFrTjFELElBQWlCLDJCQUEyQixDQVMzQztBQVRELFdBQWlCLDJCQUEyQjtJQUMzQiw0Q0FBZ0IsR0FBZ0MsQ0FBQyxLQUE0QixFQUFFLEtBQW1CLEVBQTJCLEVBQUU7UUFDeEksTUFBTSxTQUFTLEdBQUcsa0NBQXFCLENBQUMsS0FBSyxDQUFDLFNBQVUsQ0FBQyxDQUFDO1FBQzFELE1BQU0sT0FBTyxHQUFHLGtDQUFxQixDQUFDLEtBQUssQ0FBQyxPQUFRLENBQUMsQ0FBQztRQUN0RCxJQUFJLFNBQVMsR0FBRyxPQUFPLEVBQUU7WUFDckIsT0FBTyxFQUFFLFVBQVUsRUFBRSxnQkFBZ0IsRUFBRSxjQUFjLEVBQUUsaUJBQU8sQ0FBQyxDQUFDLENBQUMsbUVBQW1FLENBQUMsRUFBRSxDQUFDO1NBQzNJO1FBQ0QsT0FBTyxJQUFJLENBQUM7SUFDaEIsQ0FBQyxDQUFDO0FBQ04sQ0FBQyxFQVRnQiwyQkFBMkIsR0FBM0IsbUNBQTJCLEtB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QUFDO1NBQ2Y7UUFDRCxPQUFPLENBQUMsRUFBRTtZQUFFLE9BQU8sK0JBQWtCLENBQUMsQ0FBQyxDQUFDLENBQUM7U0FBRTtJQUMvQyxDQUFDO0NBQ0o7QUEzaEJELDRDQTJoQkMiLCJzb3VyY2VzQ29udGVudCI6WyIvKlxuICogQ29weXJpZ2h0IDIwMTkgQW1hem9uLmNvbSwgSW5jLiBvciBpdHMgYWZmaWxpYXRlcy4gQWxsIFJpZ2h0cyBSZXNlcnZlZC5cbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIikuXG4gKiBZb3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBBIGNvcHkgb2YgdGhlIExpY2Vuc2UgaXMgbG9jYXRlZCBhdFxuICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBvciBpbiB0aGUgXCJsaWNlbnNlXCIgZmlsZSBhY2NvbXBhbnlpbmcgdGhpcyBmaWxlLiBUaGlzIGZpbGUgaXMgZGlzdHJpYnV0ZWRcbiAqIG9uIGFuIFwiQVMgSVNcIiBCQVNJUywgV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlclxuICogZXhwcmVzcyBvciBpbXBsaWVkLiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmdcbiAqIHBlcm1pc3Npb25zIGFuZCBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuXG5cbmltcG9ydCB7IEludGVudFJlcXVlc3QgfSBmcm9tIFwiYXNrLXNkay1tb2RlbFwiO1xuaW1wb3J0IF8gZnJvbSBcImxvZGFzaFwiO1xuaW1wb3J0IGkxOG5leHQgZnJvbSAnaTE4bmV4dCc7XG5pbXBvcnQgeyBJbnZhbGlkVmFsdWVBY3QsIENvbnRlbnRBY3QgfSBmcm9tIFwiLi4vLi4vc3lzdGVtQWN0cy9Db250ZW50QWN0c1wiO1xuaW1wb3J0IHsgQWN0aW9uQW5kVGFzaywgZ2VuZXJhdGVBY3Rpb25UYXNrUGFpcnMsIHVucGFja0Nvbmp1bmN0aW9uQ29udHJvbEludGVudCwgQ29uanVuY3Rpb25Db250cm9sSW50ZW50IH0gZnJvbSAnLi4vLi4vaW50ZW50cy9Db25qdW5jdGlvbkNvbnRyb2xJbnRlbnQnO1xuaW1wb3J0IHsgdW5wYWNrRGF0ZVJhbmdlQ29udHJvbEludGVudCwgRGF0ZVJhbmdlQ29udHJvbEludGVudCB9IGZyb20gJy4uLy4uL2ludGVudHMvRGF0ZVJhbmdlQ29udHJvbEludGVudCc7XG5pbXBvcnQgeyB1bnBhY2tHZW5lcmFsQ29udHJvbEludGVudCwgR2VuZXJhbENvbnRyb2xJbnRlbnQgfSBmcm9tICcuLi8uLi9pbnRlbnRzL0dlbmVyYWxDb250cm9sSW50ZW50JztcbmltcG9ydCB7IENvbnRyb2wgfSBmcm9tICcuLi8uLi9jb250cm9scy9Db250cm9sJztcbmltcG9ydCB7IGFsZXhhRGF0ZUZvcm1hdFRvRGF0ZSwgZmluZEVkZ2VEYXRlT2ZEYXRlUmFuZ2UgfSBmcm9tICcuL0RhdGVIZWxwZXInO1xuaW1wb3J0IHsgUmVxdWVzdFZhbHVlQWN0IH0gZnJvbSAnLi4vLi4vc3lzdGVtQWN0cy9Jbml0aWF0aXZlQWN0cyc7XG5pbXBvcnQgeyBTeXN0ZW1BY3QgfSBmcm9tICcuLi8uLi9zeXN0ZW1BY3RzL1N5c3RlbUFjdCc7XG5pbXBvcnQgeyBDb250cm9sSW5wdXQgfSBmcm9tICcuLi8uLi9jb250cm9scy9Db250cm9sSW5wdXQnO1xuaW1wb3J0IHsgQ29udHJvbFJlc3VsdEJ1aWxkZXIgfSBmcm9tICcuLi8uLi9jb250cm9scy9Db250cm9sUmVzdWx0JztcbmltcG9ydCB7IENvbnRyb2xSZXNwb25zZUJ1aWxkZXIgfSBmcm9tICcuLi8uLi9yZXNwb25zZUdlbmVyYXRpb24vQ29udHJvbFJlc3BvbnNlQnVpbGRlcic7XG5pbXBvcnQgeyBEYXRlUmFuZ2VDb250cm9sSW50ZW50SW5wdXQsIGdlbmVyYXRlRGF0ZXNJbnB1dEdyb3VwcyB9IGZyb20gJy4vRGF0ZVJhbmdlTkxVSGVscGVyJztcbmltcG9ydCB7IG9rSWYsIGZhbHNlSWZHdWFyZEZhaWxlZCB9IGZyb20gJy4uLy4uL3V0aWxzL1ByZWRpY2F0ZXMnO1xuaW1wb3J0IHsgQ29udHJvbEludGVyYWN0aW9uTW9kZWxHZW5lcmF0b3IgfSBmcm9tICcuLi8uLi9pbnRlcmFjdGlvbk1vZGVsR2VuZXJhdGlvbi9Db250cm9sSW50ZXJhY3Rpb25Nb2RlbEdlbmVyYXRvcic7XG5pbXBvcnQgeyBJbnRlcmFjdGlvbk1vZGVsQ29udHJpYnV0b3IgfSBmcm9tICcuLi8uLi9jb250cm9scy9taXhpbnMvSW50ZXJhY3Rpb25Nb2RlbENvbnRyaWJ1dG9yJztcbmltcG9ydCB7IE1vZGVsRGF0YSwgU2hhcmVkU2xvdFR5cGUgfSBmcm9tICcuLi8uLi9pbnRlcmFjdGlvbk1vZGVsR2VuZXJhdGlvbi9Nb2RlbFR5cGVzJztcbmltcG9ydCB7IENvbnRhaW5lckNvbnRyb2wsIENvbnRhaW5lckNvbnRyb2xQcm9wcywgQ29udGFpbmVyQ29udHJvbFN0YXRlIH0gZnJvbSAnLi4vLi4vY29udHJvbHMvQ29udGFpbmVyQ29udHJvbCc7XG5pbXBvcnQgeyBEYXRlQ29udHJvbCwgRGF0ZUNvbnRyb2xQcm9tcHRQcm9wcywgRGF0ZVZhbGlkYXRpb25GdW5jdGlvbiB9IGZyb20gJy4uL0RhdGVDb250cm9sJztcbmltcG9ydCB7IHVucGFja1NpbmdsZVZhbHVlQ29udHJvbEludGVudCB9IGZyb20gJy4uLy4uL2ludGVudHMvU2luZ2xlVmFsdWVDb250cm9sSW50ZW50JztcbmltcG9ydCB7IEFtYXpvbkJ1aWx0SW5TbG90VHlwZSB9IGZyb20gJy4uLy4uL2ludGVudHMvQW1hem9uQnVpbHRJblNsb3RUeXBlJztcbmltcG9ydCB7IExvZ2dlciB9IGZyb20gJy4uLy4uL2xvZ2dpbmcvTG9nZ2VyJztcbmltcG9ydCB7IFN0cmluZ09yTGlzdCwgSW5wdXRVdGlsIH0gZnJvbSAnLi4vLi4nO1xuaW1wb3J0IHsgRGVlcFJlcXVpcmVkIH0gZnJvbSAnLi4vLi4vdXRpbHMvRGVlcFJlcXVpcmVkJztcbmltcG9ydCB7IERhdGVDb250cm9sSW50ZW50IH0gZnJvbSAnLi4vLi4vaW50ZW50cy9EYXRlQ29udHJvbEludGVudCc7XG5pbXBvcnQgeyBTdHJpbmdzIGFzICQgfSBmcm9tICcuLi8uLi9jb25zdGFudHMvU3RyaW5ncyc7XG5pbXBvcnQgeyBWYWxpZGF0aW9uUmVzdWx0IH0gZnJvbSAnLi4vLi4vY29udHJvbHMvVmFsaWRhdGlvblJlc3VsdCc7XG5cblxuXG5jb25zdCBsb2cgPSBuZXcgTG9nZ2VyKCdBc2tTZGtDb250cm9sczpEYXRlUmFuZ2VDb250cm9sJyk7XG5cbmV4cG9ydCB0eXBlIERhdGVSYW5nZVZhbGlkYXRpb25GdW5jdGlvbiA9ICgoc3RhdGU6IERhdGVSYW5nZUNvbnRyb2xTdGF0ZSwgaW5wdXQ6IENvbnRyb2xJbnB1dCkgPT4gdHJ1ZSB8IFZhbGlkYXRpb25SZXN1bHQpO1xuXG5leHBvcnQgaW50ZXJmYWNlIERhdGVSYW5nZUNvbnRyb2xQcm9tcHRQcm9wcyB7XG4gICAgc3RhcnREYXRlPzogRGF0ZUNvbnRyb2xQcm9tcHRQcm9wcyxcbiAgICBlbmREYXRlPzogRGF0ZUNvbnRyb2xQcm9tcHRQcm9wcyxcbiAgICByZXF1ZXN0UmFuZ2U/OiBTdHJpbmdPckxpc3QgfCAoKGFjdDogUmVxdWVzdFZhbHVlQWN0LCBpbnB1dDogQ29udHJvbElucHV0KSA9PiBTdHJpbmdPckxpc3QpLFxuICAgIHJhbmdlU2V0PzogU3RyaW5nT3JMaXN0IHwgKChhY3Q6IERhdGVSYW5nZVNldEFjdCwgaW5wdXQ6IENvbnRyb2xJbnB1dCkgPT4gU3RyaW5nT3JMaXN0KTtcblxuICAgIHJhbmdlQ2hhbmdlZD86IFN0cmluZ09yTGlzdCB8ICgoYWN0OiBEYXRlUmFuZ2VDaGFuZ2VkQWN0LCBpbnB1dDogQ29udHJvbElucHV0KSA9PiBTdHJpbmdPckxpc3QpO1xuICAgIGludmFsaWRSYW5nZT86IFN0cmluZ09yTGlzdCB8ICgoYWN0OiBJbnZhbGlkVmFsdWVBY3Q8c3RyaW5nPiwgaW5wdXQ6IENvbnRyb2xJbnB1dCkgPT4gU3RyaW5nT3JMaXN0KSxcbn1cblxuZXhwb3J0IGludGVyZmFjZSBEYXRlUmFuZ2VDb250cm9sSW50ZXJhY3Rpb25Nb2RlbFByb3BzIHtcbiAgICAvKipcbiAgICAgKiBUYXJnZXQtc2xvdC12YWx1ZXMgYXNzb2NpYXRlZCB3aXRoIHRoaXMgQ29udHJvbC5cbiAgICAgKlxuICAgICAqIFVzYWdlOlxuICAgICAqICAqIFRoaXMgYWxsb3dzIHVzZXJzIHRvIHJlZmVyIHRvIGEgY29udHJvbC5cbiAgICAgKiAgKiBBIGNvbnRyb2wgY2FuIGJlIGFzc29jaWF0ZWQgd2l0aCBtYW55IHRhcmdldC1zbG90LXZhbHVlcywgZWcgWydkYXRlJywgJ3N0YXJ0RGF0ZScsICdldmVudFN0YXJ0RGF0ZScsICd2YWNhdGlvblN0YXJ0J11cbiAgICAgKiAgKiBJdCBpcyBhIGdvb2QgaWRlYSB0byBhc3NvY2lhdGUgd2l0aCBnZW5lcmFsIHRhcmdldHMgKGUuZy4gZGF0ZSkgYW5kIHNwZWNpZmljIHRhcmdldHMgKGUuZy4gdmFjYXRpb25TdGFydCkgc28gdGhhdCB0aGVcbiAgICAgKiAgICB1c2VyIGNhbiBzYXkgZWl0aGVyIGdlbmVyYWwgb3Igc3BlY2lmaWMgdGhpbmdzLiAgZS5nLiAnY2hhbmdlIHRoZSBkYXRlIHRvIFR1ZXNkYXknLCBvciAnSSB3YW50IG15IHZhY2F0aW9uIHRvIHN0YXJ0IG9uIFR1ZXNkYXknLlxuICAgICAqICAqIFRoZSBhc3NvY2lhdGlvbiBkb2VzIG5vdCBoYXZlIHRvIGJlIGV4Y2x1c2l2ZSwgYW5kIGdlbmVyYWwgdGFyZ2V0IHNsb3QgdmFsdWVzIHdpbGwgb2Z0ZW4gYmUgYXNzb2NpYXRlZCB3aXRoIG1hbnkgY29udHJvbHMuXG4gICAgICogICAgSW4gc2l0dWF0aW9ucyB3aGVyZSB0aGVyZSBpcyBhbWJpZ3VpdHkgYWJvdXQgd2hhdCB0aGUgdXNlciBpcyByZWZlcnJpbmcgdG8sIHRoZSBwYXJlbnQgY29udHJvbHNcbiAgICAgKiAgICBtdXN0IHJlc29sdmUgdGhlIGNvbmZ1c2lvbi5cbiAgICAgKlxuICAgICAqL1xuICAgIHRhcmdldHM/OiBEYXRlUmFuZ2VDb250cm9sVGFyZ2V0UHJvcHM7XG5cbiAgICAvKipcbiAgICAgKiBBY3Rpb24tc2xvdC12YWx1ZXMgYXNzb2NpYXRlZCB0byB0aGUgY2FwYWJpbGl0aWVzIG9mIHRoaXMgQ29udHJvbC5cbiAgICAgKlxuICAgICAqIFVzYWdlOlxuICAgICAqICAqIFRoaXMgYWxsb3dzIHVzZXJzIHRvIHJlZmVyIHRvIGFuIGFjdGlvbiB1c2luZyBtb3JlIGRvbWFpbi1hcHByb3ByaWF0ZSB3b3Jkcy4gRm9yIGV4YW1wbGUsIGEgdXNlciBtaWdodFxuICAgICAqICAgIGxpa2UgdG8gc2F5ICdzaG93IHR3byBpdGVtcycgcmF0aGVyIHRoYXQgJ3NldCBpdGVtIGNvdW50IHRvIHR3bycuICBUbyBhY2hpZXZlIHRoaXMsIGFzc29jaWF0ZSB0aGVcbiAgICAgKiAgICBzbG90IHZhbHVlICdzaG93JyB0byB0aGUgJ3NldCcgY2FwYWJpbGl0eSBsaWtlIHNvOlxuICAgICAqXG4gICAgICogYGBgdHNcbiAgICAgKiBhY3Rpb25zOiB7XG4gICAgICogICAgc2V0OiBbJ3NldCcsICdzaG93J11cbiAgICAgKiB9XG4gICAgICogYGBgXG4gICAgICovXG4gICAgYWN0aW9ucz86IERhdGVSYW5nZUNvbnRyb2xBY3Rpb25Qcm9wcztcbn1cblxuZXhwb3J0IHR5cGUgRGF0ZVJhbmdlQ29udHJvbFRhcmdldFByb3BzID0ge1xuXG4gICAgLyoqXG4gICAgICogVGFyZ2V0cyB0aGUgdXNlciBjYW4gdXNlIHRvIHJlZmVyIHRvIHRoZSAnZGF0ZSByYW5nZScgaW4gZ2VuZXJhbC5cbiAgICAgKlxuICAgICAqIEVhY2ggaWRlbnRpZmVyIGlzIGFuIGBpZGAgZm9yIGEgdmFsdWUgb2YgdGhlIGBUYXJnZXRgIHNsb3QgaW4gdGhlIGludGVyYWN0aW9uIG1vZGVsLlxuICAgICAqXG4gICAgICogRm9yIGV4YW1wbGUsIGEgY29udHJvbCBtYXkgaGF2ZSBhIHRhcmdldCBvZiAndXNlcm5hbWUnIGFuZCBhbiBhc3NvY2lhdGVkIGVudHJ5IGluIHRoZVxuICAgICAqIGludGVyYWN0aW9uIG1vZGVsIHN1Y2ggYXM6XG4gICAgICogYGBgXG4gICAgICogbmV3IERhdGVSYW5nZUNvbnRyb2woXG4gICAgICogICAge1xuICAgICAqICAgICAgaW50ZXJhY3Rpb25Nb2RlbDoge1xuICAgICAqICAgICAgICAgIHRhcmdldHM6IFsnZXZlbnREYXRlcyddICAgPC0tLS0tLS0tLS0gUmVmZXJlbmNlIHRvIHNsb3QgSURcbiAgICAgKiAgICAgIH1cbiAgICAgKiAgICAgIC4uLlxuICAgICAqICAgIH1cbiAgICAgKiAgICk7XG4gICAgICpcbiAgICAgKiAtLS1cbiAgICAgKlxuICAgICAqIEludGVyYWN0aW9uTW9kZWwgKGVuLVVTLmpzb24pOlxuICAgICAqIC4uLlxuICAgICAqICAgICAgdHlwZXM6IFtcbiAgICAgKiAgICAgICAgICAgICAge1xuICAgICAqICAgICAgICAgICAgICAgbmFtZTogXCJ0YXJnZXRcIixcbiAgICAgKiAgICAgICAgICAgICAgIHZhbHVlczogW1xuICAgICAqICAgICAgICAgICAgICAgICB7XG4gICAgICogICAgICAgICAgICAgICAgICAgaWQ6IFwiZXZlbnREYXRlc1wiLCAgICAgICAgPC0tLS0tLSAgIElEIHJlZmVyZW5jZWQgYnkgdGhlIGNvbnRyb2xcbiAgICAgKiAgICAgICAgICAgICAgICAgICBuYW1lOiB7XG4gICAgICogICAgICAgICAgICAgICAgICAgICB2YWx1ZTogXCJldmVudERhdGVzXCIsXG4gICAgICogICAgICAgICAgICAgICAgICAgICBzeW5vbnltczogW1xuICAgICAqICAgICAgICAgICAgICAgICAgICAgICBcIkV2ZW50IGRhdGVzXCIsXG4gICAgICogICAgICAgICAgICAgICAgICAgICAgIFwidGhlIGV2ZW50IGRhdGVzXCIsXG4gICAgICogICAgICAgICAgICAgICAgICAgICAgIFwibXkgZXZlbnQgZGF0ZXNcIixcbiAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgLi4uXG4gICAgICogfVxuICAgICAqIGBgYFxuICAgICAqL1xuICAgIHNlbGY/OiBzdHJpbmdbXVxuXG4gICAgLyoqXG4gICAgICogVGFyZ2V0cyB0aGUgdXNlciBjYW4gdXNlIHRvIHJlZmVyIHRvIHRoZSBgc3RhcnQgZGF0ZWAgaW4gaXNvbGF0aW9uLlxuICAgICAqXG4gICAgICogRWFjaCBpZGVudGlmZXIgaXMgYW4gYGlkYCBmb3IgYSB2YWx1ZSBvZiB0aGUgYFRhcmdldGAgc2xvdCBpbiB0aGUgaW50ZXJhY3Rpb24gbW9kZWwuXG4gICAgICpcbiAgICAgKiBGb3IgZXhhbXBsZSwgYSBjb250cm9sIG1heSBoYXZlIGEgdGFyZ2V0IG9mICdldmVudFN0YXJ0RGF0ZScgYW5kIGFuIGFzc29jaWF0ZWQgZW50cnkgaW4gdGhlXG4gICAgICogaW50ZXJhY3Rpb24gbW9kZWwgc3VjaCBhczpcbiAgICAgKiBgYGBcbiAgICAgKiBuZXcgRGF0ZVJhbmdlQ29udHJvbChcbiAgICAgKiAgICB7XG4gICAgICogICAgICBpbnRlcmFjdGlvbk1vZGVsOiB7XG4gICAgICogICAgICAgICAgdGFyZ2V0czogWydldmVudFN0YXJ0RGF0ZSddLCAgICAgICAgPC0tLS0tLSAgIFJlZmVyZW5jZSB0byBzbG90IElEXG4gICAgICogICAgICAgICAgLi4uXG4gICAgICogICAgICB9XG4gICAgICogICAgfVxuICAgICAqICAgKTtcbiAgICAgKlxuICAgICAqIC0tLVxuICAgICAqXG4gICAgICogSW50ZXJhY3Rpb25Nb2RlbCAoZW4tVVMuanNvbik6XG4gICAgICogLi4uXG4gICAgICogICAgICB0eXBlczogW1xuICAgICAqICAgICAgICAgICAgICB7XG4gICAgICogICAgICAgICAgICAgICBuYW1lOiBcInRhcmdldFwiLFxuICAgICAqICAgICAgICAgICAgICAgdmFsdWVzOiBbXG4gICAgICogICAgICAgICAgICAgICAgIHtcbiAgICAgKiAgICAgICAgICAgICAgICAgICBpZDogXCJldmVudFN0YXJ0RGF0ZVwiLCAgICAgICAgPC0tLS0tLSAgIElEIHJlZmVyZW5jZWQgYnkgdGhlIGNvbnRyb2xcbiAgICAgKiAgICAgICAgICAgICAgICAgICBuYW1lOiB7XG4gICAgICogICAgICAgICAgICAgICAgICAgICB2YWx1ZTogXCJldmVudFN0YXJ0RGF0ZVwiLFxuICAgICAqICAgICAgICAgICAgICAgICAgICAgc3lub255bXM6IFtcbiAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgXCJldmVudCBzdGFydCBkYXRlXCIsXG4gICAgICogICAgICAgICAgICAgICAgICAgICAgIFwiZXZlbnQgc3RhcnRcIixcbiAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgXCJzdGFydCBvZiBldmVudFwiLFxuICAgICAqICAgICAgICAgICAgICAgICAgICAgICAuLi5cbiAgICAgKiB9XG4gICAgICogYGBgXG4gICAgICovXG4gICAgc3RhcnREYXRlPzogc3RyaW5nW10sXG5cbiAgICAvKipcbiAgICAgKiBUYXJnZXRzIHRoZSB1c2VyIGNhbiB1c2UgdG8gcmVmZXIgdG8gdGhlIGBlbmQgZGF0ZWAgaW4gaXNvbGF0aW9uLlxuICAgICAqXG4gICAgICogRWFjaCBpZGVudGlmZXIgaXMgYW4gYGlkYCBmb3IgYSB2YWx1ZSBvZiB0aGUgYFRhcmdldGAgc2xvdCBpbiB0aGUgaW50ZXJhY3Rpb24gbW9kZWwuXG4gICAgICpcbiAgICAgKiBGb3IgZXhhbXBsZSwgYSBjb250cm9sIG1heSBoYXZlIGEgdGFyZ2V0IG9mICdldmVudEVuZERhdGUnIGFuZCBhbiBhc3NvY2lhdGVkIGVudHJ5IGluIHRoZVxuICAgICAqIGludGVyYWN0aW9uIG1vZGVsIHN1Y2ggYXM6XG4gICAgICogYGBgXG4gICAgICogbmV3IERhdGVSYW5nZUNvbnRyb2woXG4gICAgICogICAge1xuICAgICAqICAgICAgaW50ZXJhY3Rpb25Nb2RlbDoge1xuICAgICAqICAgICAgICAgIHRhcmdldHM6IFsnZXZlbnRFbmREYXRlJ10sICAgICAgICA8LS0tLS0tICAgUmVmZXJlbmNlIHRvIHNsb3QgSURcbiAgICAgKiAgICAgICAgICAuLi5cbiAgICAgKiAgICAgIH1cbiAgICAgKiAgICB9XG4gICAgICogICApO1xuICAgICAqXG4gICAgICogLS0tXG4gICAgICpcbiAgICAgKiBJbnRlcmFjdGlvbk1vZGVsIChlbi1VUy5qc29uKTpcbiAgICAgKiAuLi5cbiAgICAgKiAgICAgIHR5cGVzOiBbXG4gICAgICogICAgICAgICAgICAgIHtcbiAgICAgKiAgICAgICAgICAgICAgIG5hbWU6IFwidGFyZ2V0XCIsXG4gICAgICogICAgICAgICAgICAgICB2YWx1ZXM6IFtcbiAgICAgKiAgICAgICAgICAgICAgICAge1xuICAgICAqICAgICAgICAgICAgICAgICAgIGlkOiBcImV2ZW50RW5kRGF0ZVwiLCAgICAgICAgPC0tLS0tLSAgIElEIHJlZmVyZW5jZWQgYnkgdGhlIGNvbnRyb2xcbiAgICAgKiAgICAgICAgICAgICAgICAgICBuYW1lOiB7XG4gICAgICogICAgICAgICAgICAgICAgICAgICB2YWx1ZTogXCJldmVudFN0YXJ0RGF0ZVwiLFxuICAgICAqICAgICAgICAgICAgICAgICAgICAgc3lub255bXM6IFtcbiAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgXCJldmVudCBlbmQgZGF0ZVwiLFxuICAgICAqICAgICAgICAgICAgICAgICAgICAgICBcImV2ZW50IGVuZFwiLFxuICAgICAqICAgICAgICAgICAgICAgICAgICAgICBcImVuZCBvZiBldmVudFwiLFxuICAgICAqICAgICAgICAgICAgICAgICAgICAgICAuLi5cbiAgICAgKiB9XG4gICAgICogYGBgXG4gICAgICovXG4gICAgZW5kRGF0ZT86IHN0cmluZ1tdLFxufTtcblxuZXhwb3J0IGludGVyZmFjZSBEYXRlUmFuZ2VDb250cm9sUHJvcHMgZXh0ZW5kcyBDb250YWluZXJDb250cm9sUHJvcHMge1xuICAgIGlkOiBzdHJpbmc7XG5cbiAgICBwcm9tcHRzPzogRGF0ZVJhbmdlQ29udHJvbFByb21wdFByb3BzO1xuXG4gICAgcmVwcm9tcHRzPzogRGF0ZVJhbmdlQ29udHJvbFByb21wdFByb3BzO1xuXG4gICAgaW50ZXJhY3Rpb25Nb2RlbD86IERhdGVSYW5nZUNvbnRyb2xJbnRlcmFjdGlvbk1vZGVsUHJvcHM7XG4gICAgXG4gICAgLyoqXG4gICAgICogRGV0ZXJtaW5lcyBpZiB0aGUgdmFsdWUgaXMgdmFsaWQuXG4gICAgICpcbiAgICAgKiBEZWZhdWx0OiBgdHJ1ZWAsIGkuZS4gYW55IHZhbHVlIGlzIHZhbGlkLlxuICAgICAqXG4gICAgICogVXNhZ2U6XG4gICAgICogICogVmFsaWRhdGlvbiBmdW5jdGlvbnMgcmV0dXJuIGVpdGhlciBgdHJ1ZWAgb3IgYW4gYGVycm9yQ29kZWAgc3RyaW5nLiAgVGhlIGBlcnJvckNvZGVgIGNhblxuICAgICAqICAgIGJlIGNvbnZlcnRlZCBpbnRvIGEgc3VyZmFjZSBmb3JtIGR1cmluZyB0aGUgcmVuZGVyIHBoYXNlLlxuICAgICAqICAqIENvbW1vbiB2YWxpZGF0aW9uIGZ1bmN0aW9ucyBhcmUgZGVmaW5lZCBpbiB0aGUgYERhdGVSYW5nZUNvbnRyb2xWYWxpZGF0aW9uc2AgbmFtZXNwYWNlXG4gICAgICogICAgd2hpY2ggY2FuIGJlIGFkZGVkIGRpcmVjdGx5IHRvIHRoaXMgcHJvcC4gZS5nLjpcbiAgICAgKiBgYGBcbiAgICAgKiAgICB2YWxpZDogRGF0ZVJhbmdlQ29udHJvbFZhbGlkYXRpb25zLlNUQVJUX0JFRk9SRV9FTkQsXG4gICAgICogYGBgXG4gICAgICovXG4gICAgdmFsaWRhdGlvbj86IHtcbiAgICAgICAgc3RhcnREYXRlVmFsaWQ/OiBEYXRlVmFsaWRhdGlvbkZ1bmN0aW9uIHwgRGF0ZVZhbGlkYXRpb25GdW5jdGlvbltdLFxuICAgICAgICBlbmREYXRlVmFsaWQ/OiBEYXRlVmFsaWRhdGlvbkZ1bmN0aW9uIHwgRGF0ZVZhbGlkYXRpb25GdW5jdGlvbltdLFxuICAgICAgICByYW5nZVZhbGlkPzogRGF0ZVJhbmdlVmFsaWRhdGlvbkZ1bmN0aW9uIHwgRGF0ZVJhbmdlVmFsaWRhdGlvbkZ1bmN0aW9uW11cbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogV2hlbiB0aGVyZSBpcyBubyBvbiBnb2luZyBxdWVzdGlvbiwgc2hvdWxkIERhdGVSYW5nZUNvbnRyb2xcbiAgICAgKiBzcG9udGFuZW91c2x5IGFzayBmb3IgZGF0ZSByYW5nZSBpbmZvIGlmIGl0J3Mgbm90IGludm9rZWQgaW4gcHJldmlvdXMgZGlhbG9nIHR1cm5zXG4gICAgICovXG4gICAgcmVxdWlyZWQ/OiBib29sZWFuIHwgKChpbnB1dDogQ29udHJvbElucHV0KSA9PiBib29sZWFuKTtcblxuICAgIC8vIFRPRE86IEFkZCBjb25maXJtYXRpb25SZXF1aXJlZCBmb3IgZGF0ZSByYW5nZSB2YWx1ZXMuXG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgRGF0ZVJhbmdlQ29udHJvbEFjdGlvblByb3BzIHtcbiAgICBzZXQ/OiBzdHJpbmdbXSxcbiAgICBjaGFuZ2U/OiBzdHJpbmdbXVxufVxuXG5leHBvcnQgbmFtZXNwYWNlIERhdGVSYW5nZUNvbnRyb2xWYWxpZGF0aW9ucyB7XG4gICAgZXhwb3J0IGNvbnN0IFNUQVJUX0JFRk9SRV9FTkQ6IERhdGVSYW5nZVZhbGlkYXRpb25GdW5jdGlvbiA9IChzdGF0ZTogRGF0ZVJhbmdlQ29udHJvbFN0YXRlLCBpbnB1dDogQ29udHJvbElucHV0KTogdHJ1ZSB8IFZhbGlkYXRpb25SZXN1bHQgPT4ge1xuICAgICAgICBjb25zdCBzdGFydERhdGUgPSBhbGV4YURhdGVGb3JtYXRUb0RhdGUoc3RhdGUuc3RhcnREYXRlISk7XG4gICAgICAgIGNvbnN0IGVuZERhdGUgPSBhbGV4YURhdGVGb3JtYXRUb0RhdGUoc3RhdGUuZW5kRGF0ZSEpO1xuICAgICAgICBpZiAoc3RhcnREYXRlID4gZW5kRGF0ZSkge1xuICAgICAgICAgICAgcmV0dXJuIHsgcmVhc29uQ29kZTogJ3N0YXJ0QmVmb3JlRW5kJywgcmVuZGVyZWRSZWFzb246IGkxOG5leHQudCgnREFURV9SQU5HRV9DT05UUk9MX0RFRkFVTFRfUFJPTVBUX1ZBTElEQVRJT05fRkFJTF9TVEFSVF9BRlRFUl9FTkQnKSB9O1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH07XG59XG5cbmV4cG9ydCBjbGFzcyBEYXRlUmFuZ2VDb250cm9sU3RhdGUgZXh0ZW5kcyBDb250YWluZXJDb250cm9sU3RhdGUge1xuICAgIHN0YXJ0RGF0ZT86IHN0cmluZztcbiAgICBlbmREYXRlPzogc3RyaW5nO1xuICAgIHByaW9yU3RhcnREYXRlPzogc3RyaW5nIDtcbiAgICBwcmlvckVuZERhdGU/OiBzdHJpbmc7XG4gICAgb3BlblF1ZXN0aW9uOiBib29sZWFuID0gZmFsc2U7XG4gICAgb25Gb2N1czogYm9vbGVhbiA9IHRydWU7XG59XG5cbmV4cG9ydCBlbnVtIFRhcmdldENhdGVnb3J5IHtcbiAgICBTdGFydERhdGUgPSAnc3RhcnREYXRlJyxcbiAgICBFbmREYXRlID0gJ2VuZERhdGUnLFxuICAgIEJvdGggPSAnYm90aCcsXG4gICAgTmVpdGhlciA9ICduZWl0aGVyJyxcbiAgICBFaXRoZXIgPSAnZWl0aGVyJ1xufVxuXG5leHBvcnQgZW51bSBEYXRlQ29udHJvbFRhcmdldCB7XG4gICAgU3RhcnREYXRlID0gJ3N0YXJ0RGF0ZScsXG4gICAgRW5kRGF0ZSA9ICdlbmREYXRlJ1xufVxuXG5leHBvcnQgY2xhc3MgRGF0ZVJhbmdlU2V0QWN0IGV4dGVuZHMgQ29udGVudEFjdCB7XG4gICAgcHVibGljIHJlYWRvbmx5IHN0YXJ0RGF0ZTogc3RyaW5nIHwgdW5kZWZpbmVkO1xuICAgIHB1YmxpYyByZWFkb25seSBlbmREYXRlOiBzdHJpbmcgfCB1bmRlZmluZWQ7XG5cbiAgICBjb25zdHJ1Y3Rvcihjb250cm9sOiBDb250cm9sLCBzdGFydDogc3RyaW5nIHwgdW5kZWZpbmVkLCBlbmQ6IHN0cmluZyB8IHVuZGVmaW5lZCkge1xuICAgICAgICBzdXBlcihjb250cm9sKTtcbiAgICAgICAgdGhpcy5zdGFydERhdGUgPSBzdGFydDtcbiAgICAgICAgdGhpcy5lbmREYXRlID0gZW5kO1xuICAgIH1cblxuICAgIHJlbmRlcihpbnB1dDogQ29udHJvbElucHV0LCByZXNwb25zZUJ1aWxkZXI6IENvbnRyb2xSZXNwb25zZUJ1aWxkZXIpOiB2b2lkIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdUaGlzIGlzIG5vdCBpbnRlbmRlZCB0byBiZSBjYWxsZWQuIFJlbmRlcmluZyBpcyBjb250cm9sbGVkIGJ5IHRoZSBDb250cm9sIGl0c2VsZi4nKTtcbiAgICB9XG59XG5cbmV4cG9ydCBjbGFzcyBEYXRlUmFuZ2VDaGFuZ2VkQWN0IGV4dGVuZHMgQ29udGVudEFjdCB7XG4gICAgcHVibGljIHJlYWRvbmx5IHN0YXJ0RGF0ZTogc3RyaW5nIHwgdW5kZWZpbmVkO1xuICAgIHB1YmxpYyByZWFkb25seSBlbmREYXRlOiBzdHJpbmcgfCB1bmRlZmluZWQ7XG4gICAgcHVibGljIHJlYWRvbmx5IHByaW9yU3RhcnREYXRlOiBzdHJpbmcgfCB1bmRlZmluZWQ7XG4gICAgcHVibGljIHJlYWRvbmx5IHByaW9yRW5kRGF0ZTogc3RyaW5nIHwgdW5kZWZpbmVkO1xuXG4gICAgY29uc3RydWN0b3IoY29udHJvbDogQ29udHJvbCwgc3RhcnQ6IHN0cmluZyB8IHVuZGVmaW5lZCwgZW5kOiBzdHJpbmcgfCB1bmRlZmluZWQsIHByaW9yU3RhcnQ6IHN0cmluZyB8IHVuZGVmaW5lZCwgcHJpb3JFbmQ6IHN0cmluZyB8IHVuZGVmaW5lZCkge1xuICAgICAgICBzdXBlcihjb250cm9sKTtcbiAgICAgICAgdGhpcy5zdGFydERhdGUgPSBzdGFydDtcbiAgICAgICAgdGhpcy5wcmlvclN0YXJ0RGF0ZSA9IHByaW9yU3RhcnQ7XG4gICAgICAgIHRoaXMuZW5kRGF0ZSA9IGVuZDtcbiAgICAgICAgdGhpcy5wcmlvckVuZERhdGUgPSBwcmlvckVuZDtcbiAgICB9XG5cbiAgICByZW5kZXIoaW5wdXQ6IENvbnRyb2xJbnB1dCwgcmVzcG9uc2VCdWlsZGVyOiBDb250cm9sUmVzcG9uc2VCdWlsZGVyKTogdm9pZCB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcignVGhpcyBpcyBub3QgaW50ZW5kZWQgdG8gYmUgY2FsbGVkLiBSZW5kZXJpbmcgaXMgY29udHJvbGxlZCBieSB0aGUgQ29udHJvbCBpdHNlbGYuJyk7XG4gICAgfVxufVxuXG5leHBvcnQgY2xhc3MgRGF0ZVJhbmdlQ29udHJvbCBleHRlbmRzIENvbnRhaW5lckNvbnRyb2wgaW1wbGVtZW50cyBJbnRlcmFjdGlvbk1vZGVsQ29udHJpYnV0b3Ige1xuXG4gICAgc3RhcnREYXRlQ29udHJvbDogRGF0ZUNvbnRyb2w7XG4gICAgZW5kRGF0ZUNvbnRyb2w6IERhdGVDb250cm9sO1xuICAgIHN0YXRlOiBEYXRlUmFuZ2VDb250cm9sU3RhdGU7XG4gICAgcHJvcHM6IERlZXBSZXF1aXJlZDxEYXRlUmFuZ2VDb250cm9sUHJvcHM+O1xuICAgIGNoaWxkcmVuOiBEYXRlQ29udHJvbFtdO1xuICAgIGhhbmRsZUZ1bmM6ICgoaW5wdXQ6IENvbnRyb2xJbnB1dCwgcmVzdWx0QnVpbGRlcjogQ29udHJvbFJlc3VsdEJ1aWxkZXIpID0+IHZvaWQpIHwgdW5kZWZpbmVkO1xuICAgIHRha2VJbml0aWF0aXZlRnVuYzogKChpbnB1dDogQ29udHJvbElucHV0LCByZXN1bHRCdWlsZGVyOiBDb250cm9sUmVzdWx0QnVpbGRlcikgPT4gdm9pZCkgfCB1bmRlZmluZWQ7XG4gICAgc3RhdGljIG1lcmdlV2l0aERlZmF1bHRQcm9wcyhwcm9wczogRGF0ZVJhbmdlQ29udHJvbFByb3BzKTogRGVlcFJlcXVpcmVkPERhdGVSYW5nZUNvbnRyb2xQcm9wcz4ge1xuICAgICAgICBjb25zdCBkZWZhdWx0czogRGVlcFJlcXVpcmVkPERhdGVSYW5nZUNvbnRyb2xQcm9wcz4gPSB7XG4gICAgICAgICAgICBpZDogJ3VuaW5pdGlhbGl6ZWQnLFxuICAgICAgICAgICAgdmFsaWRhdGlvbjoge1xuICAgICAgICAgICAgICAgIHN0YXJ0RGF0ZVZhbGlkOiBbXSxcbiAgICAgICAgICAgICAgICBlbmREYXRlVmFsaWQ6IFtdLFxuICAgICAgICAgICAgICAgIHJhbmdlVmFsaWQ6IFtdXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgcmVxdWlyZWQ6IHRydWUsXG4gICAgICAgICAgICBpbnRlcmFjdGlvbk1vZGVsOiB7XG4gICAgICAgICAgICAgICAgdGFyZ2V0czoge1xuICAgICAgICAgICAgICAgICAgICBzdGFydERhdGU6IFsnc3RhcnREYXRlJywgJ2RhdGUnLCAkLlRhcmdldC5JdF0sXG4gICAgICAgICAgICAgICAgICAgIGVuZERhdGU6IFsnZW5kRGF0ZScsICdkYXRlJywgJC5UYXJnZXQuSXRdLFxuICAgICAgICAgICAgICAgICAgICBzZWxmOiBbJ2RhdGUnLCAnZGF0ZVJhbmdlJywgJC5UYXJnZXQuSXRdXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBhY3Rpb25zOiB7XG4gICAgICAgICAgICAgICAgICAgIHNldDogWyQuQWN0aW9uLlNldF0sXG4gICAgICAgICAgICAgICAgICAgIGNoYW5nZTogWyQuQWN0aW9uLkNoYW5nZV1cbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIC8vIFRPRE86IHJldmlldyBhbGwgZGVmYXVsdCBwcm9tcHRzXG4gICAgICAgICAgICBwcm9tcHRzOiB7XG4gICAgICAgICAgICAgICAgc3RhcnREYXRlOiB7XG4gICAgICAgICAgICAgICAgICAgIGNvbmZpcm1WYWx1ZTogKGFjdCkgPT4gaTE4bmV4dC50KCdEQVRFX1JBTkdFX0NPTlRST0xfREVGQVVMVF9QUk9NUFRfQ09ORklSTV9TVEFSVF9EQVRFJywgeyB2YWx1ZTogYWN0LnBheWxvYWQudmFsdWUgfSksXG4gICAgICAgICAgICAgICAgICAgIHZhbHVlQWZmaXJtZWQ6IGkxOG5leHQudCgnREFURV9SQU5HRV9DT05UUk9MX0RFRkFVTFRfUFJPTVBUX1NUQVJUX0RBVEVfQUZGSVJNRUQnKSxcbiAgICAgICAgICAgICAgICAgICAgdmFsdWVEaXNhZmZpcm1lZDogaTE4bmV4dC50KCdEQVRFX1JBTkdFX0NPTlRST0xfREVGQVVMVF9QUk9NUFRfU1RBUlRfREFURV9ESVNBRkZJUk1FRCcpLFxuICAgICAgICAgICAgICAgICAgICB2YWx1ZVNldDogKGFjdCkgPT4gaTE4bmV4dC50KCdEQVRFX1JBTkdFX0NPTlRST0xfREVGQVVMVF9QUk9NUFRfU1RBUlRfREFURV9TRVQnLCB7IHZhbHVlOiBhY3QucGF5bG9hZC52YWx1ZSB9KSxcbiAgICAgICAgICAgICAgICAgICAgdmFsdWVDaGFuZ2VkOiAoYWN0KSA9PiBpMThuZXh0LnQoJ0RBVEVfUkFOR0VfQ09OVFJPTF9ERUZBVUxUX1BST01QVF9TVEFSVF9EQVRFX0NIQU5HRUQnLCB7IHZhbHVlOiBhY3QucGF5bG9hZC52YWx1ZSB9KSxcbiAgICAgICAgICAgICAgICAgICAgaW52YWxpZFZhbHVlOiAoYWN0KSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoYWN0LnBheWxvYWQucmVuZGVyZWRSZWFzb24gIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBpMThuZXh0LnQoJ0RBVEVfUkFOR0VfQ09OVFJPTF9ERUZBVUxUX1BST01QVF9JTlZBTElEX1NUQVJUX1dJVEhfUkVBU09OJywgeyByZWFzb246IGFjdC5wYXlsb2FkLnJlbmRlcmVkUmVhc29uIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGkxOG5leHQudCgnREFURV9SQU5HRV9DT05UUk9MX0RFRkFVTFRfUFJPTVBUX0dFTkVSQUxfSU5WQUxJRF9EQVRFJyk7XG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIHJlcXVlc3RWYWx1ZTogaTE4bmV4dC50KCdEQVRFX1JBTkdFX0NPTlRST0xfREVGQVVMVF9QUk9NUFRfUkVRVUVTVF9TVEFSVF9EQVRFJyksXG4gICAgICAgICAgICAgICAgICAgIHJlcXVlc3RDaGFuZ2VkVmFsdWU6IGkxOG5leHQudCgnREFURV9SQU5HRV9DT05UUk9MX0RFRkFVTFRfUFJPTVBUX1JFUVVFU1RfQ0hBTkdFRF9TVEFSVF9EQVRFJyksXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBlbmREYXRlOiB7XG4gICAgICAgICAgICAgICAgICAgIGNvbmZpcm1WYWx1ZTogKGFjdCkgPT4gaTE4bmV4dC50KCdEQVRFX1JBTkdFX0NPTlRST0xfREVGQVVMVF9QUk9NUFRfQ09ORklSTV9FTkRfREFURScsIHsgdmFsdWU6IGFjdC5wYXlsb2FkLnZhbHVlIH0pLFxuICAgICAgICAgICAgICAgICAgICB2YWx1ZUFmZmlybWVkOiBpMThuZXh0LnQoJ0RBVEVfUkFOR0VfQ09OVFJPTF9ERUZBVUxUX1BST01QVF9FTkRfREFURV9BRkZJUk1FRCcpLFxuICAgICAgICAgICAgICAgICAgICB2YWx1ZURpc2FmZmlybWVkOiBpMThuZXh0LnQoJ0RBVEVfUkFOR0VfQ09OVFJPTF9ERUZBVUxUX1BST01QVF9FTkRfREFURV9ESVNBRkZJUk1FRCcpLFxuICAgICAgICAgICAgICAgICAgICB2YWx1ZVNldDogKGFjdCkgPT4gaTE4bmV4dC50KCdEQVRFX1JBTkdFX0NPTlRST0xfREVGQVVMVF9QUk9NUFRfRU5EX0RBVEVfU0VUJywgeyB2YWx1ZTogYWN0LnBheWxvYWQudmFsdWUgfSksXG4gICAgICAgICAgICAgICAgICAgIHZhbHVlQ2hhbmdlZDogKGFjdCkgPT4gaTE4bmV4dC50KCdEQVRFX1JBTkdFX0NPTlRST0xfREVGQVVMVF9QUk9NUFRfRU5EX0RBVEVfQ0hBTkdFRCcsIHsgdmFsdWU6IGFjdC5wYXlsb2FkLnZhbHVlIH0pLFxuICAgICAgICAgICAgICAgICAgICBpbnZhbGlkVmFsdWU6IChhY3QpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhY3QucGF5bG9hZC5yZW5kZXJlZFJlYXNvbiAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGkxOG5leHQudCgnREFURV9SQU5HRV9DT05UUk9MX0RFRkFVTFRfUFJPTVBUX0lOVkFMSURfRU5EX1dJVEhfUkVBU09OJywgeyByZWFzb246IGFjdC5wYXlsb2FkLnJlbmRlcmVkUmVhc29uIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGkxOG5leHQudCgnREFURV9SQU5HRV9DT05UUk9MX0RFRkFVTFRfUFJPTVBUX0dFTkVSQUxfSU5WQUxJRF9EQVRFJyk7XG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIHJlcXVlc3RWYWx1ZTogaTE4bmV4dC50KCdEQVRFX1JBTkdFX0NPTlRST0xfREVGQVVMVF9QUk9NUFRfUkVRVUVTVF9FTkRfREFURScpLFxuICAgICAgICAgICAgICAgICAgICByZXF1ZXN0Q2hhbmdlZFZhbHVlOiBpMThuZXh0LnQoJ0RBVEVfUkFOR0VfQ09OVFJPTF9ERUZBVUxUX1BST01QVF9SRVFVRVNUX0NIQU5HRURfRU5EX0RBVEUnKSxcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIHJlcXVlc3RSYW5nZTogKGFjdDogUmVxdWVzdFZhbHVlQWN0KSA9PiBpMThuZXh0LnQoJ0RBVEVfUkFOR0VfQ09OVFJPTF9ERUZBVUxUX1BST01QVF9SRVFVRVNUX1JBTkdFJyksXG4gICAgICAgICAgICAgICAgcmFuZ2VTZXQ6IChhY3Q6IERhdGVSYW5nZVNldEFjdCkgPT4gaTE4bmV4dC50KCdEQVRFX1JBTkdFX0NPTlRST0xfREVGQVVMVF9QUk9NUFRfUkFOR0VfU0VUJywgeyBzdGFydDogYWN0LnN0YXJ0RGF0ZSwgZW5kOiBhY3QuZW5kRGF0ZSB9KSxcbiAgICAgICAgICAgICAgICByYW5nZUNoYW5nZWQ6IChhY3Q6IERhdGVSYW5nZUNoYW5nZWRBY3QpID0+IGkxOG5leHQudCgnREFURV9SQU5HRV9DT05UUk9MX0RFRkFVTFRfUFJPTVBUX1JBTkdFX0NIQU5HRUQnLCB7IHN0YXJ0OiBhY3Quc3RhcnREYXRlLCBlbmQ6IGFjdC5lbmREYXRlIH0pLFxuICAgICAgICAgICAgICAgIGludmFsaWRSYW5nZTogKGFjdDogSW52YWxpZFZhbHVlQWN0PHN0cmluZz4pID0+IHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGFjdC5wYXlsb2FkLnJlbmRlcmVkUmVhc29uICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBpMThuZXh0LnQoJ0RBVEVfUkFOR0VfQ09OVFJPTF9ERUZBVUxUX1BST01QVF9JTlZBTElEX1JBTkdFX1dJVEhfUkVBU09OJywgeyByZWFzb246IGFjdC5wYXlsb2FkLnJlbmRlcmVkUmVhc29uIH0pO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBpMThuZXh0LnQoJ0RBVEVfUkFOR0VfQ09OVFJPTF9ERUZBVUxUX1BST01QVF9HRU5FUkFMX0lOVkFMSURfUkFOR0UnKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgcmVwcm9tcHRzOiB7XG4gICAgICAgICAgICAgICAgc3RhcnREYXRlOiB7XG4gICAgICAgICAgICAgICAgICAgIGNvbmZpcm1WYWx1ZTogKGFjdCkgPT4gaTE4bmV4dC50KCdEQVRFX1JBTkdFX0NPTlRST0xfREVGQVVMVF9SRVBST01QVF9DT05GSVJNX1NUQVJUX0RBVEUnLCB7IHZhbHVlOiBhY3QucGF5bG9hZC52YWx1ZSB9KSxcbiAgICAgICAgICAgICAgICAgICAgdmFsdWVBZmZpcm1lZDogaTE4bmV4dC50KCdEQVRFX1JBTkdFX0NPTlRST0xfREVGQVVMVF9SRVBST01QVF9TVEFSVF9EQVRFX0FGRklSTUVEJyksXG4gICAgICAgICAgICAgICAgICAgIHZhbHVlRGlzYWZmaXJtZWQ6IGkxOG5leHQudCgnREFURV9SQU5HRV9DT05UUk9MX0RFRkFVTFRfUkVQUk9NUFRfU1RBUlRfREFURV9ESVNBRkZJUk1FRCcpLFxuICAgICAgICAgICAgICAgICAgICB2YWx1ZVNldDogKGFjdCkgPT4gaTE4bmV4dC50KCdEQVRFX1JBTkdFX0NPTlRST0xfREVGQVVMVF9SRVBST01QVF9TVEFSVF9EQVRFX1NFVCcsIHsgdmFsdWU6IGFjdC5wYXlsb2FkLnZhbHVlIH0pLFxuICAgICAgICAgICAgICAgICAgICB2YWx1ZUNoYW5nZWQ6IChhY3QpID0+IGkxOG5leHQudCgnREFURV9SQU5HRV9DT05UUk9MX0RFRkFVTFRfUkVQUk9NUFRfU1RBUlRfREFURV9DSEFOR0VEJywgeyB2YWx1ZTogYWN0LnBheWxvYWQudmFsdWUgfSksXG4gICAgICAgICAgICAgICAgICAgIGludmFsaWRWYWx1ZTogKGFjdCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGFjdC5wYXlsb2FkLnJlYXNvbkNvZGUgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBpMThuZXh0LnQoJ0RBVEVfUkFOR0VfQ09OVFJPTF9ERUZBVUxUX1JFUFJPTVBUX0lOVkFMSURfU1RBUlRfV0lUSF9SRUFTT04nLCB7IHJlYXNvbjogYWN0LnBheWxvYWQucmVhc29uQ29kZSB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBpMThuZXh0LnQoJ0RBVEVfUkFOR0VfQ09OVFJPTF9ERUZBVUxUX1JFUFJPTVBUX0dFTkVSQUxfSU5WQUxJRF9EQVRFJyk7XG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIHJlcXVlc3RWYWx1ZTogaTE4bmV4dC50KCdEQVRFX1JBTkdFX0NPTlRST0xfREVGQVVMVF9SRVBST01QVF9SRVFVRVNUX1NUQVJUX0RBVEUnKSxcbiAgICAgICAgICAgICAgICAgICAgcmVxdWVzdENoYW5nZWRWYWx1ZTogaTE4bmV4dC50KCdEQVRFX1JBTkdFX0NPTlRST0xfREVGQVVMVF9SRVBST01QVF9SRVFVRVNUX0NIQU5HRURfU1RBUlRfREFURScpLFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgZW5kRGF0ZToge1xuICAgICAgICAgICAgICAgICAgICBjb25maXJtVmFsdWU6IChhY3QpID0+IGkxOG5leHQudCgnREFURV9SQU5HRV9DT05UUk9MX0RFRkFVTFRfUkVQUk9NUFRfQ09ORklSTV9FTkRfREFURScsIHsgdmFsdWU6IGFjdC5wYXlsb2FkLnZhbHVlIH0pLFxuICAgICAgICAgICAgICAgICAgICB2YWx1ZUFmZmlybWVkOiBpMThuZXh0LnQoJ0RBVEVfUkFOR0VfQ09OVFJPTF9ERUZBVUxUX1JFUFJPTVBUX0VORF9EQVRFX0FGRklSTUVEJyksXG4gICAgICAgICAgICAgICAgICAgIHZhbHVlRGlzYWZmaXJtZWQ6IGkxOG5leHQudCgnREFURV9SQU5HRV9DT05UUk9MX0RFRkFVTFRfUkVQUk9NUFRfRU5EX0RBVEVfRElTQUZGSVJNRUQnKSxcbiAgICAgICAgICAgICAgICAgICAgdmFsdWVTZXQ6IChhY3QpID0+IGkxOG5leHQudCgnREFURV9SQU5HRV9DT05UUk9MX0RFRkFVTFRfUkVQUk9NUFRfRU5EX0RBVEVfU0VUJywgeyB2YWx1ZTogYWN0LnBheWxvYWQudmFsdWUgfSksXG4gICAgICAgICAgICAgICAgICAgIHZhbHVlQ2hhbmdlZDogKGFjdCkgPT4gaTE4bmV4dC50KCdEQVRFX1JBTkdFX0NPTlRST0xfREVGQVVMVF9SRVBST01QVF9FTkRfREFURV9DSEFOR0VEJywgeyB2YWx1ZTogYWN0LnBheWxvYWQudmFsdWUgfSksXG4gICAgICAgICAgICAgICAgICAgIGludmFsaWRWYWx1ZTogKGFjdCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGFjdC5wYXlsb2FkLnJlYXNvbkNvZGUgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBpMThuZXh0LnQoJ0RBVEVfUkFOR0VfQ09OVFJPTF9ERUZBVUxUX1JFUFJPTVBUX0lOVkFMSURfRU5EX1dJVEhfUkVBU09OJywgeyByZWFzb246IGFjdC5wYXlsb2FkLnJlYXNvbkNvZGUgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gaTE4bmV4dC50KCdEQVRFX1JBTkdFX0NPTlRST0xfREVGQVVMVF9SRVBST01QVF9HRU5FUkFMX0lOVkFMSURfREFURScpO1xuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICByZXF1ZXN0VmFsdWU6IGkxOG5leHQudCgnREFURV9SQU5HRV9DT05UUk9MX0RFRkFVTFRfUkVQUk9NUFRfUkVRVUVTVF9FTkRfREFURScpLFxuICAgICAgICAgICAgICAgICAgICByZXF1ZXN0Q2hhbmdlZFZhbHVlOiBpMThuZXh0LnQoJ0RBVEVfUkFOR0VfQ09OVFJPTF9ERUZBVUxUX1JFUFJPTVBUX1JFUVVFU1RfQ0hBTkdFRF9FTkRfREFURScpLFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgcmVxdWVzdFJhbmdlOiAoYWN0OiBSZXF1ZXN0VmFsdWVBY3QpID0+IGkxOG5leHQudCgnREFURV9SQU5HRV9DT05UUk9MX0RFRkFVTFRfUkVQUk9NUFRfUkVRVUVTVF9SQU5HRScpLFxuICAgICAgICAgICAgICAgIHJhbmdlU2V0OiAoYWN0OiBEYXRlUmFuZ2VTZXRBY3QpID0+IGkxOG5leHQudCgnREFURV9SQU5HRV9DT05UUk9MX0RFRkFVTFRfUkVQUk9NUFRfUkFOR0VfU0VUJywgeyBzdGFydDogYWN0LnN0YXJ0RGF0ZSwgZW5kOiBhY3QuZW5kRGF0ZSB9KSxcbiAgICAgICAgICAgICAgICByYW5nZUNoYW5nZWQ6IChhY3Q6IERhdGVSYW5nZUNoYW5nZWRBY3QpID0+IGkxOG5leHQudCgnREFURV9SQU5HRV9DT05UUk9MX0RFRkFVTFRfUkVQUk9NUFRfUkFOR0VfQ0hBTkdFRCcsIHsgc3RhcnQ6IGFjdC5zdGFydERhdGUsIGVuZDogYWN0LmVuZERhdGUgfSksXG4gICAgICAgICAgICAgICAgaW52YWxpZFJhbmdlOiAoYWN0OiBJbnZhbGlkVmFsdWVBY3Q8c3RyaW5nPikgPT4ge1xuICAgICAgICAgICAgICAgICAgICBpZiAoYWN0LnBheWxvYWQucmVhc29uQ29kZSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gaTE4bmV4dC50KCdEQVRFX1JBTkdFX0NPTlRST0xfREVGQVVMVF9SRVBST01QVF9JTlZBTElEX1JBTkdFX1dJVEhfUkVBU09OJywgeyByZWFzb246IGFjdC5wYXlsb2FkLnJlYXNvbkNvZGUgfSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGkxOG5leHQudCgnREFURV9SQU5HRV9DT05UUk9MX0RFRkFVTFRfUkVQUk9NUFRfR0VORVJBTF9JTlZBTElEX1JBTkdFJyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgfTtcblxuICAgICAgICByZXR1cm4gXy5tZXJnZVdpdGgoZGVmYXVsdHMsIHByb3BzKTtcbiAgICB9XG5cbiAgICBjb25zdHJ1Y3Rvcihwcm9wczogRGF0ZVJhbmdlQ29udHJvbFByb3BzKSB7XG4gICAgICAgIHN1cGVyKHByb3BzKTtcbiAgICAgICAgdGhpcy5zdGF0ZSA9IG5ldyBEYXRlUmFuZ2VDb250cm9sU3RhdGUoKTtcbiAgICAgICAgdGhpcy5wcm9wcyA9IERhdGVSYW5nZUNvbnRyb2wubWVyZ2VXaXRoRGVmYXVsdFByb3BzKHByb3BzKTtcbiAgICAgICAgdGhpcy5zdGFydERhdGVDb250cm9sID0gbmV3IERhdGVDb250cm9sKHtcbiAgICAgICAgICAgIGlkOiBgJHt0aGlzLnByb3BzLmlkfV9zdGFydERhdGVgLFxuICAgICAgICAgICAgaW50ZXJhY3Rpb25Nb2RlbDoge1xuICAgICAgICAgICAgICAgIHRhcmdldHM6IHRoaXMucHJvcHMuaW50ZXJhY3Rpb25Nb2RlbC50YXJnZXRzLnN0YXJ0RGF0ZVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHByb21wdHM6IHRoaXMucHJvcHMucHJvbXB0cy5zdGFydERhdGUsXG4gICAgICAgICAgICB2YWxpZGF0aW9uOiB0aGlzLnByb3BzLnZhbGlkYXRpb24uc3RhcnREYXRlVmFsaWQsXG4gICAgICAgICAgICByZXF1aXJlZDogdGhpcy5wcm9wcy5yZXF1aXJlZCxcbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMuZW5kRGF0ZUNvbnRyb2wgPSBuZXcgRGF0ZUNvbnRyb2woe1xuICAgICAgICAgICAgaWQ6IGAke3RoaXMucHJvcHMuaWR9X2VuZERhdGVgLFxuICAgICAgICAgICAgaW50ZXJhY3Rpb25Nb2RlbDoge1xuICAgICAgICAgICAgICAgIHRhcmdldHM6IHRoaXMucHJvcHMuaW50ZXJhY3Rpb25Nb2RlbC50YXJnZXRzLmVuZERhdGVcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBwcm9tcHRzOiB0aGlzLnByb3BzLnByb21wdHMuZW5kRGF0ZSxcbiAgICAgICAgICAgIHZhbGlkYXRpb246IHRoaXMucHJvcHMudmFsaWRhdGlvbi5lbmREYXRlVmFsaWQsXG4gICAgICAgICAgICByZXF1aXJlZDogdGhpcy5wcm9wcy5yZXF1aXJlZCxcbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMuYWRkQ2hpbGQodGhpcy5zdGFydERhdGVDb250cm9sKVxuICAgICAgICAgICAgLmFkZENoaWxkKHRoaXMuZW5kRGF0ZUNvbnRyb2wpO1xuICAgIH1cblxuICAgIGFzeW5jIGNhbkhhbmRsZShpbnB1dDogQ29udHJvbElucHV0KTogUHJvbWlzZTxib29sZWFuPiB7XG4gICAgICAgIHJldHVybiBhd2FpdCB0aGlzLmNhbkhhbmRsZUZvckZvY3VzKGlucHV0KSB8fCB0aGlzLmNhbkhhbmRsZUZvck5vRm9jdXMoaW5wdXQpO1xuICAgIH1cblxuICAgIGFzeW5jIGhhbmRsZShpbnB1dDogQ29udHJvbElucHV0LCByZXN1bHRCdWlsZGVyOiBDb250cm9sUmVzdWx0QnVpbGRlcik6IFByb21pc2U8dm9pZD4ge1xuXG4gICAgICAgIGxvZy5kZWJ1ZyhgRGF0ZVJhbmdlQ29udHJvbFske3RoaXMuaWR9XTogaGFuZGxlKCkuIEVudGVyaW5nYCk7XG5cbiAgICAgICAgLy8gdXBkYXRlIHRoZSBwcmlvclN0YXJ0RGF0ZSBhbmQgcHJpb3JFbmREYXRlIGJlZm9yZSBuZXcgb3BlcmF0aW9uXG4gICAgICAgIHRoaXMudXBkYXRlUHJpb3IoKTtcblxuICAgICAgICAvLyBDYWxsaW5nIGhhbmRsZSBmdW5jdGlvbiB0byBtYWtlIGNoYW5nZXMgdG8gc3RhdGUgdmFsdWVzXG4gICAgICAgIGlmICh0aGlzLmhhbmRsZUZ1bmMpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmhhbmRsZUZ1bmMoaW5wdXQsIHJlc3VsdEJ1aWxkZXIpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gSWYgY2FuJ3QgaGFuZGxlIGJ5IERhdGVSYW5nZUNvbnRyb2wgaXRzZWxmLCBsZXQgY2hpbGRyZW4gaGFuZGxlIGl0IGFuZCB1cGRhdGUgc3RhdGUgdmFsdWVzXG4gICAgICAgIGF3YWl0IHRoaXMuaGFuZGxlQnlDaGlsZChpbnB1dCwgcmVzdWx0QnVpbGRlcik7XG4gICAgICAgIGNvbnN0IG5ld1N0YXJ0RGF0ZSA9IHRoaXMuZ2V0U3RhcnREYXRlRnJvbUNoaWxkKCk7XG4gICAgICAgIGNvbnN0IG5ld0VuZERhdGUgPSB0aGlzLmdldEVuZERhdGVGcm9tQ2hpbGQoKTtcbiAgICAgICAgdGhpcy5zZXRTdGFydERhdGUobmV3U3RhcnREYXRlKTtcbiAgICAgICAgdGhpcy5zZXRFbmREYXRlKG5ld0VuZERhdGUpO1xuICAgICAgICB0aGlzLnN0YXRlLm9uRm9jdXMgPSBmYWxzZTtcblxuICAgICAgICAvLyBBZnRlciBjaGlsZCBoYW5kbGUgdGhlIHJlcXVlc3QgYW5kIGNoaWxkIGhhcyBubyBxdWVzdGlvblxuICAgICAgICAvLyBhc2sgRGF0ZVJhbmdlQ29udHJvbCB3aGV0aGVyIHRoZSB2YWx1ZSBpcyByZWFkeVxuICAgICAgICBpZiAoIXJlc3VsdEJ1aWxkZXIuaGFzSW5pdGlhdGl2ZUFjdCgpICYmIGF3YWl0IHRoaXMuY2FuVGFrZUluaXRpYXRpdmUoaW5wdXQpKSB7XG4gICAgICAgICAgICBpZiAodGhpcy50YWtlSW5pdGlhdGl2ZUZ1bmMgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgIHRoaXMudGFrZUluaXRpYXRpdmVGdW5jKGlucHV0LCByZXN1bHRCdWlsZGVyKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxuICAgIHVwZGF0ZUludGVyYWN0aW9uTW9kZWwoZ2VuZXJhdG9yOiBDb250cm9sSW50ZXJhY3Rpb25Nb2RlbEdlbmVyYXRvciwgaW1EYXRhOiBNb2RlbERhdGEpIHtcbiAgICAgICAgZ2VuZXJhdG9yLmFkZENvbnRyb2xJbnRlbnQobmV3IEdlbmVyYWxDb250cm9sSW50ZW50KCksIGltRGF0YSk7XG4gICAgICAgIGdlbmVyYXRvci5hZGRDb250cm9sSW50ZW50KG5ldyBEYXRlQ29udHJvbEludGVudCgpLCBpbURhdGEpO1xuICAgICAgICBnZW5lcmF0b3IuYWRkQ29udHJvbEludGVudChuZXcgQ29uanVuY3Rpb25Db250cm9sSW50ZW50KCksIGltRGF0YSk7XG4gICAgICAgIGdlbmVyYXRvci5hZGRDb250cm9sSW50ZW50KG5ldyBEYXRlUmFuZ2VDb250cm9sSW50ZW50KCksIGltRGF0YSk7XG5cbiAgICAgICAgaWYgKHRoaXMucHJvcHMuaW50ZXJhY3Rpb25Nb2RlbC50YXJnZXRzLnNlbGYuaW5jbHVkZXMoJ2RhdGUnKSkge1xuICAgICAgICAgICAgZ2VuZXJhdG9yLmFkZFZhbHVlc1RvU2xvdFR5cGUoU2hhcmVkU2xvdFR5cGUuVEFSR0VULCBpMThuZXh0LnQoJ0RBVEVfQ09OVFJPTF9ERUZBVUxUX1NMT1RfVkFMVUVTX1RBUkdFVF9EQVRFJywgeyByZXR1cm5PYmplY3RzOiB0cnVlIH0pKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5wcm9wcy5pbnRlcmFjdGlvbk1vZGVsLnRhcmdldHMuc2VsZi5pbmNsdWRlcygnZGF0ZVJhbmdlJykpIHtcbiAgICAgICAgICAgIGdlbmVyYXRvci5hZGRWYWx1ZXNUb1Nsb3RUeXBlKFNoYXJlZFNsb3RUeXBlLlRBUkdFVCwgaTE4bmV4dC50KCdEQVRFX1JBTkdFX0NPTlRST0xfREVGQVVMVF9TTE9UX1ZBTFVFU19UQVJHRVRfREFURV9SQU5HRScsIHsgcmV0dXJuT2JqZWN0czogdHJ1ZSB9KSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMucHJvcHMuaW50ZXJhY3Rpb25Nb2RlbC50YXJnZXRzLnN0YXJ0RGF0ZS5pbmNsdWRlcygnc3RhcnREYXRlJykpIHtcbiAgICAgICAgICAgIGdlbmVyYXRvci5hZGRWYWx1ZXNUb1Nsb3RUeXBlKFNoYXJlZFNsb3RUeXBlLlRBUkdFVCwgaTE4bmV4dC50KCdEQVRFX1JBTkdFX0NPTlRST0xfREVGQVVMVF9TTE9UX1ZBTFVFU19UQVJHRVRfU1RBUlRfREFURScsIHsgcmV0dXJuT2JqZWN0czogdHJ1ZSB9KSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMucHJvcHMuaW50ZXJhY3Rpb25Nb2RlbC50YXJnZXRzLmVuZERhdGUuaW5jbHVkZXMoJ2VuZERhdGUnKSkge1xuICAgICAgICAgICAgZ2VuZXJhdG9yLmFkZFZhbHVlc1RvU2xvdFR5cGUoU2hhcmVkU2xvdFR5cGUuVEFSR0VULCBpMThuZXh0LnQoJ0RBVEVfUkFOR0VfQ09OVFJPTF9ERUZBVUxUX1NMT1RfVkFMVUVTX1RBUkdFVF9FTkRfREFURScsIHsgcmV0dXJuT2JqZWN0czogdHJ1ZSB9KSk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBnZXRUYXJnZXRJZHMoKTogc3RyaW5nW10ge1xuXG4gICAgICAgIHJldHVybiB0aGlzLnByb3BzLmludGVyYWN0aW9uTW9kZWwudGFyZ2V0cy5zZWxmO1xuICAgIH1cblxuICAgIGdldFN0YXJ0RGF0ZUZyb21DaGlsZCgpOiBzdHJpbmcgfCB1bmRlZmluZWQge1xuXG4gICAgICAgIHJldHVybiB0aGlzLnN0YXJ0RGF0ZUNvbnRyb2wuc3RhdGUudmFsdWU7XG4gICAgfVxuXG4gICAgZ2V0RW5kRGF0ZUZyb21DaGlsZCgpOiBzdHJpbmcgfCB1bmRlZmluZWQge1xuXG4gICAgICAgIHJldHVybiB0aGlzLmVuZERhdGVDb250cm9sLnN0YXRlLnZhbHVlO1xuICAgIH1cblxuICAgIHNldFN0YXJ0RGF0ZShkYXRlOiBzdHJpbmcgfCB1bmRlZmluZWQpOiB2b2lkIHtcblxuICAgICAgICB0aGlzLnN0YXJ0RGF0ZUNvbnRyb2wuc3RhdGUudmFsdWUgPSBkYXRlO1xuICAgICAgICB0aGlzLnN0YXRlLnN0YXJ0RGF0ZSA9IGRhdGU7XG5cbiAgICAgICAgLy8gQ2xlYW4gb3BlbiBxdWVzdGlvbiBvbmNlIGEgdmFsdWUgc2V0XG4gICAgICAgIHRoaXMuc3RhdGUub3BlblF1ZXN0aW9uID0gZmFsc2U7XG4gICAgfVxuXG4gICAgc2V0RW5kRGF0ZShkYXRlOiBzdHJpbmcgfCB1bmRlZmluZWQpOiB2b2lkIHtcblxuICAgICAgICB0aGlzLmVuZERhdGVDb250cm9sLnN0YXRlLnZhbHVlID0gZGF0ZTtcbiAgICAgICAgdGhpcy5zdGF0ZS5lbmREYXRlID0gZGF0ZTtcblxuICAgICAgICAvLyBDbGVhbiBvcGVuIHF1ZXN0aW9uIG9uY2UgYSB2YWx1ZSBzZXRcbiAgICAgICAgdGhpcy5zdGF0ZS5vcGVuUXVlc3Rpb24gPSBmYWxzZTtcbiAgICB9XG5cbiAgICBhc3luYyBjYW5IYW5kbGVGb3JGb2N1cyhpbnB1dDogQ29udHJvbElucHV0KTogUHJvbWlzZTxib29sZWFuPiB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBva0lmKHRoaXMuc3RhdGUub25Gb2N1cyA9PT0gdHJ1ZSk7XG5cbiAgICAgICAgICAgIC8vIFdoZW4gdGhlIGZvY3VzIGlzIG9uIHBhcmVudCBpdHNlbGZcbiAgICAgICAgICAgIC8vIGdpdmUgdGhlIHBhcmVudCBwcmlvcml0eSB0byBoYW5kbGUgdGhlIHJlcXVlc3RcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmlzVHdvVmFsdWVJbnB1dChpbnB1dClcbiAgICAgICAgICAgIHx8IHRoaXMuaXNEYXRlSW50ZXJwcmV0ZWRBc0RhdGVSYW5nZShpbnB1dClcbiAgICAgICAgICAgIHx8IHRoaXMuaXNDaGFuZ2VCb3RoKGlucHV0KVxuICAgICAgICAgICAgfHwgdGhpcy5pc0NoYW5nZVJhbmdlKGlucHV0KVxuICAgICAgICAgICAgfHwgdGhpcy5jYW5IYW5kbGVCeUNoaWxkKGlucHV0KTtcbiAgICAgICAgfVxuICAgICAgICBjYXRjaCAoZSkge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlSWZHdWFyZEZhaWxlZChlKTtcbiAgICAgICAgfVxuXG4gICAgfVxuXG4gICAgYXN5bmMgY2FuSGFuZGxlRm9yTm9Gb2N1cyhpbnB1dDogQ29udHJvbElucHV0KTogUHJvbWlzZTxib29sZWFuPiB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBva0lmKHRoaXMuc3RhdGUub25Gb2N1cyA9PT0gZmFsc2UpO1xuXG4gICAgICAgICAgICAvLyBXaGVuIHRoZSBmb2N1cyBpcyBvbiBjaGlsZHJlblxuICAgICAgICAgICAgLy8gZ2l2ZSBjaGlsZHJlbiBwcmlvcml0eSB0byBoYW5kbGUgdGhlIHJlcXVlc3RcbiAgICAgICAgICAgIHJldHVybiBhd2FpdCB0aGlzLmNhbkhhbmRsZUJ5Q2hpbGQoaW5wdXQpXG4gICAgICAgICAgICB8fCB0aGlzLmlzVHdvVmFsdWVJbnB1dChpbnB1dClcbiAgICAgICAgICAgIHx8IHRoaXMuaXNEYXRlSW50ZXJwcmV0ZWRBc0RhdGVSYW5nZShpbnB1dClcbiAgICAgICAgICAgIHx8IHRoaXMuaXNDaGFuZ2VCb3RoKGlucHV0KVxuICAgICAgICAgICAgfHwgdGhpcy5pc0NoYW5nZVJhbmdlKGlucHV0KTtcbiAgICAgICAgfVxuICAgICAgICBjYXRjaCAoZSkge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlSWZHdWFyZEZhaWxlZChlKTtcbiAgICAgICAgfVxuXG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogVGVzdCBpZiB0aGUgaW5wdXQgaGFzIGJvdGggc3RhcnQgZGF0ZSBhbmQgZW5kIGRhdGUgcHJvdmlkZWRcbiAgICAgKiBAcGFyYW0gaW5wdXRcbiAgICAgKi9cbiAgICBpc1R3b1ZhbHVlSW5wdXQoaW5wdXQ6IENvbnRyb2xJbnB1dCk6IGJvb2xlYW4ge1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgb2tJZihJbnB1dFV0aWwuaXNJbnRlbnQoaW5wdXQsIERhdGVSYW5nZUNvbnRyb2xJbnRlbnQubmFtZSkpO1xuICAgICAgICAgICAgY29uc3QgaW50ZW50ID0gKGlucHV0LnJlcXVlc3QgYXMgSW50ZW50UmVxdWVzdCkuaW50ZW50O1xuICAgICAgICAgICAgY29uc3QgdW5wYWNrZWRTbG90cyA9IHVucGFja0RhdGVSYW5nZUNvbnRyb2xJbnRlbnQoaW50ZW50KTtcbiAgICAgICAgICAgIGlmICh1bnBhY2tlZFNsb3RzLnRhcmdldCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgb2tJZihJbnB1dFV0aWwudGFyZ2V0SXNNYXRjaE9yVW5kZWZpbmVkKHVucGFja2VkU2xvdHMudGFyZ2V0LCB0aGlzLnByb3BzLmludGVyYWN0aW9uTW9kZWwudGFyZ2V0cy5zZWxmKSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIG9rSWYoSW5wdXRVdGlsLnRhcmdldElzTWF0Y2hPclVuZGVmaW5lZCh1bnBhY2tlZFNsb3RzW1widGFyZ2V0LmFcIl0sIHRoaXMucHJvcHMuaW50ZXJhY3Rpb25Nb2RlbC50YXJnZXRzLnN0YXJ0RGF0ZSkgfHwgSW5wdXRVdGlsLnRhcmdldElzTWF0Y2hPclVuZGVmaW5lZCh1bnBhY2tlZFNsb3RzW1widGFyZ2V0LmFcIl0sIHRoaXMucHJvcHMuaW50ZXJhY3Rpb25Nb2RlbC50YXJnZXRzLmVuZERhdGUpKTtcbiAgICAgICAgICAgICAgICBva0lmKElucHV0VXRpbC50YXJnZXRJc01hdGNoT3JVbmRlZmluZWQodW5wYWNrZWRTbG90c1tcInRhcmdldC5iXCJdLCB0aGlzLnByb3BzLmludGVyYWN0aW9uTW9kZWwudGFyZ2V0cy5zdGFydERhdGUpIHx8IElucHV0VXRpbC50YXJnZXRJc01hdGNoT3JVbmRlZmluZWQodW5wYWNrZWRTbG90c1tcInRhcmdldC5iXCJdLCB0aGlzLnByb3BzLmludGVyYWN0aW9uTW9kZWwudGFyZ2V0cy5lbmREYXRlKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjb25zdCBpbnB1dEdyb3VwczogRGF0ZVJhbmdlQ29udHJvbEludGVudElucHV0W10gPSBnZW5lcmF0ZURhdGVzSW5wdXRHcm91cHModGhpcy5wcm9wcywgdW5wYWNrZWRTbG90cyk7XG4gICAgICAgICAgICBmb3IgKGNvbnN0IGlucHV0R3JvdXAgb2YgaW5wdXRHcm91cHMpIHtcbiAgICAgICAgICAgICAgICBva0lmKElucHV0VXRpbC52YWx1ZVN0ckRlZmluZWQoaW5wdXRHcm91cC52YWx1ZSkpO1xuICAgICAgICAgICAgICAgIG9rSWYoSW5wdXRVdGlsLmFjdGlvbklzU2V0T3JVbmRlZmluZWQoaW5wdXRHcm91cC5hY3Rpb24sIHRoaXMucHJvcHMuaW50ZXJhY3Rpb25Nb2RlbC5hY3Rpb25zLnNldCkgfHwgSW5wdXRVdGlsLmFjdGlvbklzTWF0Y2goaW5wdXRHcm91cC5hY3Rpb24sIHRoaXMucHJvcHMuaW50ZXJhY3Rpb25Nb2RlbC5hY3Rpb25zLmNoYW5nZSkpO1xuICAgICAgICAgICAgICAgIG9rSWYoaW5wdXRHcm91cC50YXJnZXQgPT09IFRhcmdldENhdGVnb3J5LlN0YXJ0RGF0ZSB8fCBpbnB1dEdyb3VwLnRhcmdldCA9PT0gVGFyZ2V0Q2F0ZWdvcnkuRW5kRGF0ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLmhhbmRsZUZ1bmMgPSB0aGlzLmhhbmRsZVR3b1ZhbHVlSW5wdXQ7XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICBjYXRjaCAoZSkge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlSWZHdWFyZEZhaWxlZChlKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGhhbmRsZVR3b1ZhbHVlSW5wdXQoaW5wdXQ6IENvbnRyb2xJbnB1dCwgcmVzdWx0QnVpbGRlcjogQ29udHJvbFJlc3VsdEJ1aWxkZXIpOiB2b2lkIHtcbiAgICAgICAgY29uc3QgaW50ZW50ID0gKGlucHV0LnJlcXVlc3QgYXMgSW50ZW50UmVxdWVzdCkuaW50ZW50O1xuICAgICAgICBjb25zdCB1bnBhY2tlZFNsb3RzID0gdW5wYWNrRGF0ZVJhbmdlQ29udHJvbEludGVudChpbnRlbnQpO1xuICAgICAgICBjb25zdCBpbnB1dEdyb3VwczogRGF0ZVJhbmdlQ29udHJvbEludGVudElucHV0W10gPSBnZW5lcmF0ZURhdGVzSW5wdXRHcm91cHModGhpcy5wcm9wcywgdW5wYWNrZWRTbG90cyk7XG4gICAgICAgIGZvciAoY29uc3QgaW5wdXRHcm91cCBvZiBpbnB1dEdyb3Vwcykge1xuICAgICAgICAgICAgaWYgKGlucHV0R3JvdXAudGFyZ2V0ID09PSBUYXJnZXRDYXRlZ29yeS5TdGFydERhdGUpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnNldFN0YXJ0RGF0ZShmaW5kRWRnZURhdGVPZkRhdGVSYW5nZShpbnB1dEdyb3VwLnZhbHVlLCB0cnVlKSk7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKGlucHV0R3JvdXAudGFyZ2V0ID09PSBUYXJnZXRDYXRlZ29yeS5FbmREYXRlKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5zZXRFbmREYXRlKGZpbmRFZGdlRGF0ZU9mRGF0ZVJhbmdlKGlucHV0R3JvdXAudmFsdWUsIGZhbHNlKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLmFja0RhdGVSYW5nZVZhbHVlQ2hhbmdlcyhyZXN1bHRCdWlsZGVyKTtcbiAgICAgICAgaWYgKHRoaXMud2FudHNUb0NvcnJlY3RSYW5nZShpbnB1dCkpIHtcbiAgICAgICAgICAgIHRoaXMuY29ycmVjdFJhbmdlKGlucHV0LCByZXN1bHRCdWlsZGVyKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLnN0YXRlLm9uRm9jdXMgPSB0cnVlO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIERldGVybWluZSB3aGV0aGVyIHRoZSBpbnB1dCBzaW5nbGUgZGF0ZSB2YWx1ZSBzaG91bGQgYmUgY29uc2lkZXJlZCBhcyBkYXRlIHJhbmdlXG4gICAgICpcbiAgICAgKiBUaGUgRGF0ZVJhbmdlQ29udHJvbCB3aWxsIHJlZ2FyZCBhIHNpbmdsZSB2YWx1ZSBpbnB1dCBhcyBkYXRlIHJhbmdlIHdoZW4gdGhlcmUncyBubyBjbGVhciB0YXJnZXQgYW5kXG4gICAgICogd2hlbiB0aGUgRGF0ZVJhbmdlQ29udHJvbCBpdHNlbGYgaXMgdW5kZXIgZm9jdXNcbiAgICAgKiBFLkcuICdzZXQgcmFuZ2UgdG8gMjAxOCcsIHdoZXJlIDIwMTggd2lsbCBiZSByZWdhcmRlZCBhcyBhIHJhbmdlIGFuZCBib3RoIHN0YXJ0IGRhdGUgYW5kIGVuZCBkYXRlIHdpbGwgYmUgc2V0IHRvIDIwMThcbiAgICAgKiBAcGFyYW0gaW5wdXRcbiAgICAgKi9cbiAgICBpc0RhdGVJbnRlcnByZXRlZEFzRGF0ZVJhbmdlKGlucHV0OiBDb250cm9sSW5wdXQpOiBib29sZWFuIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIG9rSWYoSW5wdXRVdGlsLmlzU2luZ2xlVmFsdWVDb250cm9sSW50ZW50KGlucHV0LCBBbWF6b25CdWlsdEluU2xvdFR5cGUuREFURSkpO1xuICAgICAgICAgICAgY29uc3QgaW50ZW50ID0gKGlucHV0LnJlcXVlc3QgYXMgSW50ZW50UmVxdWVzdCkuaW50ZW50O1xuICAgICAgICAgICAgY29uc3QgdW5wYWNrZWRTbG90cyA9IHVucGFja1NpbmdsZVZhbHVlQ29udHJvbEludGVudChpbnRlbnQpO1xuICAgICAgICAgICAgb2tJZihJbnB1dFV0aWwudGFyZ2V0SXNNYXRjaE9yVW5kZWZpbmVkKHVucGFja2VkU2xvdHMudGFyZ2V0LCB0aGlzLnByb3BzLmludGVyYWN0aW9uTW9kZWwudGFyZ2V0cy5zZWxmKSk7XG4gICAgICAgICAgICBva0lmKElucHV0VXRpbC5hY3Rpb25Jc01hdGNoT3JVbmRlZmluZWQodW5wYWNrZWRTbG90cy5hY3Rpb24sIHRoaXMucHJvcHMuaW50ZXJhY3Rpb25Nb2RlbC5hY3Rpb25zLnNldCkgfHwgSW5wdXRVdGlsLmFjdGlvbklzTWF0Y2hPclVuZGVmaW5lZCh1bnBhY2tlZFNsb3RzLmFjdGlvbiwgdGhpcy5wcm9wcy5pbnRlcmFjdGlvbk1vZGVsLmFjdGlvbnMuY2hhbmdlKSk7XG5cbiAgICAgICAgICAgIHRoaXMuaGFuZGxlRnVuYyA9IHRoaXMuaGFuZGxlRGF0ZVJhbmdlSW5wdXQ7XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICBjYXRjaCAoZSkge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlSWZHdWFyZEZhaWxlZChlKTtcbiAgICAgICAgfVxuICAgIH1cblxuXG5cbiAgICBoYW5kbGVEYXRlUmFuZ2VJbnB1dChpbnB1dDogQ29udHJvbElucHV0LCByZXN1bHRCdWlsZGVyOiBDb250cm9sUmVzdWx0QnVpbGRlcik6IHZvaWQge1xuICAgICAgICBjb25zdCBpbnRlbnQgPSAoaW5wdXQucmVxdWVzdCBhcyBJbnRlbnRSZXF1ZXN0KS5pbnRlbnQ7XG4gICAgICAgIGNvbnN0IHsgdmFsdWVTdHIgfSA9IHVucGFja1NpbmdsZVZhbHVlQ29udHJvbEludGVudChpbnRlbnQpO1xuXG4gICAgICAgIHRoaXMuc2V0U3RhcnREYXRlKGZpbmRFZGdlRGF0ZU9mRGF0ZVJhbmdlKHZhbHVlU3RyLCB0cnVlKSk7XG4gICAgICAgIHRoaXMuc2V0RW5kRGF0ZShmaW5kRWRnZURhdGVPZkRhdGVSYW5nZSh2YWx1ZVN0ciwgZmFsc2UpKTtcbiAgICAgICAgdGhpcy5hY2tEYXRlUmFuZ2VWYWx1ZUNoYW5nZXMocmVzdWx0QnVpbGRlcik7XG4gICAgICAgIGlmICh0aGlzLndhbnRzVG9Db3JyZWN0UmFuZ2UoaW5wdXQpKSB7XG4gICAgICAgICAgICB0aGlzLmNvcnJlY3RSYW5nZShpbnB1dCwgcmVzdWx0QnVpbGRlcik7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5zdGF0ZS5vbkZvY3VzID0gdHJ1ZTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBEZXRlcm1pbmUgd2hldGhlciB0aGUgaW5wdXQgYWN0aW9uIGlzIHRhcmdldGluZyBib3RoIHN0YXJ0IGRhdGUgYW5kIGVuZCBkYXRlXG4gICAgICpcbiAgICAgKiBFLkcuICdDaGFuZ2Ugc3RhcnQgZGF0ZSBhbmQgZW5kIGRhdGUnXG4gICAgICogQHBhcmFtIGlucHV0XG4gICAgICovXG4gICAgaXNDaGFuZ2VCb3RoKGlucHV0OiBDb250cm9sSW5wdXQpOiBib29sZWFuIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIG9rSWYoSW5wdXRVdGlsLmlzSW50ZW50KGlucHV0LCBDb25qdW5jdGlvbkNvbnRyb2xJbnRlbnQubmFtZSkpO1xuICAgICAgICAgICAgY29uc3QgaW50ZW50ID0gKGlucHV0LnJlcXVlc3QgYXMgSW50ZW50UmVxdWVzdCkuaW50ZW50O1xuICAgICAgICAgICAgY29uc3QgdW5wYWNrZWRTbG90cyA9IHVucGFja0Nvbmp1bmN0aW9uQ29udHJvbEludGVudChpbnRlbnQpO1xuICAgICAgICAgICAgb2tJZihJbnB1dFV0aWwuZmVlZGJhY2tJc01hdGNoT3JVbmRlZmluZWQodW5wYWNrZWRTbG90cy5mZWVkYmFjaywgWyQuRmVlZGJhY2suQWZmaXJtLCAkLkZlZWRiYWNrLkRpc2FmZmlybV0pKTtcbiAgICAgICAgICAgIGNvbnN0IGlucHV0czogQWN0aW9uQW5kVGFza1tdID0gZ2VuZXJhdGVBY3Rpb25UYXNrUGFpcnModW5wYWNrZWRTbG90cyk7XG4gICAgICAgICAgICBmb3IgKGNvbnN0IGlucHV0IG9mIGlucHV0cykge1xuICAgICAgICAgICAgICAgIG9rSWYoSW5wdXRVdGlsLnRhcmdldElzTWF0Y2hPclVuZGVmaW5lZChpbnB1dC50YXJnZXQsIHRoaXMucHJvcHMuaW50ZXJhY3Rpb25Nb2RlbC50YXJnZXRzLnN0YXJ0RGF0ZSkgfHwgSW5wdXRVdGlsLnRhcmdldElzTWF0Y2hPclVuZGVmaW5lZChpbnB1dC50YXJnZXQsIHRoaXMucHJvcHMuaW50ZXJhY3Rpb25Nb2RlbC50YXJnZXRzLmVuZERhdGUpKTtcbiAgICAgICAgICAgICAgICBva0lmKElucHV0VXRpbC5hY3Rpb25Jc1NldE9yVW5kZWZpbmVkKGlucHV0LmFjdGlvbiwgdGhpcy5wcm9wcy5pbnRlcmFjdGlvbk1vZGVsLmFjdGlvbnMuc2V0KSB8fCBJbnB1dFV0aWwuYWN0aW9uSXNNYXRjaChpbnB1dC5hY3Rpb24sIHRoaXMucHJvcHMuaW50ZXJhY3Rpb25Nb2RlbC5hY3Rpb25zLmNoYW5nZSkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy5oYW5kbGVGdW5jID0gdGhpcy5oYW5kbGVDaGFuZ2VWYWx1ZTtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIGNhdGNoIChlKSB7IHJldHVybiBmYWxzZUlmR3VhcmRGYWlsZWQoZSk7IH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBEZXRlcm1pbmUgd2hldGhlciB0aGUgaW5wdXQgYWN0aW9uIGlzIHRhcmdldGluZyBkYXRlIHJhbmdlXG4gICAgICpcbiAgICAgKiBFLkcuICdDaGFuZ2UnLCAnQ2hhbmdlIGRhdGUnXG4gICAgICogQHBhcmFtIGlucHV0XG4gICAgICovXG4gICAgaXNDaGFuZ2VSYW5nZShpbnB1dDogQ29udHJvbElucHV0KTogYm9vbGVhbiB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBva0lmKElucHV0VXRpbC5pc0ludGVudChpbnB1dCwgR2VuZXJhbENvbnRyb2xJbnRlbnQubmFtZSkpO1xuICAgICAgICAgICAgY29uc3QgaW50ZW50ID0gKGlucHV0LnJlcXVlc3QgYXMgSW50ZW50UmVxdWVzdCkuaW50ZW50O1xuICAgICAgICAgICAgY29uc3QgdW5wYWNrZWRTbG90cyA9IHVucGFja0dlbmVyYWxDb250cm9sSW50ZW50KGludGVudCk7XG4gICAgICAgICAgICBva0lmKElucHV0VXRpbC5mZWVkYmFja0lzTWF0Y2hPclVuZGVmaW5lZCh1bnBhY2tlZFNsb3RzLmZlZWRiYWNrLCBbJC5GZWVkYmFjay5BZmZpcm0sICQuRmVlZGJhY2suRGlzYWZmaXJtXSkpO1xuICAgICAgICAgICAgb2tJZihJbnB1dFV0aWwudGFyZ2V0SXNNYXRjaE9yVW5kZWZpbmVkKHVucGFja2VkU2xvdHMudGFyZ2V0LCB0aGlzLnByb3BzLmludGVyYWN0aW9uTW9kZWwudGFyZ2V0cy5zZWxmKSk7XG4gICAgICAgICAgICB0aGlzLmhhbmRsZUZ1bmMgPSB0aGlzLmhhbmRsZUNoYW5nZVZhbHVlO1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgY2F0Y2ggKGUpIHsgcmV0dXJuIGZhbHNlSWZHdWFyZEZhaWxlZChlKTsgfVxuICAgIH1cblxuICAgIGhhbmRsZUNoYW5nZVZhbHVlKGlucHV0OiBDb250cm9sSW5wdXQsIHJlc3VsdEJ1aWxkZXI6IENvbnRyb2xSZXN1bHRCdWlsZGVyKTogdm9pZCB7XG5cbiAgICAgICAgdGhpcy5zdGF0ZS5vcGVuUXVlc3Rpb24gPSB0cnVlO1xuICAgICAgICB0aGlzLnN0YXRlLm9uRm9jdXMgPSB0cnVlO1xuICAgICAgICByZXN1bHRCdWlsZGVyLmFkZEFjdChuZXcgUmVxdWVzdFZhbHVlQWN0KHRoaXMpKTtcbiAgICB9XG5cbiAgICAvLyBVcGRhdGUgcHJpb3JFbmREYXRlICYgcHJpb3JTdGFydERhdGVcbiAgICBwcml2YXRlIHVwZGF0ZVByaW9yKCk6IHZvaWQge1xuICAgICAgICB0aGlzLnN0YXRlLnByaW9yRW5kRGF0ZSA9IHRoaXMuc3RhdGUuZW5kRGF0ZTtcbiAgICAgICAgdGhpcy5zdGF0ZS5wcmlvclN0YXJ0RGF0ZSA9IHRoaXMuc3RhdGUuc3RhcnREYXRlO1xuICAgIH1cblxuICAgIHByaXZhdGUgYWNrRGF0ZVJhbmdlVmFsdWVDaGFuZ2VzKHJlc3VsdEJ1aWxkZXI6IENvbnRyb2xSZXN1bHRCdWlsZGVyKTogdm9pZCB7XG4gICAgICAgIC8vIFRoZSBEYXRlUmFuZ2VDb250cm9sIG9ubHkgYWNrIGRhdGUgcmFuZ2UgY2hhbmdlc1xuICAgICAgICAvLyBPbmx5IHN0YXJ0IGRhdGUgY2hhbmdlIG9yIGVuZCBkYXRlIGNoYW5nZSB3aWxsIGJlIGhhbmRsZWQgYnkgQ2hpbGQgY29udHJvbHNcbiAgICAgICAgaWYgKHRoaXMuc3RhdGUuc3RhcnREYXRlICE9PSB1bmRlZmluZWQgJiYgdGhpcy5zdGF0ZS5lbmREYXRlICE9PSB1bmRlZmluZWQgJiYgdGhpcy5zdGF0ZS5zdGFydERhdGUgIT09IHRoaXMuc3RhdGUucHJpb3JTdGFydERhdGUgJiYgdGhpcy5zdGF0ZS5lbmREYXRlICE9PSB0aGlzLnN0YXRlLnByaW9yRW5kRGF0ZSkge1xuICAgICAgICAgICAgLy8gSWYgaXQncyB0aGUgZmlyc3QgdGltZSB0byBzZXQgdGhlIHZhbHVlLCBEYXRlUmFuZ2VDb250cm9sIHdpbGwgc2VuZCBEYXRlUmFuZ2VTZXRBY3RcbiAgICAgICAgICAgIC8vIEFuZCB3aGVuIHRoZXJlJ3MgYW4gb2xkIHZhbHVlIGV4aXN0LCBEYXRlUmFuZ2VDb250cm9sIHdpbGwgc2VuZCBEYXRlUmFuZ2VDaGFuZ2VkQWN0XG4gICAgICAgICAgICB0aGlzLnN0YXRlLnByaW9yU3RhcnREYXRlICE9PSB1bmRlZmluZWQgJiYgdGhpcy5zdGF0ZS5wcmlvckVuZERhdGUgIT09IHVuZGVmaW5lZCA/XG4gICAgICAgICAgICAgICAgcmVzdWx0QnVpbGRlci5hZGRBY3QobmV3IERhdGVSYW5nZUNoYW5nZWRBY3QodGhpcywgdGhpcy5zdGF0ZS5zdGFydERhdGUsIHRoaXMuc3RhdGUuZW5kRGF0ZSwgdGhpcy5zdGF0ZS5wcmlvclN0YXJ0RGF0ZSwgdGhpcy5zdGF0ZS5wcmlvckVuZERhdGUpKSA6XG4gICAgICAgICAgICAgICAgcmVzdWx0QnVpbGRlci5hZGRBY3QobmV3IERhdGVSYW5nZVNldEFjdCh0aGlzLCB0aGlzLnN0YXRlLnN0YXJ0RGF0ZSwgdGhpcy5zdGF0ZS5lbmREYXRlKSk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICB2YWxpZGF0ZURhdGVSYW5nZShpbnB1dDogQ29udHJvbElucHV0KTogdHJ1ZSB8IFZhbGlkYXRpb25SZXN1bHQge1xuICAgICAgICBjb25zdCBsaXN0T2ZWYWxpZGF0aW9uRnVuYzogRGF0ZVJhbmdlVmFsaWRhdGlvbkZ1bmN0aW9uW10gPSB0eXBlb2YodGhpcy5wcm9wcy52YWxpZGF0aW9uLnJhbmdlVmFsaWQpID09PSAnZnVuY3Rpb24nID8gW3RoaXMucHJvcHMudmFsaWRhdGlvbi5yYW5nZVZhbGlkXSA6IHRoaXMucHJvcHMudmFsaWRhdGlvbi5yYW5nZVZhbGlkO1xuICAgICAgICBmb3IgKGNvbnN0IHZhbGlkYXRpb25GdW5jdGlvbiBvZiBsaXN0T2ZWYWxpZGF0aW9uRnVuYykge1xuICAgICAgICAgICAgY29uc3QgdmFsaWRhdGlvblJlc3VsdDogdHJ1ZSB8IFZhbGlkYXRpb25SZXN1bHQgPSB2YWxpZGF0aW9uRnVuY3Rpb24odGhpcy5zdGF0ZSwgaW5wdXQpO1xuICAgICAgICAgICAgaWYgKHZhbGlkYXRpb25SZXN1bHQgIT09IHRydWUpIHtcbiAgICAgICAgICAgICAgICBsb2cuZGVidWcoYERhdGVSYW5nZUNvbnRyb2wudmFsaWRhdGUoKTogdmFsaWRhdGlvbiBmYWlsZWQuIFJlYXNvbjogJHtKU09OLnN0cmluZ2lmeSh2YWxpZGF0aW9uUmVzdWx0LCBudWxsLCAyKX0uYCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHZhbGlkYXRpb25SZXN1bHQ7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuXG5cblxuICAgIHJlbmRlckFjdChhY3Q6IFN5c3RlbUFjdCwgaW5wdXQ6IENvbnRyb2xJbnB1dCwgYnVpbGRlcjogQ29udHJvbFJlc3BvbnNlQnVpbGRlcik6IHZvaWQge1xuXG4gICAgICAgIGlmIChhY3QgaW5zdGFuY2VvZiBSZXF1ZXN0VmFsdWVBY3QpIHtcbiAgICAgICAgICAgIGJ1aWxkZXIuYWRkUHJvbXB0RnJhZ21lbnQodGhpcy5ldmFsdWF0ZVByb21wdFByb3AoYWN0LCB0aGlzLnByb3BzLnByb21wdHMucmVxdWVzdFJhbmdlLCBpbnB1dCkpO1xuICAgICAgICAgICAgYnVpbGRlci5hZGRSZXByb21wdEZyYWdtZW50KHRoaXMuZXZhbHVhdGVQcm9tcHRQcm9wKGFjdCwgdGhpcy5wcm9wcy5yZXByb21wdHMucmVxdWVzdFJhbmdlLCBpbnB1dCkpO1xuICAgICAgICB9XG5cbiAgICAgICAgZWxzZSBpZiAoYWN0IGluc3RhbmNlb2YgRGF0ZVJhbmdlU2V0QWN0KSB7XG4gICAgICAgICAgICBidWlsZGVyLmFkZFByb21wdEZyYWdtZW50KHRoaXMuZXZhbHVhdGVQcm9tcHRQcm9wKGFjdCwgdGhpcy5wcm9wcy5wcm9tcHRzLnJhbmdlU2V0LCBpbnB1dCkpO1xuICAgICAgICAgICAgYnVpbGRlci5hZGRSZXByb21wdEZyYWdtZW50KHRoaXMuZXZhbHVhdGVQcm9tcHRQcm9wKGFjdCwgdGhpcy5wcm9wcy5yZXByb21wdHMucmFuZ2VTZXQsIGlucHV0KSk7XG4gICAgICAgIH1cblxuICAgICAgICBlbHNlIGlmIChhY3QgaW5zdGFuY2VvZiBEYXRlUmFuZ2VDaGFuZ2VkQWN0KSB7XG4gICAgICAgICAgICBidWlsZGVyLmFkZFByb21wdEZyYWdtZW50KHRoaXMuZXZhbHVhdGVQcm9tcHRQcm9wKGFjdCwgdGhpcy5wcm9wcy5wcm9tcHRzLnJhbmdlQ2hhbmdlZCwgaW5wdXQpKTtcbiAgICAgICAgICAgIGJ1aWxkZXIuYWRkUmVwcm9tcHRGcmFnbWVudCh0aGlzLmV2YWx1YXRlUHJvbXB0UHJvcChhY3QsIHRoaXMucHJvcHMucmVwcm9tcHRzLnJhbmdlQ2hhbmdlZCwgaW5wdXQpKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGVsc2UgaWYgKGFjdCBpbnN0YW5jZW9mIEludmFsaWRWYWx1ZUFjdCkge1xuICAgICAgICAgICAgYnVpbGRlci5hZGRQcm9tcHRGcmFnbWVudCh0aGlzLmV2YWx1YXRlUHJvbXB0UHJvcChhY3QsIHRoaXMucHJvcHMucHJvbXB0cy5pbnZhbGlkUmFuZ2UsIGlucHV0KSk7XG4gICAgICAgICAgICBidWlsZGVyLmFkZFJlcHJvbXB0RnJhZ21lbnQodGhpcy5ldmFsdWF0ZVByb21wdFByb3AoYWN0LCB0aGlzLnByb3BzLnJlcHJvbXB0cy5pbnZhbGlkUmFuZ2UsIGlucHV0KSk7XG4gICAgICAgIH1cblxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMudGhyb3dVbmhhbmRsZWRBY3RFcnJvcihhY3QpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgYXN5bmMgY2FuVGFrZUluaXRpYXRpdmUoaW5wdXQ6IENvbnRyb2xJbnB1dCk6IFByb21pc2U8Ym9vbGVhbj4ge1xuXG4gICAgICAgIHJldHVybiB0aGlzLm5lZWRzVmFsdWUoaW5wdXQpXG4gICAgICAgICAgICB8fCBhd2FpdCB0aGlzLmNhblRha2VJbml0aWF0aXZlQnlDaGlsZChpbnB1dClcbiAgICAgICAgICAgIHx8IHRoaXMuaGFzT3BlblF1ZXN0aW9uKClcbiAgICAgICAgICAgIHx8IHRoaXMud2FudHNUb0NvcnJlY3RSYW5nZShpbnB1dCk7XG4gICAgfVxuXG4gICAgYXN5bmMgdGFrZUluaXRpYXRpdmUoaW5wdXQ6IENvbnRyb2xJbnB1dCwgcmVzdWx0QnVpbGRlcjogQ29udHJvbFJlc3VsdEJ1aWxkZXIpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICAgICAgbG9nLmRlYnVnKGBEYXRlUmFuZ2VDb250cm9sWyR7dGhpcy5pZH1dOiB0YWtlSW5pdGlhdGl2ZSgpLiBFbnRlcmluZ2ApO1xuICAgICAgICBpZiAodGhpcy50YWtlSW5pdGlhdGl2ZUZ1bmMgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGhpcy50YWtlSW5pdGlhdGl2ZUZ1bmMoaW5wdXQsIHJlc3VsdEJ1aWxkZXIpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgbmVlZHNWYWx1ZShpbnB1dDogQ29udHJvbElucHV0KTogYm9vbGVhbiB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBva0lmKHRoaXMuZXZhbHVhdGVCb29sZWFuUHJvcCh0aGlzLnByb3BzLnJlcXVpcmVkLCBpbnB1dCkpO1xuICAgICAgICAgICAgb2tJZih0aGlzLnN0YXRlLnN0YXJ0RGF0ZSA9PT0gdW5kZWZpbmVkICYmIHRoaXMuc3RhdGUuZW5kRGF0ZSA9PT0gdW5kZWZpbmVkKTtcbiAgICAgICAgICAgIHRoaXMudGFrZUluaXRpYXRpdmVGdW5jID0gdGhpcy5yZXF1ZXN0RGF0ZVJhbmdlO1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgY2F0Y2ggKGUpIHsgcmV0dXJuIGZhbHNlSWZHdWFyZEZhaWxlZChlKTsgfVxuICAgIH1cblxuICAgIHJlcXVlc3REYXRlUmFuZ2UoaW5wdXQ6IENvbnRyb2xJbnB1dCwgcmVzdWx0QnVpbGRlcjogQ29udHJvbFJlc3VsdEJ1aWxkZXIpOiB2b2lkIHtcbiAgICAgICAgdGhpcy5zdGF0ZS5vbkZvY3VzID0gdHJ1ZTtcbiAgICAgICAgcmVzdWx0QnVpbGRlci5hZGRBY3QobmV3IFJlcXVlc3RWYWx1ZUFjdCh0aGlzKSk7XG4gICAgfVxuXG4gICAgaGFzT3BlblF1ZXN0aW9uKCk6IGJvb2xlYW4ge1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgb2tJZih0aGlzLnN0YXRlLm9wZW5RdWVzdGlvbiA9PT0gdHJ1ZSk7XG4gICAgICAgICAgICB0aGlzLnRha2VJbml0aWF0aXZlRnVuYyA9IHRoaXMucmVxdWVzdERhdGVSYW5nZTtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIGNhdGNoIChlKSB7IHJldHVybiBmYWxzZUlmR3VhcmRGYWlsZWQoZSk7IH1cbiAgICB9XG5cbiAgICB3YW50c1RvQ29ycmVjdFJhbmdlKGlucHV0OiBDb250cm9sSW5wdXQpOiBib29sZWFuIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIC8vIE9ubHkgZml4IHJhbmdlIHdoZW4gcmFuZ2UgaXMgc2V0IGFuZCB0aGVyZSdzIG5vIG9wZW4gcXVlc3Rpb25cbiAgICAgICAgICAgIG9rSWYoIXRoaXMubmVlZHNWYWx1ZShpbnB1dCkgJiYgIXRoaXMuaGFzT3BlblF1ZXN0aW9uKCkpO1xuICAgICAgICAgICAgY29uc3QgcmFuZ2VWYWxpZGF0aW9uUmVzdWx0OiB0cnVlIHwgVmFsaWRhdGlvblJlc3VsdCA9IHRoaXMudmFsaWRhdGVEYXRlUmFuZ2UoaW5wdXQpO1xuICAgICAgICAgICAgb2tJZihyYW5nZVZhbGlkYXRpb25SZXN1bHQgIT09IHRydWUpO1xuICAgICAgICAgICAgdGhpcy50YWtlSW5pdGlhdGl2ZUZ1bmMgPSB0aGlzLmNvcnJlY3RSYW5nZTtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIGNhdGNoIChlKSB7IHJldHVybiBmYWxzZUlmR3VhcmRGYWlsZWQoZSk7IH1cbiAgICB9XG5cbiAgICBjb3JyZWN0UmFuZ2UoaW5wdXQ6IENvbnRyb2xJbnB1dCwgcmVzdWx0QnVpbGRlcjogQ29udHJvbFJlc3VsdEJ1aWxkZXIpOiB2b2lkIHtcbiAgICAgICAgY29uc3QgcmFuZ2VWYWxpZGF0aW9uUmVzdWx0OiB0cnVlIHwgVmFsaWRhdGlvblJlc3VsdCA9IHRoaXMudmFsaWRhdGVEYXRlUmFuZ2UoaW5wdXQpO1xuICAgICAgICB0aGlzLnN0YXRlLm9uRm9jdXMgPSB0cnVlO1xuICAgICAgICBpZiAocmFuZ2VWYWxpZGF0aW9uUmVzdWx0ICE9PSB0cnVlKSB7XG4gICAgICAgICAgICBjb25zdCBzdGF0ZVZhbHVlID0gaTE4bmV4dC50KCdEQVRFX1JBTkdFX0NPTlRST0xfREVGQVVMVF9TVEFURV9WQUxVRV9GT1JfU1RBUlRfQU5EX0VORCcsIHsgc3RhcnQ6IHRoaXMuc3RhdGUuc3RhcnREYXRlLCBlbmQ6IHRoaXMuc3RhdGUuZW5kRGF0ZSB9KTtcbiAgICAgICAgICAgIHJlc3VsdEJ1aWxkZXIuYWRkQWN0KG5ldyBJbnZhbGlkVmFsdWVBY3Q8c3RyaW5nPih0aGlzLCB7dmFsdWU6IHN0YXRlVmFsdWUsIHJlYXNvbkNvZGU6IHJhbmdlVmFsaWRhdGlvblJlc3VsdC5yZWFzb25Db2RlLCByZW5kZXJlZFJlYXNvbjogcmFuZ2VWYWxpZGF0aW9uUmVzdWx0LnJlbmRlcmVkUmVhc29uIH0pKTtcbiAgICAgICAgICAgIC8vIGlmIHRoZSByYW5nZS12YWxpZGF0aW9uIGZhaWx1cmUgaXMgZHVlIHRvIG9uZSBkYXRlIGNoYW5naW5nLCBvbmx5IHJlcXVlc3QgdGhhdCBvbmVcbiAgICAgICAgICAgIGlmICh0aGlzLnN0YXRlLnN0YXJ0RGF0ZSAhPT0gdGhpcy5zdGF0ZS5wcmlvclN0YXJ0RGF0ZSAmJiB0aGlzLnN0YXRlLmVuZERhdGUgIT09IHRoaXMuc3RhdGUucHJpb3JFbmREYXRlKSB7XG4gICAgICAgICAgICAgICAgcmVzdWx0QnVpbGRlci5hZGRBY3QobmV3IFJlcXVlc3RWYWx1ZUFjdCh0aGlzKSk7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKHRoaXMuc3RhdGUuc3RhcnREYXRlICE9PSB0aGlzLnN0YXRlLnByaW9yU3RhcnREYXRlKSB7XG4gICAgICAgICAgICAgICAgcmVzdWx0QnVpbGRlci5hZGRBY3QobmV3IFJlcXVlc3RWYWx1ZUFjdCh0aGlzLnN0YXJ0RGF0ZUNvbnRyb2wpKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgcmVzdWx0QnVpbGRlci5hZGRBY3QobmV3IFJlcXVlc3RWYWx1ZUFjdCh0aGlzLmVuZERhdGVDb250cm9sKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBhc3luYyBjYW5UYWtlSW5pdGlhdGl2ZUJ5Q2hpbGQoaW5wdXQ6IENvbnRyb2xJbnB1dCk6IFByb21pc2U8Ym9vbGVhbj4ge1xuXG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBva0lmKGF3YWl0IHN1cGVyLmNhblRha2VJbml0aWF0aXZlQnlDaGlsZChpbnB1dCkpO1xuICAgICAgICAgICAgdGhpcy5zdGF0ZS5vbkZvY3VzID0gZmFsc2U7XG4gICAgICAgICAgICB0aGlzLnRha2VJbml0aWF0aXZlRnVuYyA9IHRoaXMudGFrZUluaXRpYXRpdmVCeUNoaWxkO1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgY2F0Y2ggKGUpIHsgcmV0dXJuIGZhbHNlSWZHdWFyZEZhaWxlZChlKTsgfVxuICAgIH1cbn1cbiJdfQ==