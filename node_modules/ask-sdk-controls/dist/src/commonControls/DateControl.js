"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.DateControl = exports.DateControlState = exports.DateControlValidations = exports.DateValidationFailReasonCode = void 0;
const tslib_1 = require("tslib");
const lodash_1 = tslib_1.__importDefault(require("lodash"));
const i18next_1 = tslib_1.__importDefault(require("i18next"));
const Strings_1 = require("../constants/Strings");
const Control_1 = require("../controls/Control");
const AmazonBuiltInSlotType_1 = require("../intents/AmazonBuiltInSlotType");
const GeneralControlIntent_1 = require("../intents/GeneralControlIntent");
const SingleValueControlIntent_1 = require("../intents/SingleValueControlIntent");
const ModelTypes_1 = require("../interactionModelGeneration/ModelTypes");
const Logger_1 = require("../logging/Logger");
const ContentActs_1 = require("../systemActs/ContentActs");
const InitiativeActs_1 = require("../systemActs/InitiativeActs");
const InputUtil_1 = require("../utils/InputUtil");
const Predicates_1 = require("../utils/Predicates");
const DateHelper_1 = require("./dateRangeControl/DateHelper");
const log = new Logger_1.Logger('AskSdkControls:DateControl');
var DateValidationFailReasonCode;
(function (DateValidationFailReasonCode) {
    DateValidationFailReasonCode["PAST_DATE_ONLY"] = "pastDateOnly";
    DateValidationFailReasonCode["FUTURE_DATE_ONLY"] = "futureDateOnly";
})(DateValidationFailReasonCode = exports.DateValidationFailReasonCode || (exports.DateValidationFailReasonCode = {}));
var DateControlValidations;
(function (DateControlValidations) {
    DateControlValidations.PAST_DATE_ONLY = (state, input) => {
        const startDate = DateHelper_1.getStartDateOfRange(state.value);
        const startDateInUTC = DateHelper_1.getUTCDate(startDate);
        const now = new Date();
        if (startDateInUTC > now) {
            return {
                reasonCode: DateValidationFailReasonCode.PAST_DATE_ONLY,
                renderedReason: i18next_1.default.t('DATE_CONTROL_DEFAULT_PROMPT_VALIDATION_FAIL_PAST_DATE_ONLY')
            };
        }
        return true;
    };
    DateControlValidations.FUTURE_DATE_ONLY = (state, input) => {
        const endDate = DateHelper_1.getEndDateOfRange(state.value);
        const endDateInUTC = DateHelper_1.getUTCDate(endDate);
        const now = new Date();
        if (endDateInUTC < now) {
            return {
                reasonCode: DateValidationFailReasonCode.FUTURE_DATE_ONLY,
                renderedReason: i18next_1.default.t('DATE_CONTROL_DEFAULT_PROMPT_VALIDATION_FAIL_FUTURE_DATE_ONLY')
            };
        }
        return true;
    };
})(DateControlValidations = exports.DateControlValidations || (exports.DateControlValidations = {}));
class DateControlState {
    constructor() {
        /**
         * Tracks whether the value is confirmed by the user, if confirmationRequired is set to true.
         */
        this.isValueConfirmed = false;
    }
}
exports.DateControlState = DateControlState;
class DateControl extends Control_1.Control {
    constructor(props) {
        super(props.id);
        this.state = new DateControlState();
        this.supportedControlIntents = [new SingleValueControlIntent_1.SingleValueControlIntent(AmazonBuiltInSlotType_1.AmazonBuiltInSlotType.DATE), new GeneralControlIntent_1.GeneralControlIntent()];
        this.rawProps = props;
        this.props = DateControl.mergeWithDefaultProps(props);
    }
    static mergeWithDefaultProps(props) {
        const defaults = {
            id: 'dummy',
            prompts: {
                confirmValue: (act) => i18next_1.default.t('DATE_CONTROL_DEFAULT_PROMPT_CONFIRM_VALUE', { value: act.payload.value }),
                valueAffirmed: i18next_1.default.t('DATE_CONTROL_DEFAULT_PROMPT_VALUE_AFFIRMED'),
                valueDisaffirmed: i18next_1.default.t('DATE_CONTROL_DEFAULT_PROMPT_VALUE_DISAFFIRMED'),
                valueSet: i18next_1.default.t('DATE_CONTROL_DEFAULT_PROMPT_VALUE_SET'),
                valueChanged: (act) => i18next_1.default.t('DATE_CONTROL_DEFAULT_PROMPT_VALUE_CHANGED', { old: act.payload.previousValue, new: act.payload.value }),
                invalidValue: (act) => {
                    if (act.payload.renderedReason !== undefined) {
                        return i18next_1.default.t('DATE_CONTROL_DEFAULT_PROMPT_INVALID_VALUE_WITH_REASON', { reason: act.payload.renderedReason });
                    }
                    return i18next_1.default.t('DATE_CONTROL_DEFAULT_PROMPT_GENERAL_INVALID_VALUE');
                },
                requestValue: i18next_1.default.t('DATE_CONTROL_DEFAULT_PROMPT_REQUEST_VALUE'),
                requestChangedValue: i18next_1.default.t('DATE_CONTROL_DEFAULT_PROMPT_REQUEST_CHANGED_VALUE'),
            },
            reprompts: {
                confirmValue: (act) => i18next_1.default.t('DATE_CONTROL_DEFAULT_REPROMPT_CONFIRM_VALUE', { value: act.payload.value }),
                valueAffirmed: i18next_1.default.t('DATE_CONTROL_DEFAULT_REPROMPT_VALUE_AFFIRMED'),
                valueDisaffirmed: i18next_1.default.t('DATE_CONTROL_DEFAULT_REPROMPT_VALUE_DISAFFIRMED'),
                valueSet: i18next_1.default.t('DATE_CONTROL_DEFAULT_REPROMPT_VALUE_SET'),
                valueChanged: (act) => i18next_1.default.t('DATE_CONTROL_DEFAULT_REPROMPT_VALUE_CHANGED', { old: act.payload.previousValue, new: act.payload.value }),
                invalidValue: (act) => {
                    if (act.payload.renderedReason !== undefined) {
                        return i18next_1.default.t('DATE_CONTROL_DEFAULT_REPROMPT_INVALID_VALUE_WITH_REASON', { reason: act.payload.renderedReason });
                    }
                    return i18next_1.default.t('DATE_CONTROL_DEFAULT_REPROMPT_GENERAL_INVALID_VALUE');
                },
                requestValue: i18next_1.default.t('DATE_CONTROL_DEFAULT_REPROMPT_REQUEST_VALUE'),
                requestChangedValue: i18next_1.default.t('DATE_CONTROL_DEFAULT_REPROMPT_REQUEST_CHANGED_VALUE'),
            },
            interactionModel: {
                actions: {
                    set: [Strings_1.Strings.Action.Set],
                    change: [Strings_1.Strings.Action.Change],
                },
                targets: ['date', Strings_1.Strings.Target.It]
            },
            validation: [],
            confirmationRequired: false,
            required: true
        };
        return lodash_1.default.merge(defaults, props);
    }
    canHandle(input) {
        return this.isSetWithValue(input)
            || this.isSetWithoutValue(input)
            || this.isChangeWithValue(input)
            || this.isChangeWithoutValue(input)
            || this.isBareValue(input)
            || this.isConfirmationAffirmed(input)
            || this.isConfirmationDisAffirmed(input);
    }
    /**
     * Test if the input is an implicit or explicit set-action with a value provided.
     *
     * @param input
     */
    isSetWithValue(input) {
        try {
            Predicates_1.okIf(InputUtil_1.InputUtil.isSingleValueControlIntent(input, AmazonBuiltInSlotType_1.AmazonBuiltInSlotType.DATE));
            const { feedback, action, target, valueStr } = SingleValueControlIntent_1.unpackSingleValueControlIntent(input.request.intent);
            Predicates_1.okIf(InputUtil_1.InputUtil.feedbackIsMatchOrUndefined(feedback, [Strings_1.Strings.Feedback.Affirm, Strings_1.Strings.Feedback.Disaffirm]));
            Predicates_1.okIf(InputUtil_1.InputUtil.actionIsMatch(action, this.props.interactionModel.actions.set));
            Predicates_1.okIf(InputUtil_1.InputUtil.targetIsMatchOrUndefined(target, this.props.interactionModel.targets));
            Predicates_1.okIf(InputUtil_1.InputUtil.valueStrDefined(valueStr));
            this.handleFunc = this.handleSetWithValue;
            return true;
        }
        catch (e) {
            return Predicates_1.falseIfGuardFailed(e);
        }
    }
    handleSetWithValue(input, resultBuilder) {
        const { valueStr } = SingleValueControlIntent_1.unpackSingleValueControlIntent(input.request.intent);
        this.setValue(valueStr);
        this.validateAndAddActs(input, resultBuilder, Strings_1.Strings.Action.Set);
        return;
    }
    /**
     * Test if the input is an implicit or explicit set-action with no value
     *
     * @param input
     */
    isSetWithoutValue(input) {
        try {
            Predicates_1.okIf(InputUtil_1.InputUtil.isIntent(input, GeneralControlIntent_1.GeneralControlIntent.name));
            const { feedback, action, target } = GeneralControlIntent_1.unpackGeneralControlIntent(input.request.intent);
            Predicates_1.okIf(InputUtil_1.InputUtil.feedbackIsMatchOrUndefined(feedback, [Strings_1.Strings.Feedback.Affirm, Strings_1.Strings.Feedback.Disaffirm]));
            Predicates_1.okIf(InputUtil_1.InputUtil.actionIsMatch(action, this.props.interactionModel.actions.set));
            Predicates_1.okIf(InputUtil_1.InputUtil.targetIsMatchOrUndefined(target, this.props.interactionModel.targets));
            this.handleFunc = this.handleSetWithoutValue;
            return true;
        }
        catch (e) {
            return Predicates_1.falseIfGuardFailed(e);
        }
    }
    handleSetWithoutValue(input, resultBuilder) {
        this.askElicitationQuestion(Strings_1.Strings.Action.Set, input, resultBuilder);
        return;
    }
    /**
     * Test if the input is a valid change-action with a value provided.
     *
     * @param input
     */
    isChangeWithValue(input) {
        try {
            Predicates_1.okIf(InputUtil_1.InputUtil.isSingleValueControlIntent(input, AmazonBuiltInSlotType_1.AmazonBuiltInSlotType.DATE));
            const { feedback, action, target, valueStr } = SingleValueControlIntent_1.unpackSingleValueControlIntent(input.request.intent);
            Predicates_1.okIf(InputUtil_1.InputUtil.feedbackIsMatchOrUndefined(feedback, [Strings_1.Strings.Feedback.Affirm, Strings_1.Strings.Feedback.Disaffirm]));
            Predicates_1.okIf(InputUtil_1.InputUtil.actionIsMatch(action, this.props.interactionModel.actions.change));
            Predicates_1.okIf(InputUtil_1.InputUtil.targetIsMatchOrUndefined(target, this.props.interactionModel.targets));
            Predicates_1.okIf(InputUtil_1.InputUtil.valueStrDefined(valueStr));
            this.handleFunc = this.handleChangeWithValue;
            return true;
        }
        catch (e) {
            return Predicates_1.falseIfGuardFailed(e);
        }
    }
    handleChangeWithValue(input, resultBuilder) {
        const { valueStr } = SingleValueControlIntent_1.unpackSingleValueControlIntent(input.request.intent);
        this.setValue(valueStr);
        this.validateAndAddActs(input, resultBuilder, this.state.value !== undefined ? Strings_1.Strings.Action.Change : Strings_1.Strings.Action.Set);
        return;
    }
    /**
     * Test if the input is a valid change-action without a value provided.
     *
     * @param input
     */
    isChangeWithoutValue(input) {
        try {
            Predicates_1.okIf(InputUtil_1.InputUtil.isIntent(input, GeneralControlIntent_1.GeneralControlIntent.name));
            const { feedback, action, target } = GeneralControlIntent_1.unpackGeneralControlIntent(input.request.intent);
            Predicates_1.okIf(InputUtil_1.InputUtil.feedbackIsMatchOrUndefined(feedback, [Strings_1.Strings.Feedback.Affirm, Strings_1.Strings.Feedback.Disaffirm]));
            Predicates_1.okIf(InputUtil_1.InputUtil.actionIsMatch(action, this.props.interactionModel.actions.change));
            Predicates_1.okIf(InputUtil_1.InputUtil.targetIsMatchOrUndefined(target, this.props.interactionModel.targets));
            this.handleFunc = this.handleChangeWithoutValue;
            return true;
        }
        catch (e) {
            return Predicates_1.falseIfGuardFailed(e);
        }
    }
    handleChangeWithoutValue(input, resultBuilder) {
        this.askElicitationQuestion(Strings_1.Strings.Action.Change, input, resultBuilder);
        return;
    }
    /**
     * Test if the input is a DateControlIntent with just a date provided.
     * If we aren't asking a question it is assumed the user meant 'set value'.
     * @param input
     */
    isBareValue(input) {
        try {
            Predicates_1.okIf(InputUtil_1.InputUtil.isSingleValueControlIntent(input, AmazonBuiltInSlotType_1.AmazonBuiltInSlotType.DATE));
            const { feedback, action, target, valueStr } = SingleValueControlIntent_1.unpackSingleValueControlIntent(input.request.intent);
            Predicates_1.okIf(InputUtil_1.InputUtil.feedbackIsUndefined(feedback));
            Predicates_1.okIf(InputUtil_1.InputUtil.actionIsUndefined(action));
            Predicates_1.okIf(InputUtil_1.InputUtil.targetIsMatchOrUndefined(target, this.props.interactionModel.targets));
            Predicates_1.okIf(InputUtil_1.InputUtil.valueStrDefined(valueStr));
            this.handleFunc = this.handleBareValue;
            return true;
        }
        catch (e) {
            return Predicates_1.falseIfGuardFailed(e);
        }
    }
    handleBareValue(input, resultBuilder) {
        var _a;
        const { valueStr } = SingleValueControlIntent_1.unpackSingleValueControlIntent(input.request.intent);
        this.setValue(valueStr);
        this.validateAndAddActs(input, resultBuilder, (_a = this.state.elicitationAction) !== null && _a !== void 0 ? _a : Strings_1.Strings.Action.Set);
        return;
    }
    isConfirmationAffirmed(input) {
        try {
            Predicates_1.okIf(InputUtil_1.InputUtil.isBareYes(input));
            Predicates_1.okIf(this.state.lastInitiativeAct === 'ConfirmValueAct');
            this.handleFunc = this.handleConfirmationAffirmed;
            return true;
        }
        catch (e) {
            return Predicates_1.falseIfGuardFailed(e);
        }
    }
    handleConfirmationAffirmed(input, resultBuilder) {
        const validationResult = this.validate(input);
        if (validationResult !== true) {
            resultBuilder.addAct(new ContentActs_1.InvalidValueAct(this, {
                value: this.state.value,
                reasonCode: validationResult.reasonCode,
                renderedReason: validationResult.renderedReason
            }));
            this.askElicitationQuestion(Strings_1.Strings.Action.Change, input, resultBuilder);
        }
        else {
            this.state.isValueConfirmed = true;
            resultBuilder.addAct(new ContentActs_1.ValueConfirmedAct(this, { value: this.state.value }));
            if (this.state.elicitationAction === Strings_1.Strings.Action.Change) {
                if (this.state.previousValue !== undefined) {
                    resultBuilder.addAct(new ContentActs_1.ValueChangedAct(this, { previousValue: this.state.previousValue, value: this.state.value }));
                }
                else {
                    throw new Error('ValueChangedAct should only be used if there is an actual previous value');
                }
            }
            else {
                resultBuilder.addAct(new ContentActs_1.ValueSetAct(this, { value: this.state.value }));
            }
        }
    }
    isConfirmationDisAffirmed(input) {
        try {
            Predicates_1.okIf(InputUtil_1.InputUtil.isBareNo(input));
            Predicates_1.okIf(this.state.lastInitiativeAct === 'ConfirmValueAct');
            this.handleFunc = this.handleConfirmationDisAffirmed;
            return true;
        }
        catch (e) {
            return Predicates_1.falseIfGuardFailed(e);
        }
    }
    handleConfirmationDisAffirmed(input, resultBuilder) {
        this.state.isValueConfirmed = false;
        resultBuilder.addAct(new ContentActs_1.ValueDisconfirmedAct(this, { value: this.state.value }));
        resultBuilder.addAct(new InitiativeActs_1.RequestValueAct(this));
    }
    async handle(input, resultBuilder) {
        log.debug(`DateControl[${this.id}]: handle(). Entering`);
        if (this.handleFunc === undefined) {
            const intent = input.request.intent;
            throw new Error(`${intent.name} can not be handled by ${this.constructor.name}.`);
        }
        this.handleFunc(input, resultBuilder);
    }
    canTakeInitiative(input) {
        return this.wantsToConfirmValue(input)
            || this.wantsToFixInvalidValue(input)
            || this.wantsToElicitValue(input);
    }
    takeInitiative(input, resultBuilder) {
        if (this.wantsToElicitValue(input)) {
            this.askElicitationQuestion(Strings_1.Strings.Action.Set, input, resultBuilder);
        }
        else if (this.wantsToFixInvalidValue(input)) {
            this.validateAndAddActs(input, resultBuilder, Strings_1.Strings.Action.Change);
        }
        else if (this.wantsToConfirmValue(input)) {
            this.confirmValue(input, resultBuilder);
        }
    }
    wantsToElicitValue(input) {
        return this.state.value === undefined && this.evaluateBooleanProp(this.props.required, input);
    }
    askElicitationQuestion(elicitationAction, input, resultBuilder) {
        this.state.elicitationAction = elicitationAction;
        switch (elicitationAction) {
            case Strings_1.Strings.Action.Set:
                resultBuilder.addAct(new InitiativeActs_1.RequestValueAct(this));
                return;
            case Strings_1.Strings.Action.Change:
                resultBuilder.addAct(new InitiativeActs_1.RequestChangedValueAct(this, { currentValue: this.state.value }));
                return;
            default:
                throw new Error(`Unhandled. Unknown elicitationAction: ${elicitationAction}`);
        }
    }
    validateAndAddActs(input, resultBuilder, elicitationAction) {
        this.state.elicitationAction = elicitationAction;
        if (this.wantsToConfirmValue(input)) {
            this.confirmValue(input, resultBuilder);
            return;
        }
        const validationResult = this.validate(input);
        if (validationResult === true) {
            if (elicitationAction === Strings_1.Strings.Action.Change) {
                // if elicitationAction == 'change', then the previousValue must be defined.
                if (this.state.previousValue !== undefined) {
                    resultBuilder.addAct(new ContentActs_1.ValueChangedAct(this, { previousValue: this.state.previousValue, value: this.state.value }));
                }
                else {
                    throw new Error('ValueChangedAct should only be used if there is an actual previous value');
                }
            }
            else {
                resultBuilder.addAct(new ContentActs_1.ValueSetAct(this, { value: this.state.value }));
            }
        }
        else {
            // feedback
            resultBuilder.addAct(new ContentActs_1.InvalidValueAct(this, {
                value: this.state.value,
                reasonCode: validationResult.reasonCode,
                renderedReason: validationResult.renderedReason
            }));
            this.askElicitationQuestion(elicitationAction, input, resultBuilder);
        }
        return;
    }
    wantsToConfirmValue(input) {
        return this.evaluateBooleanProp(this.props.confirmationRequired, input) && this.state.isValueConfirmed === false;
    }
    confirmValue(input, resultBuilder) {
        this.state.lastInitiativeAct = 'ConfirmValueAct';
        resultBuilder.addAct(new InitiativeActs_1.ConfirmValueAct(this, { value: this.state.value }));
    }
    wantsToFixInvalidValue(input) {
        return this.state.value !== undefined && this.validate(input) !== true;
    }
    validate(input) {
        const listOfValidationFunc = typeof (this.props.validation) === 'function' ? [this.props.validation] : this.props.validation;
        for (const validationFunction of listOfValidationFunc) {
            const validationResult = validationFunction(this.state, input);
            if (validationResult !== true) {
                log.debug(`DateControl.validate(): validation failed. Reason: ${JSON.stringify(validationResult, null, 2)}.`);
                return validationResult;
            }
        }
        return true;
    }
    setValue(value) {
        this.state.previousValue = this.state.value;
        this.state.value = value;
        this.state.isValueConfirmed = false;
    }
    clear() {
        this.state.value = undefined;
        this.state.previousValue = undefined;
        this.state.elicitationAction = undefined;
        this.state.isValueConfirmed = false;
    }
    renderAct(act, input, builder) {
        if (act instanceof InitiativeActs_1.RequestValueAct) {
            builder.addPromptFragment(this.evaluatePromptProp(act, this.props.prompts.requestValue, input));
            builder.addRepromptFragment(this.evaluatePromptProp(act, this.props.reprompts.requestValue, input));
            const slotElicitation = generateSlotElicitation();
            builder.addElicitSlotDirective(slotElicitation.slotName, slotElicitation.intent);
        }
        else if (act instanceof ContentActs_1.ValueSetAct) {
            builder.addPromptFragment(this.evaluatePromptProp(act, this.props.prompts.valueSet, input));
            builder.addRepromptFragment(this.evaluatePromptProp(act, this.props.reprompts.valueSet, input));
        }
        else if (act instanceof ContentActs_1.ValueChangedAct) {
            builder.addPromptFragment(this.evaluatePromptProp(act, this.props.prompts.valueChanged, input));
            builder.addRepromptFragment(this.evaluatePromptProp(act, this.props.reprompts.valueChanged, input));
        }
        else if (act instanceof ContentActs_1.InvalidValueAct) {
            builder.addPromptFragment(this.evaluatePromptProp(act, this.props.prompts.invalidValue, input));
            builder.addRepromptFragment(this.evaluatePromptProp(act, this.props.reprompts.invalidValue, input));
        }
        else if (act instanceof InitiativeActs_1.RequestChangedValueAct) {
            builder.addPromptFragment(this.evaluatePromptProp(act, this.props.prompts.requestChangedValue, input));
            builder.addRepromptFragment(this.evaluatePromptProp(act, this.props.reprompts.requestChangedValue, input));
        }
        else if (act instanceof InitiativeActs_1.ConfirmValueAct) {
            builder.addPromptFragment(this.evaluatePromptProp(act, this.props.prompts.confirmValue, input));
            builder.addRepromptFragment(this.evaluatePromptProp(act, this.props.reprompts.confirmValue, input));
        }
        else if (act instanceof ContentActs_1.ValueConfirmedAct) {
            builder.addPromptFragment(this.evaluatePromptProp(act, this.props.prompts.valueAffirmed, input));
            builder.addRepromptFragment(this.evaluatePromptProp(act, this.props.reprompts.valueAffirmed, input));
        }
        else if (act instanceof ContentActs_1.ValueDisconfirmedAct) {
            builder.addPromptFragment(this.evaluatePromptProp(act, this.props.prompts.valueDisaffirmed, input));
            builder.addRepromptFragment(this.evaluatePromptProp(act, this.props.reprompts.valueDisaffirmed, input));
        }
        else {
            this.throwUnhandledActError(act);
        }
    }
    updateInteractionModel(generator, imData) {
        generator.addControlIntent(new GeneralControlIntent_1.GeneralControlIntent(), imData);
        generator.addControlIntent(new SingleValueControlIntent_1.SingleValueControlIntent(AmazonBuiltInSlotType_1.AmazonBuiltInSlotType.DATE), imData);
        generator.addYesAndNoIntents();
        if (this.props.interactionModel.targets.includes('date')) {
            generator.addValuesToSlotType(ModelTypes_1.SharedSlotType.TARGET, i18next_1.default.t('DATE_CONTROL_DEFAULT_SLOT_VALUES_TARGET_DATE', { returnObjects: true }));
        }
    }
    getTargetIds() {
        return this.props.interactionModel.targets;
    }
}
exports.DateControl = DateControl;
function generateSlotElicitation() {
    const intent = {
        // try to do this using string constants rather than literals.
        name: "DateControlIntent",
        slots: {
            "feedback": { name: "feedback", value: '', confirmationStatus: 'NONE' },
            "action": { name: "action", value: '', confirmationStatus: 'NONE' },
            "target": { name: "target", value: '', confirmationStatus: 'NONE' },
            "AMAZON.DATE": { name: "AMAZON.DATE", value: '', confirmationStatus: 'NONE' },
            "head": { name: "head", value: '', confirmationStatus: 'NONE' },
            "tail": { name: "tail", value: '', confirmationStatus: 'NONE' },
            "preposition": { name: "preposition", value: '', confirmationStatus: 'NONE' }
        },
        confirmationStatus: "NONE"
    };
    return {
        intent,
        slotName: Strings_1.Strings.SlotType.AmazonDate
    };
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiRGF0ZUNvbnRyb2wuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi9zcmMvY29tbW9uQ29udHJvbHMvRGF0ZUNvbnRyb2wudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQWFBLDREQUF1QjtBQUN2Qiw4REFBOEI7QUFDOUIsa0RBQW9EO0FBQ3BELGlEQUEwRTtBQUkxRSw0RUFBeUU7QUFDekUsMEVBQW1HO0FBQ25HLGtGQUErRztBQUUvRyx5RUFBcUY7QUFDckYsOENBQTJDO0FBRTNDLDJEQUFtSTtBQUNuSSxpRUFBd0c7QUFJeEcsa0RBQStDO0FBQy9DLG9EQUErRDtBQUMvRCw4REFBbUc7QUFLbkcsTUFBTSxHQUFHLEdBQUcsSUFBSSxlQUFNLENBQUMsNEJBQTRCLENBQUMsQ0FBQztBQXdMckQsSUFBWSw0QkFHWDtBQUhELFdBQVksNEJBQTRCO0lBQ3BDLCtEQUErQixDQUFBO0lBQy9CLG1FQUFtQyxDQUFBO0FBQ3ZDLENBQUMsRUFIVyw0QkFBNEIsR0FBNUIsb0NBQTRCLEtBQTVCLG9DQUE0QixRQUd2QztBQUVELElBQWlCLHNCQUFzQixDQTZCdEM7QUE3QkQsV0FBaUIsc0JBQXNCO0lBQ3RCLHFDQUFjLEdBQTJCLENBQUMsS0FBdUIsRUFBRSxLQUFtQixFQUEyQixFQUFFO1FBRTVILE1BQU0sU0FBUyxHQUFHLGdDQUFtQixDQUFDLEtBQUssQ0FBQyxLQUFNLENBQUMsQ0FBQztRQUNwRCxNQUFNLGNBQWMsR0FBRyx1QkFBVSxDQUFDLFNBQVMsQ0FBQyxDQUFDO1FBRTdDLE1BQU0sR0FBRyxHQUFHLElBQUksSUFBSSxFQUFFLENBQUM7UUFDdkIsSUFBSSxjQUFjLEdBQUcsR0FBRyxFQUFFO1lBQ3RCLE9BQU87Z0JBQ0gsVUFBVSxFQUFFLDRCQUE0QixDQUFDLGNBQWM7Z0JBQ3ZELGNBQWMsRUFBRSxpQkFBTyxDQUFDLENBQUMsQ0FBQyw0REFBNEQsQ0FBQzthQUMxRixDQUFDO1NBQ0w7UUFDRCxPQUFPLElBQUksQ0FBQztJ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QUUsVUFBVSxFQUFFLEtBQUssRUFBRSxFQUFFLEVBQUUsa0JBQWtCLEVBQUUsTUFBTSxFQUFFO1lBQ3ZFLFFBQVEsRUFBRSxFQUFFLElBQUksRUFBRSxRQUFRLEVBQUUsS0FBSyxFQUFFLEVBQUUsRUFBRSxrQkFBa0IsRUFBRSxNQUFNLEVBQUU7WUFDbkUsUUFBUSxFQUFFLEVBQUUsSUFBSSxFQUFFLFFBQVEsRUFBRSxLQUFLLEVBQUUsRUFBRSxFQUFFLGtCQUFrQixFQUFFLE1BQU0sRUFBRTtZQUNuRSxhQUFhLEVBQUUsRUFBRSxJQUFJLEVBQUUsYUFBYSxFQUFFLEtBQUssRUFBRSxFQUFFLEVBQUUsa0JBQWtCLEVBQUUsTUFBTSxFQUFFO1lBQzdFLE1BQU0sRUFBRSxFQUFFLElBQUksRUFBRSxNQUFNLEVBQUUsS0FBSyxFQUFFLEVBQUUsRUFBRSxrQkFBa0IsRUFBRSxNQUFNLEVBQUU7WUFDL0QsTUFBTSxFQUFFLEVBQUUsSUFBSSxFQUFFLE1BQU0sRUFBRSxLQUFLLEVBQUUsRUFBRSxFQUFFLGtCQUFrQixFQUFFLE1BQU0sRUFBRTtZQUMvRCxhQUFhLEVBQUUsRUFBRSxJQUFJLEVBQUUsYUFBYSxFQUFFLEtBQUssRUFBRSxFQUFFLEVBQUUsa0JBQWtCLEVBQUUsTUFBTSxFQUFFO1NBQ2hGO1FBQ0Qsa0JBQWtCLEVBQUUsTUFBTTtLQUM3QixDQUFDO0lBRUYsT0FBTztRQUNILE1BQU07UUFDTixRQUFRLEVBQUUsaUJBQUMsQ0FBQyxRQUFRLENBQUMsVUFBVTtLQUNsQyxDQUFDO0FBQ04sQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbIi8qXG4gKiBDb3B5cmlnaHQgMjAyMCBBbWF6b24uY29tLCBJbmMuIG9yIGl0cyBhZmZpbGlhdGVzLiBBbGwgUmlnaHRzIFJlc2VydmVkLlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKS5cbiAqIFlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIEEgY29weSBvZiB0aGUgTGljZW5zZSBpcyBsb2NhdGVkIGF0XG4gKiAgICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIG9yIGluIHRoZSBcImxpY2Vuc2VcIiBmaWxlIGFjY29tcGFueWluZyB0aGlzIGZpbGUuIFRoaXMgZmlsZSBpcyBkaXN0cmlidXRlZFxuICogb24gYW4gXCJBUyBJU1wiIEJBU0lTLCBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyXG4gKiBleHByZXNzIG9yIGltcGxpZWQuIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZ1xuICogcGVybWlzc2lvbnMgYW5kIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG5pbXBvcnQgeyBJbnRlbnQsIEludGVudFJlcXVlc3QgfSBmcm9tIFwiYXNrLXNkay1tb2RlbFwiO1xuaW1wb3J0IF8gZnJvbSBcImxvZGFzaFwiO1xuaW1wb3J0IGkxOG5leHQgZnJvbSAnaTE4bmV4dCc7XG5pbXBvcnQgeyBTdHJpbmdzIGFzICQgfSBmcm9tIFwiLi4vY29uc3RhbnRzL1N0cmluZ3NcIjtcbmltcG9ydCB7IENvbnRyb2wsIENvbnRyb2xQcm9wcywgQ29udHJvbFN0YXRlIH0gZnJvbSAnLi4vY29udHJvbHMvQ29udHJvbCc7XG5pbXBvcnQgeyBDb250cm9sSW5wdXQgfSBmcm9tICcuLi9jb250cm9scy9Db250cm9sSW5wdXQnO1xuaW1wb3J0IHsgQ29udHJvbFJlc3VsdEJ1aWxkZXIgfSBmcm9tICcuLi9jb250cm9scy9Db250cm9sUmVzdWx0JztcbmltcG9ydCB7IEludGVyYWN0aW9uTW9kZWxDb250cmlidXRvciB9IGZyb20gJy4uL2NvbnRyb2xzL21peGlucy9JbnRlcmFjdGlvbk1vZGVsQ29udHJpYnV0b3InO1xuaW1wb3J0IHsgQW1hem9uQnVpbHRJblNsb3RUeXBlIH0gZnJvbSAnLi4vaW50ZW50cy9BbWF6b25CdWlsdEluU2xvdFR5cGUnO1xuaW1wb3J0IHsgR2VuZXJhbENvbnRyb2xJbnRlbnQsIHVucGFja0dlbmVyYWxDb250cm9sSW50ZW50IH0gZnJvbSAnLi4vaW50ZW50cy9HZW5lcmFsQ29udHJvbEludGVudCc7XG5pbXBvcnQgeyBTaW5nbGVWYWx1ZUNvbnRyb2xJbnRlbnQsIHVucGFja1NpbmdsZVZhbHVlQ29udHJvbEludGVudCB9IGZyb20gJy4uL2ludGVudHMvU2luZ2xlVmFsdWVDb250cm9sSW50ZW50JztcbmltcG9ydCB7IENvbnRyb2xJbnRlcmFjdGlvbk1vZGVsR2VuZXJhdG9yIH0gZnJvbSAnLi4vaW50ZXJhY3Rpb25Nb2RlbEdlbmVyYXRpb24vQ29udHJvbEludGVyYWN0aW9uTW9kZWxHZW5lcmF0b3InO1xuaW1wb3J0IHsgTW9kZWxEYXRhLCBTaGFyZWRTbG90VHlwZSB9IGZyb20gJy4uL2ludGVyYWN0aW9uTW9kZWxHZW5lcmF0aW9uL01vZGVsVHlwZXMnO1xuaW1wb3J0IHsgTG9nZ2VyIH0gZnJvbSBcIi4uL2xvZ2dpbmcvTG9nZ2VyXCI7XG5pbXBvcnQgeyBDb250cm9sUmVzcG9uc2VCdWlsZGVyIH0gZnJvbSAnLi4vcmVzcG9uc2VHZW5lcmF0aW9uL0NvbnRyb2xSZXNwb25zZUJ1aWxkZXInO1xuaW1wb3J0IHsgSW52YWxpZFZhbHVlQWN0LCBWYWx1ZUNoYW5nZWRBY3QsIFZhbHVlU2V0QWN0LCBWYWx1ZURpc2NvbmZpcm1lZEFjdCwgVmFsdWVDb25maXJtZWRBY3QgfSBmcm9tIFwiLi4vc3lzdGVtQWN0cy9Db250ZW50QWN0c1wiO1xuaW1wb3J0IHsgUmVxdWVzdENoYW5nZWRWYWx1ZUFjdCwgUmVxdWVzdFZhbHVlQWN0LCBDb25maXJtVmFsdWVBY3QgfSBmcm9tIFwiLi4vc3lzdGVtQWN0cy9Jbml0aWF0aXZlQWN0c1wiO1xuaW1wb3J0IHsgU3lzdGVtQWN0IH0gZnJvbSAnLi4vc3lzdGVtQWN0cy9TeXN0ZW1BY3QnO1xuaW1wb3J0IHsgU3RyaW5nT3JMaXN0IH0gZnJvbSAnLi4vdXRpbHMvQmFzaWNUeXBlcyc7XG5pbXBvcnQgeyBEZWVwUmVxdWlyZWQgfSBmcm9tICcuLi91dGlscy9EZWVwUmVxdWlyZWQnO1xuaW1wb3J0IHsgSW5wdXRVdGlsIH0gZnJvbSBcIi4uL3V0aWxzL0lucHV0VXRpbFwiO1xuaW1wb3J0IHsgZmFsc2VJZkd1YXJkRmFpbGVkLCBva0lmIH0gZnJvbSAnLi4vdXRpbHMvUHJlZGljYXRlcyc7XG5pbXBvcnQgeyBnZXRFbmREYXRlT2ZSYW5nZSwgZ2V0U3RhcnREYXRlT2ZSYW5nZSwgZ2V0VVRDRGF0ZSB9IGZyb20gJy4vZGF0ZVJhbmdlQ29udHJvbC9EYXRlSGVscGVyJztcbmltcG9ydCB7IFZhbGlkYXRpb25SZXN1bHQgfSBmcm9tICcuLi9jb250cm9scy9WYWxpZGF0aW9uUmVzdWx0JztcblxuXG5cbmNvbnN0IGxvZyA9IG5ldyBMb2dnZXIoJ0Fza1Nka0NvbnRyb2xzOkRhdGVDb250cm9sJyk7XG5cbmV4cG9ydCB0eXBlIERhdGVWYWxpZGF0aW9uRnVuY3Rpb24gPSAoc3RhdGU6IERhdGVDb250cm9sU3RhdGUsIGlucHV0OiBDb250cm9sSW5wdXQpID0+IHRydWUgfCBWYWxpZGF0aW9uUmVzdWx0O1xuXG5leHBvcnQgdHlwZSBEYXRlQ29udHJvbEFjdGlvblByb3BzID0ge1xuICAgIC8qKlxuICAgICAqIEFjdGlvbiBzbG90LXZhbHVlcyB0aGUgdXNlciBjYW4gdXNlIHRvIHJlZmVyIHRvIHRoZSBgc2V0YCBhY3Rpb24tY2FwYWJpbGl0eSBvZiB0aGlzIGNvbnRyb2wuXG4gICAgICpcbiAgICAgKiBFYWNoIGlkZW50aWZlciBpcyBhbiBgaWRgIGZvciBhIHZhbHVlIG9mIHRoZSBgQWN0aW9uYCBzbG90IHR5cGUgaW4gdGhlIGludGVyYWN0aW9uIG1vZGVsLlxuICAgICAqXG4gICAgICogUHVycG9zZTpcbiAgICAgKiAqIFRoaXMgZmxleGliaWxpdHkgaXMgdXNlZnVsIHdoZW4gYW4gYWN0aW9uIHZlcmIgKHN1Y2ggYXMgJ3Nob3cnKSBtaWdodCBoYXZlIGRpZmZlcmVudCBtZWFuaW5nIHRvIGRpZmZlcmVudCBjb250cm9scy5cbiAgICAgKiAqIElmIHRoZSBmbGV4aWJpbGl0eSBpcyBub3QgcmVxdWlyZWQgaXQgaXMgc3VmZmljaWVudCB0byBhZGQgc3lub255bXMgdG8gdGhlIHN0YW5kYXJkIFwic2V0XCIgYWN0aW9uLXNsb3QtdmFsdWUuXG4gICAgICpcbiAgICAgKiBFeGFtcGxlOlxuICAgICAqIFRoZSBjb250cm9sIGluc3RhbmNlIGJlbG93IHVzZSB0aGlzIHByb3AgdG8gcmVwcmVzZW50IHRoYXQgJ3Nob3cgdHVlc2RheScgaXMgZXF1aXZhbGVudFxuICAgICAqIHRvICdzZXQgdGhlIGRhdGUgdG8gdHVlc2RheScgZm9yIHRoaXMgY29udHJvbC5cbiAgICAgKlxuICAgICAqXG4gICAgICogYGBgXG4gICAgICogbmV3IERhdGVDb250cm9sKFxuICAgICAqICAgIHtcbiAgICAgKiAgICAgIG5sdToge1xuICAgICAqICAgICAgICAgIGFjdGlvbnM6IHtcbiAgICAgKiAgICAgICAgICAgICAgc2V0OiBbJ3Nob3cnXSAgICAgICA8LS0tLS0tICAgJ3Nob3cnIGlzIGEgc2xvdCBJRCBmb3IgdGhlIGFjdGlvbiBzbG90LXR5cGUuXG4gICAgICogICAgICAgICAgfSxcbiAgICAgKiAgICAgIH1cbiAgICAgKiAgICAgIC4uLlxuICAgICAqICAgIH1cbiAgICAgKiAgICk7XG4gICAgICpcbiAgICAgKiAtLS1cbiAgICAgKlxuICAgICAqIEludGVyYWN0aW9uTW9kZWwgKGVuLVVTLmpzb24pOlxuICAgICAqIC4uLlxuICAgICAqICAgICAgdHlwZXM6IFtcbiAgICAgKiAgICAgICAgICAgICAge1xuICAgICAqICAgICAgICAgICAgICAgbmFtZTogXCJhY3Rpb25zXCIsXG4gICAgICogICAgICAgICAgICAgICB2YWx1ZXM6IFtcbiAgICAgKiAgICAgICAgICAgICAgICAge1xuICAgICAqICAgICAgICAgICAgICAgICAgIGlkOiBcInNob3dcIiwgICAgICAgIDwtLS0tLS0gICBJRCByZWZlcmVuY2VkIGJ5IHRoZSBjb250cm9sXG4gICAgICogICAgICAgICAgICAgICAgICAgbmFtZToge1xuICAgICAqICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IFwic2hvd1wiLFxuICAgICAqICAgICAgICAgICAgICAgICAgICAgICAuLi5cbiAgICAgKiB9XG4gICAgICogYGBgXG4gICAgICovXG4gICAgc2V0Pzogc3RyaW5nW107XG4gICAgLyoqXG4gICAgICogQWN0aW9uIHNsb3QtdmFsdWVzIHRoZSB1c2VyIGNhbiB1c2UgdG8gcmVmZXIgdG8gdGhlIGBjaGFuZ2VgIGFjdGlvbi1jYXBhYmlsaXR5IG9mIHRoaXMgY29udHJvbC5cbiAgICAgKlxuICAgICAqIEVhY2ggaWRlbnRpZmVyIGlzIGFuIGBpZGAgZm9yIGEgdmFsdWUgb2YgdGhlIGBBY3Rpb25gIHNsb3QgaW4gdGhlIGludGVyYWN0aW9uIG1vZGVsLlxuICAgICAqXG4gICAgICogUHVycG9zZTpcbiAgICAgKiAqIFRoaXMgZmxleGliaWxpdHkgaXMgdXNlZnVsIHdoZW4gYW4gYWN0aW9uIHZlcmIgKHN1Y2ggYXMgJ3VwZGF0ZScpIG1pZ2h0IGhhdmUgZGlmZmVyZW50IG1lYW5pbmcgdG8gZGlmZmVyZW50IGNvbnRyb2xzLlxuICAgICAqICogSWYgdGhlIGZsZXhpYmlsaXR5IGlzIG5vdCByZXF1aXJlZCBpdCBpcyBzdWZmaWNpZW50IHRvIGFkZCBzeW5vbnltcyB0byB0aGUgc3RhbmRhcmQgXCJjaGFuZ2VcIiBhY3Rpb24tc2xvdC12YWx1ZS5cbiAgICAgKlxuICAgICAqIEZ1cnRoZXIgaW5mb3JtYXRpb25cbiAgICAgKiAgKiBTZWUgdGhlIGBzZXRgIHByb3BlcnR5IGZvciBtb3JlIGluZm9ybWF0aW9uLlxuICAgICAqL1xuICAgIGNoYW5nZT86IHN0cmluZ1tdO1xufTtcblxuZXhwb3J0IGludGVyZmFjZSBEYXRlQ29udHJvbFByb21wdFByb3BzIHtcbiAgICB2YWx1ZVNldD86IFN0cmluZ09yTGlzdCB8ICgoYWN0OiBWYWx1ZVNldEFjdDxudW1iZXI+LCBpbnB1dDogQ29udHJvbElucHV0KSA9PiBTdHJpbmdPckxpc3QpO1xuICAgIHZhbHVlQ2hhbmdlZD86IFN0cmluZ09yTGlzdCB8ICgoYWN0OiBWYWx1ZUNoYW5nZWRBY3Q8bnVtYmVyPiwgaW5wdXQ6IENvbnRyb2xJbnB1dCkgPT4gU3RyaW5nT3JMaXN0KTtcbiAgICBpbnZhbGlkVmFsdWU/OiBTdHJpbmdPckxpc3QgfCAoKGFjdDogSW52YWxpZFZhbHVlQWN0PG51bWJlcj4sIGlucHV0OiBDb250cm9sSW5wdXQpID0+IFN0cmluZ09yTGlzdCk7XG4gICAgcmVxdWVzdFZhbHVlPzogU3RyaW5nT3JMaXN0IHwgKChhY3Q6IFJlcXVlc3RWYWx1ZUFjdCwgaW5wdXQ6IENvbnRyb2xJbnB1dCkgPT4gU3RyaW5nT3JMaXN0KTtcbiAgICByZXF1ZXN0Q2hhbmdlZFZhbHVlPzogU3RyaW5nT3JMaXN0IHwgKChhY3Q6IFJlcXVlc3RDaGFuZ2VkVmFsdWVBY3QsIGlucHV0OiBDb250cm9sSW5wdXQpID0+IFN0cmluZ09yTGlzdCk7XG4gICAgY29uZmlybVZhbHVlPzogU3RyaW5nT3JMaXN0IHwgKChhY3Q6IENvbmZpcm1WYWx1ZUFjdDxudW1iZXI+LCBpbnB1dDogQ29udHJvbElucHV0KSA9PiBTdHJpbmdPckxpc3QpO1xuICAgIHZhbHVlRGlzYWZmaXJtZWQ/OiBTdHJpbmdPckxpc3QgfCAoKGFjdDogVmFsdWVEaXNjb25maXJtZWRBY3Q8bnVtYmVyPiwgaW5wdXQ6IENvbnRyb2xJbnB1dCkgPT4gU3RyaW5nT3JMaXN0KTtcbiAgICB2YWx1ZUFmZmlybWVkPzogU3RyaW5nT3JMaXN0IHwgKChhY3Q6IFZhbHVlQ29uZmlybWVkQWN0PG51bWJlcj4sIGlucHV0OiBDb250cm9sSW5wdXQpID0+IFN0cmluZ09yTGlzdCk7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgRGF0ZUNvbnRyb2xQcm9wcyBleHRlbmRzIENvbnRyb2xQcm9wcyB7XG4gICAgaWQ6IHN0cmluZztcblxuICAgIHByb21wdHM/OiBEYXRlQ29udHJvbFByb21wdFByb3BzO1xuICAgIHJlcHJvbXB0cz86IERhdGVDb250cm9sUHJvbXB0UHJvcHM7XG5cbiAgICAvKipcbiAgICAgKiBQcm9wcyB0byBjdXN0b21pemUgdGhlIHJlbGF0aW9uc2hpcCBiZXR3ZWVuIHRoZSBpbnRlcmFjdGlvbiBtb2RlbCBhbmQgdGhlIGNvbnRyb2wuXG4gICAgICovXG4gICAgaW50ZXJhY3Rpb25Nb2RlbD86IERhdGVDb250cm9sSW50ZXJhY3Rpb25Nb2RlbFByb3BzO1xuXG4gICAgLyoqXG4gICAgICogRGV0ZXJtaW5lcyBpZiB0aGUgdmFsdWUgaXMgdmFsaWQuXG4gICAgICpcbiAgICAgKiBEZWZhdWx0OiBgdHJ1ZWAsIGkuZS4gYW55IHZhbHVlIGlzIHZhbGlkLlxuICAgICAqXG4gICAgICogVXNhZ2U6XG4gICAgICogICogVmFsaWRhdGlvbiBmdW5jdGlvbnMgcmV0dXJuIGVpdGhlciBgdHJ1ZWAgb3IgYW4gYGVycm9yQ29kZWAgc3RyaW5nLiAgVGhlIGBlcnJvckNvZGVgIGNhblxuICAgICAqICAgIGJlIGNvbnZlcnRlZCBpbnRvIGEgc3VyZmFjZSBmb3JtIGR1cmluZyB0aGUgcmVuZGVyIHBoYXNlLlxuICAgICAqICAqIENvbW1vbiB2YWxpZGF0aW9uIGZ1bmN0aW9ucyBhcmUgZGVmaW5lZCBpbiB0aGUgYERhdGVDb250cm9sVmFsaWRhdGlvbnNgIG5hbWVzcGFjZVxuICAgICAqICAgIHdoaWNoIGNhbiBiZSBhZGRlZCBkaXJlY3RseSB0byB0aGlzIHByb3AuIGUuZy46XG4gICAgICogYGBgXG4gICAgICogICAgdmFsaWQ6IERhdGVDb250cm9sVmFsaWRhdGlvbnMuRlVUVVJFX0RBVEVfT05MWSxcbiAgICAgKiBgYGBcbiAgICAgKi9cbiAgICB2YWxpZGF0aW9uPzogRGF0ZVZhbGlkYXRpb25GdW5jdGlvbiB8IERhdGVWYWxpZGF0aW9uRnVuY3Rpb25bXTtcblxuICAgIC8qKlxuICAgICAqIERldGVybWluZXMgaWYgdGhlIHZhbHVlIGNvbGxlY3RlZCBieSB0aGlzIENvbnRyb2wgaXMgcmVxdWlyZWQgYnkgdGhlIHNraWxsLlxuICAgICAqXG4gICAgICogQmVoYXZpb3I6XG4gICAgICogICogSWYgYHJlcXVpcmVkID0gdHJ1ZWAsIHRoZSBjb250cm9sIHdpbGwgdGFrZSB0aGUgaW5pdGlhdGl2ZSB0byByZXF1ZXN0IGEgdmFsdWUgZnJvbSB0aGUgdXNlci5cbiAgICAgKi9cbiAgICByZXF1aXJlZD86IGJvb2xlYW4gfCAoKGlucHV0OiBDb250cm9sSW5wdXQpID0+IGJvb2xlYW4pO1xuXG4gICAgLyoqXG4gICAgICogV2hldGhlciB0aGUgQ29udHJvbCBoYXMgdG8gY29uZmlybSB0aGUgdmFsdWUgd2hpY2ggdXNlciBwcm92aWRlcy5cbiAgICAgKiBcbiAgICAgKiBCZWhhdmlvcjpcbiAgICAgKiAgLSBpZiB0cnVlLCB0aGUgQ29udHJvbCB3aWxsIGdlbmVyYXRlIGEgY29uZmlybWF0aW9uIHF1ZXN0aW9uIHdoZW4gYSB2YWx1ZSBpcyBwcm92aWRlZC5cbiAgICAgKi9cbiAgICBjb25maXJtYXRpb25SZXF1aXJlZD86IGJvb2xlYW4gfCAoKGlucHV0OiBDb250cm9sSW5wdXQpID0+IGJvb2xlYW4pO1xuXG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgRGF0ZUNvbnRyb2xJbnRlcmFjdGlvbk1vZGVsUHJvcHMge1xuICAgIC8qKlxuICAgICAqIFRhcmdldHMgdGhlIHVzZXIgY2FuIHVzZSB0byByZWZlciB0byBhIHRoaXMgY29udHJvbC5cbiAgICAgKlxuICAgICAqIEVhY2ggaWRlbnRpZmVyIGlzIGFuIGBpZGAgZm9yIGEgdmFsdWUgb2YgdGhlIGBUYXJnZXRgIHNsb3QgaW4gdGhlIGludGVyYWN0aW9uIG1vZGVsLlxuICAgICAqXG4gICAgICogRm9yIGV4YW1wbGUsIHRoZSBjb250cm9sIG1heSBoYXZlIGEgdGFyZ2V0IG9mICdwZXRBZ2UnIGFuZCBhbiBhc3NvY2lhdGVkIGVudHJ5IGluIHRoZVxuICAgICAqIGludGVyYWN0aW9uIG1vZGVsIHN1Y2ggYXM6XG4gICAgICogYGBgXG4gICAgICogbmV3IE15Q29udHJvbChcbiAgICAgKiAgICB7XG4gICAgICogICAgICBubHU6IHtcbiAgICAgKiAgICAgICAgICB0YXJnZXRzOiBbJ3BldEFnZSddLCAgIDwtLS0tLS0tLS0tIFJlZmVyZW5jZSB0byBzbG90IElEXG4gICAgICogICAgICB9XG4gICAgICogICAgICAuLi5cbiAgICAgKiAgICB9XG4gICAgICogICApO1xuICAgICAqXG4gICAgICogLS0tXG4gICAgICpcbiAgICAgKiBJbnRlcmFjdGlvbk1vZGVsIChlbi1VUy5qc29uKTpcbiAgICAgKiAuLi5cbiAgICAgKiAgICAgIHR5cGVzOiBbXG4gICAgICogICAgICAgICAgICAgIHtcbiAgICAgKiAgICAgICAgICAgICAgIG5hbWU6IFwidGFyZ2V0XCIsXG4gICAgICogICAgICAgICAgICAgICB2YWx1ZXM6IFtcbiAgICAgKiAgICAgICAgICAgICAgICAge1xuICAgICAqICAgICAgICAgICAgICAgICAgIGlkOiBcInBldEFnZVwiLCAgICAgICAgPC0tLS0tLSAgIElEIHJlZmVyZW5jZWQgYnkgdGhlIGNvbnRyb2xcbiAgICAgKiAgICAgICAgICAgICAgICAgICBuYW1lOiB7XG4gICAgICogICAgICAgICAgICAgICAgICAgICB2YWx1ZTogXCJwZXRBZ2VcIixcbiAgICAgKiAgICAgICAgICAgICAgICAgICAgIHN5bm9ueW1zOiBbXG4gICAgICogICAgICAgICAgICAgICAgICAgICAgIFwiUGV0J3MgYWdlXCIsXG4gICAgICogICAgICAgICAgICAgICAgICAgICAgIFwiTXkgcGV0J3MgYWdlXCIsXG4gICAgICogICAgICAgICAgICAgICAgICAgICAgIFwiRG9nJ3MgYWdlXCIsXG4gICAgICogICAgICAgICAgICAgICAgICAgICAgIC4uLlxuICAgICAqIH1cbiAgICAgKiBgYGBcbiAgICAgKi9cbiAgICB0YXJnZXRzPzogc3RyaW5nW107XG5cbiAgICAvKipcbiAgICAgKiBBY3Rpb24tc2xvdC12YWx1ZXMgYXNzb2NpYXRlZCB0byB0aGUgYWN0aW9uLWNhcGFiaWxpdGllcyBvZiB0aGlzIENvbnRyb2wuXG4gICAgICpcbiAgICAgKiBEZWZhdWx0OlxuICAgICAqIGBgYHRzXG4gICAgICoge1xuICAgICAqICAgIHNldDogWydzZXQnXVxuICAgICAqICAgIGNoYW5nZTogWydjaGFuZ2UnXSxcbiAgICAgKiB9XG4gICAgICogYGBgXG4gICAgICpcbiAgICAgKiBVc2FnZTpcbiAgICAgKiAgKiBUaGlzIGFsbG93cyB1c2VycyB0byByZWZlciB0byBhbiBhY3Rpb24gdXNpbmcgbW9yZSBkb21haW4tYXBwcm9wcmlhdGUgd29yZHMuIEZvciBleGFtcGxlLCBhIHVzZXIgbWlnaHRcbiAgICAgKiAgICBsaWtlIHRvIHNheSAnc2hvdyB0d28gaXRlbXMnIHJhdGhlciB0aGF0ICdzZXQgaXRlbSBjb3VudCB0byB0d28nLiAgVG8gYWNoaWV2ZSB0aGlzLCBpbmNsdWRlIHRoZVxuICAgICAqICAgIHNsb3QtdmFsdWUtaWQgJ3Nob3cnIGluIHRoZSBsaXN0IGFzc29jaWF0ZWQgd2l0aCB0aGUgJ3NldCcgY2FwYWJpbGl0eSBhbmQgZW5zdXJlIHRoZSBpbnRlcmFjdGlvbi1tb2RlbFxuICAgICAqICAgIGluY2x1ZGVzIGFuIGFjdGlvbiBzbG90IHZhbHVlIHdpdGggaWQ9c2hvdyBhbmQgYXBwcm9wcmlhdGUgc3lub255bXMuXG4gICAgICpcbiAgICAgKiBgYGBcbiAgICAgKiB7XG4gICAgICogICAgIHNldDogWydzZXQnLCAnc2hvdycsICdzZWxlY3QnXSAgLy8gRWFjaCBlbnRyeSBpcyBhbiBhY3Rpb24tc2xvdC12YWx1ZSB0aGF0IGlzIGNvbnNpZGVyZWQgYSBzeW5vbnltIHRvICdzZXQnIGZvciB0aGlzIGNvbnRyb2wuXG4gICAgICogfVxuICAgICAqIGBgYFxuICAgICAqL1xuICAgIGFjdGlvbnM/OiBEYXRlQ29udHJvbEFjdGlvblByb3BzO1xufVxuZXhwb3J0IGVudW0gRGF0ZVZhbGlkYXRpb25GYWlsUmVhc29uQ29kZSB7XG4gICAgUEFTVF9EQVRFX09OTFkgPSAncGFzdERhdGVPbmx5JyxcbiAgICBGVVRVUkVfREFURV9PTkxZID0gJ2Z1dHVyZURhdGVPbmx5Jyxcbn1cblxuZXhwb3J0IG5hbWVzcGFjZSBEYXRlQ29udHJvbFZhbGlkYXRpb25zIHtcbiAgICBleHBvcnQgY29uc3QgUEFTVF9EQVRFX09OTFk6IERhdGVWYWxpZGF0aW9uRnVuY3Rpb24gPSAoc3RhdGU6IERhdGVDb250cm9sU3RhdGUsIGlucHV0OiBDb250cm9sSW5wdXQpOiB0cnVlIHwgVmFsaWRhdGlvblJlc3VsdCA9PiB7XG5cbiAgICAgICAgY29uc3Qgc3RhcnREYXRlID0gZ2V0U3RhcnREYXRlT2ZSYW5nZShzdGF0ZS52YWx1ZSEpO1xuICAgICAgICBjb25zdCBzdGFydERhdGVJblVUQyA9IGdldFVUQ0RhdGUoc3RhcnREYXRlKTtcblxuICAgICAgICBjb25zdCBub3cgPSBuZXcgRGF0ZSgpO1xuICAgICAgICBpZiAoc3RhcnREYXRlSW5VVEMgPiBub3cpIHtcbiAgICAgICAgICAgIHJldHVybiB7IFxuICAgICAgICAgICAgICAgIHJlYXNvbkNvZGU6IERhdGVWYWxpZGF0aW9uRmFpbFJlYXNvbkNvZGUuUEFTVF9EQVRFX09OTFksXG4gICAgICAgICAgICAgICAgcmVuZGVyZWRSZWFzb246IGkxOG5leHQudCgnREFURV9DT05UUk9MX0RFRkFVTFRfUFJPTVBUX1ZBTElEQVRJT05fRkFJTF9QQVNUX0RBVEVfT05MWScpXG4gICAgICAgICAgICB9O1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH07XG5cbiAgICBleHBvcnQgY29uc3QgRlVUVVJFX0RBVEVfT05MWTogRGF0ZVZhbGlkYXRpb25GdW5jdGlvbiA9IChzdGF0ZTogRGF0ZUNvbnRyb2xTdGF0ZSwgaW5wdXQ6IENvbnRyb2xJbnB1dCk6IHRydWUgfCBWYWxpZGF0aW9uUmVzdWx0ID0+IHtcbiAgICAgICAgY29uc3QgZW5kRGF0ZSA9IGdldEVuZERhdGVPZlJhbmdlKHN0YXRlLnZhbHVlISk7XG4gICAgICAgIGNvbnN0IGVuZERhdGVJblVUQyA9IGdldFVUQ0RhdGUoZW5kRGF0ZSk7XG5cbiAgICAgICAgY29uc3Qgbm93ID0gbmV3IERhdGUoKTtcbiAgICAgICAgaWYgKGVuZERhdGVJblVUQyA8IG5vdykge1xuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICByZWFzb25Db2RlOiBEYXRlVmFsaWRhdGlvbkZhaWxSZWFzb25Db2RlLkZVVFVSRV9EQVRFX09OTFksXG4gICAgICAgICAgICAgICAgcmVuZGVyZWRSZWFzb246IGkxOG5leHQudCgnREFURV9DT05UUk9MX0RFRkFVTFRfUFJPTVBUX1ZBTElEQVRJT05fRkFJTF9GVVRVUkVfREFURV9PTkxZJylcbiAgICAgICAgICAgIH07XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfTtcbn1cblxuZXhwb3J0IGNsYXNzIERhdGVDb250cm9sU3RhdGUgaW1wbGVtZW50cyBDb250cm9sU3RhdGUge1xuICAgIC8qKlxuICAgICAqIFZhbHVlLCB3aGljaCBpcyB0aGUgSUQgb2YgYSBTbG90VmFsdWUgZm9yIHRoaXMuVmFsdWVUeXBlLlxuICAgICAqL1xuICAgIHZhbHVlPzogc3RyaW5nO1xuXG4gICAgLyoqXG4gICAgICogVHJhY2tzIHdoZXRoZXIgYW4gZWxpY2l0YXRpb24gaXMgaGFwcGVuaW5nIGFuZCB3aGV0aGVyIGl0IGlzIHRvICdTZXQnIG9yICdDaGFuZ2UnIHRoZSB2YWx1ZS5cbiAgICAgKi9cbiAgICBlbGljaXRhdGlvbkFjdGlvbj86IHN0cmluZzsgIC8vIHJlY29yZHMgd2hhdCBraW5kIG9mIGVsaWNpdGF0aW9uIHdlIGFyZSBwZXJmb3JtaW5nLlxuICAgICAgICBcbiAgICAvKipcbiAgICAgKiBUcmFja3Mgd2hldGhlciB0aGUgdmFsdWUgaXMgY29uZmlybWVkIGJ5IHRoZSB1c2VyLCBpZiBjb25maXJtYXRpb25SZXF1aXJlZCBpcyBzZXQgdG8gdHJ1ZS5cbiAgICAgKi9cbiAgICBpc1ZhbHVlQ29uZmlybWVkOiBib29sZWFuID0gZmFsc2U7XG5cbiAgICAvKipcbiAgICAgKiBQcmV2aW91cyB2YWx1ZSB1c2VkIHRvIHRyYWNrIGNoYW5nZSBvZiBhIGNvbnRyb2wgdmFsdWUuXG4gICAgICovXG4gICAgcHJldmlvdXNWYWx1ZT86IHN0cmluZztcbiAgICBcbiAgICAvKipcbiAgICAgKiBUcmFja3MgdGhlIGxhc3QgaW5pdGlhdGl2ZSBhY3QgZnJvbSB0aGUgY29udHJvbFxuICAgICAqL1xuICAgIGxhc3RJbml0aWF0aXZlQWN0Pzogc3RyaW5nOyAvLyBUT0RPOiBTdG9yZSBhY3R1YWwgYWN0XG5cbn1cblxuZXhwb3J0IGNsYXNzIERhdGVDb250cm9sIGV4dGVuZHMgQ29udHJvbCBpbXBsZW1lbnRzIEludGVyYWN0aW9uTW9kZWxDb250cmlidXRvciB7XG5cbiAgICByYXdQcm9wczogRGF0ZUNvbnRyb2xQcm9wcztcbiAgICBwcm9wczogRGVlcFJlcXVpcmVkPERhdGVDb250cm9sUHJvcHM+O1xuICAgIHN0YXRlOiBEYXRlQ29udHJvbFN0YXRlID0gbmV3IERhdGVDb250cm9sU3RhdGUoKTtcbiAgICBwcml2YXRlIGhhbmRsZUZ1bmM/OiAoaW5wdXQ6IENvbnRyb2xJbnB1dCwgcmVzdWx0QnVpbGRlcjogQ29udHJvbFJlc3VsdEJ1aWxkZXIpID0+IHZvaWQ7XG4gICAgc3VwcG9ydGVkQ29udHJvbEludGVudHMgPSBbbmV3IFNpbmdsZVZhbHVlQ29udHJvbEludGVudChBbWF6b25CdWlsdEluU2xvdFR5cGUuREFURSksIG5ldyBHZW5lcmFsQ29udHJvbEludGVudCgpXTtcblxuICAgIGNvbnN0cnVjdG9yKHByb3BzOiBEYXRlQ29udHJvbFByb3BzKSB7XG4gICAgICAgIHN1cGVyKHByb3BzLmlkKTtcbiAgICAgICAgdGhpcy5yYXdQcm9wcyA9IHByb3BzO1xuICAgICAgICB0aGlzLnByb3BzID0gRGF0ZUNvbnRyb2wubWVyZ2VXaXRoRGVmYXVsdFByb3BzKHByb3BzKTtcbiAgICB9XG5cbiAgICBzdGF0aWMgbWVyZ2VXaXRoRGVmYXVsdFByb3BzKHByb3BzOiBEYXRlQ29udHJvbFByb3BzKTogRGVlcFJlcXVpcmVkPERhdGVDb250cm9sUHJvcHM+IHtcblxuICAgICAgICBjb25zdCBkZWZhdWx0czogRGVlcFJlcXVpcmVkPERhdGVDb250cm9sUHJvcHM+ID1cbiAgICAgICAge1xuICAgICAgICAgICAgaWQ6ICdkdW1teScsXG4gICAgICAgICAgICBwcm9tcHRzOiB7XG4gICAgICAgICAgICAgICAgY29uZmlybVZhbHVlOiAoYWN0KSA9PiBpMThuZXh0LnQoJ0RBVEVfQ09OVFJPTF9ERUZBVUxUX1BST01QVF9DT05GSVJNX1ZBTFVFJywgeyB2YWx1ZTogYWN0LnBheWxvYWQudmFsdWUgfSksXG4gICAgICAgICAgICAgICAgdmFsdWVBZmZpcm1lZDogaTE4bmV4dC50KCdEQVRFX0NPTlRST0xfREVGQVVMVF9QUk9NUFRfVkFMVUVfQUZGSVJNRUQnKSxcbiAgICAgICAgICAgICAgICB2YWx1ZURpc2FmZmlybWVkOiBpMThuZXh0LnQoJ0RBVEVfQ09OVFJPTF9ERUZBVUxUX1BST01QVF9WQUxVRV9ESVNBRkZJUk1FRCcpLFxuICAgICAgICAgICAgICAgIHZhbHVlU2V0OiBpMThuZXh0LnQoJ0RBVEVfQ09OVFJPTF9ERUZBVUxUX1BST01QVF9WQUxVRV9TRVQnKSxcbiAgICAgICAgICAgICAgICB2YWx1ZUNoYW5nZWQ6IChhY3QpID0+IGkxOG5leHQudCgnREFURV9DT05UUk9MX0RFRkFVTFRfUFJPTVBUX1ZBTFVFX0NIQU5HRUQnLCB7IG9sZDogYWN0LnBheWxvYWQucHJldmlvdXNWYWx1ZSwgbmV3OiBhY3QucGF5bG9hZC52YWx1ZSB9KSxcbiAgICAgICAgICAgICAgICBpbnZhbGlkVmFsdWU6IChhY3QpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGFjdC5wYXlsb2FkLnJlbmRlcmVkUmVhc29uICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBpMThuZXh0LnQoJ0RBVEVfQ09OVFJPTF9ERUZBVUxUX1BST01QVF9JTlZBTElEX1ZBTFVFX1dJVEhfUkVBU09OJywgeyByZWFzb246IGFjdC5wYXlsb2FkLnJlbmRlcmVkUmVhc29uIH0pO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBpMThuZXh0LnQoJ0RBVEVfQ09OVFJPTF9ERUZBVUxUX1BST01QVF9HRU5FUkFMX0lOVkFMSURfVkFMVUUnKTtcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIHJlcXVlc3RWYWx1ZTogaTE4bmV4dC50KCdEQVRFX0NPTlRST0xfREVGQVVMVF9QUk9NUFRfUkVRVUVTVF9WQUxVRScpLFxuICAgICAgICAgICAgICAgIHJlcXVlc3RDaGFuZ2VkVmFsdWU6IGkxOG5leHQudCgnREFURV9DT05UUk9MX0RFRkFVTFRfUFJPTVBUX1JFUVVFU1RfQ0hBTkdFRF9WQUxVRScpLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHJlcHJvbXB0czoge1xuICAgICAgICAgICAgICAgIGNvbmZpcm1WYWx1ZTogKGFjdCkgPT4gaTE4bmV4dC50KCdEQVRFX0NPTlRST0xfREVGQVVMVF9SRVBST01QVF9DT05GSVJNX1ZBTFVFJywgeyB2YWx1ZTogYWN0LnBheWxvYWQudmFsdWUgfSksXG4gICAgICAgICAgICAgICAgdmFsdWVBZmZpcm1lZDogaTE4bmV4dC50KCdEQVRFX0NPTlRST0xfREVGQVVMVF9SRVBST01QVF9WQUxVRV9BRkZJUk1FRCcpLFxuICAgICAgICAgICAgICAgIHZhbHVlRGlzYWZmaXJtZWQ6IGkxOG5leHQudCgnREFURV9DT05UUk9MX0RFRkFVTFRfUkVQUk9NUFRfVkFMVUVfRElTQUZGSVJNRUQnKSxcbiAgICAgICAgICAgICAgICB2YWx1ZVNldDogaTE4bmV4dC50KCdEQVRFX0NPTlRST0xfREVGQVVMVF9SRVBST01QVF9WQUxVRV9TRVQnKSxcbiAgICAgICAgICAgICAgICB2YWx1ZUNoYW5nZWQ6IChhY3QpID0+IGkxOG5leHQudCgnREFURV9DT05UUk9MX0RFRkFVTFRfUkVQUk9NUFRfVkFMVUVfQ0hBTkdFRCcsIHsgb2xkOiBhY3QucGF5bG9hZC5wcmV2aW91c1ZhbHVlLCBuZXc6IGFjdC5wYXlsb2FkLnZhbHVlIH0pLFxuICAgICAgICAgICAgICAgIGludmFsaWRWYWx1ZTogKGFjdCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBpZiAoYWN0LnBheWxvYWQucmVuZGVyZWRSZWFzb24gIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGkxOG5leHQudCgnREFURV9DT05UUk9MX0RFRkFVTFRfUkVQUk9NUFRfSU5WQUxJRF9WQUxVRV9XSVRIX1JFQVNPTicsIHsgcmVhc29uOiBhY3QucGF5bG9hZC5yZW5kZXJlZFJlYXNvbiB9KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gaTE4bmV4dC50KCdEQVRFX0NPTlRST0xfREVGQVVMVF9SRVBST01QVF9HRU5FUkFMX0lOVkFMSURfVkFMVUUnKTtcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIHJlcXVlc3RWYWx1ZTogaTE4bmV4dC50KCdEQVRFX0NPTlRST0xfREVGQVVMVF9SRVBST01QVF9SRVFVRVNUX1ZBTFVFJyksXG4gICAgICAgICAgICAgICAgcmVxdWVzdENoYW5nZWRWYWx1ZTogaTE4bmV4dC50KCdEQVRFX0NPTlRST0xfREVGQVVMVF9SRVBST01QVF9SRVFVRVNUX0NIQU5HRURfVkFMVUUnKSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBpbnRlcmFjdGlvbk1vZGVsOiB7XG4gICAgICAgICAgICAgICAgYWN0aW9uczoge1xuICAgICAgICAgICAgICAgICAgICBzZXQ6IFskLkFjdGlvbi5TZXRdLFxuICAgICAgICAgICAgICAgICAgICBjaGFuZ2U6IFskLkFjdGlvbi5DaGFuZ2VdLFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgdGFyZ2V0czogWydkYXRlJywgJC5UYXJnZXQuSXRdXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgdmFsaWRhdGlvbjogW10sXG4gICAgICAgICAgICBjb25maXJtYXRpb25SZXF1aXJlZDogZmFsc2UsXG4gICAgICAgICAgICByZXF1aXJlZDogdHJ1ZVxuICAgICAgICB9O1xuXG4gICAgICAgIHJldHVybiBfLm1lcmdlKGRlZmF1bHRzLCBwcm9wcyk7XG4gICAgfVxuXG4gICAgY2FuSGFuZGxlKGlucHV0OiBDb250cm9sSW5wdXQpOiBib29sZWFuIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuaXNTZXRXaXRoVmFsdWUoaW5wdXQpXG4gICAgICAgICAgICB8fCB0aGlzLmlzU2V0V2l0aG91dFZhbHVlKGlucHV0KVxuICAgICAgICAgICAgfHwgdGhpcy5pc0NoYW5nZVdpdGhWYWx1ZShpbnB1dClcbiAgICAgICAgICAgIHx8IHRoaXMuaXNDaGFuZ2VXaXRob3V0VmFsdWUoaW5wdXQpXG4gICAgICAgICAgICB8fCB0aGlzLmlzQmFyZVZhbHVlKGlucHV0KVxuICAgICAgICAgICAgfHwgdGhpcy5pc0NvbmZpcm1hdGlvbkFmZmlybWVkKGlucHV0KVxuICAgICAgICAgICAgfHwgdGhpcy5pc0NvbmZpcm1hdGlvbkRpc0FmZmlybWVkKGlucHV0KTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBUZXN0IGlmIHRoZSBpbnB1dCBpcyBhbiBpbXBsaWNpdCBvciBleHBsaWNpdCBzZXQtYWN0aW9uIHdpdGggYSB2YWx1ZSBwcm92aWRlZC5cbiAgICAgKlxuICAgICAqIEBwYXJhbSBpbnB1dFxuICAgICAqL1xuICAgIGlzU2V0V2l0aFZhbHVlKGlucHV0OiBDb250cm9sSW5wdXQpOiBib29sZWFuIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIG9rSWYoSW5wdXRVdGlsLmlzU2luZ2xlVmFsdWVDb250cm9sSW50ZW50KGlucHV0LCBBbWF6b25CdWlsdEluU2xvdFR5cGUuREFURSkpO1xuICAgICAgICAgICAgY29uc3QgeyBmZWVkYmFjaywgYWN0aW9uLCB0YXJnZXQsIHZhbHVlU3RyIH0gPSB1bnBhY2tTaW5nbGVWYWx1ZUNvbnRyb2xJbnRlbnQoKGlucHV0LnJlcXVlc3QgYXMgSW50ZW50UmVxdWVzdCkuaW50ZW50KTtcbiAgICAgICAgICAgIG9rSWYoSW5wdXRVdGlsLmZlZWRiYWNrSXNNYXRjaE9yVW5kZWZpbmVkKGZlZWRiYWNrLCBbJC5GZWVkYmFjay5BZmZpcm0sICQuRmVlZGJhY2suRGlzYWZmaXJtXSkpO1xuICAgICAgICAgICAgb2tJZihJbnB1dFV0aWwuYWN0aW9uSXNNYXRjaChhY3Rpb24sIHRoaXMucHJvcHMuaW50ZXJhY3Rpb25Nb2RlbC5hY3Rpb25zLnNldCkpO1xuICAgICAgICAgICAgb2tJZihJbnB1dFV0aWwudGFyZ2V0SXNNYXRjaE9yVW5kZWZpbmVkKHRhcmdldCwgdGhpcy5wcm9wcy5pbnRlcmFjdGlvbk1vZGVsLnRhcmdldHMpKTtcbiAgICAgICAgICAgIG9rSWYoSW5wdXRVdGlsLnZhbHVlU3RyRGVmaW5lZCh2YWx1ZVN0cikpO1xuICAgICAgICAgICAgdGhpcy5oYW5kbGVGdW5jID0gdGhpcy5oYW5kbGVTZXRXaXRoVmFsdWU7XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICBjYXRjaCAoZSkgeyByZXR1cm4gZmFsc2VJZkd1YXJkRmFpbGVkKGUpOyB9XG4gICAgfVxuXG4gICAgaGFuZGxlU2V0V2l0aFZhbHVlKGlucHV0OiBDb250cm9sSW5wdXQsIHJlc3VsdEJ1aWxkZXI6IENvbnRyb2xSZXN1bHRCdWlsZGVyKTogdm9pZCB7XG4gICAgICAgIGNvbnN0IHsgdmFsdWVTdHIgfSA9IHVucGFja1NpbmdsZVZhbHVlQ29udHJvbEludGVudCgoaW5wdXQucmVxdWVzdCBhcyBJbnRlbnRSZXF1ZXN0KS5pbnRlbnQpO1xuICAgICAgICB0aGlzLnNldFZhbHVlKHZhbHVlU3RyKTtcbiAgICAgICAgdGhpcy52YWxpZGF0ZUFuZEFkZEFjdHMoaW5wdXQsIHJlc3VsdEJ1aWxkZXIsICQuQWN0aW9uLlNldCk7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBUZXN0IGlmIHRoZSBpbnB1dCBpcyBhbiBpbXBsaWNpdCBvciBleHBsaWNpdCBzZXQtYWN0aW9uIHdpdGggbm8gdmFsdWVcbiAgICAgKlxuICAgICAqIEBwYXJhbSBpbnB1dFxuICAgICAqL1xuICAgIGlzU2V0V2l0aG91dFZhbHVlKGlucHV0OiBDb250cm9sSW5wdXQpOiBib29sZWFuIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIG9rSWYoSW5wdXRVdGlsLmlzSW50ZW50KGlucHV0LCBHZW5lcmFsQ29udHJvbEludGVudC5uYW1lKSk7XG4gICAgICAgICAgICBjb25zdCB7IGZlZWRiYWNrLCBhY3Rpb24sIHRhcmdldCB9ID0gdW5wYWNrR2VuZXJhbENvbnRyb2xJbnRlbnQoKGlucHV0LnJlcXVlc3QgYXMgSW50ZW50UmVxdWVzdCkuaW50ZW50KTtcbiAgICAgICAgICAgIG9rSWYoSW5wdXRVdGlsLmZlZWRiYWNrSXNNYXRjaE9yVW5kZWZpbmVkKGZlZWRiYWNrLCBbJC5GZWVkYmFjay5BZmZpcm0sICQuRmVlZGJhY2suRGlzYWZmaXJtXSkpO1xuICAgICAgICAgICAgb2tJZihJbnB1dFV0aWwuYWN0aW9uSXNNYXRjaChhY3Rpb24sIHRoaXMucHJvcHMuaW50ZXJhY3Rpb25Nb2RlbC5hY3Rpb25zLnNldCkpO1xuICAgICAgICAgICAgb2tJZihJbnB1dFV0aWwudGFyZ2V0SXNNYXRjaE9yVW5kZWZpbmVkKHRhcmdldCwgdGhpcy5wcm9wcy5pbnRlcmFjdGlvbk1vZGVsLnRhcmdldHMpKTtcbiAgICAgICAgICAgIHRoaXMuaGFuZGxlRnVuYyA9IHRoaXMuaGFuZGxlU2V0V2l0aG91dFZhbHVlO1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgY2F0Y2ggKGUpIHsgcmV0dXJuIGZhbHNlSWZHdWFyZEZhaWxlZChlKTsgfVxuICAgIH1cblxuICAgIGhhbmRsZVNldFdpdGhvdXRWYWx1ZShpbnB1dDogQ29udHJvbElucHV0LCByZXN1bHRCdWlsZGVyOiBDb250cm9sUmVzdWx0QnVpbGRlcik6IHZvaWQge1xuICAgICAgICB0aGlzLmFza0VsaWNpdGF0aW9uUXVlc3Rpb24oJC5BY3Rpb24uU2V0LCBpbnB1dCwgcmVzdWx0QnVpbGRlcik7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBUZXN0IGlmIHRoZSBpbnB1dCBpcyBhIHZhbGlkIGNoYW5nZS1hY3Rpb24gd2l0aCBhIHZhbHVlIHByb3ZpZGVkLlxuICAgICAqXG4gICAgICogQHBhcmFtIGlucHV0XG4gICAgICovXG4gICAgaXNDaGFuZ2VXaXRoVmFsdWUoaW5wdXQ6IENvbnRyb2xJbnB1dCk6IGJvb2xlYW4ge1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgb2tJZihJbnB1dFV0aWwuaXNTaW5nbGVWYWx1ZUNvbnRyb2xJbnRlbnQoaW5wdXQsIEFtYXpvbkJ1aWx0SW5TbG90VHlwZS5EQVRFKSk7XG4gICAgICAgICAgICBjb25zdCB7IGZlZWRiYWNrLCBhY3Rpb24sIHRhcmdldCwgdmFsdWVTdHIgfSA9IHVucGFja1NpbmdsZVZhbHVlQ29udHJvbEludGVudCgoaW5wdXQucmVxdWVzdCBhcyBJbnRlbnRSZXF1ZXN0KS5pbnRlbnQpO1xuICAgICAgICAgICAgb2tJZihJbnB1dFV0aWwuZmVlZGJhY2tJc01hdGNoT3JVbmRlZmluZWQoZmVlZGJhY2ssIFskLkZlZWRiYWNrLkFmZmlybSwgJC5GZWVkYmFjay5EaXNhZmZpcm1dKSk7XG4gICAgICAgICAgICBva0lmKElucHV0VXRpbC5hY3Rpb25Jc01hdGNoKGFjdGlvbiwgdGhpcy5wcm9wcy5pbnRlcmFjdGlvbk1vZGVsLmFjdGlvbnMuY2hhbmdlKSk7XG4gICAgICAgICAgICBva0lmKElucHV0VXRpbC50YXJnZXRJc01hdGNoT3JVbmRlZmluZWQodGFyZ2V0LCB0aGlzLnByb3BzLmludGVyYWN0aW9uTW9kZWwudGFyZ2V0cykpO1xuICAgICAgICAgICAgb2tJZihJbnB1dFV0aWwudmFsdWVTdHJEZWZpbmVkKHZhbHVlU3RyKSk7XG4gICAgICAgICAgICB0aGlzLmhhbmRsZUZ1bmMgPSB0aGlzLmhhbmRsZUNoYW5nZVdpdGhWYWx1ZTtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIGNhdGNoIChlKSB7IHJldHVybiBmYWxzZUlmR3VhcmRGYWlsZWQoZSk7IH1cbiAgICB9XG5cbiAgICBoYW5kbGVDaGFuZ2VXaXRoVmFsdWUoaW5wdXQ6IENvbnRyb2xJbnB1dCwgcmVzdWx0QnVpbGRlcjogQ29udHJvbFJlc3VsdEJ1aWxkZXIpOiB2b2lkIHtcbiAgICAgICAgY29uc3QgeyB2YWx1ZVN0ciB9ID0gdW5wYWNrU2luZ2xlVmFsdWVDb250cm9sSW50ZW50KChpbnB1dC5yZXF1ZXN0IGFzIEludGVudFJlcXVlc3QpLmludGVudCk7XG4gICAgICAgIHRoaXMuc2V0VmFsdWUodmFsdWVTdHIpO1xuICAgICAgICB0aGlzLnZhbGlkYXRlQW5kQWRkQWN0cyhpbnB1dCwgcmVzdWx0QnVpbGRlciwgdGhpcy5zdGF0ZS52YWx1ZSAhPT0gdW5kZWZpbmVkID8gJC5BY3Rpb24uQ2hhbmdlIDogJC5BY3Rpb24uU2V0KTtcbiAgICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFRlc3QgaWYgdGhlIGlucHV0IGlzIGEgdmFsaWQgY2hhbmdlLWFjdGlvbiB3aXRob3V0IGEgdmFsdWUgcHJvdmlkZWQuXG4gICAgICpcbiAgICAgKiBAcGFyYW0gaW5wdXRcbiAgICAgKi9cbiAgICBpc0NoYW5nZVdpdGhvdXRWYWx1ZShpbnB1dDogQ29udHJvbElucHV0KTogYm9vbGVhbiB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBva0lmKElucHV0VXRpbC5pc0ludGVudChpbnB1dCwgR2VuZXJhbENvbnRyb2xJbnRlbnQubmFtZSkpO1xuICAgICAgICAgICAgY29uc3QgeyBmZWVkYmFjaywgYWN0aW9uLCB0YXJnZXQgfSA9IHVucGFja0dlbmVyYWxDb250cm9sSW50ZW50KChpbnB1dC5yZXF1ZXN0IGFzIEludGVudFJlcXVlc3QpLmludGVudCk7XG4gICAgICAgICAgICBva0lmKElucHV0VXRpbC5mZWVkYmFja0lzTWF0Y2hPclVuZGVmaW5lZChmZWVkYmFjaywgWyQuRmVlZGJhY2suQWZmaXJtLCAkLkZlZWRiYWNrLkRpc2FmZmlybV0pKTtcbiAgICAgICAgICAgIG9rSWYoSW5wdXRVdGlsLmFjdGlvbklzTWF0Y2goYWN0aW9uLCB0aGlzLnByb3BzLmludGVyYWN0aW9uTW9kZWwuYWN0aW9ucy5jaGFuZ2UpKTtcbiAgICAgICAgICAgIG9rSWYoSW5wdXRVdGlsLnRhcmdldElzTWF0Y2hPclVuZGVmaW5lZCh0YXJnZXQsIHRoaXMucHJvcHMuaW50ZXJhY3Rpb25Nb2RlbC50YXJnZXRzKSk7XG4gICAgICAgICAgICB0aGlzLmhhbmRsZUZ1bmMgPSB0aGlzLmhhbmRsZUNoYW5nZVdpdGhvdXRWYWx1ZTtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIGNhdGNoIChlKSB7IHJldHVybiBmYWxzZUlmR3VhcmRGYWlsZWQoZSk7IH1cbiAgICB9XG5cbiAgICBoYW5kbGVDaGFuZ2VXaXRob3V0VmFsdWUoaW5wdXQ6IENvbnRyb2xJbnB1dCwgcmVzdWx0QnVpbGRlcjogQ29udHJvbFJlc3VsdEJ1aWxkZXIpOiB2b2lkIHtcbiAgICAgICAgdGhpcy5hc2tFbGljaXRhdGlvblF1ZXN0aW9uKCQuQWN0aW9uLkNoYW5nZSwgaW5wdXQsIHJlc3VsdEJ1aWxkZXIpO1xuICAgICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogVGVzdCBpZiB0aGUgaW5wdXQgaXMgYSBEYXRlQ29udHJvbEludGVudCB3aXRoIGp1c3QgYSBkYXRlIHByb3ZpZGVkLlxuICAgICAqIElmIHdlIGFyZW4ndCBhc2tpbmcgYSBxdWVzdGlvbiBpdCBpcyBhc3N1bWVkIHRoZSB1c2VyIG1lYW50ICdzZXQgdmFsdWUnLlxuICAgICAqIEBwYXJhbSBpbnB1dFxuICAgICAqL1xuICAgIGlzQmFyZVZhbHVlKGlucHV0OiBDb250cm9sSW5wdXQpOiBhbnkge1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgb2tJZihJbnB1dFV0aWwuaXNTaW5nbGVWYWx1ZUNvbnRyb2xJbnRlbnQoaW5wdXQsIEFtYXpvbkJ1aWx0SW5TbG90VHlwZS5EQVRFKSk7XG4gICAgICAgICAgICBjb25zdCB7IGZlZWRiYWNrLCBhY3Rpb24sIHRhcmdldCwgdmFsdWVTdHIgfSA9IHVucGFja1NpbmdsZVZhbHVlQ29udHJvbEludGVudCgoaW5wdXQucmVxdWVzdCBhcyBJbnRlbnRSZXF1ZXN0KS5pbnRlbnQpO1xuICAgICAgICAgICAgb2tJZihJbnB1dFV0aWwuZmVlZGJhY2tJc1VuZGVmaW5lZChmZWVkYmFjaykpO1xuICAgICAgICAgICAgb2tJZihJbnB1dFV0aWwuYWN0aW9uSXNVbmRlZmluZWQoYWN0aW9uKSk7XG4gICAgICAgICAgICBva0lmKElucHV0VXRpbC50YXJnZXRJc01hdGNoT3JVbmRlZmluZWQodGFyZ2V0LCB0aGlzLnByb3BzLmludGVyYWN0aW9uTW9kZWwudGFyZ2V0cykpO1xuICAgICAgICAgICAgb2tJZihJbnB1dFV0aWwudmFsdWVTdHJEZWZpbmVkKHZhbHVlU3RyKSk7XG4gICAgICAgICAgICB0aGlzLmhhbmRsZUZ1bmMgPSB0aGlzLmhhbmRsZUJhcmVWYWx1ZTtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIGNhdGNoIChlKSB7IHJldHVybiBmYWxzZUlmR3VhcmRGYWlsZWQoZSk7IH1cbiAgICB9XG5cblxuICAgIGhhbmRsZUJhcmVWYWx1ZShpbnB1dDogQ29udHJvbElucHV0LCByZXN1bHRCdWlsZGVyOiBDb250cm9sUmVzdWx0QnVpbGRlcik6IHZvaWQge1xuICAgICAgICBjb25zdCB7IHZhbHVlU3RyIH0gPSB1bnBhY2tTaW5nbGVWYWx1ZUNvbnRyb2xJbnRlbnQoKGlucHV0LnJlcXVlc3QgYXMgSW50ZW50UmVxdWVzdCkuaW50ZW50KTtcbiAgICAgICAgdGhpcy5zZXRWYWx1ZSh2YWx1ZVN0cik7XG4gICAgICAgIHRoaXMudmFsaWRhdGVBbmRBZGRBY3RzKGlucHV0LCByZXN1bHRCdWlsZGVyLCB0aGlzLnN0YXRlLmVsaWNpdGF0aW9uQWN0aW9uID8/ICQuQWN0aW9uLlNldCk7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBpc0NvbmZpcm1hdGlvbkFmZmlybWVkKGlucHV0OiBDb250cm9sSW5wdXQpOiBhbnkge1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgb2tJZihJbnB1dFV0aWwuaXNCYXJlWWVzKGlucHV0KSk7XG4gICAgICAgICAgICBva0lmKHRoaXMuc3RhdGUubGFzdEluaXRpYXRpdmVBY3QgPT09ICdDb25maXJtVmFsdWVBY3QnKTtcbiAgICAgICAgICAgIHRoaXMuaGFuZGxlRnVuYyA9IHRoaXMuaGFuZGxlQ29uZmlybWF0aW9uQWZmaXJtZWQ7XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICBjYXRjaCAoZSkge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlSWZHdWFyZEZhaWxlZChlKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGhhbmRsZUNvbmZpcm1hdGlvbkFmZmlybWVkKGlucHV0OiBDb250cm9sSW5wdXQsIHJlc3VsdEJ1aWxkZXI6IENvbnRyb2xSZXN1bHRCdWlsZGVyKTogdm9pZCB7XG4gICAgICAgIGNvbnN0IHZhbGlkYXRpb25SZXN1bHQ6IHRydWUgfCBWYWxpZGF0aW9uUmVzdWx0ID0gdGhpcy52YWxpZGF0ZShpbnB1dCk7XG4gICAgICAgIGlmICh2YWxpZGF0aW9uUmVzdWx0ICE9PSB0cnVlKSB7XG4gICAgICAgICAgICByZXN1bHRCdWlsZGVyLmFkZEFjdChcbiAgICAgICAgICAgICAgICBuZXcgSW52YWxpZFZhbHVlQWN0PHN0cmluZz4oXG4gICAgICAgICAgICAgICAgICAgIHRoaXMsIFxuICAgICAgICAgICAgICAgICAgICB7IFxuICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IHRoaXMuc3RhdGUudmFsdWUhLCBcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlYXNvbkNvZGU6IHZhbGlkYXRpb25SZXN1bHQucmVhc29uQ29kZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlbmRlcmVkUmVhc29uOiB2YWxpZGF0aW9uUmVzdWx0LnJlbmRlcmVkUmVhc29uXG4gICAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICApO1xuICAgICAgICAgICAgdGhpcy5hc2tFbGljaXRhdGlvblF1ZXN0aW9uKCQuQWN0aW9uLkNoYW5nZSwgaW5wdXQsIHJlc3VsdEJ1aWxkZXIpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5zdGF0ZS5pc1ZhbHVlQ29uZmlybWVkID0gdHJ1ZTtcbiAgICAgICAgICAgIHJlc3VsdEJ1aWxkZXIuYWRkQWN0KFxuICAgICAgICAgICAgICAgIG5ldyBWYWx1ZUNvbmZpcm1lZEFjdCh0aGlzLCB7IHZhbHVlOiB0aGlzLnN0YXRlLnZhbHVlIH0pXG4gICAgICAgICAgICApO1xuICAgICAgICAgICAgaWYgKHRoaXMuc3RhdGUuZWxpY2l0YXRpb25BY3Rpb24gPT09ICQuQWN0aW9uLkNoYW5nZSkge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLnN0YXRlLnByZXZpb3VzVmFsdWUgIT09IHVuZGVmaW5lZCl7XG4gICAgICAgICAgICAgICAgICAgIHJlc3VsdEJ1aWxkZXIuYWRkQWN0KFxuICAgICAgICAgICAgICAgICAgICAgICAgbmV3IFZhbHVlQ2hhbmdlZEFjdDxzdHJpbmc+KHRoaXMsIHtwcmV2aW91c1ZhbHVlOiB0aGlzLnN0YXRlLnByZXZpb3VzVmFsdWUsIHZhbHVlOiB0aGlzLnN0YXRlLnZhbHVlISB9KVxuICAgICAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdWYWx1ZUNoYW5nZWRBY3Qgc2hvdWxkIG9ubHkgYmUgdXNlZCBpZiB0aGVyZSBpcyBhbiBhY3R1YWwgcHJldmlvdXMgdmFsdWUnKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICByZXN1bHRCdWlsZGVyLmFkZEFjdChcbiAgICAgICAgICAgICAgICAgICAgbmV3IFZhbHVlU2V0QWN0KHRoaXMsIHsgdmFsdWU6IHRoaXMuc3RhdGUudmFsdWUgfSlcbiAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgaXNDb25maXJtYXRpb25EaXNBZmZpcm1lZChpbnB1dDogQ29udHJvbElucHV0KTogYW55IHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIG9rSWYoSW5wdXRVdGlsLmlzQmFyZU5vKGlucHV0KSk7XG4gICAgICAgICAgICBva0lmKHRoaXMuc3RhdGUubGFzdEluaXRpYXRpdmVBY3QgPT09ICdDb25maXJtVmFsdWVBY3QnKTtcbiAgICAgICAgICAgIHRoaXMuaGFuZGxlRnVuYyA9IHRoaXMuaGFuZGxlQ29uZmlybWF0aW9uRGlzQWZmaXJtZWQ7XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICBjYXRjaCAoZSkge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlSWZHdWFyZEZhaWxlZChlKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGhhbmRsZUNvbmZpcm1hdGlvbkRpc0FmZmlybWVkKGlucHV0OiBDb250cm9sSW5wdXQsIHJlc3VsdEJ1aWxkZXI6IENvbnRyb2xSZXN1bHRCdWlsZGVyKTogdm9pZCB7XG4gICAgICAgIHRoaXMuc3RhdGUuaXNWYWx1ZUNvbmZpcm1lZCA9IGZhbHNlO1xuICAgICAgICByZXN1bHRCdWlsZGVyLmFkZEFjdChuZXcgVmFsdWVEaXNjb25maXJtZWRBY3QodGhpcywge3ZhbHVlOiB0aGlzLnN0YXRlLnZhbHVlfSkpO1xuICAgICAgICByZXN1bHRCdWlsZGVyLmFkZEFjdChuZXcgUmVxdWVzdFZhbHVlQWN0KHRoaXMpKTtcbiAgICB9XG5cbiAgICBhc3luYyBoYW5kbGUoaW5wdXQ6IENvbnRyb2xJbnB1dCwgcmVzdWx0QnVpbGRlcjogQ29udHJvbFJlc3VsdEJ1aWxkZXIpOiBQcm9taXNlPHZvaWQ+IHtcblxuICAgICAgICBsb2cuZGVidWcoYERhdGVDb250cm9sWyR7dGhpcy5pZH1dOiBoYW5kbGUoKS4gRW50ZXJpbmdgKTtcblxuICAgICAgICBpZiAodGhpcy5oYW5kbGVGdW5jID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIGNvbnN0IGludGVudDogSW50ZW50ID0gKGlucHV0LnJlcXVlc3QgYXMgSW50ZW50UmVxdWVzdCkuaW50ZW50O1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGAke2ludGVudC5uYW1lfSBjYW4gbm90IGJlIGhhbmRsZWQgYnkgJHt0aGlzLmNvbnN0cnVjdG9yLm5hbWV9LmApO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5oYW5kbGVGdW5jKGlucHV0LCByZXN1bHRCdWlsZGVyKTtcbiAgICB9XG5cbiAgICBjYW5UYWtlSW5pdGlhdGl2ZShpbnB1dDogQ29udHJvbElucHV0KTogYm9vbGVhbiB7XG4gICAgICAgIHJldHVybiB0aGlzLndhbnRzVG9Db25maXJtVmFsdWUoaW5wdXQpXG4gICAgICAgICAgICB8fCB0aGlzLndhbnRzVG9GaXhJbnZhbGlkVmFsdWUoaW5wdXQpXG4gICAgICAgICAgICB8fCB0aGlzLndhbnRzVG9FbGljaXRWYWx1ZShpbnB1dCk7XG4gICAgfVxuXG4gICAgdGFrZUluaXRpYXRpdmUoaW5wdXQ6IENvbnRyb2xJbnB1dCwgcmVzdWx0QnVpbGRlcjogQ29udHJvbFJlc3VsdEJ1aWxkZXIpOiB2b2lkIHtcbiAgICAgICAgaWYgKHRoaXMud2FudHNUb0VsaWNpdFZhbHVlKGlucHV0KSkge1xuICAgICAgICAgICAgdGhpcy5hc2tFbGljaXRhdGlvblF1ZXN0aW9uKCQuQWN0aW9uLlNldCwgaW5wdXQsIHJlc3VsdEJ1aWxkZXIpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKHRoaXMud2FudHNUb0ZpeEludmFsaWRWYWx1ZShpbnB1dCkpe1xuICAgICAgICAgICAgdGhpcy52YWxpZGF0ZUFuZEFkZEFjdHMoaW5wdXQsIHJlc3VsdEJ1aWxkZXIsICQuQWN0aW9uLkNoYW5nZSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAodGhpcy53YW50c1RvQ29uZmlybVZhbHVlKGlucHV0KSkge1xuICAgICAgICAgICAgdGhpcy5jb25maXJtVmFsdWUoaW5wdXQsIHJlc3VsdEJ1aWxkZXIpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgd2FudHNUb0VsaWNpdFZhbHVlKGlucHV0OiBDb250cm9sSW5wdXQpOiBib29sZWFuIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuc3RhdGUudmFsdWUgPT09IHVuZGVmaW5lZCAmJiB0aGlzLmV2YWx1YXRlQm9vbGVhblByb3AodGhpcy5wcm9wcy5yZXF1aXJlZCwgaW5wdXQpO1xuICAgIH1cblxuICAgIGFza0VsaWNpdGF0aW9uUXVlc3Rpb24oZWxpY2l0YXRpb25BY3Rpb246IHN0cmluZywgaW5wdXQ6IENvbnRyb2xJbnB1dCwgcmVzdWx0QnVpbGRlcjogQ29udHJvbFJlc3VsdEJ1aWxkZXIpIHtcbiAgICAgICAgdGhpcy5zdGF0ZS5lbGljaXRhdGlvbkFjdGlvbiA9IGVsaWNpdGF0aW9uQWN0aW9uO1xuICAgICAgICBzd2l0Y2ggKGVsaWNpdGF0aW9uQWN0aW9uKSB7XG4gICAgICAgICAgICBjYXNlICQuQWN0aW9uLlNldDpcbiAgICAgICAgICAgICAgICByZXN1bHRCdWlsZGVyLmFkZEFjdChuZXcgUmVxdWVzdFZhbHVlQWN0KHRoaXMpKTtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICBjYXNlICQuQWN0aW9uLkNoYW5nZTpcbiAgICAgICAgICAgICAgICByZXN1bHRCdWlsZGVyLmFkZEFjdChuZXcgUmVxdWVzdENoYW5nZWRWYWx1ZUFjdCh0aGlzLCB7Y3VycmVudFZhbHVlOiB0aGlzLnN0YXRlLnZhbHVlIX0pKTtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgVW5oYW5kbGVkLiBVbmtub3duIGVsaWNpdGF0aW9uQWN0aW9uOiAke2VsaWNpdGF0aW9uQWN0aW9ufWApO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgdmFsaWRhdGVBbmRBZGRBY3RzKGlucHV0OiBDb250cm9sSW5wdXQsIHJlc3VsdEJ1aWxkZXI6IENvbnRyb2xSZXN1bHRCdWlsZGVyLCBlbGljaXRhdGlvbkFjdGlvbjogc3RyaW5nKTogdm9pZCB7XG4gICAgICAgIHRoaXMuc3RhdGUuZWxpY2l0YXRpb25BY3Rpb24gPSBlbGljaXRhdGlvbkFjdGlvbjtcbiAgICAgICAgaWYgKHRoaXMud2FudHNUb0NvbmZpcm1WYWx1ZShpbnB1dCkpe1xuICAgICAgICAgICAgdGhpcy5jb25maXJtVmFsdWUoaW5wdXQsIHJlc3VsdEJ1aWxkZXIpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHZhbGlkYXRpb25SZXN1bHQ6IHRydWUgfCBWYWxpZGF0aW9uUmVzdWx0ID0gdGhpcy52YWxpZGF0ZShpbnB1dCk7XG4gICAgICAgIGlmICh2YWxpZGF0aW9uUmVzdWx0ID09PSB0cnVlKSB7XG4gICAgICAgICAgICBpZiAoZWxpY2l0YXRpb25BY3Rpb24gPT09ICQuQWN0aW9uLkNoYW5nZSkge1xuICAgICAgICAgICAgICAgIC8vIGlmIGVsaWNpdGF0aW9uQWN0aW9uID09ICdjaGFuZ2UnLCB0aGVuIHRoZSBwcmV2aW91c1ZhbHVlIG11c3QgYmUgZGVmaW5lZC5cbiAgICAgICAgICAgICAgICBpZiAodGhpcy5zdGF0ZS5wcmV2aW91c1ZhbHVlICE9PSB1bmRlZmluZWQpe1xuICAgICAgICAgICAgICAgICAgICByZXN1bHRCdWlsZGVyLmFkZEFjdChcbiAgICAgICAgICAgICAgICAgICAgICAgIG5ldyBWYWx1ZUNoYW5nZWRBY3Q8c3RyaW5nPih0aGlzLCB7cHJldmlvdXNWYWx1ZTogdGhpcy5zdGF0ZS5wcmV2aW91c1ZhbHVlLCB2YWx1ZTogdGhpcy5zdGF0ZS52YWx1ZSEgfSlcbiAgICAgICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignVmFsdWVDaGFuZ2VkQWN0IHNob3VsZCBvbmx5IGJlIHVzZWQgaWYgdGhlcmUgaXMgYW4gYWN0dWFsIHByZXZpb3VzIHZhbHVlJyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgcmVzdWx0QnVpbGRlci5hZGRBY3QobmV3IFZhbHVlU2V0QWN0KHRoaXMsIHsgdmFsdWU6IHRoaXMuc3RhdGUudmFsdWUgfSkpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgLy8gZmVlZGJhY2tcbiAgICAgICAgICAgIHJlc3VsdEJ1aWxkZXIuYWRkQWN0KFxuICAgICAgICAgICAgICAgIG5ldyBJbnZhbGlkVmFsdWVBY3Q8c3RyaW5nPihcbiAgICAgICAgICAgICAgICAgICAgdGhpcywgXG4gICAgICAgICAgICAgICAgICAgIHsgXG4gICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogdGhpcy5zdGF0ZS52YWx1ZSEsIFxuICAgICAgICAgICAgICAgICAgICAgICAgcmVhc29uQ29kZTogdmFsaWRhdGlvblJlc3VsdC5yZWFzb25Db2RlLFxuICAgICAgICAgICAgICAgICAgICAgICAgcmVuZGVyZWRSZWFzb246IHZhbGlkYXRpb25SZXN1bHQucmVuZGVyZWRSZWFzb25cbiAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgICB0aGlzLmFza0VsaWNpdGF0aW9uUXVlc3Rpb24oZWxpY2l0YXRpb25BY3Rpb24sIGlucHV0LCByZXN1bHRCdWlsZGVyKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgd2FudHNUb0NvbmZpcm1WYWx1ZShpbnB1dDogQ29udHJvbElucHV0KTogYm9vbGVhbiB7XG4gICAgICAgIHJldHVybiB0aGlzLmV2YWx1YXRlQm9vbGVhblByb3AodGhpcy5wcm9wcy5jb25maXJtYXRpb25SZXF1aXJlZCwgaW5wdXQpICYmIHRoaXMuc3RhdGUuaXNWYWx1ZUNvbmZpcm1lZCA9PT0gZmFsc2U7XG4gICAgfVxuXG4gICAgY29uZmlybVZhbHVlKGlucHV0OiBDb250cm9sSW5wdXQsIHJlc3VsdEJ1aWxkZXI6IENvbnRyb2xSZXN1bHRCdWlsZGVyKTogdm9pZCB7XG4gICAgICAgIHRoaXMuc3RhdGUubGFzdEluaXRpYXRpdmVBY3QgPSAnQ29uZmlybVZhbHVlQWN0JztcbiAgICAgICAgcmVzdWx0QnVpbGRlci5hZGRBY3QobmV3IENvbmZpcm1WYWx1ZUFjdCh0aGlzLCB7IHZhbHVlOiB0aGlzLnN0YXRlLnZhbHVlIH0pKTtcbiAgICB9XG5cbiAgICB3YW50c1RvRml4SW52YWxpZFZhbHVlKGlucHV0OiBDb250cm9sSW5wdXQpOiBib29sZWFuIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuc3RhdGUudmFsdWUgIT09IHVuZGVmaW5lZCAmJiB0aGlzLnZhbGlkYXRlKGlucHV0KSAhPT0gdHJ1ZTtcbiAgICB9XG5cbiAgICB2YWxpZGF0ZShpbnB1dDogQ29udHJvbElucHV0KTogdHJ1ZSB8IFZhbGlkYXRpb25SZXN1bHQge1xuICAgICAgICBjb25zdCBsaXN0T2ZWYWxpZGF0aW9uRnVuYzogRGF0ZVZhbGlkYXRpb25GdW5jdGlvbltdID0gdHlwZW9mKHRoaXMucHJvcHMudmFsaWRhdGlvbikgPT09ICdmdW5jdGlvbicgPyBbdGhpcy5wcm9wcy52YWxpZGF0aW9uXSA6IHRoaXMucHJvcHMudmFsaWRhdGlvbjtcbiAgICAgICAgZm9yIChjb25zdCB2YWxpZGF0aW9uRnVuY3Rpb24gb2YgbGlzdE9mVmFsaWRhdGlvbkZ1bmMpIHtcbiAgICAgICAgICAgIGNvbnN0IHZhbGlkYXRpb25SZXN1bHQ6IHRydWUgfCBWYWxpZGF0aW9uUmVzdWx0ID0gdmFsaWRhdGlvbkZ1bmN0aW9uKHRoaXMuc3RhdGUsIGlucHV0KTtcbiAgICAgICAgICAgIGlmICh2YWxpZGF0aW9uUmVzdWx0ICE9PSB0cnVlKSB7XG4gICAgICAgICAgICAgICAgbG9nLmRlYnVnKGBEYXRlQ29udHJvbC52YWxpZGF0ZSgpOiB2YWxpZGF0aW9uIGZhaWxlZC4gUmVhc29uOiAke0pTT04uc3RyaW5naWZ5KHZhbGlkYXRpb25SZXN1bHQsIG51bGwsIDIpfS5gKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gdmFsaWRhdGlvblJlc3VsdDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG5cbiAgICBzZXRWYWx1ZSh2YWx1ZTogc3RyaW5nKSB7XG4gICAgICAgIHRoaXMuc3RhdGUucHJldmlvdXNWYWx1ZSA9IHRoaXMuc3RhdGUudmFsdWU7XG4gICAgICAgIHRoaXMuc3RhdGUudmFsdWUgPSB2YWx1ZTtcbiAgICAgICAgdGhpcy5zdGF0ZS5pc1ZhbHVlQ29uZmlybWVkID0gZmFsc2U7XG4gICAgfVxuXG4gICAgY2xlYXIoKSB7XG4gICAgICAgIHRoaXMuc3RhdGUudmFsdWUgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMuc3RhdGUucHJldmlvdXNWYWx1ZSA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5zdGF0ZS5lbGljaXRhdGlvbkFjdGlvbiA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5zdGF0ZS5pc1ZhbHVlQ29uZmlybWVkID0gZmFsc2U7XG4gICAgfVxuXG4gICAgcmVuZGVyQWN0KGFjdDogU3lzdGVtQWN0LCBpbnB1dDogQ29udHJvbElucHV0LCBidWlsZGVyOiBDb250cm9sUmVzcG9uc2VCdWlsZGVyKTogdm9pZCB7XG5cbiAgICAgICAgaWYgKGFjdCBpbnN0YW5jZW9mIFJlcXVlc3RWYWx1ZUFjdCkge1xuICAgICAgICAgICAgYnVpbGRlci5hZGRQcm9tcHRGcmFnbWVudCh0aGlzLmV2YWx1YXRlUHJvbXB0UHJvcChhY3QsIHRoaXMucHJvcHMucHJvbXB0cy5yZXF1ZXN0VmFsdWUsIGlucHV0KSk7XG4gICAgICAgICAgICBidWlsZGVyLmFkZFJlcHJvbXB0RnJhZ21lbnQodGhpcy5ldmFsdWF0ZVByb21wdFByb3AoYWN0LCB0aGlzLnByb3BzLnJlcHJvbXB0cy5yZXF1ZXN0VmFsdWUsIGlucHV0KSk7XG4gICAgICAgICAgICBjb25zdCBzbG90RWxpY2l0YXRpb24gPSBnZW5lcmF0ZVNsb3RFbGljaXRhdGlvbigpO1xuICAgICAgICAgICAgYnVpbGRlci5hZGRFbGljaXRTbG90RGlyZWN0aXZlKHNsb3RFbGljaXRhdGlvbi5zbG90TmFtZSwgc2xvdEVsaWNpdGF0aW9uLmludGVudCk7XG4gICAgICAgIH1cblxuICAgICAgICBlbHNlIGlmIChhY3QgaW5zdGFuY2VvZiBWYWx1ZVNldEFjdCkge1xuICAgICAgICAgICAgYnVpbGRlci5hZGRQcm9tcHRGcmFnbWVudCh0aGlzLmV2YWx1YXRlUHJvbXB0UHJvcChhY3QsIHRoaXMucHJvcHMucHJvbXB0cy52YWx1ZVNldCwgaW5wdXQpKTtcbiAgICAgICAgICAgIGJ1aWxkZXIuYWRkUmVwcm9tcHRGcmFnbWVudCh0aGlzLmV2YWx1YXRlUHJvbXB0UHJvcChhY3QsIHRoaXMucHJvcHMucmVwcm9tcHRzLnZhbHVlU2V0LCBpbnB1dCkpO1xuICAgICAgICB9XG5cbiAgICAgICAgZWxzZSBpZiAoYWN0IGluc3RhbmNlb2YgVmFsdWVDaGFuZ2VkQWN0KSB7XG4gICAgICAgICAgICBidWlsZGVyLmFkZFByb21wdEZyYWdtZW50KHRoaXMuZXZhbHVhdGVQcm9tcHRQcm9wKGFjdCwgdGhpcy5wcm9wcy5wcm9tcHRzLnZhbHVlQ2hhbmdlZCwgaW5wdXQpKTtcbiAgICAgICAgICAgIGJ1aWxkZXIuYWRkUmVwcm9tcHRGcmFnbWVudCh0aGlzLmV2YWx1YXRlUHJvbXB0UHJvcChhY3QsIHRoaXMucHJvcHMucmVwcm9tcHRzLnZhbHVlQ2hhbmdlZCwgaW5wdXQpKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGVsc2UgaWYgKGFjdCBpbnN0YW5jZW9mIEludmFsaWRWYWx1ZUFjdCkge1xuICAgICAgICAgICAgYnVpbGRlci5hZGRQcm9tcHRGcmFnbWVudCh0aGlzLmV2YWx1YXRlUHJvbXB0UHJvcChhY3QsIHRoaXMucHJvcHMucHJvbXB0cy5pbnZhbGlkVmFsdWUsIGlucHV0KSk7XG4gICAgICAgICAgICBidWlsZGVyLmFkZFJlcHJvbXB0RnJhZ21lbnQodGhpcy5ldmFsdWF0ZVByb21wdFByb3AoYWN0LCB0aGlzLnByb3BzLnJlcHJvbXB0cy5pbnZhbGlkVmFsdWUsIGlucHV0KSk7XG4gICAgICAgIH1cblxuICAgICAgICBlbHNlIGlmIChhY3QgaW5zdGFuY2VvZiBSZXF1ZXN0Q2hhbmdlZFZhbHVlQWN0KSB7XG4gICAgICAgICAgICBidWlsZGVyLmFkZFByb21wdEZyYWdtZW50KHRoaXMuZXZhbHVhdGVQcm9tcHRQcm9wKGFjdCwgdGhpcy5wcm9wcy5wcm9tcHRzLnJlcXVlc3RDaGFuZ2VkVmFsdWUsIGlucHV0KSk7XG4gICAgICAgICAgICBidWlsZGVyLmFkZFJlcHJvbXB0RnJhZ21lbnQodGhpcy5ldmFsdWF0ZVByb21wdFByb3AoYWN0LCB0aGlzLnByb3BzLnJlcHJvbXB0cy5yZXF1ZXN0Q2hhbmdlZFZhbHVlLCBpbnB1dCkpO1xuICAgICAgICB9XG5cbiAgICAgICAgZWxzZSBpZiAoYWN0IGluc3RhbmNlb2YgQ29uZmlybVZhbHVlQWN0KSB7XG4gICAgICAgICAgICBidWlsZGVyLmFkZFByb21wdEZyYWdtZW50KHRoaXMuZXZhbHVhdGVQcm9tcHRQcm9wKGFjdCwgdGhpcy5wcm9wcy5wcm9tcHRzLmNvbmZpcm1WYWx1ZSwgaW5wdXQpKTtcbiAgICAgICAgICAgIGJ1aWxkZXIuYWRkUmVwcm9tcHRGcmFnbWVudCh0aGlzLmV2YWx1YXRlUHJvbXB0UHJvcChhY3QsIHRoaXMucHJvcHMucmVwcm9tcHRzLmNvbmZpcm1WYWx1ZSwgaW5wdXQpKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGVsc2UgaWYgKGFjdCBpbnN0YW5jZW9mIFZhbHVlQ29uZmlybWVkQWN0KSB7XG4gICAgICAgICAgICBidWlsZGVyLmFkZFByb21wdEZyYWdtZW50KHRoaXMuZXZhbHVhdGVQcm9tcHRQcm9wKGFjdCwgdGhpcy5wcm9wcy5wcm9tcHRzLnZhbHVlQWZmaXJtZWQsIGlucHV0KSk7XG4gICAgICAgICAgICBidWlsZGVyLmFkZFJlcHJvbXB0RnJhZ21lbnQodGhpcy5ldmFsdWF0ZVByb21wdFByb3AoYWN0LCB0aGlzLnByb3BzLnJlcHJvbXB0cy52YWx1ZUFmZmlybWVkLCBpbnB1dCkpO1xuICAgICAgICB9XG5cbiAgICAgICAgZWxzZSBpZiAoYWN0IGluc3RhbmNlb2YgVmFsdWVEaXNjb25maXJtZWRBY3QpIHtcbiAgICAgICAgICAgIGJ1aWxkZXIuYWRkUHJvbXB0RnJhZ21lbnQodGhpcy5ldmFsdWF0ZVByb21wdFByb3AoYWN0LCB0aGlzLnByb3BzLnByb21wdHMudmFsdWVEaXNhZmZpcm1lZCwgaW5wdXQpKTtcbiAgICAgICAgICAgIGJ1aWxkZXIuYWRkUmVwcm9tcHRGcmFnbWVudCh0aGlzLmV2YWx1YXRlUHJvbXB0UHJvcChhY3QsIHRoaXMucHJvcHMucmVwcm9tcHRzLnZhbHVlRGlzYWZmaXJtZWQsIGlucHV0KSk7XG4gICAgICAgIH1cblxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMudGhyb3dVbmhhbmRsZWRBY3RFcnJvcihhY3QpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgdXBkYXRlSW50ZXJhY3Rpb25Nb2RlbChnZW5lcmF0b3I6IENvbnRyb2xJbnRlcmFjdGlvbk1vZGVsR2VuZXJhdG9yLCBpbURhdGE6IE1vZGVsRGF0YSkge1xuICAgICAgICBnZW5lcmF0b3IuYWRkQ29udHJvbEludGVudChuZXcgR2VuZXJhbENvbnRyb2xJbnRlbnQoKSwgaW1EYXRhKTtcbiAgICAgICAgZ2VuZXJhdG9yLmFkZENvbnRyb2xJbnRlbnQobmV3IFNpbmdsZVZhbHVlQ29udHJvbEludGVudChBbWF6b25CdWlsdEluU2xvdFR5cGUuREFURSksIGltRGF0YSk7XG4gICAgICAgIGdlbmVyYXRvci5hZGRZZXNBbmROb0ludGVudHMoKTtcblxuICAgICAgICBpZiAodGhpcy5wcm9wcy5pbnRlcmFjdGlvbk1vZGVsLnRhcmdldHMuaW5jbHVkZXMoJ2RhdGUnKSkge1xuICAgICAgICAgICAgZ2VuZXJhdG9yLmFkZFZhbHVlc1RvU2xvdFR5cGUoU2hhcmVkU2xvdFR5cGUuVEFSR0VULCBpMThuZXh0LnQoJ0RBVEVfQ09OVFJPTF9ERUZBVUxUX1NMT1RfVkFMVUVTX1RBUkdFVF9EQVRFJywgeyByZXR1cm5PYmplY3RzOiB0cnVlIH0pKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGdldFRhcmdldElkcygpOiBzdHJpbmdbXSB7XG4gICAgICAgIHJldHVybiB0aGlzLnByb3BzLmludGVyYWN0aW9uTW9kZWwudGFyZ2V0cztcbiAgICB9XG59XG5cbmZ1bmN0aW9uIGdlbmVyYXRlU2xvdEVsaWNpdGF0aW9uKCk6IHsgaW50ZW50OiBJbnRlbnQsIHNsb3ROYW1lOiBzdHJpbmcgfSB7XG4gICAgY29uc3QgaW50ZW50OiBJbnRlbnQgPSB7XG4gICAgICAgIC8vIHRyeSB0byBkbyB0aGlzIHVzaW5nIHN0cmluZyBjb25zdGFudHMgcmF0aGVyIHRoYW4gbGl0ZXJhbHMuXG4gICAgICAgIG5hbWU6IFwiRGF0ZUNvbnRyb2xJbnRlbnRcIixcbiAgICAgICAgc2xvdHM6IHtcbiAgICAgICAgICAgIFwiZmVlZGJhY2tcIjogeyBuYW1lOiBcImZlZWRiYWNrXCIsIHZhbHVlOiAnJywgY29uZmlybWF0aW9uU3RhdHVzOiAnTk9ORScgfSxcbiAgICAgICAgICAgIFwiYWN0aW9uXCI6IHsgbmFtZTogXCJhY3Rpb25cIiwgdmFsdWU6ICcnLCBjb25maXJtYXRpb25TdGF0dXM6ICdOT05FJyB9LFxuICAgICAgICAgICAgXCJ0YXJnZXRcIjogeyBuYW1lOiBcInRhcmdldFwiLCB2YWx1ZTogJycsIGNvbmZpcm1hdGlvblN0YXR1czogJ05PTkUnIH0sXG4gICAgICAgICAgICBcIkFNQVpPTi5EQVRFXCI6IHsgbmFtZTogXCJBTUFaT04uREFURVwiLCB2YWx1ZTogJycsIGNvbmZpcm1hdGlvblN0YXR1czogJ05PTkUnIH0sXG4gICAgICAgICAgICBcImhlYWRcIjogeyBuYW1lOiBcImhlYWRcIiwgdmFsdWU6ICcnLCBjb25maXJtYXRpb25TdGF0dXM6ICdOT05FJyB9LFxuICAgICAgICAgICAgXCJ0YWlsXCI6IHsgbmFtZTogXCJ0YWlsXCIsIHZhbHVlOiAnJywgY29uZmlybWF0aW9uU3RhdHVzOiAnTk9ORScgfSxcbiAgICAgICAgICAgIFwicHJlcG9zaXRpb25cIjogeyBuYW1lOiBcInByZXBvc2l0aW9uXCIsIHZhbHVlOiAnJywgY29uZmlybWF0aW9uU3RhdHVzOiAnTk9ORScgfVxuICAgICAgICB9LFxuICAgICAgICBjb25maXJtYXRpb25TdGF0dXM6IFwiTk9ORVwiXG4gICAgfTtcblxuICAgIHJldHVybiB7XG4gICAgICAgIGludGVudCxcbiAgICAgICAgc2xvdE5hbWU6ICQuU2xvdFR5cGUuQW1hem9uRGF0ZVxuICAgIH07XG59XG4iXX0=