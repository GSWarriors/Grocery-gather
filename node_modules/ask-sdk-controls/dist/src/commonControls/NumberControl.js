"use strict";
/*
 * Copyright 2020 Amazon.com, Inc. or its affiliates. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License").
 * You may not use this file except in compliance with the License.
 * A copy of the License is located at
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * or in the "license" file accompanying this file. This file is distributed
 * on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either
 * express or implied. See the License for the specific language governing
 * permissions and limitations under the License.
 */
Object.defineProperty(exports, "__esModule", { value: true });
exports.NumberControl = exports.NumberControlState = void 0;
const tslib_1 = require("tslib");
const lodash_1 = tslib_1.__importDefault(require("lodash"));
const i18next_1 = tslib_1.__importDefault(require("i18next"));
const __1 = require("..");
const Strings_1 = require("../constants/Strings");
const Control_1 = require("../controls/Control");
const GeneralControlIntent_1 = require("../intents/GeneralControlIntent");
const ModelTypes_1 = require("../interactionModelGeneration/ModelTypes");
const Logger_1 = require("../logging/Logger");
const ContentActs_1 = require("../systemActs/ContentActs");
const InitiativeActs_1 = require("../systemActs/InitiativeActs");
const log = new Logger_1.Logger('AskSdkControls:NumberControl');
class NumberControlState {
    constructor() {
        this.isValueConfirmed = false;
        this.rejectedValues = [];
    }
}
exports.NumberControlState = NumberControlState;
/**
 * Main class for NumberControl.
 * For constructor parameters please read the interface @NumberControlProps .
 */
class NumberControl extends Control_1.Control {
    constructor(props) {
        super(props.id);
        this.state = new NumberControlState();
        this.rawProps = props;
        this.props = NumberControl.mergeWithDefaultProps(props);
    }
    static mergeWithDefaultProps(props) {
        const defaults = {
            id: 'placeholder',
            interactionModel: {
                actions: {
                    set: [Strings_1.Strings.Action.Set],
                    change: [Strings_1.Strings.Action.Change],
                },
                targets: ['number', Strings_1.Strings.Target.It]
            },
            prompts: {
                requestValue: i18next_1.default.t('NUMBER_CONTROL_DEFAULT_PROMPT_REQUEST_VALUE'),
                confirmValue: (act) => i18next_1.default.t('NUMBER_CONTROL_DEFAULT_PROMPT_CONFIRM_VALUE', { value: act.payload.value }),
                valueDisaffirmed: i18next_1.default.t('NUMBER_CONTROL_DEFAULT_PROMPT_VALUE_DISAFFIRMED'),
                valueSet: (act) => i18next_1.default.t('NUMBER_CONTROL_DEFAULT_PROMPT_VALUE_SET', { value: act.payload.value }),
                valueAffirmed: i18next_1.default.t('NUMBER_CONTROL_DEFAULT_PROMPT_VALUE_AFFIRMED'),
                suggestValue: (act) => i18next_1.default.t('NUMBER_CONTROL_DEFAULT_PROMPT_SUGGEST_VALUE', { value: act.payload.value }),
                informConfusingDisconfirmation: (act) => i18next_1.default.t('NUMBER_CONTROL_DEFAULT_PROMPT_INFORM_CONFUSING_DISCONFIRMATION'),
                informConfusingConfirmation: (act) => i18next_1.default.t('NUMBER_CONTROL_DEFAULT_PROMPT_INFORM_CONFUSING_CONFIRMATION', { previousValue: act.payload.value }),
                repeatUnusableValue: (act) => i18next_1.default.t('NUMBER_CONTROL_DEFAULT_PROMPT_REPEAT_UNUSABLE_VALUE', { value: act.payload.value }),
                invalidValue: (act) => {
                    if (act.payload.renderedReason !== undefined) {
                        return i18next_1.default.t('NUMBER_CONTROL_DEFAULT_PROMPT_INVALID_VALUE_WITH_REASON', { value: act.payload.value, reason: act.payload.renderedReason });
                    }
                    return i18next_1.default.t('NUMBER_CONTROL_DEFAULT_PROMPT_GENERAL_INVALID_VALUE', { value: act.payload.value });
                },
            },
            reprompts: {
                requestValue: i18next_1.default.t('NUMBER_CONTROL_DEFAULT_REPROMPT_REQUEST_VALUE'),
                confirmValue: (act) => i18next_1.default.t('NUMBER_CONTROL_DEFAULT_REPROMPT_CONFIRM_VALUE', { value: act.payload.value }),
                valueDisaffirmed: i18next_1.default.t('NUMBER_CONTROL_DEFAULT_REPROMPT_VALUE_DISAFFIRMED'),
                valueSet: (act) => i18next_1.default.t('NUMBER_CONTROL_DEFAULT_REPROMPT_VALUE_SET', { value: act.payload.value }),
                valueAffirmed: i18next_1.default.t('NUMBER_CONTROL_DEFAULT_REPROMPT_VALUE_AFFIRMED'),
                suggestValue: (act) => i18next_1.default.t('NUMBER_CONTROL_DEFAULT_REPROMPT_SUGGEST_VALUE', { value: act.payload.value }),
                informConfusingDisconfirmation: (act) => i18next_1.default.t('NUMBER_CONTROL_DEFAULT_REPROMPT_INFORM_CONFUSING_DISCONFIRMATION'),
                informConfusingConfirmation: (act) => i18next_1.default.t('NUMBER_CONTROL_DEFAULT_REPROMPT_INFORM_CONFUSING_CONFIRMATION', { previousValue: act.payload.value }),
                repeatUnusableValue: (act) => i18next_1.default.t('NUMBER_CONTROL_DEFAULT_REPROMPT_REPEAT_UNUSABLE_VALUE', { value: act.payload.value }),
                invalidValue: (act) => {
                    if (act.payload.renderedReason !== undefined) {
                        return i18next_1.default.t('NUMBER_CONTROL_DEFAULT_REPROMPT_INVALID_VALUE_WITH_REASON', { value: act.payload.value, reason: act.payload.renderedReason });
                    }
                    return i18next_1.default.t('NUMBER_CONTROL_DEFAULT_REPROMPT_GENERAL_INVALID_VALUE', { value: act.payload.value });
                },
            },
            validation: [],
            confirmationRequired: false,
            ambiguousPairs: [[13, 30], [14, 40], [15, 50], [16, 60], [17, 70], [18, 80]],
            required: true,
        };
        return lodash_1.default.merge(defaults, props);
    }
    canHandle(input) {
        return this.canHandleForEmptyStateValue(input)
            || this.canHandleForExistingStateValue(input);
    }
    async handle(input, resultBuilder) {
        log.debug(`NumberControl[${this.id}]: handle(). Entering`);
        const intent = input.request.intent;
        if (this.handleFunc === undefined) {
            throw new Error(`${intent.name} can not be handled by ${this.constructor.name}.`);
        }
        this.handleFunc(input, resultBuilder);
    }
    canTakeInitiative(input) {
        return this.wantsToElicitValue(input)
            || this.wantsToFixInvalidValue(input)
            || this.wantsToConfirmValue(input);
    }
    async takeInitiative(input, resultBuilder) {
        log.debug(`NumberControl[${this.id}]: takeInitiative(). Entering`);
        if (this.wantsToElicitValue(input)) {
            resultBuilder.addAct(new InitiativeActs_1.RequestValueAct(this));
        }
        else if (this.wantsToFixInvalidValue(input)) {
            const validationResult = this.validateNumber(input);
            resultBuilder.addAct(new ContentActs_1.InvalidValueAct(this, {
                value: this.state.value,
                reasonCode: 'ValueInvalid',
                renderedReason: validationResult.renderedReason
            }));
            resultBuilder.addAct(new InitiativeActs_1.RequestValueAct(this));
        }
        else if (this.wantsToConfirmValue(input)) {
            resultBuilder.addAct(new InitiativeActs_1.ConfirmValueAct(this, { value: this.state.value }));
        }
        else {
            const intent = input.request.intent;
            throw new Error(`${intent.name} can not take initiative from ${this.constructor.name}.`);
        }
    }
    renderAct(act, input, builder) {
        if (act instanceof InitiativeActs_1.RequestValueAct) {
            builder.addPromptFragment(this.evaluatePromptProp(act, this.props.prompts.requestValue, input));
            builder.addRepromptFragment(this.evaluatePromptProp(act, this.props.reprompts.requestValue, input));
            const slotElicitation = generateSlotElicitation();
            builder.addElicitSlotDirective(slotElicitation.slotName, slotElicitation.intent);
        }
        else if (act instanceof InitiativeActs_1.ConfirmValueAct) {
            builder.addPromptFragment(this.evaluatePromptProp(act, this.props.prompts.confirmValue, input));
            builder.addRepromptFragment(this.evaluatePromptProp(act, this.props.reprompts.confirmValue, input));
        }
        else if (act instanceof ContentActs_1.ValueDisconfirmedAct) {
            builder.addPromptFragment(this.evaluatePromptProp(act, this.props.prompts.valueDisaffirmed, input));
            builder.addRepromptFragment(this.evaluatePromptProp(act, this.props.reprompts.valueDisaffirmed, input));
        }
        else if (act instanceof ContentActs_1.ValueSetAct) {
            builder.addPromptFragment(this.evaluatePromptProp(act, this.props.prompts.valueSet, input));
            builder.addRepromptFragment(this.evaluatePromptProp(act, this.props.reprompts.valueSet, input));
        }
        else if (act instanceof ContentActs_1.ValueConfirmedAct) {
            builder.addPromptFragment(this.evaluatePromptProp(act, this.props.prompts.valueAffirmed, input));
            builder.addRepromptFragment(this.evaluatePromptProp(act, this.props.reprompts.valueAffirmed, input));
        }
        else if (act instanceof InitiativeActs_1.SuggestValueAct) {
            builder.addPromptFragment(this.evaluatePromptProp(act, this.props.prompts.suggestValue, input));
            builder.addRepromptFragment(this.evaluatePromptProp(act, this.props.reprompts.suggestValue, input));
        }
        else if (act instanceof ContentActs_1.InformConfusingConfirmationAct) {
            builder.addPromptFragment(this.evaluatePromptProp(act, this.props.prompts.informConfusingConfirmation, input));
            builder.addRepromptFragment(this.evaluatePromptProp(act, this.props.reprompts.informConfusingConfirmation, input));
        }
        else if (act instanceof ContentActs_1.InformConfusingDisconfirmationAct) {
            builder.addPromptFragment(this.evaluatePromptProp(act, this.props.prompts.informConfusingDisconfirmation, input));
            builder.addRepromptFragment(this.evaluatePromptProp(act, this.props.reprompts.informConfusingDisconfirmation, input));
        }
        else if (act instanceof ContentActs_1.ProblematicInputValueAct) {
            builder.addPromptFragment(this.evaluatePromptProp(act, this.props.prompts.repeatUnusableValue, input));
            builder.addRepromptFragment(this.evaluatePromptProp(act, this.props.reprompts.repeatUnusableValue, input));
        }
        else if (act instanceof ContentActs_1.InvalidValueAct) {
            builder.addPromptFragment(this.evaluatePromptProp(act, this.props.prompts.invalidValue, input));
            builder.addRepromptFragment(this.evaluatePromptProp(act, this.props.reprompts.invalidValue, input));
        }
        else {
            this.throwUnhandledActError(act);
        }
    }
    updateInteractionModel(generator, imData) {
        generator.addControlIntent(new GeneralControlIntent_1.GeneralControlIntent(), imData);
        generator.addControlIntent(new __1.SingleValueControlIntent(__1.AmazonBuiltInSlotType.NUMBER), imData);
        generator.addYesAndNoIntents();
        if (this.props.interactionModel.targets.includes('number')) {
            generator.addValuesToSlotType(ModelTypes_1.SharedSlotType.TARGET, i18next_1.default.t('NUMBER_CONTROL_DEFAULT_SLOT_VALUES_TARGET_NUMBER', { returnObjects: true }));
        }
    }
    getTargetIds() {
        return this.props.interactionModel.targets;
    }
    /* --------------------------------------------
     * This block handles when the lastQuestion has not been asked
     */
    canHandleForEmptyStateValue(input) {
        try {
            __1.okIf(this.state.value === undefined);
            if (__1.InputUtil.isIntent(input, GeneralControlIntent_1.GeneralControlIntent.name)) {
                const { action, target } = GeneralControlIntent_1.unpackGeneralControlIntent(input.request.intent);
                __1.okIf(__1.InputUtil.actionIsMatchOrUndefined(action, [...this.props.interactionModel.actions.set, ...this.props.interactionModel.actions.change]));
                __1.okIf(__1.InputUtil.targetIsMatchOrUndefined(target, this.props.interactionModel.targets));
                this.handleFunc = this.handleLastQuestionEmptyAndValueNotExisting;
                return true;
            }
            else if (__1.InputUtil.isSingleValueControlIntent(input, __1.AmazonBuiltInSlotType.NUMBER)) {
                const { action, target } = __1.unpackSingleValueControlIntent(input.request.intent);
                __1.okIf(__1.InputUtil.actionIsMatchOrUndefined(action, [...this.props.interactionModel.actions.set, ...this.props.interactionModel.actions.change]));
                __1.okIf(__1.InputUtil.targetIsMatchOrUndefined(target, this.props.interactionModel.targets));
                this.handleFunc = this.handleLastQuestionEmptyAndValueExisting;
                return true;
            }
            return false;
        }
        catch (e) {
            return __1.falseIfGuardFailed(e);
        }
    }
    handleLastQuestionEmptyAndValueNotExisting(input, resultBuilder) {
        resultBuilder.addAct(new InitiativeActs_1.RequestValueAct(this));
    }
    handleLastQuestionEmptyAndValueExisting(input, resultBuilder) {
        const { action, valueStr } = __1.unpackSingleValueControlIntent(input.request.intent);
        this.setValue(valueStr);
        this.commonHandlerWhenValueChanged(action !== null && action !== void 0 ? action : Strings_1.Strings.Action.Set, input, resultBuilder);
    }
    /* -------------------------------------------- */
    /* --------------------------------------------
     * This block handles when the current value is to be confirmed
     */
    canHandleForExistingStateValue(input) {
        try {
            __1.okIf(this.state.value !== undefined);
            return this.isValueInRejectedValues(input)
                || this.isBareNoWhenConfirmingValue(input)
                || this.isFeedbackNoAndValueUndefinedWhenConfirmingValue(input)
                || this.isFeedbackNoAndValueNotChangedWhenConfirmingValue(input)
                || this.isFeedbackNoAndValueChangedWhenConfirmingValue(input)
                || this.isBareYesConfirmingValue(input)
                || this.isFeedbackYesAndValueChangedWhenConfirmingValue(input)
                || this.isFeedbackYesAndValueNotChangedWhenConfirmingValue(input)
                || this.isFeedbackYesAndValueUndefinedWhenConfirmingValue(input)
                || this.isFeedbackUndefinedAndValueNotChangedWhenConfirmingValue(input)
                || this.isFeedbackUndefinedAndValueChangedWhenConfirmingValue(input)
                || this.isTargetsMatchWithoutFeedbackNorValueWhenConfirmingValue(input);
        }
        catch (e) {
            return __1.falseIfGuardFailed(e);
        }
    }
    isValueInRejectedValues(input) {
        try {
            __1.okIf(__1.InputUtil.isSingleValueControlIntent(input, __1.AmazonBuiltInSlotType.NUMBER));
            const { action, target, valueStr } = __1.unpackSingleValueControlIntent(input.request.intent);
            __1.okIf(__1.InputUtil.actionIsMatchOrUndefined(action, [...this.props.interactionModel.actions.set, ...this.props.interactionModel.actions.change]));
            __1.okIf(__1.InputUtil.targetIsMatchOrUndefined(target, this.props.interactionModel.targets));
            __1.okIf(this.state.rejectedValues.includes(Number.parseInt(valueStr, 10)));
            this.handleFunc = this.handleValueExistsInRejectedValues;
            return true;
        }
        catch (e) {
            return __1.falseIfGuardFailed(e);
        }
    }
    handleValueExistsInRejectedValues(input, resultBuilder) {
        const { valueStr } = __1.unpackSingleValueControlIntent(input.request.intent);
        this.setValue(valueStr);
        resultBuilder.addAct(new ContentActs_1.ProblematicInputValueAct(this, { reasonCode: 'ValuePreviouslyRejected', value: this.state.value }));
        resultBuilder.addAct(new InitiativeActs_1.RequestValueAct(this));
    }
    isBareNoWhenConfirmingValue(input) {
        try {
            __1.okIf(__1.InputUtil.isBareNo(input));
            this.handleFunc = this.handleFeedbackNoAndWithoutValueWhenConfirmingValue;
            return true;
        }
        catch (e) {
            return __1.falseIfGuardFailed(e);
        }
    }
    isFeedbackNoAndValueUndefinedWhenConfirmingValue(input) {
        try {
            __1.okIf(__1.InputUtil.isIntent(input, GeneralControlIntent_1.GeneralControlIntent.name));
            const { feedback, action, target } = GeneralControlIntent_1.unpackGeneralControlIntent(input.request.intent);
            __1.okIf(__1.InputUtil.actionIsMatchOrUndefined(action, [...this.props.interactionModel.actions.set, ...this.props.interactionModel.actions.change]));
            __1.okIf(__1.InputUtil.targetIsMatchOrUndefined(target, this.props.interactionModel.targets));
            __1.okIf(__1.InputUtil.feedbackIsFalse(feedback));
            this.handleFunc = this.handleFeedbackNoAndWithoutValueWhenConfirmingValue;
            return true;
        }
        catch (e) {
            return __1.falseIfGuardFailed(e);
        }
    }
    handleFeedbackNoAndWithoutValueWhenConfirmingValue(input, resultBuilder) {
        resultBuilder.addAct(new ContentActs_1.ValueDisconfirmedAct(this, { value: this.state.value }));
        this.commonHandlerWhenValueRejected(input, resultBuilder);
    }
    isFeedbackNoAndValueNotChangedWhenConfirmingValue(input) {
        try {
            __1.okIf(__1.InputUtil.isSingleValueControlIntent(input, __1.AmazonBuiltInSlotType.NUMBER));
            const { action, target, feedback, valueStr } = __1.unpackSingleValueControlIntent(input.request.intent);
            __1.okIf(__1.InputUtil.actionIsMatchOrUndefined(action, [...this.props.interactionModel.actions.set, ...this.props.interactionModel.actions.change]));
            __1.okIf(__1.InputUtil.targetIsMatchOrUndefined(target, this.props.interactionModel.targets));
            __1.okIf(__1.InputUtil.feedbackIsFalse(feedback));
            __1.okIf(this.state.value === Number.parseInt(valueStr, 10));
            this.handleFunc = this.handleFeedbackNoAndValueNotChangedWhenConfirmingValue;
            return true;
        }
        catch (e) {
            return __1.falseIfGuardFailed(e);
        }
    }
    handleFeedbackNoAndValueNotChangedWhenConfirmingValue(input, resultBuilder) {
        resultBuilder.addAct(new ContentActs_1.InformConfusingDisconfirmationAct(this, { value: this.state.value, reasonCode: 'DisconfirmedWithSameValue' }));
        this.commonHandlerWhenValueRejected(input, resultBuilder);
    }
    isFeedbackNoAndValueChangedWhenConfirmingValue(input) {
        try {
            __1.okIf(__1.InputUtil.isSingleValueControlIntent(input, __1.AmazonBuiltInSlotType.NUMBER));
            const { feedback, action, target, valueStr } = __1.unpackSingleValueControlIntent(input.request.intent);
            __1.okIf(__1.InputUtil.actionIsMatchOrUndefined(action, [...this.props.interactionModel.actions.set, ...this.props.interactionModel.actions.change]));
            __1.okIf(__1.InputUtil.targetIsMatchOrUndefined(target, this.props.interactionModel.targets));
            __1.okIf(__1.InputUtil.feedbackIsFalse(feedback));
            __1.okIf(__1.InputUtil.valueStrDefined(valueStr));
            __1.okIf(this.state.value !== Number.parseInt(valueStr, 10));
            this.handleFunc = this.handleFeedbackNoAndValueChangedWhenConfirmingValue;
            return true;
        }
        catch (e) {
            return __1.falseIfGuardFailed(e);
        }
    }
    handleFeedbackNoAndValueChangedWhenConfirmingValue(input, resultBuilder) {
        const { action, valueStr } = __1.unpackSingleValueControlIntent(input.request.intent);
        this.setValue(valueStr);
        this.commonHandlerWhenValueChanged(action !== null && action !== void 0 ? action : Strings_1.Strings.Action.Set, input, resultBuilder);
    }
    isFeedbackYesAndValueChangedWhenConfirmingValue(input) {
        try {
            __1.okIf(__1.InputUtil.isSingleValueControlIntent(input, __1.AmazonBuiltInSlotType.NUMBER));
            const { feedback, action, target, valueStr } = __1.unpackSingleValueControlIntent(input.request.intent);
            __1.okIf(__1.InputUtil.actionIsMatchOrUndefined(action, [...this.props.interactionModel.actions.set, ...this.props.interactionModel.actions.change]));
            __1.okIf(__1.InputUtil.targetIsMatchOrUndefined(target, this.props.interactionModel.targets));
            __1.okIf(__1.InputUtil.feedbackIsTrue(feedback));
            __1.okIf(__1.InputUtil.valueStrDefined(valueStr));
            __1.okIf(this.state.value !== Number.parseInt(valueStr, 10));
            this.handleFunc = this.handleFeedbackYesAndValueChangedWhenConfirmingValue;
            return true;
        }
        catch (e) {
            return __1.falseIfGuardFailed(e);
        }
    }
    handleFeedbackYesAndValueChangedWhenConfirmingValue(input, resultBuilder) {
        const { action, valueStr } = __1.unpackSingleValueControlIntent(input.request.intent);
        const previousValue = this.state.value;
        this.setValue(valueStr);
        resultBuilder.addAct(new ContentActs_1.InformConfusingConfirmationAct(this, { value: previousValue, reasonCode: 'ConfirmedWithDifferentValue' }));
        resultBuilder.addAct(new InitiativeActs_1.ConfirmValueAct(this, { value: this.state.value }));
    }
    isBareYesConfirmingValue(input) {
        try {
            __1.okIf(__1.InputUtil.isBareYes(input));
            this.handleFunc = this.handleFeedbackYesAndValueNotChangedOrUndefinedWhenConfirmingValue;
            return true;
        }
        catch (e) {
            return __1.falseIfGuardFailed(e);
        }
    }
    isFeedbackYesAndValueNotChangedWhenConfirmingValue(input) {
        try {
            __1.okIf(__1.InputUtil.isSingleValueControlIntent(input, __1.AmazonBuiltInSlotType.NUMBER));
            const { feedback, action, target, valueStr } = __1.unpackSingleValueControlIntent(input.request.intent);
            __1.okIf(__1.InputUtil.actionIsMatchOrUndefined(action, [...this.props.interactionModel.actions.set, ...this.props.interactionModel.actions.change]));
            __1.okIf(__1.InputUtil.targetIsMatchOrUndefined(target, this.props.interactionModel.targets));
            __1.okIf(__1.InputUtil.feedbackIsTrue(feedback));
            __1.okIf(this.state.value === Number.parseInt(valueStr, 10));
            this.handleFunc = this.handleFeedbackYesAndValueNotChangedOrUndefinedWhenConfirmingValue;
            return true;
        }
        catch (e) {
            return __1.falseIfGuardFailed(e);
        }
    }
    isFeedbackYesAndValueUndefinedWhenConfirmingValue(input) {
        try {
            __1.okIf(__1.InputUtil.isIntent(input, GeneralControlIntent_1.GeneralControlIntent.name));
            const { feedback, action, target } = GeneralControlIntent_1.unpackGeneralControlIntent(input.request.intent);
            __1.okIf(__1.InputUtil.actionIsMatchOrUndefined(action, [...this.props.interactionModel.actions.set, ...this.props.interactionModel.actions.change]));
            __1.okIf(__1.InputUtil.targetIsMatchOrUndefined(target, this.props.interactionModel.targets));
            __1.okIf(__1.InputUtil.feedbackIsTrue(feedback));
            this.handleFunc = this.handleFeedbackYesAndValueNotChangedOrUndefinedWhenConfirmingValue;
            return true;
        }
        catch (e) {
            return __1.falseIfGuardFailed(e);
        }
    }
    handleFeedbackYesAndValueNotChangedOrUndefinedWhenConfirmingValue(input, resultBuilder) {
        this.state.isValueConfirmed = true;
        resultBuilder.addAct(new ContentActs_1.ValueConfirmedAct(this, { value: this.state.value }));
    }
    isFeedbackUndefinedAndValueNotChangedWhenConfirmingValue(input) {
        try {
            __1.okIf(__1.InputUtil.isSingleValueControlIntent(input, __1.AmazonBuiltInSlotType.NUMBER));
            const { feedback, action, target, valueStr } = __1.unpackSingleValueControlIntent(input.request.intent);
            __1.okIf(__1.InputUtil.actionIsMatchOrUndefined(action, [...this.props.interactionModel.actions.set, ...this.props.interactionModel.actions.change]));
            __1.okIf(__1.InputUtil.targetIsMatchOrUndefined(target, this.props.interactionModel.targets));
            __1.okIf(__1.InputUtil.feedbackIsUndefined(feedback));
            __1.okIf(__1.InputUtil.valueStrDefined(valueStr));
            __1.okIf(this.state.value === Number.parseInt(valueStr, 10));
            this.handleFunc = this.handleFeedbackYesAndValueUndefinedWhenConfirmingValue;
            return true;
        }
        catch (e) {
            return __1.falseIfGuardFailed(e);
        }
    }
    handleFeedbackYesAndValueUndefinedWhenConfirmingValue(input, resultBuilder) {
        this.state.isValueConfirmed = true;
        resultBuilder.addAct(new ContentActs_1.ValueConfirmedAct(this, { value: this.state.value }));
    }
    isFeedbackUndefinedAndValueChangedWhenConfirmingValue(input) {
        try {
            __1.okIf(__1.InputUtil.isSingleValueControlIntent(input, __1.AmazonBuiltInSlotType.NUMBER));
            const { feedback, action, target, valueStr } = __1.unpackSingleValueControlIntent(input.request.intent);
            __1.okIf(__1.InputUtil.actionIsMatchOrUndefined(action, [...this.props.interactionModel.actions.set, ...this.props.interactionModel.actions.change]));
            __1.okIf(__1.InputUtil.targetIsMatchOrUndefined(target, this.props.interactionModel.targets));
            __1.okIf(__1.InputUtil.feedbackIsUndefined(feedback));
            __1.okIf(__1.InputUtil.valueStrDefined(valueStr));
            __1.okIf(this.state.value !== Number.parseInt(valueStr, 10));
            this.handleFunc = this.handleFeedbackUndefinedAndValueChangedWhenConfirmingValue;
            return true;
        }
        catch (e) {
            return __1.falseIfGuardFailed(e);
        }
    }
    handleFeedbackUndefinedAndValueChangedWhenConfirmingValue(input, resultBuilder) {
        const { action, valueStr } = __1.unpackSingleValueControlIntent(input.request.intent);
        this.setValue(valueStr);
        this.commonHandlerWhenValueChanged(action !== null && action !== void 0 ? action : Strings_1.Strings.Action.Set, input, resultBuilder);
    }
    isTargetsMatchWithoutFeedbackNorValueWhenConfirmingValue(input) {
        try {
            __1.okIf(__1.InputUtil.isIntent(input, GeneralControlIntent_1.GeneralControlIntent.name));
            const { feedback, action, target } = GeneralControlIntent_1.unpackGeneralControlIntent(input.request.intent);
            __1.okIf(__1.InputUtil.feedbackIsUndefined(feedback));
            __1.okIf(__1.InputUtil.actionIsMatchOrUndefined(action, [...this.props.interactionModel.actions.set, ...this.props.interactionModel.actions.change]));
            __1.okIf(__1.InputUtil.targetIsMatch(target, lodash_1.default.without(this.props.interactionModel.targets, Strings_1.Strings.Target.It)));
            this.handleFunc = this.handleTargetMatchWithoutFeedbackNorValueWhenConfirmingValue;
            return true;
        }
        catch (e) {
            return __1.falseIfGuardFailed(e);
        }
    }
    handleTargetMatchWithoutFeedbackNorValueWhenConfirmingValue(input, resultBuilder) {
        resultBuilder.addAct(new InitiativeActs_1.RequestValueAct(this));
    }
    /* -------------------------------------------- */
    commonHandlerWhenValueChanged(action, input, resultBuilder) {
        const validationResult = this.validateNumber(input);
        if (validationResult !== true) {
            this.state.rejectedValues.push(this.state.value);
            resultBuilder.addAct(new ContentActs_1.InvalidValueAct(this, { value: this.state.value, renderedReason: validationResult.renderedReason }));
            resultBuilder.addAct(new InitiativeActs_1.RequestValueAct(this));
        }
        else if (!this.isConfirmationRequired(input)) {
            this.state.isValueConfirmed = true;
            resultBuilder.addAct(new ContentActs_1.ValueSetAct(this, { value: this.state.value }));
        }
        else {
            resultBuilder.addAct(new InitiativeActs_1.ConfirmValueAct(this, { value: this.state.value }));
        }
    }
    /**
     * TODO: User's action has to be used in this function to form the response prompt, need to define action in the related payloadType
     *
     * U: No, {change} the value please
     * A: What value do you want to {change} to <RequestValueAct>
     */
    commonHandlerWhenValueRejected(input, resultBuilder) {
        this.state.rejectedValues.push(this.state.value);
        const ambiguousPartner = this.getAmbiguousPartner(this.state.value);
        if (ambiguousPartner !== undefined && !this.state.rejectedValues.includes(ambiguousPartner)) {
            const previousValue = this.state.value;
            this.state.value = ambiguousPartner;
            const validationResult = this.validateNumber(input);
            if (validationResult === true) {
                resultBuilder.addAct(new InitiativeActs_1.SuggestValueAct(this, { value: this.state.value }));
            }
            else {
                this.state.value = previousValue;
                resultBuilder.addAct(new InitiativeActs_1.RequestValueAct(this));
            }
        }
        else {
            resultBuilder.addAct(new InitiativeActs_1.RequestValueAct(this));
        }
    }
    wantsToElicitValue(input) {
        return this.evaluateBooleanProp(this.props.required, input) && this.state.value === undefined;
    }
    wantsToFixInvalidValue(input) {
        if (!this.evaluateBooleanProp(this.props.required, input) || this.state.value === undefined) {
            return false;
        }
        const validationResult = this.validateNumber(input);
        return validationResult !== true;
    }
    wantsToConfirmValue(input) {
        if (!this.evaluateBooleanProp(this.props.required, input) || this.state.value === undefined) {
            return false;
        }
        if (this.state.isValueConfirmed) {
            return false;
        }
        return this.isConfirmationRequired(input);
    }
    clear() {
        this.state = new NumberControlState();
    }
    setValue(value) {
        this.state.value = typeof value === 'string' ? Number.parseInt(value, 10) : value;
    }
    validateNumber(input) {
        const listOfValidationFunc = typeof (this.props.validation) === 'function' ? [this.props.validation] : this.props.validation;
        for (const validationFunction of listOfValidationFunc) {
            const validationResult = validationFunction(this.state, input);
            if (validationResult !== true) {
                log.debug(`NumberControl.validate(): validation failed. Reason: ${JSON.stringify(validationResult, null, 2)}.`);
                return validationResult;
            }
        }
        return true;
    }
    isConfirmationRequired(input) {
        if (typeof this.props.confirmationRequired === 'function') {
            return this.props.confirmationRequired(this.state, input);
        }
        else if (typeof this.props.confirmationRequired === 'boolean') {
            return this.props.confirmationRequired;
        }
        else {
            return true; // by default confirmation is required
        }
    }
    getAmbiguousPartner(value) {
        const pairs = this.props.ambiguousPairs;
        for (const pair of pairs) {
            if (pair[0] === value) {
                return pair[1];
            }
            else if (pair[1] === value) {
                return pair[0];
            }
        }
        return undefined;
    }
}
exports.NumberControl = NumberControl;
function generateSlotElicitation() {
    const intent = {
        name: "NumberControlIntent",
        slots: {
            "AMAZON.NUMBER": { name: "AMAZON.NUMBER", value: '', confirmationStatus: 'NONE' },
            "feedback": { name: "feedback", value: '', confirmationStatus: 'NONE' },
            "action": { name: "action", value: '', confirmationStatus: 'NONE' },
            "target": { name: "target", value: '', confirmationStatus: 'NONE' },
            "head": { name: "head", value: '', confirmationStatus: 'NONE' },
            "tail": { name: "tail", value: '', confirmationStatus: 'NONE' },
            "preposition": { name: "preposition", value: '', confirmationStatus: 'NONE' },
        },
        confirmationStatus: "NONE"
    };
    return {
        intent,
        slotName: Strings_1.Strings.SlotType.AmazonNumber
    };
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiTnVtYmVyQ29udHJvbC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9jb21tb25Db250cm9scy9OdW1iZXJDb250cm9sLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQTs7Ozs7Ozs7Ozs7R0FXRzs7OztBQUdILDREQUF1QjtBQUN2Qiw4REFBOEI7QUFDOUIsMEJBQXdKO0FBQ3hKLGtEQUFvRDtBQUNwRCxpREFBMEU7QUFJMUUsMEVBQW1HO0FBRW5HLHlFQUFxRjtBQUNyRiw4Q0FBMkM7QUFFM0MsMkRBQStNO0FBQy9NLGlFQUFpRztBQU1qRyxNQUFNLEdBQUcsR0FBRyxJQUFJLGVBQU0sQ0FBQyw4QkFBOEIsQ0FBQyxDQUFDO0FBa0h2RCxNQUFhLGtCQUFrQjtJQUEvQjtRQUVJLHFCQUFnQixHQUFZLEtBQUssQ0FBQztRQUNsQyxtQkFBYyxHQUFhLEVBQUUsQ0FBQztJQUNsQyxDQUFDO0NBQUE7QUFKRCxnREFJQztBQUVEOzs7R0FHRztBQUNILE1BQWEsYUFBYyxTQUFRLGlCQUFPO0lBTXRDLFlBQVksS0FBeUI7UUFDakMsS0FBSyxDQUFDLEtBQUssQ0FBQyxFQUFFLENBQUMsQ0FBQztRQUpwQixVQUFLLEdBQXVCLElBQUksa0JBQWtCLEVBQUUsQ0FBQztRQUtqRCxJQUFJLENBQUMsUUFBUSxHQUFHLEtBQUssQ0FBQztRQUN0QixJQUFJLENBQUMsS0FBSyxHQUFHLGFBQWEsQ0FBQyxxQkFBcUIsQ0FBQyxLQUFLLENBQUMsQ0FBQztJQUM1RCxDQUFDO0lBRUQsTUFBTSxDQUFDLHFCQUFxQixDQUFDLEtBQXlCO1FBQ2xELE1BQU0sUUFBUSxHQUFxQztZQUMvQyxFQUFFLEVBQUUsYUFBYTtZQUNqQixnQkFBZ0IsRUFBRTtnQkFDZCxPQUFPLEVBQUU7b0JBQ0wsR0FBRyxFQUFFLENBQUMsaUJBQUMsQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDO29CQUNuQixNQUFNLEVBQUUsQ0FBQyxpQkFBQyxDQUFDLE1BQU0sQ0FBQyxN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LE1BQU0sRUFBRSxLQUFLLEVBQUUsRUFBRSxFQUFFLGtCQUFrQixFQUFFLE1BQU0sRUFBRTtZQUMvRCxNQUFNLEVBQUUsRUFBRSxJQUFJLEVBQUUsTUFBTSxFQUFFLEtBQUssRUFBRSxFQUFFLEVBQUUsa0JBQWtCLEVBQUUsTUFBTSxFQUFFO1lBQy9ELGFBQWEsRUFBRSxFQUFFLElBQUksRUFBRSxhQUFhLEVBQUUsS0FBSyxFQUFFLEVBQUUsRUFBRSxrQkFBa0IsRUFBRSxNQUFNLEVBQUU7U0FDaEY7UUFDRCxrQkFBa0IsRUFBRSxNQUFNO0tBQzdCLENBQUM7SUFFRixPQUFPO1FBQ0gsTUFBTTtRQUNOLFFBQVEsRUFBRSxpQkFBQyxDQUFDLFFBQVEsQ0FBQyxZQUFZO0tBQ3BDLENBQUM7QUFDTixDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiLypcbiAqIENvcHlyaWdodCAyMDIwIEFtYXpvbi5jb20sIEluYy4gb3IgaXRzIGFmZmlsaWF0ZXMuIEFsbCBSaWdodHMgUmVzZXJ2ZWQuXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpLlxuICogWW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogQSBjb3B5IG9mIHRoZSBMaWNlbnNlIGlzIGxvY2F0ZWQgYXRcbiAqICAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogb3IgaW4gdGhlIFwibGljZW5zZVwiIGZpbGUgYWNjb21wYW55aW5nIHRoaXMgZmlsZS4gVGhpcyBmaWxlIGlzIGRpc3RyaWJ1dGVkXG4gKiBvbiBhbiBcIkFTIElTXCIgQkFTSVMsIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXJcbiAqIGV4cHJlc3Mgb3IgaW1wbGllZC4gU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nXG4gKiBwZXJtaXNzaW9ucyBhbmQgbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cblxuaW1wb3J0IHsgSW50ZW50LCBJbnRlbnRSZXF1ZXN0IH0gZnJvbSBcImFzay1zZGstbW9kZWxcIjtcbmltcG9ydCBfIGZyb20gXCJsb2Rhc2hcIjtcbmltcG9ydCBpMThuZXh0IGZyb20gJ2kxOG5leHQnO1xuaW1wb3J0IHsgQW1hem9uQnVpbHRJblNsb3RUeXBlLCBEZWVwUmVxdWlyZWQsIGZhbHNlSWZHdWFyZEZhaWxlZCwgSW5wdXRVdGlsLCBva0lmLCBTaW5nbGVWYWx1ZUNvbnRyb2xJbnRlbnQsIHVucGFja1NpbmdsZVZhbHVlQ29udHJvbEludGVudCB9IGZyb20gJy4uJztcbmltcG9ydCB7IFN0cmluZ3MgYXMgJCB9IGZyb20gXCIuLi9jb25zdGFudHMvU3RyaW5nc1wiO1xuaW1wb3J0IHsgQ29udHJvbCwgQ29udHJvbFByb3BzLCBDb250cm9sU3RhdGUgfSBmcm9tICcuLi9jb250cm9scy9Db250cm9sJztcbmltcG9ydCB7IENvbnRyb2xJbnB1dCB9IGZyb20gJy4uL2NvbnRyb2xzL0NvbnRyb2xJbnB1dCc7XG5pbXBvcnQgeyBDb250cm9sUmVzdWx0QnVpbGRlciB9IGZyb20gJy4uL2NvbnRyb2xzL0NvbnRyb2xSZXN1bHQnO1xuaW1wb3J0IHsgSW50ZXJhY3Rpb25Nb2RlbENvbnRyaWJ1dG9yIH0gZnJvbSAnLi4vY29udHJvbHMvbWl4aW5zL0ludGVyYWN0aW9uTW9kZWxDb250cmlidXRvcic7XG5pbXBvcnQgeyBHZW5lcmFsQ29udHJvbEludGVudCwgdW5wYWNrR2VuZXJhbENvbnRyb2xJbnRlbnQgfSBmcm9tICcuLi9pbnRlbnRzL0dlbmVyYWxDb250cm9sSW50ZW50JztcbmltcG9ydCB7IENvbnRyb2xJbnRlcmFjdGlvbk1vZGVsR2VuZXJhdG9yIH0gZnJvbSAnLi4vaW50ZXJhY3Rpb25Nb2RlbEdlbmVyYXRpb24vQ29udHJvbEludGVyYWN0aW9uTW9kZWxHZW5lcmF0b3InO1xuaW1wb3J0IHsgTW9kZWxEYXRhLCBTaGFyZWRTbG90VHlwZSB9IGZyb20gJy4uL2ludGVyYWN0aW9uTW9kZWxHZW5lcmF0aW9uL01vZGVsVHlwZXMnO1xuaW1wb3J0IHsgTG9nZ2VyIH0gZnJvbSAnLi4vbG9nZ2luZy9Mb2dnZXInO1xuaW1wb3J0IHsgQ29udHJvbFJlc3BvbnNlQnVpbGRlciB9IGZyb20gJy4uL3Jlc3BvbnNlR2VuZXJhdGlvbi9Db250cm9sUmVzcG9uc2VCdWlsZGVyJztcbmltcG9ydCB7IEluZm9ybUNvbmZ1c2luZ0NvbmZpcm1hdGlvbkFjdCwgSW5mb3JtQ29uZnVzaW5nRGlzY29uZmlybWF0aW9uQWN0LCBJbnZhbGlkVmFsdWVBY3QsIFByb2JsZW1hdGljSW5wdXRWYWx1ZUFjdCwgVmFsdWVDb25maXJtZWRBY3QsIFZhbHVlRGlzY29uZmlybWVkQWN0LCBWYWx1ZVNldEFjdCB9IGZyb20gXCIuLi9zeXN0ZW1BY3RzL0NvbnRlbnRBY3RzXCI7XG5pbXBvcnQgeyBDb25maXJtVmFsdWVBY3QsIFJlcXVlc3RWYWx1ZUFjdCwgU3VnZ2VzdFZhbHVlQWN0IH0gZnJvbSAnLi4vc3lzdGVtQWN0cy9Jbml0aWF0aXZlQWN0cyc7XG5pbXBvcnQgeyBTeXN0ZW1BY3QgfSBmcm9tICcuLi9zeXN0ZW1BY3RzL1N5c3RlbUFjdCc7XG5pbXBvcnQgeyBTdHJpbmdPckxpc3QsIFN0cmluZ09yVHJ1ZSB9IGZyb20gJy4uL3V0aWxzL0Jhc2ljVHlwZXMnO1xuaW1wb3J0IHsgVmFsaWRhdGlvblJlc3VsdCB9IGZyb20gJy4uL2NvbnRyb2xzL1ZhbGlkYXRpb25SZXN1bHQnO1xuXG5cbmNvbnN0IGxvZyA9IG5ldyBMb2dnZXIoJ0Fza1Nka0NvbnRyb2xzOk51bWJlckNvbnRyb2wnKTtcblxuZXhwb3J0IHR5cGUgTnVtYmVyVmFsaWRhdGlvbkZ1bmN0aW9uID0gKHN0YXRlOiBOdW1iZXJDb250cm9sU3RhdGUsIGlucHV0OiBDb250cm9sSW5wdXQpID0+IHRydWUgfCBWYWxpZGF0aW9uUmVzdWx0O1xuZXhwb3J0IHR5cGUgTnVtYmVyQ29uZmlybWF0aW9uUmVxdWlyZUZ1bmN0aW9uID0gKHN0YXRlOiBOdW1iZXJDb250cm9sU3RhdGUsIGlucHV0OiBDb250cm9sSW5wdXQpID0+IGJvb2xlYW47XG5leHBvcnQgdHlwZSBOdW1iZXJDb250cm9sQWN0aW9uUHJvcHMgPSB7XG4gICAgc2V0Pzogc3RyaW5nW107XG4gICAgY2hhbmdlPzogc3RyaW5nW107XG59O1xuXG5leHBvcnQgaW50ZXJmYWNlIE51bWJlckNvbnRyb2xJbnRlcmFjdGlvbk1vZGVsUHJvcHMge1xuICAgIC8qKlxuICAgICAqIFRhcmdldHMgdGhlIHVzZXIgY2FuIHVzZSB0byByZWZlciB0byB0aGlzIGNvbnRyb2wuXG4gICAgICpcbiAgICAgKiBFYWNoIGlkZW50aWZlciBpcyBhbiBgaWRgIGZvciBhIHZhbHVlIG9mIHRoZSBgVGFyZ2V0YCBzbG90IGluIHRoZSBpbnRlcmFjdGlvbiBtb2RlbC5cbiAgICAgKlxuICAgICAqIEZvciBleGFtcGxlLCB0aGUgY29udHJvbCBtYXkgaGF2ZSBhIHRhcmdldCBvZiAncGV0QWdlJyBhbmQgYW4gYXNzb2NpYXRlZCBlbnRyeSBpbiB0aGVcbiAgICAgKiBpbnRlcmFjdGlvbiBtb2RlbCBzdWNoIGFzOlxuICAgICAqIGBgYFxuICAgICAqIG5ldyBNeUNvbnRyb2woXG4gICAgICogICAge1xuICAgICAqICAgICAgaW50ZXJhY3Rpb25Nb2RlbDoge1xuICAgICAqICAgICAgICAgIHRhcmdldHM6IFsncGV0QWdlJ10sICAgPC0tLS0tLS0tLS0gJ3BldEFnZScgaXMgYSBzbG90LXZhbHVlIElEIGZvciB0aGUgdGFyZ2V0IHNsb3QgdHlwZS5cbiAgICAgKiAgICAgIH1cbiAgICAgKiAgICAgIC4uLlxuICAgICAqICAgIH1cbiAgICAgKiAgICk7XG4gICAgICpcbiAgICAgKiAtLS1cbiAgICAgKlxuICAgICAqIEludGVyYWN0aW9uTW9kZWwgKGVuLVVTLmpzb24pOlxuICAgICAqIC4uLlxuICAgICAqICAgICAgdHlwZXM6IFtcbiAgICAgKiAgICAgICAgICAgICAge1xuICAgICAqICAgICAgICAgICAgICAgbmFtZTogXCJ0YXJnZXRcIixcbiAgICAgKiAgICAgICAgICAgICAgIHZhbHVlczogW1xuICAgICAqICAgICAgICAgICAgICAgICB7XG4gICAgICogICAgICAgICAgICAgICAgICAgaWQ6IFwicGV0QWdlXCIsICAgICAgICA8LS0tLS0tICAgVGhlIHNsb3QtdmFsdWUgSUQgcmVmZXJlbmNlZCBieSB0aGUgY29udHJvbFxuICAgICAqICAgICAgICAgICAgICAgICAgIG5hbWU6IHtcbiAgICAgKiAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiBcInBldEFnZVwiLFxuICAgICAqICAgICAgICAgICAgICAgICAgICAgc3lub255bXM6IFtcbiAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgXCJQZXQncyBhZ2VcIixcbiAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgXCJNeSBwZXQncyBhZ2VcIixcbiAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgXCJEb2cncyBhZ2VcIixcbiAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgLi4uXG4gICAgICogfVxuICAgICAqIGBgYFxuICAgICAqL1xuICAgIHRhcmdldHM/OiBzdHJpbmdbXTtcblxuICAgIC8qKlxuICAgICAqIEFjdGlvbi1zbG90LXZhbHVlcyBhc3NvY2lhdGVkIHRvIHRoZSBhY3Rpb24tY2FwYWJpbGl0aWVzIG9mIHRoaXMgQ29udHJvbC5cbiAgICAgKlxuICAgICAqIERlZmF1bHQ6XG4gICAgICogYGBgdHNcbiAgICAgKiB7XG4gICAgICogICAgc2V0OiBbJ3NldCddXG4gICAgICogICAgY2hhbmdlOiBbJ2NoYW5nZSddLFxuICAgICAqIH1cbiAgICAgKiBgYGBcbiAgICAgKlxuICAgICAqIFVzYWdlOlxuICAgICAqICAqIFRoaXMgYWxsb3dzIHVzZXJzIHRvIHJlZmVyIHRvIGFuIGFjdGlvbiB1c2luZyBtb3JlIGRvbWFpbi1hcHByb3ByaWF0ZSB3b3Jkcy4gRm9yIGV4YW1wbGUsIGEgdXNlciBtaWdodFxuICAgICAqICAgIGxpa2UgdG8gc2F5ICdzaG93IHR3byBpdGVtcycgcmF0aGVyIHRoYXQgJ3NldCBpdGVtIGNvdW50IHRvIHR3bycuICBUbyBhY2hpZXZlIHRoaXMsIGluY2x1ZGUgdGhlXG4gICAgICogICAgc2xvdC12YWx1ZS1pZCAnc2hvdycgaW4gdGhlIGxpc3QgYXNzb2NpYXRlZCB3aXRoIHRoZSAnc2V0JyBjYXBhYmlsaXR5IGFuZCBlbnN1cmUgdGhlIGludGVyYWN0aW9uLW1vZGVsXG4gICAgICogICAgaW5jbHVkZXMgYW4gYWN0aW9uIHNsb3QgdmFsdWUgd2l0aCBpZD1zaG93IGFuZCBhcHByb3ByaWF0ZSBzeW5vbnltcy5cbiAgICAgKlxuICAgICAqIGBgYFxuICAgICAqIHtcbiAgICAgKiAgICAgc2V0OiBbJ3NldCcsICdzaG93JywgJ3NlbGVjdCddICAvLyBFYWNoIGVudHJ5IGlzIGFuIGFjdGlvbi1zbG90LXZhbHVlIHRoYXQgaXMgY29uc2lkZXJlZCBhIHN5bm9ueW0gdG8gJ3NldCcgZm9yIHRoaXMgY29udHJvbC5cbiAgICAgKiB9XG4gICAgICogYGBgXG4gICAgICovXG4gICAgYWN0aW9ucz86IE51bWJlckNvbnRyb2xBY3Rpb25Qcm9wcztcbn1cblxuZXhwb3J0IGludGVyZmFjZSBOdW1iZXJDb250cm9sUHJvcHMgZXh0ZW5kcyBDb250cm9sUHJvcHMge1xuICAgIGlkOiBzdHJpbmc7XG5cbiAgICBpbnRlcmFjdGlvbk1vZGVsPzogTnVtYmVyQ29udHJvbEludGVyYWN0aW9uTW9kZWxQcm9wcztcblxuICAgIHByb21wdHM/OiBOdW1iZXJDb250cm9sUHJvbXB0c1Byb3BzO1xuICAgIHJlcHJvbXB0cz86IE51bWJlckNvbnRyb2xQcm9tcHRzUHJvcHM7XG5cbiAgICByZXF1aXJlZD86IGJvb2xlYW4gfCAoKGlucHV0OiBDb250cm9sSW5wdXQpID0+IGJvb2xlYW4pO1xuXG4gICAgLyoqXG4gICAgICogTGlzdCBvZiB2YWxpZGF0aW9uIGZ1bmN0aW9ucyB0byBjaGVjayBpZiB0aGUgdXNlciBpbnB1dCBudW1iZXIgaXMgdmFsaWQuXG4gICAgICovXG4gICAgdmFsaWRhdGlvbj86IE51bWJlclZhbGlkYXRpb25GdW5jdGlvbiB8IE51bWJlclZhbGlkYXRpb25GdW5jdGlvbltdO1xuXG4gICAgLyoqXG4gICAgICogSW5wdXRzIHRoYXQgZG8gbm90IHJlcXVpcmUgY29uZmlybWF0aW9uLiBBbGwgdmFsdWVzIG5lZWQgdG8gYmUgY29uZmlybWVkIGlmIHRoaXMgaXMgbm90IHByb3ZpZGVkLlxuICAgICAqL1xuICAgIGNvbmZpcm1hdGlvblJlcXVpcmVkPzogYm9vbGVhbiB8IE51bWJlckNvbmZpcm1hdGlvblJlcXVpcmVGdW5jdGlvbjtcblxuICAgIC8qKlxuICAgICAqIExpc3Qgb2YgZHVhbHMgdGhhdCBvbmNlIG9uZSBvZiB0aGVtIGlzIG5vdCBhZmZpcm1lZCwgdGhlIG90aGVyIHdpbGwgYmUgcHJvbXB0ZWQgZm9yIGNvbmZpcm1hdGlvbi5cbiAgICAgKi9cbiAgICBhbWJpZ3VvdXNQYWlycz86IEFycmF5PFtudW1iZXIsIG51bWJlcl0+O1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIE51bWJlckNvbnRyb2xQcm9tcHRzUHJvcHMge1xuICAgIHJlcXVlc3RWYWx1ZT86IFN0cmluZ09yTGlzdCB8ICgoYWN0OiBSZXF1ZXN0VmFsdWVBY3QsIGlucHV0OiBDb250cm9sSW5wdXQpID0+IFN0cmluZ09yTGlzdCk7XG4gICAgY29uZmlybVZhbHVlPzogU3RyaW5nT3JMaXN0IHwgKChhY3Q6IENvbmZpcm1WYWx1ZUFjdDxudW1iZXI+LCBpbnB1dDogQ29udHJvbElucHV0KSA9PiBTdHJpbmdPckxpc3QpO1xuICAgIHZhbHVlRGlzYWZmaXJtZWQ/OiBTdHJpbmdPckxpc3QgfCAoKGFjdDogVmFsdWVEaXNjb25maXJtZWRBY3Q8bnVtYmVyPiwgaW5wdXQ6IENvbnRyb2xJbnB1dCkgPT4gU3RyaW5nT3JMaXN0KTtcbiAgICB2YWx1ZVNldD86IFN0cmluZ09yTGlzdCB8ICgoYWN0OiBWYWx1ZVNldEFjdDxudW1iZXI+LCBpbnB1dDogQ29udHJvbElucHV0KSA9PiBTdHJpbmdPckxpc3QpO1xuICAgIHZhbHVlQWZmaXJtZWQ/OiBTdHJpbmdPckxpc3QgfCAoKGFjdDogVmFsdWVDb25maXJtZWRBY3Q8bnVtYmVyPiwgaW5wdXQ6IENvbnRyb2xJbnB1dCkgPT4gU3RyaW5nT3JMaXN0KTtcbiAgICBzdWdnZXN0VmFsdWU/OiBTdHJpbmdPckxpc3QgfCAoKGFjdDogU3VnZ2VzdFZhbHVlQWN0PG51bWJlcj4sIGlucHV0OiBDb250cm9sSW5wdXQpID0+IFN0cmluZ09yTGlzdCk7XG4gICAgaW5mb3JtQ29uZnVzaW5nRGlzY29uZmlybWF0aW9uPzogU3RyaW5nT3JMaXN0IHwgKChhY3Q6IEluZm9ybUNvbmZ1c2luZ0Rpc2NvbmZpcm1hdGlvbkFjdDxudW1iZXI+LCBpbnB1dDogQ29udHJvbElucHV0KSA9PiBTdHJpbmdPckxpc3QpO1xuICAgIGluZm9ybUNvbmZ1c2luZ0NvbmZpcm1hdGlvbj86IFN0cmluZ09yTGlzdCB8ICgoYWN0OiBJbmZvcm1Db25mdXNpbmdDb25maXJtYXRpb25BY3Q8bnVtYmVyPiwgaW5wdXQ6IENvbnRyb2xJbnB1dCkgPT4gU3RyaW5nT3JMaXN0KTtcbiAgICByZXBlYXRVbnVzYWJsZVZhbHVlPzogU3RyaW5nT3JMaXN0IHwgKChhY3Q6IFByb2JsZW1hdGljSW5wdXRWYWx1ZUFjdDxudW1iZXI+LCBpbnB1dDogQ29udHJvbElucHV0KSA9PiBTdHJpbmdPckxpc3QpO1xuICAgIGludmFsaWRWYWx1ZT86IFN0cmluZ09yTGlzdCB8ICgoYWN0OiBJbnZhbGlkVmFsdWVBY3Q8bnVtYmVyPiwgaW5wdXQ6IENvbnRyb2xJbnB1dCkgPT4gU3RyaW5nT3JMaXN0KTtcbn1cblxuZXhwb3J0IGNsYXNzIE51bWJlckNvbnRyb2xTdGF0ZSBpbXBsZW1lbnRzIENvbnRyb2xTdGF0ZSB7XG4gICAgdmFsdWU/OiBudW1iZXI7XG4gICAgaXNWYWx1ZUNvbmZpcm1lZDogYm9vbGVhbiA9IGZhbHNlO1xuICAgIHJlamVjdGVkVmFsdWVzOiBudW1iZXJbXSA9IFtdO1xufVxuXG4vKipcbiAqIE1haW4gY2xhc3MgZm9yIE51bWJlckNvbnRyb2wuXG4gKiBGb3IgY29uc3RydWN0b3IgcGFyYW1ldGVycyBwbGVhc2UgcmVhZCB0aGUgaW50ZXJmYWNlIEBOdW1iZXJDb250cm9sUHJvcHMgLlxuICovXG5leHBvcnQgY2xhc3MgTnVtYmVyQ29udHJvbCBleHRlbmRzIENvbnRyb2wgaW1wbGVtZW50cyBJbnRlcmFjdGlvbk1vZGVsQ29udHJpYnV0b3Ige1xuICAgIHJhd1Byb3BzOiBOdW1iZXJDb250cm9sUHJvcHM7XG4gICAgcHJvcHM6IERlZXBSZXF1aXJlZDxOdW1iZXJDb250cm9sUHJvcHM+O1xuICAgIHN0YXRlOiBOdW1iZXJDb250cm9sU3RhdGUgPSBuZXcgTnVtYmVyQ29udHJvbFN0YXRlKCk7XG4gICAgaGFuZGxlRnVuYz86IChpbnB1dDogQ29udHJvbElucHV0LCByZXN1bHRCdWlsZGVyOiBDb250cm9sUmVzdWx0QnVpbGRlcikgPT4gdm9pZDtcblxuICAgIGNvbnN0cnVjdG9yKHByb3BzOiBOdW1iZXJDb250cm9sUHJvcHMpIHtcbiAgICAgICAgc3VwZXIocHJvcHMuaWQpO1xuICAgICAgICB0aGlzLnJhd1Byb3BzID0gcHJvcHM7XG4gICAgICAgIHRoaXMucHJvcHMgPSBOdW1iZXJDb250cm9sLm1lcmdlV2l0aERlZmF1bHRQcm9wcyhwcm9wcyk7XG4gICAgfVxuXG4gICAgc3RhdGljIG1lcmdlV2l0aERlZmF1bHRQcm9wcyhwcm9wczogTnVtYmVyQ29udHJvbFByb3BzKTogRGVlcFJlcXVpcmVkPE51bWJlckNvbnRyb2xQcm9wcz4ge1xuICAgICAgICBjb25zdCBkZWZhdWx0czogRGVlcFJlcXVpcmVkPE51bWJlckNvbnRyb2xQcm9wcz4gPSB7XG4gICAgICAgICAgICBpZDogJ3BsYWNlaG9sZGVyJyxcbiAgICAgICAgICAgIGludGVyYWN0aW9uTW9kZWw6IHtcbiAgICAgICAgICAgICAgICBhY3Rpb25zOiB7XG4gICAgICAgICAgICAgICAgICAgIHNldDogWyQuQWN0aW9uLlNldF0sXG4gICAgICAgICAgICAgICAgICAgIGNoYW5nZTogWyQuQWN0aW9uLkNoYW5nZV0sXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICB0YXJnZXRzOiBbJ251bWJlcicsICQuVGFyZ2V0Lkl0XVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHByb21wdHM6IHtcbiAgICAgICAgICAgICAgICByZXF1ZXN0VmFsdWU6IGkxOG5leHQudCgnTlVNQkVSX0NPTlRST0xfREVGQVVMVF9QUk9NUFRfUkVRVUVTVF9WQUxVRScpLFxuICAgICAgICAgICAgICAgIGNvbmZpcm1WYWx1ZTogKGFjdCkgPT4gaTE4bmV4dC50KCdOVU1CRVJfQ09OVFJPTF9ERUZBVUxUX1BST01QVF9DT05GSVJNX1ZBTFVFJywgeyB2YWx1ZTogYWN0LnBheWxvYWQudmFsdWUgfSksXG4gICAgICAgICAgICAgICAgdmFsdWVEaXNhZmZpcm1lZDogaTE4bmV4dC50KCdOVU1CRVJfQ09OVFJPTF9ERUZBVUxUX1BST01QVF9WQUxVRV9ESVNBRkZJUk1FRCcpLFxuICAgICAgICAgICAgICAgIHZhbHVlU2V0OiAoYWN0KSA9PiBpMThuZXh0LnQoJ05VTUJFUl9DT05UUk9MX0RFRkFVTFRfUFJPTVBUX1ZBTFVFX1NFVCcsIHsgdmFsdWU6IGFjdC5wYXlsb2FkLnZhbHVlIH0pLFxuICAgICAgICAgICAgICAgIHZhbHVlQWZmaXJtZWQ6IGkxOG5leHQudCgnTlVNQkVSX0NPTlRST0xfREVGQVVMVF9QUk9NUFRfVkFMVUVfQUZGSVJNRUQnKSxcbiAgICAgICAgICAgICAgICBzdWdnZXN0VmFsdWU6IChhY3QpID0+IGkxOG5leHQudCgnTlVNQkVSX0NPTlRST0xfREVGQVVMVF9QUk9NUFRfU1VHR0VTVF9WQUxVRScsIHsgdmFsdWU6IGFjdC5wYXlsb2FkLnZhbHVlIH0pLFxuICAgICAgICAgICAgICAgIGluZm9ybUNvbmZ1c2luZ0Rpc2NvbmZpcm1hdGlvbjogKGFjdCkgPT4gaTE4bmV4dC50KCdOVU1CRVJfQ09OVFJPTF9ERUZBVUxUX1BST01QVF9JTkZPUk1fQ09ORlVTSU5HX0RJU0NPTkZJUk1BVElPTicpLFxuICAgICAgICAgICAgICAgIGluZm9ybUNvbmZ1c2luZ0NvbmZpcm1hdGlvbjogKGFjdCkgPT4gaTE4bmV4dC50KCdOVU1CRVJfQ09OVFJPTF9ERUZBVUxUX1BST01QVF9JTkZPUk1fQ09ORlVTSU5HX0NPTkZJUk1BVElPTicsIHsgcHJldmlvdXNWYWx1ZTogYWN0LnBheWxvYWQudmFsdWUgfSksXG4gICAgICAgICAgICAgICAgcmVwZWF0VW51c2FibGVWYWx1ZTogKGFjdCkgPT4gaTE4bmV4dC50KCdOVU1CRVJfQ09OVFJPTF9ERUZBVUxUX1BST01QVF9SRVBFQVRfVU5VU0FCTEVfVkFMVUUnLCB7IHZhbHVlOiBhY3QucGF5bG9hZC52YWx1ZSB9KSxcbiAgICAgICAgICAgICAgICBpbnZhbGlkVmFsdWU6IChhY3QpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGFjdC5wYXlsb2FkLnJlbmRlcmVkUmVhc29uICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBpMThuZXh0LnQoJ05VTUJFUl9DT05UUk9MX0RFRkFVTFRfUFJPTVBUX0lOVkFMSURfVkFMVUVfV0lUSF9SRUFTT04nLCB7IHZhbHVlOiBhY3QucGF5bG9hZC52YWx1ZSwgcmVhc29uOiBhY3QucGF5bG9hZC5yZW5kZXJlZFJlYXNvbiB9KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gaTE4bmV4dC50KCdOVU1CRVJfQ09OVFJPTF9ERUZBVUxUX1BST01QVF9HRU5FUkFMX0lOVkFMSURfVkFMVUUnLCB7IHZhbHVlOiBhY3QucGF5bG9hZC52YWx1ZSB9KTtcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHJlcHJvbXB0czoge1xuICAgICAgICAgICAgICAgIHJlcXVlc3RWYWx1ZTogaTE4bmV4dC50KCdOVU1CRVJfQ09OVFJPTF9ERUZBVUxUX1JFUFJPTVBUX1JFUVVFU1RfVkFMVUUnKSxcbiAgICAgICAgICAgICAgICBjb25maXJtVmFsdWU6IChhY3QpID0+IGkxOG5leHQudCgnTlVNQkVSX0NPTlRST0xfREVGQVVMVF9SRVBST01QVF9DT05GSVJNX1ZBTFVFJywgeyB2YWx1ZTogYWN0LnBheWxvYWQudmFsdWUgfSksXG4gICAgICAgICAgICAgICAgdmFsdWVEaXNhZmZpcm1lZDogaTE4bmV4dC50KCdOVU1CRVJfQ09OVFJPTF9ERUZBVUxUX1JFUFJPTVBUX1ZBTFVFX0RJU0FGRklSTUVEJyksXG4gICAgICAgICAgICAgICAgdmFsdWVTZXQ6IChhY3QpID0+IGkxOG5leHQudCgnTlVNQkVSX0NPTlRST0xfREVGQVVMVF9SRVBST01QVF9WQUxVRV9TRVQnLCB7IHZhbHVlOiBhY3QucGF5bG9hZC52YWx1ZSB9KSxcbiAgICAgICAgICAgICAgICB2YWx1ZUFmZmlybWVkOiBpMThuZXh0LnQoJ05VTUJFUl9DT05UUk9MX0RFRkFVTFRfUkVQUk9NUFRfVkFMVUVfQUZGSVJNRUQnKSxcbiAgICAgICAgICAgICAgICBzdWdnZXN0VmFsdWU6IChhY3QpID0+IGkxOG5leHQudCgnTlVNQkVSX0NPTlRST0xfREVGQVVMVF9SRVBST01QVF9TVUdHRVNUX1ZBTFVFJywgeyB2YWx1ZTogYWN0LnBheWxvYWQudmFsdWUgfSksXG4gICAgICAgICAgICAgICAgaW5mb3JtQ29uZnVzaW5nRGlzY29uZmlybWF0aW9uOiAoYWN0KSA9PiBpMThuZXh0LnQoJ05VTUJFUl9DT05UUk9MX0RFRkFVTFRfUkVQUk9NUFRfSU5GT1JNX0NPTkZVU0lOR19ESVNDT05GSVJNQVRJT04nKSxcbiAgICAgICAgICAgICAgICBpbmZvcm1Db25mdXNpbmdDb25maXJtYXRpb246IChhY3QpID0+IGkxOG5leHQudCgnTlVNQkVSX0NPTlRST0xfREVGQVVMVF9SRVBST01QVF9JTkZPUk1fQ09ORlVTSU5HX0NPTkZJUk1BVElPTicsIHsgcHJldmlvdXNWYWx1ZTogYWN0LnBheWxvYWQudmFsdWUgfSksXG4gICAgICAgICAgICAgICAgcmVwZWF0VW51c2FibGVWYWx1ZTogKGFjdCkgPT4gaTE4bmV4dC50KCdOVU1CRVJfQ09OVFJPTF9ERUZBVUxUX1JFUFJPTVBUX1JFUEVBVF9VTlVTQUJMRV9WQUxVRScsIHsgdmFsdWU6IGFjdC5wYXlsb2FkLnZhbHVlIH0pLFxuICAgICAgICAgICAgICAgIGludmFsaWRWYWx1ZTogKGFjdCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBpZiAoYWN0LnBheWxvYWQucmVuZGVyZWRSZWFzb24gIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGkxOG5leHQudCgnTlVNQkVSX0NPTlRST0xfREVGQVVMVF9SRVBST01QVF9JTlZBTElEX1ZBTFVFX1dJVEhfUkVBU09OJywgeyB2YWx1ZTogYWN0LnBheWxvYWQudmFsdWUsIHJlYXNvbjogYWN0LnBheWxvYWQucmVuZGVyZWRSZWFzb24gfSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGkxOG5leHQudCgnTlVNQkVSX0NPTlRST0xfREVGQVVMVF9SRVBST01QVF9HRU5FUkFMX0lOVkFMSURfVkFMVUUnLCB7IHZhbHVlOiBhY3QucGF5bG9hZC52YWx1ZSB9KTtcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHZhbGlkYXRpb246IFtdLFxuICAgICAgICAgICAgY29uZmlybWF0aW9uUmVxdWlyZWQ6IGZhbHNlLFxuICAgICAgICAgICAgYW1iaWd1b3VzUGFpcnM6IFtbMTMsIDMwXSwgWzE0LCA0MF0sIFsxNSwgNTBdLCBbMTYsIDYwXSwgWzE3LCA3MF0sIFsxOCwgODBdXSwgLy8gVE9ETzogYXBwbHkgdG8gYWxsIG51bWJlcnMgd2l0aCB0aGUgbnVtYmVyIHN1ZmZpeCB3aXRoaW4gdGhpcyBsaXN0XG4gICAgICAgICAgICByZXF1aXJlZDogdHJ1ZSxcbiAgICAgICAgfTtcbiAgICAgICAgcmV0dXJuIF8ubWVyZ2UoZGVmYXVsdHMsIHByb3BzKTtcbiAgICB9XG5cbiAgICBjYW5IYW5kbGUoaW5wdXQ6IENvbnRyb2xJbnB1dCk6IGJvb2xlYW4ge1xuICAgICAgICByZXR1cm4gdGhpcy5jYW5IYW5kbGVGb3JFbXB0eVN0YXRlVmFsdWUoaW5wdXQpXG4gICAgICAgICAgICB8fCB0aGlzLmNhbkhhbmRsZUZvckV4aXN0aW5nU3RhdGVWYWx1ZShpbnB1dCk7XG4gICAgfVxuXG4gICAgYXN5bmMgaGFuZGxlKGlucHV0OiBDb250cm9sSW5wdXQsIHJlc3VsdEJ1aWxkZXI6IENvbnRyb2xSZXN1bHRCdWlsZGVyKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgICAgIGxvZy5kZWJ1ZyhgTnVtYmVyQ29udHJvbFske3RoaXMuaWR9XTogaGFuZGxlKCkuIEVudGVyaW5nYCk7XG5cbiAgICAgICAgY29uc3QgaW50ZW50OiBJbnRlbnQgPSAoaW5wdXQucmVxdWVzdCBhcyBJbnRlbnRSZXF1ZXN0KS5pbnRlbnQ7XG4gICAgICAgIGlmICh0aGlzLmhhbmRsZUZ1bmMgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGAke2ludGVudC5uYW1lfSBjYW4gbm90IGJlIGhhbmRsZWQgYnkgJHt0aGlzLmNvbnN0cnVjdG9yLm5hbWV9LmApO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5oYW5kbGVGdW5jKGlucHV0LCByZXN1bHRCdWlsZGVyKTtcbiAgICB9XG5cbiAgICBjYW5UYWtlSW5pdGlhdGl2ZShpbnB1dDogQ29udHJvbElucHV0KTogYm9vbGVhbiB7XG4gICAgICAgIHJldHVybiB0aGlzLndhbnRzVG9FbGljaXRWYWx1ZShpbnB1dClcbiAgICAgICAgICAgIHx8IHRoaXMud2FudHNUb0ZpeEludmFsaWRWYWx1ZShpbnB1dClcbiAgICAgICAgICAgIHx8IHRoaXMud2FudHNUb0NvbmZpcm1WYWx1ZShpbnB1dCk7XG4gICAgfVxuXG4gICAgYXN5bmMgdGFrZUluaXRpYXRpdmUoaW5wdXQ6IENvbnRyb2xJbnB1dCwgcmVzdWx0QnVpbGRlcjogQ29udHJvbFJlc3VsdEJ1aWxkZXIpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICAgICAgbG9nLmRlYnVnKGBOdW1iZXJDb250cm9sWyR7dGhpcy5pZH1dOiB0YWtlSW5pdGlhdGl2ZSgpLiBFbnRlcmluZ2ApO1xuXG4gICAgICAgIGlmICh0aGlzLndhbnRzVG9FbGljaXRWYWx1ZShpbnB1dCkpIHtcbiAgICAgICAgICAgIHJlc3VsdEJ1aWxkZXIuYWRkQWN0KG5ldyBSZXF1ZXN0VmFsdWVBY3QodGhpcykpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKHRoaXMud2FudHNUb0ZpeEludmFsaWRWYWx1ZShpbnB1dCkpIHtcbiAgICAgICAgICAgIGNvbnN0IHZhbGlkYXRpb25SZXN1bHQgPSB0aGlzLnZhbGlkYXRlTnVtYmVyKGlucHV0KTtcbiAgICAgICAgICAgIHJlc3VsdEJ1aWxkZXIuYWRkQWN0KG5ldyBJbnZhbGlkVmFsdWVBY3QodGhpcywge1xuICAgICAgICAgICAgICAgIHZhbHVlOiB0aGlzLnN0YXRlLnZhbHVlISxcbiAgICAgICAgICAgICAgICByZWFzb25Db2RlOiAnVmFsdWVJbnZhbGlkJyxcbiAgICAgICAgICAgICAgICByZW5kZXJlZFJlYXNvbjogKHZhbGlkYXRpb25SZXN1bHQgYXMgVmFsaWRhdGlvblJlc3VsdCkucmVuZGVyZWRSZWFzb25cbiAgICAgICAgICAgIH0pKTtcbiAgICAgICAgICAgIHJlc3VsdEJ1aWxkZXIuYWRkQWN0KG5ldyBSZXF1ZXN0VmFsdWVBY3QodGhpcykpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKHRoaXMud2FudHNUb0NvbmZpcm1WYWx1ZShpbnB1dCkpIHtcbiAgICAgICAgICAgIHJlc3VsdEJ1aWxkZXIuYWRkQWN0KG5ldyBDb25maXJtVmFsdWVBY3QodGhpcywgeyB2YWx1ZTogdGhpcy5zdGF0ZS52YWx1ZSB9KSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBjb25zdCBpbnRlbnQ6IEludGVudCA9IChpbnB1dC5yZXF1ZXN0IGFzIEludGVudFJlcXVlc3QpLmludGVudDtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgJHtpbnRlbnQubmFtZX0gY2FuIG5vdCB0YWtlIGluaXRpYXRpdmUgZnJvbSAke3RoaXMuY29uc3RydWN0b3IubmFtZX0uYCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICByZW5kZXJBY3QoYWN0OiBTeXN0ZW1BY3QsIGlucHV0OiBDb250cm9sSW5wdXQsIGJ1aWxkZXI6IENvbnRyb2xSZXNwb25zZUJ1aWxkZXIpIHtcbiAgICAgICAgaWYgKGFjdCBpbnN0YW5jZW9mIFJlcXVlc3RWYWx1ZUFjdCkge1xuICAgICAgICAgICAgYnVpbGRlci5hZGRQcm9tcHRGcmFnbWVudCh0aGlzLmV2YWx1YXRlUHJvbXB0UHJvcChhY3QsIHRoaXMucHJvcHMucHJvbXB0cy5yZXF1ZXN0VmFsdWUsIGlucHV0KSk7XG4gICAgICAgICAgICBidWlsZGVyLmFkZFJlcHJvbXB0RnJhZ21lbnQodGhpcy5ldmFsdWF0ZVByb21wdFByb3AoYWN0LCB0aGlzLnByb3BzLnJlcHJvbXB0cy5yZXF1ZXN0VmFsdWUsIGlucHV0KSk7XG4gICAgICAgICAgICBjb25zdCBzbG90RWxpY2l0YXRpb24gPSBnZW5lcmF0ZVNsb3RFbGljaXRhdGlvbigpO1xuICAgICAgICAgICAgYnVpbGRlci5hZGRFbGljaXRTbG90RGlyZWN0aXZlKHNsb3RFbGljaXRhdGlvbi5zbG90TmFtZSwgc2xvdEVsaWNpdGF0aW9uLmludGVudCk7XG4gICAgICAgIH1cblxuICAgICAgICBlbHNlIGlmIChhY3QgaW5zdGFuY2VvZiBDb25maXJtVmFsdWVBY3QpIHtcbiAgICAgICAgICAgIGJ1aWxkZXIuYWRkUHJvbXB0RnJhZ21lbnQodGhpcy5ldmFsdWF0ZVByb21wdFByb3AoYWN0LCB0aGlzLnByb3BzLnByb21wdHMuY29uZmlybVZhbHVlLCBpbnB1dCkpO1xuICAgICAgICAgICAgYnVpbGRlci5hZGRSZXByb21wdEZyYWdtZW50KHRoaXMuZXZhbHVhdGVQcm9tcHRQcm9wKGFjdCwgdGhpcy5wcm9wcy5yZXByb21wdHMuY29uZmlybVZhbHVlLCBpbnB1dCkpO1xuICAgICAgICB9XG5cbiAgICAgICAgZWxzZSBpZiAoYWN0IGluc3RhbmNlb2YgVmFsdWVEaXNjb25maXJtZWRBY3QpIHtcbiAgICAgICAgICAgIGJ1aWxkZXIuYWRkUHJvbXB0RnJhZ21lbnQodGhpcy5ldmFsdWF0ZVByb21wdFByb3AoYWN0LCB0aGlzLnByb3BzLnByb21wdHMudmFsdWVEaXNhZmZpcm1lZCwgaW5wdXQpKTtcbiAgICAgICAgICAgIGJ1aWxkZXIuYWRkUmVwcm9tcHRGcmFnbWVudCh0aGlzLmV2YWx1YXRlUHJvbXB0UHJvcChhY3QsIHRoaXMucHJvcHMucmVwcm9tcHRzLnZhbHVlRGlzYWZmaXJtZWQsIGlucHV0KSk7XG4gICAgICAgIH1cblxuICAgICAgICBlbHNlIGlmIChhY3QgaW5zdGFuY2VvZiBWYWx1ZVNldEFjdCkge1xuICAgICAgICAgICAgYnVpbGRlci5hZGRQcm9tcHRGcmFnbWVudCh0aGlzLmV2YWx1YXRlUHJvbXB0UHJvcChhY3QsIHRoaXMucHJvcHMucHJvbXB0cy52YWx1ZVNldCwgaW5wdXQpKTtcbiAgICAgICAgICAgIGJ1aWxkZXIuYWRkUmVwcm9tcHRGcmFnbWVudCh0aGlzLmV2YWx1YXRlUHJvbXB0UHJvcChhY3QsIHRoaXMucHJvcHMucmVwcm9tcHRzLnZhbHVlU2V0LCBpbnB1dCkpO1xuICAgICAgICB9XG5cbiAgICAgICAgZWxzZSBpZiAoYWN0IGluc3RhbmNlb2YgVmFsdWVDb25maXJtZWRBY3QpIHtcbiAgICAgICAgICAgIGJ1aWxkZXIuYWRkUHJvbXB0RnJhZ21lbnQodGhpcy5ldmFsdWF0ZVByb21wdFByb3AoYWN0LCB0aGlzLnByb3BzLnByb21wdHMudmFsdWVBZmZpcm1lZCwgaW5wdXQpKTtcbiAgICAgICAgICAgIGJ1aWxkZXIuYWRkUmVwcm9tcHRGcmFnbWVudCh0aGlzLmV2YWx1YXRlUHJvbXB0UHJvcChhY3QsIHRoaXMucHJvcHMucmVwcm9tcHRzLnZhbHVlQWZmaXJtZWQsIGlucHV0KSk7XG4gICAgICAgIH1cblxuICAgICAgICBlbHNlIGlmIChhY3QgaW5zdGFuY2VvZiBTdWdnZXN0VmFsdWVBY3QpIHtcbiAgICAgICAgICAgIGJ1aWxkZXIuYWRkUHJvbXB0RnJhZ21lbnQodGhpcy5ldmFsdWF0ZVByb21wdFByb3AoYWN0LCB0aGlzLnByb3BzLnByb21wdHMuc3VnZ2VzdFZhbHVlLCBpbnB1dCkpO1xuICAgICAgICAgICAgYnVpbGRlci5hZGRSZXByb21wdEZyYWdtZW50KHRoaXMuZXZhbHVhdGVQcm9tcHRQcm9wKGFjdCwgdGhpcy5wcm9wcy5yZXByb21wdHMuc3VnZ2VzdFZhbHVlLCBpbnB1dCkpO1xuICAgICAgICB9XG5cbiAgICAgICAgZWxzZSBpZiAoYWN0IGluc3RhbmNlb2YgSW5mb3JtQ29uZnVzaW5nQ29uZmlybWF0aW9uQWN0KSB7XG4gICAgICAgICAgICBidWlsZGVyLmFkZFByb21wdEZyYWdtZW50KHRoaXMuZXZhbHVhdGVQcm9tcHRQcm9wKGFjdCwgdGhpcy5wcm9wcy5wcm9tcHRzLmluZm9ybUNvbmZ1c2luZ0NvbmZpcm1hdGlvbiwgaW5wdXQpKTtcbiAgICAgICAgICAgIGJ1aWxkZXIuYWRkUmVwcm9tcHRGcmFnbWVudCh0aGlzLmV2YWx1YXRlUHJvbXB0UHJvcChhY3QsIHRoaXMucHJvcHMucmVwcm9tcHRzLmluZm9ybUNvbmZ1c2luZ0NvbmZpcm1hdGlvbiwgaW5wdXQpKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGVsc2UgaWYgKGFjdCBpbnN0YW5jZW9mIEluZm9ybUNvbmZ1c2luZ0Rpc2NvbmZpcm1hdGlvbkFjdCkge1xuICAgICAgICAgICAgYnVpbGRlci5hZGRQcm9tcHRGcmFnbWVudCh0aGlzLmV2YWx1YXRlUHJvbXB0UHJvcChhY3QsIHRoaXMucHJvcHMucHJvbXB0cy5pbmZvcm1Db25mdXNpbmdEaXNjb25maXJtYXRpb24sIGlucHV0KSk7XG4gICAgICAgICAgICBidWlsZGVyLmFkZFJlcHJvbXB0RnJhZ21lbnQodGhpcy5ldmFsdWF0ZVByb21wdFByb3AoYWN0LCB0aGlzLnByb3BzLnJlcHJvbXB0cy5pbmZvcm1Db25mdXNpbmdEaXNjb25maXJtYXRpb24sIGlucHV0KSk7XG4gICAgICAgIH1cblxuICAgICAgICBlbHNlIGlmIChhY3QgaW5zdGFuY2VvZiBQcm9ibGVtYXRpY0lucHV0VmFsdWVBY3QpIHtcbiAgICAgICAgICAgIGJ1aWxkZXIuYWRkUHJvbXB0RnJhZ21lbnQodGhpcy5ldmFsdWF0ZVByb21wdFByb3AoYWN0LCB0aGlzLnByb3BzLnByb21wdHMucmVwZWF0VW51c2FibGVWYWx1ZSwgaW5wdXQpKTtcbiAgICAgICAgICAgIGJ1aWxkZXIuYWRkUmVwcm9tcHRGcmFnbWVudCh0aGlzLmV2YWx1YXRlUHJvbXB0UHJvcChhY3QsIHRoaXMucHJvcHMucmVwcm9tcHRzLnJlcGVhdFVudXNhYmxlVmFsdWUsIGlucHV0KSk7XG4gICAgICAgIH1cblxuICAgICAgICBlbHNlIGlmIChhY3QgaW5zdGFuY2VvZiBJbnZhbGlkVmFsdWVBY3QpIHtcbiAgICAgICAgICAgIGJ1aWxkZXIuYWRkUHJvbXB0RnJhZ21lbnQodGhpcy5ldmFsdWF0ZVByb21wdFByb3AoYWN0LCB0aGlzLnByb3BzLnByb21wdHMuaW52YWxpZFZhbHVlLCBpbnB1dCkpO1xuICAgICAgICAgICAgYnVpbGRlci5hZGRSZXByb21wdEZyYWdtZW50KHRoaXMuZXZhbHVhdGVQcm9tcHRQcm9wKGFjdCwgdGhpcy5wcm9wcy5yZXByb21wdHMuaW52YWxpZFZhbHVlLCBpbnB1dCkpO1xuICAgICAgICB9XG5cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICB0aGlzLnRocm93VW5oYW5kbGVkQWN0RXJyb3IoYWN0KTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHVwZGF0ZUludGVyYWN0aW9uTW9kZWwoZ2VuZXJhdG9yOiBDb250cm9sSW50ZXJhY3Rpb25Nb2RlbEdlbmVyYXRvciwgaW1EYXRhOiBNb2RlbERhdGEpIHtcbiAgICAgICAgZ2VuZXJhdG9yLmFkZENvbnRyb2xJbnRlbnQobmV3IEdlbmVyYWxDb250cm9sSW50ZW50KCksIGltRGF0YSk7XG4gICAgICAgIGdlbmVyYXRvci5hZGRDb250cm9sSW50ZW50KG5ldyBTaW5nbGVWYWx1ZUNvbnRyb2xJbnRlbnQoQW1hem9uQnVpbHRJblNsb3RUeXBlLk5VTUJFUiksIGltRGF0YSk7XG4gICAgICAgIGdlbmVyYXRvci5hZGRZZXNBbmROb0ludGVudHMoKTtcblxuICAgICAgICBpZiAodGhpcy5wcm9wcy5pbnRlcmFjdGlvbk1vZGVsLnRhcmdldHMuaW5jbHVkZXMoJ251bWJlcicpKSB7XG4gICAgICAgICAgICBnZW5lcmF0b3IuYWRkVmFsdWVzVG9TbG90VHlwZShTaGFyZWRTbG90VHlwZS5UQVJHRVQsIGkxOG5leHQudCgnTlVNQkVSX0NPTlRST0xfREVGQVVMVF9TTE9UX1ZBTFVFU19UQVJHRVRfTlVNQkVSJywgeyByZXR1cm5PYmplY3RzOiB0cnVlIH0pKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGdldFRhcmdldElkcygpOiBzdHJpbmdbXSB7XG4gICAgICAgIHJldHVybiB0aGlzLnByb3BzLmludGVyYWN0aW9uTW9kZWwudGFyZ2V0cztcbiAgICB9XG5cbiAgICAvKiAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgICAqIFRoaXMgYmxvY2sgaGFuZGxlcyB3aGVuIHRoZSBsYXN0UXVlc3Rpb24gaGFzIG5vdCBiZWVuIGFza2VkXG4gICAgICovXG4gICAgcHJpdmF0ZSBjYW5IYW5kbGVGb3JFbXB0eVN0YXRlVmFsdWUoaW5wdXQ6IENvbnRyb2xJbnB1dCk6IGJvb2xlYW4ge1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgb2tJZih0aGlzLnN0YXRlLnZhbHVlID09PSB1bmRlZmluZWQpO1xuXG4gICAgICAgICAgICBpZiAoSW5wdXRVdGlsLmlzSW50ZW50KGlucHV0LCBHZW5lcmFsQ29udHJvbEludGVudC5uYW1lKSl7XG4gICAgICAgICAgICAgICAgY29uc3QgeyBhY3Rpb24sIHRhcmdldCB9ID0gdW5wYWNrR2VuZXJhbENvbnRyb2xJbnRlbnQoKGlucHV0LnJlcXVlc3QgYXMgSW50ZW50UmVxdWVzdCkuaW50ZW50KTtcbiAgICAgICAgICAgICAgICBva0lmKElucHV0VXRpbC5hY3Rpb25Jc01hdGNoT3JVbmRlZmluZWQoYWN0aW9uLCBbLi4udGhpcy5wcm9wcy5pbnRlcmFjdGlvbk1vZGVsLmFjdGlvbnMuc2V0LCAuLi50aGlzLnByb3BzLmludGVyYWN0aW9uTW9kZWwuYWN0aW9ucy5jaGFuZ2VdKSk7XG4gICAgICAgICAgICAgICAgb2tJZihJbnB1dFV0aWwudGFyZ2V0SXNNYXRjaE9yVW5kZWZpbmVkKHRhcmdldCwgdGhpcy5wcm9wcy5pbnRlcmFjdGlvbk1vZGVsLnRhcmdldHMpKTtcblxuICAgICAgICAgICAgICAgIHRoaXMuaGFuZGxlRnVuYyA9IHRoaXMuaGFuZGxlTGFzdFF1ZXN0aW9uRW1wdHlBbmRWYWx1ZU5vdEV4aXN0aW5nO1xuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoSW5wdXRVdGlsLmlzU2luZ2xlVmFsdWVDb250cm9sSW50ZW50KGlucHV0LCBBbWF6b25CdWlsdEluU2xvdFR5cGUuTlVNQkVSKSl7XG4gICAgICAgICAgICAgICAgY29uc3QgeyBhY3Rpb24sIHRhcmdldCB9ID0gdW5wYWNrU2luZ2xlVmFsdWVDb250cm9sSW50ZW50KChpbnB1dC5yZXF1ZXN0IGFzIEludGVudFJlcXVlc3QpLmludGVudCk7XG4gICAgICAgICAgICAgICAgb2tJZihJbnB1dFV0aWwuYWN0aW9uSXNNYXRjaE9yVW5kZWZpbmVkKGFjdGlvbiwgWy4uLnRoaXMucHJvcHMuaW50ZXJhY3Rpb25Nb2RlbC5hY3Rpb25zLnNldCwgLi4udGhpcy5wcm9wcy5pbnRlcmFjdGlvbk1vZGVsLmFjdGlvbnMuY2hhbmdlXSkpO1xuICAgICAgICAgICAgICAgIG9rSWYoSW5wdXRVdGlsLnRhcmdldElzTWF0Y2hPclVuZGVmaW5lZCh0YXJnZXQsIHRoaXMucHJvcHMuaW50ZXJhY3Rpb25Nb2RlbC50YXJnZXRzKSk7XG4gICAgICAgICAgICAgICAgdGhpcy5oYW5kbGVGdW5jID0gdGhpcy5oYW5kbGVMYXN0UXVlc3Rpb25FbXB0eUFuZFZhbHVlRXhpc3Rpbmc7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZUlmR3VhcmRGYWlsZWQoZSk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwcml2YXRlIGhhbmRsZUxhc3RRdWVzdGlvbkVtcHR5QW5kVmFsdWVOb3RFeGlzdGluZyhpbnB1dDogQ29udHJvbElucHV0LCByZXN1bHRCdWlsZGVyOiBDb250cm9sUmVzdWx0QnVpbGRlcik6IHZvaWQge1xuICAgICAgICByZXN1bHRCdWlsZGVyLmFkZEFjdChcbiAgICAgICAgICAgIG5ldyBSZXF1ZXN0VmFsdWVBY3QodGhpcylcbiAgICAgICAgKTtcbiAgICB9XG5cbiAgICBwcml2YXRlIGhhbmRsZUxhc3RRdWVzdGlvbkVtcHR5QW5kVmFsdWVFeGlzdGluZyhpbnB1dDogQ29udHJvbElucHV0LCByZXN1bHRCdWlsZGVyOiBDb250cm9sUmVzdWx0QnVpbGRlcik6IHZvaWQge1xuICAgICAgICBjb25zdCB7IGFjdGlvbiwgdmFsdWVTdHIgfSA9IHVucGFja1NpbmdsZVZhbHVlQ29udHJvbEludGVudCgoaW5wdXQucmVxdWVzdCBhcyBJbnRlbnRSZXF1ZXN0KS5pbnRlbnQpO1xuICAgICAgICB0aGlzLnNldFZhbHVlKHZhbHVlU3RyKTtcbiAgICAgICAgdGhpcy5jb21tb25IYW5kbGVyV2hlblZhbHVlQ2hhbmdlZChhY3Rpb24gPz8gJC5BY3Rpb24uU2V0LCBpbnB1dCwgcmVzdWx0QnVpbGRlcik7XG4gICAgfVxuICAgIC8qIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cblxuICAgIC8qIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgICogVGhpcyBibG9jayBoYW5kbGVzIHdoZW4gdGhlIGN1cnJlbnQgdmFsdWUgaXMgdG8gYmUgY29uZmlybWVkXG4gICAgICovXG4gICAgcHJpdmF0ZSBjYW5IYW5kbGVGb3JFeGlzdGluZ1N0YXRlVmFsdWUoaW5wdXQ6IENvbnRyb2xJbnB1dCk6IGJvb2xlYW4ge1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgb2tJZih0aGlzLnN0YXRlLnZhbHVlICE9PSB1bmRlZmluZWQpO1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuaXNWYWx1ZUluUmVqZWN0ZWRWYWx1ZXMoaW5wdXQpXG4gICAgICAgICAgICAgICAgfHwgdGhpcy5pc0JhcmVOb1doZW5Db25maXJtaW5nVmFsdWUoaW5wdXQpXG4gICAgICAgICAgICAgICAgfHwgdGhpcy5pc0ZlZWRiYWNrTm9BbmRWYWx1ZVVuZGVmaW5lZFdoZW5Db25maXJtaW5nVmFsdWUoaW5wdXQpXG4gICAgICAgICAgICAgICAgfHwgdGhpcy5pc0ZlZWRiYWNrTm9BbmRWYWx1ZU5vdENoYW5nZWRXaGVuQ29uZmlybWluZ1ZhbHVlKGlucHV0KVxuICAgICAgICAgICAgICAgIHx8IHRoaXMuaXNGZWVkYmFja05vQW5kVmFsdWVDaGFuZ2VkV2hlbkNvbmZpcm1pbmdWYWx1ZShpbnB1dClcbiAgICAgICAgICAgICAgICB8fCB0aGlzLmlzQmFyZVllc0NvbmZpcm1pbmdWYWx1ZShpbnB1dClcbiAgICAgICAgICAgICAgICB8fCB0aGlzLmlzRmVlZGJhY2tZZXNBbmRWYWx1ZUNoYW5nZWRXaGVuQ29uZmlybWluZ1ZhbHVlKGlucHV0KVxuICAgICAgICAgICAgICAgIHx8IHRoaXMuaXNGZWVkYmFja1llc0FuZFZhbHVlTm90Q2hhbmdlZFdoZW5Db25maXJtaW5nVmFsdWUoaW5wdXQpXG4gICAgICAgICAgICAgICAgfHwgdGhpcy5pc0ZlZWRiYWNrWWVzQW5kVmFsdWVVbmRlZmluZWRXaGVuQ29uZmlybWluZ1ZhbHVlKGlucHV0KVxuICAgICAgICAgICAgICAgIHx8IHRoaXMuaXNGZWVkYmFja1VuZGVmaW5lZEFuZFZhbHVlTm90Q2hhbmdlZFdoZW5Db25maXJtaW5nVmFsdWUoaW5wdXQpXG4gICAgICAgICAgICAgICAgfHwgdGhpcy5pc0ZlZWRiYWNrVW5kZWZpbmVkQW5kVmFsdWVDaGFuZ2VkV2hlbkNvbmZpcm1pbmdWYWx1ZShpbnB1dClcbiAgICAgICAgICAgICAgICB8fCB0aGlzLmlzVGFyZ2V0c01hdGNoV2l0aG91dEZlZWRiYWNrTm9yVmFsdWVXaGVuQ29uZmlybWluZ1ZhbHVlKGlucHV0KTtcbiAgICAgICAgfVxuICAgICAgICBjYXRjaCAoZSkge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlSWZHdWFyZEZhaWxlZChlKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHByaXZhdGUgaXNWYWx1ZUluUmVqZWN0ZWRWYWx1ZXMoaW5wdXQ6IENvbnRyb2xJbnB1dCk6IGJvb2xlYW4ge1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgb2tJZihJbnB1dFV0aWwuaXNTaW5nbGVWYWx1ZUNvbnRyb2xJbnRlbnQoaW5wdXQsIEFtYXpvbkJ1aWx0SW5TbG90VHlwZS5OVU1CRVIpKTtcbiAgICAgICAgICAgIGNvbnN0IHsgYWN0aW9uLCB0YXJnZXQsIHZhbHVlU3RyIH0gPSB1bnBhY2tTaW5nbGVWYWx1ZUNvbnRyb2xJbnRlbnQoKGlucHV0LnJlcXVlc3QgYXMgSW50ZW50UmVxdWVzdCkuaW50ZW50KTtcbiAgICAgICAgICAgIG9rSWYoSW5wdXRVdGlsLmFjdGlvbklzTWF0Y2hPclVuZGVmaW5lZChhY3Rpb24sIFsuLi50aGlzLnByb3BzLmludGVyYWN0aW9uTW9kZWwuYWN0aW9ucy5zZXQsIC4uLnRoaXMucHJvcHMuaW50ZXJhY3Rpb25Nb2RlbC5hY3Rpb25zLmNoYW5nZV0pKTtcbiAgICAgICAgICAgIG9rSWYoSW5wdXRVdGlsLnRhcmdldElzTWF0Y2hPclVuZGVmaW5lZCh0YXJnZXQsIHRoaXMucHJvcHMuaW50ZXJhY3Rpb25Nb2RlbC50YXJnZXRzKSk7XG4gICAgICAgICAgICBva0lmKHRoaXMuc3RhdGUucmVqZWN0ZWRWYWx1ZXMuaW5jbHVkZXMoTnVtYmVyLnBhcnNlSW50KHZhbHVlU3RyLCAxMCkpKTtcbiAgICAgICAgICAgIHRoaXMuaGFuZGxlRnVuYyA9IHRoaXMuaGFuZGxlVmFsdWVFeGlzdHNJblJlamVjdGVkVmFsdWVzO1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZUlmR3VhcmRGYWlsZWQoZSk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwcml2YXRlIGhhbmRsZVZhbHVlRXhpc3RzSW5SZWplY3RlZFZhbHVlcyhpbnB1dDogQ29udHJvbElucHV0LCByZXN1bHRCdWlsZGVyOiBDb250cm9sUmVzdWx0QnVpbGRlcik6IHZvaWQge1xuICAgICAgICBjb25zdCB7IHZhbHVlU3RyIH0gPSB1bnBhY2tTaW5nbGVWYWx1ZUNvbnRyb2xJbnRlbnQoKGlucHV0LnJlcXVlc3QgYXMgSW50ZW50UmVxdWVzdCkuaW50ZW50KTtcbiAgICAgICAgdGhpcy5zZXRWYWx1ZSh2YWx1ZVN0cik7XG4gICAgICAgIHJlc3VsdEJ1aWxkZXIuYWRkQWN0KFxuICAgICAgICAgICAgbmV3IFByb2JsZW1hdGljSW5wdXRWYWx1ZUFjdCh0aGlzLCB7IHJlYXNvbkNvZGU6ICdWYWx1ZVByZXZpb3VzbHlSZWplY3RlZCcsIHZhbHVlOiB0aGlzLnN0YXRlLnZhbHVlIH0pXG4gICAgICAgICk7XG4gICAgICAgIHJlc3VsdEJ1aWxkZXIuYWRkQWN0KFxuICAgICAgICAgICAgbmV3IFJlcXVlc3RWYWx1ZUFjdCh0aGlzKVxuICAgICAgICApO1xuICAgIH1cblxuICAgIHByaXZhdGUgaXNCYXJlTm9XaGVuQ29uZmlybWluZ1ZhbHVlKGlucHV0OiBDb250cm9sSW5wdXQpOiBib29sZWFuIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIG9rSWYoSW5wdXRVdGlsLmlzQmFyZU5vKGlucHV0KSk7XG4gICAgICAgICAgICB0aGlzLmhhbmRsZUZ1bmMgPSB0aGlzLmhhbmRsZUZlZWRiYWNrTm9BbmRXaXRob3V0VmFsdWVXaGVuQ29uZmlybWluZ1ZhbHVlO1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZUlmR3VhcmRGYWlsZWQoZSk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwcml2YXRlIGlzRmVlZGJhY2tOb0FuZFZhbHVlVW5kZWZpbmVkV2hlbkNvbmZpcm1pbmdWYWx1ZShpbnB1dDogQ29udHJvbElucHV0KTogYm9vbGVhbiB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBva0lmKElucHV0VXRpbC5pc0ludGVudChpbnB1dCwgR2VuZXJhbENvbnRyb2xJbnRlbnQubmFtZSkpO1xuICAgICAgICAgICAgY29uc3QgeyBmZWVkYmFjaywgYWN0aW9uLCB0YXJnZXQgfSA9IHVucGFja0dlbmVyYWxDb250cm9sSW50ZW50KChpbnB1dC5yZXF1ZXN0IGFzIEludGVudFJlcXVlc3QpLmludGVudCk7XG4gICAgICAgICAgICBva0lmKElucHV0VXRpbC5hY3Rpb25Jc01hdGNoT3JVbmRlZmluZWQoYWN0aW9uLCBbLi4udGhpcy5wcm9wcy5pbnRlcmFjdGlvbk1vZGVsLmFjdGlvbnMuc2V0LCAuLi50aGlzLnByb3BzLmludGVyYWN0aW9uTW9kZWwuYWN0aW9ucy5jaGFuZ2VdKSk7XG4gICAgICAgICAgICBva0lmKElucHV0VXRpbC50YXJnZXRJc01hdGNoT3JVbmRlZmluZWQodGFyZ2V0LCB0aGlzLnByb3BzLmludGVyYWN0aW9uTW9kZWwudGFyZ2V0cykpO1xuICAgICAgICAgICAgb2tJZihJbnB1dFV0aWwuZmVlZGJhY2tJc0ZhbHNlKGZlZWRiYWNrKSk7XG4gICAgICAgICAgICB0aGlzLmhhbmRsZUZ1bmMgPSB0aGlzLmhhbmRsZUZlZWRiYWNrTm9BbmRXaXRob3V0VmFsdWVXaGVuQ29uZmlybWluZ1ZhbHVlO1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZUlmR3VhcmRGYWlsZWQoZSk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwcml2YXRlIGhhbmRsZUZlZWRiYWNrTm9BbmRXaXRob3V0VmFsdWVXaGVuQ29uZmlybWluZ1ZhbHVlKGlucHV0OiBDb250cm9sSW5wdXQsIHJlc3VsdEJ1aWxkZXI6IENvbnRyb2xSZXN1bHRCdWlsZGVyKTogdm9pZCB7XG4gICAgICAgIHJlc3VsdEJ1aWxkZXIuYWRkQWN0KFxuICAgICAgICAgICAgbmV3IFZhbHVlRGlzY29uZmlybWVkQWN0KHRoaXMsIHt2YWx1ZTogdGhpcy5zdGF0ZS52YWx1ZSF9KVxuICAgICAgICApO1xuICAgICAgICB0aGlzLmNvbW1vbkhhbmRsZXJXaGVuVmFsdWVSZWplY3RlZChpbnB1dCwgcmVzdWx0QnVpbGRlcik7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBpc0ZlZWRiYWNrTm9BbmRWYWx1ZU5vdENoYW5nZWRXaGVuQ29uZmlybWluZ1ZhbHVlKGlucHV0OiBDb250cm9sSW5wdXQpOiBib29sZWFuIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIG9rSWYoSW5wdXRVdGlsLmlzU2luZ2xlVmFsdWVDb250cm9sSW50ZW50KGlucHV0LCBBbWF6b25CdWlsdEluU2xvdFR5cGUuTlVNQkVSKSk7XG4gICAgICAgICAgICBjb25zdCB7IGFjdGlvbiwgdGFyZ2V0LCBmZWVkYmFjaywgdmFsdWVTdHIgfSA9IHVucGFja1NpbmdsZVZhbHVlQ29udHJvbEludGVudCgoaW5wdXQucmVxdWVzdCBhcyBJbnRlbnRSZXF1ZXN0KS5pbnRlbnQpO1xuICAgICAgICAgICAgb2tJZihJbnB1dFV0aWwuYWN0aW9uSXNNYXRjaE9yVW5kZWZpbmVkKGFjdGlvbiwgWy4uLnRoaXMucHJvcHMuaW50ZXJhY3Rpb25Nb2RlbC5hY3Rpb25zLnNldCwgLi4udGhpcy5wcm9wcy5pbnRlcmFjdGlvbk1vZGVsLmFjdGlvbnMuY2hhbmdlXSkpO1xuICAgICAgICAgICAgb2tJZihJbnB1dFV0aWwudGFyZ2V0SXNNYXRjaE9yVW5kZWZpbmVkKHRhcmdldCwgdGhpcy5wcm9wcy5pbnRlcmFjdGlvbk1vZGVsLnRhcmdldHMpKTtcbiAgICAgICAgICAgIG9rSWYoSW5wdXRVdGlsLmZlZWRiYWNrSXNGYWxzZShmZWVkYmFjaykpO1xuICAgICAgICAgICAgb2tJZih0aGlzLnN0YXRlLnZhbHVlID09PSBOdW1iZXIucGFyc2VJbnQodmFsdWVTdHIsIDEwKSk7XG4gICAgICAgICAgICB0aGlzLmhhbmRsZUZ1bmMgPSB0aGlzLmhhbmRsZUZlZWRiYWNrTm9BbmRWYWx1ZU5vdENoYW5nZWRXaGVuQ29uZmlybWluZ1ZhbHVlO1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZUlmR3VhcmRGYWlsZWQoZSk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwcml2YXRlIGhhbmRsZUZlZWRiYWNrTm9BbmRWYWx1ZU5vdENoYW5nZWRXaGVuQ29uZmlybWluZ1ZhbHVlKGlucHV0OiBDb250cm9sSW5wdXQsIHJlc3VsdEJ1aWxkZXI6IENvbnRyb2xSZXN1bHRCdWlsZGVyKTogdm9pZCB7XG4gICAgICAgIHJlc3VsdEJ1aWxkZXIuYWRkQWN0KFxuICAgICAgICAgICAgbmV3IEluZm9ybUNvbmZ1c2luZ0Rpc2NvbmZpcm1hdGlvbkFjdCh0aGlzLCB7IHZhbHVlOiB0aGlzLnN0YXRlLnZhbHVlISwgcmVhc29uQ29kZTogJ0Rpc2NvbmZpcm1lZFdpdGhTYW1lVmFsdWUnIH0pXG4gICAgICAgICk7XG4gICAgICAgIHRoaXMuY29tbW9uSGFuZGxlcldoZW5WYWx1ZVJlamVjdGVkKGlucHV0LCByZXN1bHRCdWlsZGVyKTtcbiAgICB9XG5cbiAgICBwcml2YXRlIGlzRmVlZGJhY2tOb0FuZFZhbHVlQ2hhbmdlZFdoZW5Db25maXJtaW5nVmFsdWUoaW5wdXQ6IENvbnRyb2xJbnB1dCk6IGJvb2xlYW4ge1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgb2tJZihJbnB1dFV0aWwuaXNTaW5nbGVWYWx1ZUNvbnRyb2xJbnRlbnQoaW5wdXQsIEFtYXpvbkJ1aWx0SW5TbG90VHlwZS5OVU1CRVIpKTtcbiAgICAgICAgICAgIGNvbnN0IHsgZmVlZGJhY2ssIGFjdGlvbiwgdGFyZ2V0LCB2YWx1ZVN0ciB9ID0gdW5wYWNrU2luZ2xlVmFsdWVDb250cm9sSW50ZW50KChpbnB1dC5yZXF1ZXN0IGFzIEludGVudFJlcXVlc3QpLmludGVudCk7XG4gICAgICAgICAgICBva0lmKElucHV0VXRpbC5hY3Rpb25Jc01hdGNoT3JVbmRlZmluZWQoYWN0aW9uLCBbLi4udGhpcy5wcm9wcy5pbnRlcmFjdGlvbk1vZGVsLmFjdGlvbnMuc2V0LCAuLi50aGlzLnByb3BzLmludGVyYWN0aW9uTW9kZWwuYWN0aW9ucy5jaGFuZ2VdKSk7XG4gICAgICAgICAgICBva0lmKElucHV0VXRpbC50YXJnZXRJc01hdGNoT3JVbmRlZmluZWQodGFyZ2V0LCB0aGlzLnByb3BzLmludGVyYWN0aW9uTW9kZWwudGFyZ2V0cykpO1xuICAgICAgICAgICAgb2tJZihJbnB1dFV0aWwuZmVlZGJhY2tJc0ZhbHNlKGZlZWRiYWNrKSk7XG4gICAgICAgICAgICBva0lmKElucHV0VXRpbC52YWx1ZVN0ckRlZmluZWQodmFsdWVTdHIpKTtcbiAgICAgICAgICAgIG9rSWYodGhpcy5zdGF0ZS52YWx1ZSAhPT0gTnVtYmVyLnBhcnNlSW50KHZhbHVlU3RyLCAxMCkpO1xuICAgICAgICAgICAgdGhpcy5oYW5kbGVGdW5jID0gdGhpcy5oYW5kbGVGZWVkYmFja05vQW5kVmFsdWVDaGFuZ2VkV2hlbkNvbmZpcm1pbmdWYWx1ZTtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIGNhdGNoIChlKSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2VJZkd1YXJkRmFpbGVkKGUpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBoYW5kbGVGZWVkYmFja05vQW5kVmFsdWVDaGFuZ2VkV2hlbkNvbmZpcm1pbmdWYWx1ZShpbnB1dDogQ29udHJvbElucHV0LCByZXN1bHRCdWlsZGVyOiBDb250cm9sUmVzdWx0QnVpbGRlcik6IHZvaWQge1xuICAgICAgICBjb25zdCB7IGFjdGlvbiwgdmFsdWVTdHIgfSA9IHVucGFja1NpbmdsZVZhbHVlQ29udHJvbEludGVudCgoaW5wdXQucmVxdWVzdCBhcyBJbnRlbnRSZXF1ZXN0KS5pbnRlbnQpO1xuICAgICAgICB0aGlzLnNldFZhbHVlKHZhbHVlU3RyKTtcbiAgICAgICAgdGhpcy5jb21tb25IYW5kbGVyV2hlblZhbHVlQ2hhbmdlZChhY3Rpb24gPz8gJC5BY3Rpb24uU2V0LCBpbnB1dCwgcmVzdWx0QnVpbGRlcik7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBpc0ZlZWRiYWNrWWVzQW5kVmFsdWVDaGFuZ2VkV2hlbkNvbmZpcm1pbmdWYWx1ZShpbnB1dDogQ29udHJvbElucHV0KTogYm9vbGVhbiB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBva0lmKElucHV0VXRpbC5pc1NpbmdsZVZhbHVlQ29udHJvbEludGVudChpbnB1dCwgQW1hem9uQnVpbHRJblNsb3RUeXBlLk5VTUJFUikpO1xuICAgICAgICAgICAgY29uc3QgeyBmZWVkYmFjaywgYWN0aW9uLCB0YXJnZXQsIHZhbHVlU3RyIH0gPSB1bnBhY2tTaW5nbGVWYWx1ZUNvbnRyb2xJbnRlbnQoKGlucHV0LnJlcXVlc3QgYXMgSW50ZW50UmVxdWVzdCkuaW50ZW50KTtcbiAgICAgICAgICAgIG9rSWYoSW5wdXRVdGlsLmFjdGlvbklzTWF0Y2hPclVuZGVmaW5lZChhY3Rpb24sIFsuLi50aGlzLnByb3BzLmludGVyYWN0aW9uTW9kZWwuYWN0aW9ucy5zZXQsIC4uLnRoaXMucHJvcHMuaW50ZXJhY3Rpb25Nb2RlbC5hY3Rpb25zLmNoYW5nZV0pKTtcbiAgICAgICAgICAgIG9rSWYoSW5wdXRVdGlsLnRhcmdldElzTWF0Y2hPclVuZGVmaW5lZCh0YXJnZXQsIHRoaXMucHJvcHMuaW50ZXJhY3Rpb25Nb2RlbC50YXJnZXRzKSk7XG4gICAgICAgICAgICBva0lmKElucHV0VXRpbC5mZWVkYmFja0lzVHJ1ZShmZWVkYmFjaykpO1xuICAgICAgICAgICAgb2tJZihJbnB1dFV0aWwudmFsdWVTdHJEZWZpbmVkKHZhbHVlU3RyKSk7XG4gICAgICAgICAgICBva0lmKHRoaXMuc3RhdGUudmFsdWUgIT09IE51bWJlci5wYXJzZUludCh2YWx1ZVN0ciwgMTApKTtcbiAgICAgICAgICAgIHRoaXMuaGFuZGxlRnVuYyA9IHRoaXMuaGFuZGxlRmVlZGJhY2tZZXNBbmRWYWx1ZUNoYW5nZWRXaGVuQ29uZmlybWluZ1ZhbHVlO1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZUlmR3VhcmRGYWlsZWQoZSk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwcml2YXRlIGhhbmRsZUZlZWRiYWNrWWVzQW5kVmFsdWVDaGFuZ2VkV2hlbkNvbmZpcm1pbmdWYWx1ZShpbnB1dDogQ29udHJvbElucHV0LCByZXN1bHRCdWlsZGVyOiBDb250cm9sUmVzdWx0QnVpbGRlcik6IHZvaWQge1xuICAgICAgICBjb25zdCB7IGFjdGlvbiwgdmFsdWVTdHIgfSA9IHVucGFja1NpbmdsZVZhbHVlQ29udHJvbEludGVudCgoaW5wdXQucmVxdWVzdCBhcyBJbnRlbnRSZXF1ZXN0KS5pbnRlbnQpO1xuICAgICAgICBjb25zdCBwcmV2aW91c1ZhbHVlID0gdGhpcy5zdGF0ZS52YWx1ZTtcbiAgICAgICAgdGhpcy5zZXRWYWx1ZSh2YWx1ZVN0cik7XG4gICAgICAgIHJlc3VsdEJ1aWxkZXIuYWRkQWN0KFxuICAgICAgICAgICAgbmV3IEluZm9ybUNvbmZ1c2luZ0NvbmZpcm1hdGlvbkFjdCh0aGlzLCB7IHZhbHVlOiBwcmV2aW91c1ZhbHVlLCByZWFzb25Db2RlOiAnQ29uZmlybWVkV2l0aERpZmZlcmVudFZhbHVlJyB9KVxuICAgICAgICApO1xuICAgICAgICByZXN1bHRCdWlsZGVyLmFkZEFjdChcbiAgICAgICAgICAgIG5ldyBDb25maXJtVmFsdWVBY3QodGhpcywgeyB2YWx1ZTogdGhpcy5zdGF0ZS52YWx1ZSB9KVxuICAgICAgICApO1xuICAgIH1cblxuICAgIHByaXZhdGUgaXNCYXJlWWVzQ29uZmlybWluZ1ZhbHVlKGlucHV0OiBDb250cm9sSW5wdXQpOiBib29sZWFuIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIG9rSWYoSW5wdXRVdGlsLmlzQmFyZVllcyhpbnB1dCkpO1xuICAgICAgICAgICAgdGhpcy5oYW5kbGVGdW5jID0gdGhpcy5oYW5kbGVGZWVkYmFja1llc0FuZFZhbHVlTm90Q2hhbmdlZE9yVW5kZWZpbmVkV2hlbkNvbmZpcm1pbmdWYWx1ZTtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIGNhdGNoIChlKSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2VJZkd1YXJkRmFpbGVkKGUpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBpc0ZlZWRiYWNrWWVzQW5kVmFsdWVOb3RDaGFuZ2VkV2hlbkNvbmZpcm1pbmdWYWx1ZShpbnB1dDogQ29udHJvbElucHV0KTogYm9vbGVhbiB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBva0lmKElucHV0VXRpbC5pc1NpbmdsZVZhbHVlQ29udHJvbEludGVudChpbnB1dCwgQW1hem9uQnVpbHRJblNsb3RUeXBlLk5VTUJFUikpO1xuICAgICAgICAgICAgY29uc3QgeyBmZWVkYmFjaywgYWN0aW9uLCB0YXJnZXQsIHZhbHVlU3RyIH0gPSB1bnBhY2tTaW5nbGVWYWx1ZUNvbnRyb2xJbnRlbnQoKGlucHV0LnJlcXVlc3QgYXMgSW50ZW50UmVxdWVzdCkuaW50ZW50KTtcbiAgICAgICAgICAgIG9rSWYoSW5wdXRVdGlsLmFjdGlvbklzTWF0Y2hPclVuZGVmaW5lZChhY3Rpb24sIFsuLi50aGlzLnByb3BzLmludGVyYWN0aW9uTW9kZWwuYWN0aW9ucy5zZXQsIC4uLnRoaXMucHJvcHMuaW50ZXJhY3Rpb25Nb2RlbC5hY3Rpb25zLmNoYW5nZV0pKTtcbiAgICAgICAgICAgIG9rSWYoSW5wdXRVdGlsLnRhcmdldElzTWF0Y2hPclVuZGVmaW5lZCh0YXJnZXQsIHRoaXMucHJvcHMuaW50ZXJhY3Rpb25Nb2RlbC50YXJnZXRzKSk7XG4gICAgICAgICAgICBva0lmKElucHV0VXRpbC5mZWVkYmFja0lzVHJ1ZShmZWVkYmFjaykpO1xuICAgICAgICAgICAgb2tJZih0aGlzLnN0YXRlLnZhbHVlID09PSBOdW1iZXIucGFyc2VJbnQodmFsdWVTdHIsIDEwKSk7XG4gICAgICAgICAgICB0aGlzLmhhbmRsZUZ1bmMgPSB0aGlzLmhhbmRsZUZlZWRiYWNrWWVzQW5kVmFsdWVOb3RDaGFuZ2VkT3JVbmRlZmluZWRXaGVuQ29uZmlybWluZ1ZhbHVlO1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZUlmR3VhcmRGYWlsZWQoZSk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwcml2YXRlIGlzRmVlZGJhY2tZZXNBbmRWYWx1ZVVuZGVmaW5lZFdoZW5Db25maXJtaW5nVmFsdWUoaW5wdXQ6IENvbnRyb2xJbnB1dCk6IGJvb2xlYW4ge1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgb2tJZihJbnB1dFV0aWwuaXNJbnRlbnQoaW5wdXQsIEdlbmVyYWxDb250cm9sSW50ZW50Lm5hbWUpKTtcbiAgICAgICAgICAgIGNvbnN0IHsgZmVlZGJhY2ssIGFjdGlvbiwgdGFyZ2V0IH0gPSB1bnBhY2tHZW5lcmFsQ29udHJvbEludGVudCgoaW5wdXQucmVxdWVzdCBhcyBJbnRlbnRSZXF1ZXN0KS5pbnRlbnQpO1xuICAgICAgICAgICAgb2tJZihJbnB1dFV0aWwuYWN0aW9uSXNNYXRjaE9yVW5kZWZpbmVkKGFjdGlvbiwgWy4uLnRoaXMucHJvcHMuaW50ZXJhY3Rpb25Nb2RlbC5hY3Rpb25zLnNldCwgLi4udGhpcy5wcm9wcy5pbnRlcmFjdGlvbk1vZGVsLmFjdGlvbnMuY2hhbmdlXSkpO1xuICAgICAgICAgICAgb2tJZihJbnB1dFV0aWwudGFyZ2V0SXNNYXRjaE9yVW5kZWZpbmVkKHRhcmdldCwgdGhpcy5wcm9wcy5pbnRlcmFjdGlvbk1vZGVsLnRhcmdldHMpKTtcbiAgICAgICAgICAgIG9rSWYoSW5wdXRVdGlsLmZlZWRiYWNrSXNUcnVlKGZlZWRiYWNrKSk7XG4gICAgICAgICAgICB0aGlzLmhhbmRsZUZ1bmMgPSB0aGlzLmhhbmRsZUZlZWRiYWNrWWVzQW5kVmFsdWVOb3RDaGFuZ2VkT3JVbmRlZmluZWRXaGVuQ29uZmlybWluZ1ZhbHVlO1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZUlmR3VhcmRGYWlsZWQoZSk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwcml2YXRlIGhhbmRsZUZlZWRiYWNrWWVzQW5kVmFsdWVOb3RDaGFuZ2VkT3JVbmRlZmluZWRXaGVuQ29uZmlybWluZ1ZhbHVlKGlucHV0OiBDb250cm9sSW5wdXQsIHJlc3VsdEJ1aWxkZXI6IENvbnRyb2xSZXN1bHRCdWlsZGVyKTogdm9pZCB7XG4gICAgICAgIHRoaXMuc3RhdGUuaXNWYWx1ZUNvbmZpcm1lZCA9IHRydWU7XG4gICAgICAgIHJlc3VsdEJ1aWxkZXIuYWRkQWN0KFxuICAgICAgICAgICAgbmV3IFZhbHVlQ29uZmlybWVkQWN0KHRoaXMsIHsgdmFsdWU6IHRoaXMuc3RhdGUudmFsdWUgfSlcbiAgICAgICAgKTtcbiAgICB9XG5cbiAgICBwcml2YXRlIGlzRmVlZGJhY2tVbmRlZmluZWRBbmRWYWx1ZU5vdENoYW5nZWRXaGVuQ29uZmlybWluZ1ZhbHVlKGlucHV0OiBDb250cm9sSW5wdXQpOiBib29sZWFuIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIG9rSWYoSW5wdXRVdGlsLmlzU2luZ2xlVmFsdWVDb250cm9sSW50ZW50KGlucHV0LCBBbWF6b25CdWlsdEluU2xvdFR5cGUuTlVNQkVSKSk7XG4gICAgICAgICAgICBjb25zdCB7IGZlZWRiYWNrLCBhY3Rpb24sIHRhcmdldCwgdmFsdWVTdHIgfSA9IHVucGFja1NpbmdsZVZhbHVlQ29udHJvbEludGVudCgoaW5wdXQucmVxdWVzdCBhcyBJbnRlbnRSZXF1ZXN0KS5pbnRlbnQpO1xuICAgICAgICAgICAgb2tJZihJbnB1dFV0aWwuYWN0aW9uSXNNYXRjaE9yVW5kZWZpbmVkKGFjdGlvbiwgWy4uLnRoaXMucHJvcHMuaW50ZXJhY3Rpb25Nb2RlbC5hY3Rpb25zLnNldCwgLi4udGhpcy5wcm9wcy5pbnRlcmFjdGlvbk1vZGVsLmFjdGlvbnMuY2hhbmdlXSkpO1xuICAgICAgICAgICAgb2tJZihJbnB1dFV0aWwudGFyZ2V0SXNNYXRjaE9yVW5kZWZpbmVkKHRhcmdldCwgdGhpcy5wcm9wcy5pbnRlcmFjdGlvbk1vZGVsLnRhcmdldHMpKTtcbiAgICAgICAgICAgIG9rSWYoSW5wdXRVdGlsLmZlZWRiYWNrSXNVbmRlZmluZWQoZmVlZGJhY2spKTtcbiAgICAgICAgICAgIG9rSWYoSW5wdXRVdGlsLnZhbHVlU3RyRGVmaW5lZCh2YWx1ZVN0cikpO1xuICAgICAgICAgICAgb2tJZih0aGlzLnN0YXRlLnZhbHVlID09PSBOdW1iZXIucGFyc2VJbnQodmFsdWVTdHIsIDEwKSk7XG4gICAgICAgICAgICB0aGlzLmhhbmRsZUZ1bmMgPSB0aGlzLmhhbmRsZUZlZWRiYWNrWWVzQW5kVmFsdWVVbmRlZmluZWRXaGVuQ29uZmlybWluZ1ZhbHVlO1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZUlmR3VhcmRGYWlsZWQoZSk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwcml2YXRlIGhhbmRsZUZlZWRiYWNrWWVzQW5kVmFsdWVVbmRlZmluZWRXaGVuQ29uZmlybWluZ1ZhbHVlKGlucHV0OiBDb250cm9sSW5wdXQsIHJlc3VsdEJ1aWxkZXI6IENvbnRyb2xSZXN1bHRCdWlsZGVyKTogdm9pZCB7XG4gICAgICAgIHRoaXMuc3RhdGUuaXNWYWx1ZUNvbmZpcm1lZCA9IHRydWU7XG4gICAgICAgIHJlc3VsdEJ1aWxkZXIuYWRkQWN0KFxuICAgICAgICAgICAgbmV3IFZhbHVlQ29uZmlybWVkQWN0KHRoaXMsIHsgdmFsdWU6IHRoaXMuc3RhdGUudmFsdWUgfSlcbiAgICAgICAgKTtcbiAgICB9XG5cbiAgICBwcml2YXRlIGlzRmVlZGJhY2tVbmRlZmluZWRBbmRWYWx1ZUNoYW5nZWRXaGVuQ29uZmlybWluZ1ZhbHVlKGlucHV0OiBDb250cm9sSW5wdXQpOiBib29sZWFuIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIG9rSWYoSW5wdXRVdGlsLmlzU2luZ2xlVmFsdWVDb250cm9sSW50ZW50KGlucHV0LCBBbWF6b25CdWlsdEluU2xvdFR5cGUuTlVNQkVSKSk7XG4gICAgICAgICAgICBjb25zdCB7IGZlZWRiYWNrLCBhY3Rpb24sIHRhcmdldCwgdmFsdWVTdHIgfSA9IHVucGFja1NpbmdsZVZhbHVlQ29udHJvbEludGVudCgoaW5wdXQucmVxdWVzdCBhcyBJbnRlbnRSZXF1ZXN0KS5pbnRlbnQpO1xuICAgICAgICAgICAgb2tJZihJbnB1dFV0aWwuYWN0aW9uSXNNYXRjaE9yVW5kZWZpbmVkKGFjdGlvbiwgWy4uLnRoaXMucHJvcHMuaW50ZXJhY3Rpb25Nb2RlbC5hY3Rpb25zLnNldCwgLi4udGhpcy5wcm9wcy5pbnRlcmFjdGlvbk1vZGVsLmFjdGlvbnMuY2hhbmdlXSkpO1xuICAgICAgICAgICAgb2tJZihJbnB1dFV0aWwudGFyZ2V0SXNNYXRjaE9yVW5kZWZpbmVkKHRhcmdldCwgdGhpcy5wcm9wcy5pbnRlcmFjdGlvbk1vZGVsLnRhcmdldHMpKTtcbiAgICAgICAgICAgIG9rSWYoSW5wdXRVdGlsLmZlZWRiYWNrSXNVbmRlZmluZWQoZmVlZGJhY2spKTtcbiAgICAgICAgICAgIG9rSWYoSW5wdXRVdGlsLnZhbHVlU3RyRGVmaW5lZCh2YWx1ZVN0cikpO1xuICAgICAgICAgICAgb2tJZih0aGlzLnN0YXRlLnZhbHVlICE9PSBOdW1iZXIucGFyc2VJbnQodmFsdWVTdHIsIDEwKSk7XG4gICAgICAgICAgICB0aGlzLmhhbmRsZUZ1bmMgPSB0aGlzLmhhbmRsZUZlZWRiYWNrVW5kZWZpbmVkQW5kVmFsdWVDaGFuZ2VkV2hlbkNvbmZpcm1pbmdWYWx1ZTtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIGNhdGNoIChlKSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2VJZkd1YXJkRmFpbGVkKGUpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBoYW5kbGVGZWVkYmFja1VuZGVmaW5lZEFuZFZhbHVlQ2hhbmdlZFdoZW5Db25maXJtaW5nVmFsdWUoaW5wdXQ6IENvbnRyb2xJbnB1dCwgcmVzdWx0QnVpbGRlcjogQ29udHJvbFJlc3VsdEJ1aWxkZXIpOiB2b2lkIHtcbiAgICAgICAgY29uc3QgeyBhY3Rpb24sIHZhbHVlU3RyIH0gPSB1bnBhY2tTaW5nbGVWYWx1ZUNvbnRyb2xJbnRlbnQoKGlucHV0LnJlcXVlc3QgYXMgSW50ZW50UmVxdWVzdCkuaW50ZW50KTtcbiAgICAgICAgdGhpcy5zZXRWYWx1ZSh2YWx1ZVN0cik7XG4gICAgICAgIHRoaXMuY29tbW9uSGFuZGxlcldoZW5WYWx1ZUNoYW5nZWQoYWN0aW9uID8/ICQuQWN0aW9uLlNldCwgaW5wdXQsIHJlc3VsdEJ1aWxkZXIpO1xuICAgIH1cblxuICAgIHByaXZhdGUgaXNUYXJnZXRzTWF0Y2hXaXRob3V0RmVlZGJhY2tOb3JWYWx1ZVdoZW5Db25maXJtaW5nVmFsdWUoaW5wdXQ6IENvbnRyb2xJbnB1dCk6IGJvb2xlYW4ge1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgb2tJZihJbnB1dFV0aWwuaXNJbnRlbnQoaW5wdXQsIEdlbmVyYWxDb250cm9sSW50ZW50Lm5hbWUpKTtcbiAgICAgICAgICAgIGNvbnN0IHsgZmVlZGJhY2ssIGFjdGlvbiwgdGFyZ2V0IH0gPSB1bnBhY2tHZW5lcmFsQ29udHJvbEludGVudCgoaW5wdXQucmVxdWVzdCBhcyBJbnRlbnRSZXF1ZXN0KS5pbnRlbnQpO1xuICAgICAgICAgICAgb2tJZihJbnB1dFV0aWwuZmVlZGJhY2tJc1VuZGVmaW5lZChmZWVkYmFjaykpO1xuICAgICAgICAgICAgb2tJZihJbnB1dFV0aWwuYWN0aW9uSXNNYXRjaE9yVW5kZWZpbmVkKGFjdGlvbiwgWy4uLnRoaXMucHJvcHMuaW50ZXJhY3Rpb25Nb2RlbC5hY3Rpb25zLnNldCwgLi4udGhpcy5wcm9wcy5pbnRlcmFjdGlvbk1vZGVsLmFjdGlvbnMuY2hhbmdlXSkpO1xuICAgICAgICAgICAgb2tJZihJbnB1dFV0aWwudGFyZ2V0SXNNYXRjaCh0YXJnZXQsIF8ud2l0aG91dCh0aGlzLnByb3BzLmludGVyYWN0aW9uTW9kZWwudGFyZ2V0cywgJC5UYXJnZXQuSXQpKSk7XG4gICAgICAgICAgICB0aGlzLmhhbmRsZUZ1bmMgPSB0aGlzLmhhbmRsZVRhcmdldE1hdGNoV2l0aG91dEZlZWRiYWNrTm9yVmFsdWVXaGVuQ29uZmlybWluZ1ZhbHVlO1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZUlmR3VhcmRGYWlsZWQoZSk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwcml2YXRlIGhhbmRsZVRhcmdldE1hdGNoV2l0aG91dEZlZWRiYWNrTm9yVmFsdWVXaGVuQ29uZmlybWluZ1ZhbHVlKGlucHV0OiBDb250cm9sSW5wdXQsIHJlc3VsdEJ1aWxkZXI6IENvbnRyb2xSZXN1bHRCdWlsZGVyKTogdm9pZCB7XG4gICAgICAgIHJlc3VsdEJ1aWxkZXIuYWRkQWN0KFxuICAgICAgICAgICAgbmV3IFJlcXVlc3RWYWx1ZUFjdCh0aGlzKVxuICAgICAgICApO1xuICAgIH1cbiAgICAvKiAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5cbiAgICBwcml2YXRlIGNvbW1vbkhhbmRsZXJXaGVuVmFsdWVDaGFuZ2VkKGFjdGlvbjogc3RyaW5nLCBpbnB1dDogQ29udHJvbElucHV0LCByZXN1bHRCdWlsZGVyOiBDb250cm9sUmVzdWx0QnVpbGRlcik6IHZvaWQge1xuICAgICAgICBjb25zdCB2YWxpZGF0aW9uUmVzdWx0ID0gdGhpcy52YWxpZGF0ZU51bWJlcihpbnB1dCk7XG4gICAgICAgIGlmICh2YWxpZGF0aW9uUmVzdWx0ICE9PSB0cnVlKSB7XG4gICAgICAgICAgICB0aGlzLnN0YXRlLnJlamVjdGVkVmFsdWVzLnB1c2godGhpcy5zdGF0ZS52YWx1ZSEpO1xuICAgICAgICAgICAgcmVzdWx0QnVpbGRlci5hZGRBY3QoXG4gICAgICAgICAgICAgICAgbmV3IEludmFsaWRWYWx1ZUFjdCh0aGlzLCB7IHZhbHVlOiB0aGlzLnN0YXRlLnZhbHVlISwgcmVuZGVyZWRSZWFzb246IHZhbGlkYXRpb25SZXN1bHQucmVuZGVyZWRSZWFzb24gfSlcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgICByZXN1bHRCdWlsZGVyLmFkZEFjdChcbiAgICAgICAgICAgICAgICBuZXcgUmVxdWVzdFZhbHVlQWN0KHRoaXMpXG4gICAgICAgICAgICApO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKCF0aGlzLmlzQ29uZmlybWF0aW9uUmVxdWlyZWQoaW5wdXQpKSB7XG4gICAgICAgICAgICB0aGlzLnN0YXRlLmlzVmFsdWVDb25maXJtZWQgPSB0cnVlO1xuICAgICAgICAgICAgcmVzdWx0QnVpbGRlci5hZGRBY3QoXG4gICAgICAgICAgICAgICAgbmV3IFZhbHVlU2V0QWN0KHRoaXMsIHsgdmFsdWU6IHRoaXMuc3RhdGUudmFsdWUgfSlcbiAgICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICByZXN1bHRCdWlsZGVyLmFkZEFjdChcbiAgICAgICAgICAgICAgICBuZXcgQ29uZmlybVZhbHVlQWN0KHRoaXMsIHsgdmFsdWU6IHRoaXMuc3RhdGUudmFsdWUgfSlcbiAgICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBUT0RPOiBVc2VyJ3MgYWN0aW9uIGhhcyB0byBiZSB1c2VkIGluIHRoaXMgZnVuY3Rpb24gdG8gZm9ybSB0aGUgcmVzcG9uc2UgcHJvbXB0LCBuZWVkIHRvIGRlZmluZSBhY3Rpb24gaW4gdGhlIHJlbGF0ZWQgcGF5bG9hZFR5cGVcbiAgICAgKiBcbiAgICAgKiBVOiBObywge2NoYW5nZX0gdGhlIHZhbHVlIHBsZWFzZVxuICAgICAqIEE6IFdoYXQgdmFsdWUgZG8geW91IHdhbnQgdG8ge2NoYW5nZX0gdG8gPFJlcXVlc3RWYWx1ZUFjdD5cbiAgICAgKi9cbiAgICBwcml2YXRlIGNvbW1vbkhhbmRsZXJXaGVuVmFsdWVSZWplY3RlZChpbnB1dDogQ29udHJvbElucHV0LCByZXN1bHRCdWlsZGVyOiBDb250cm9sUmVzdWx0QnVpbGRlcik6IHZvaWQge1xuICAgICAgICB0aGlzLnN0YXRlLnJlamVjdGVkVmFsdWVzLnB1c2godGhpcy5zdGF0ZS52YWx1ZSEpO1xuICAgICAgICBjb25zdCBhbWJpZ3VvdXNQYXJ0bmVyID0gdGhpcy5nZXRBbWJpZ3VvdXNQYXJ0bmVyKHRoaXMuc3RhdGUudmFsdWUhKTtcbiAgICAgICAgaWYgKGFtYmlndW91c1BhcnRuZXIgIT09IHVuZGVmaW5lZCAmJiAhdGhpcy5zdGF0ZS5yZWplY3RlZFZhbHVlcy5pbmNsdWRlcyhhbWJpZ3VvdXNQYXJ0bmVyKSkge1xuICAgICAgICAgICAgY29uc3QgcHJldmlvdXNWYWx1ZSA9IHRoaXMuc3RhdGUudmFsdWU7XG4gICAgICAgICAgICB0aGlzLnN0YXRlLnZhbHVlID0gYW1iaWd1b3VzUGFydG5lcjtcbiAgICAgICAgICAgIGNvbnN0IHZhbGlkYXRpb25SZXN1bHQgPSB0aGlzLnZhbGlkYXRlTnVtYmVyKGlucHV0KTtcbiAgICAgICAgICAgIGlmICh2YWxpZGF0aW9uUmVzdWx0ID09PSB0cnVlKSB7XG4gICAgICAgICAgICAgICAgcmVzdWx0QnVpbGRlci5hZGRBY3QoXG4gICAgICAgICAgICAgICAgICAgIG5ldyBTdWdnZXN0VmFsdWVBY3QodGhpcywgeyB2YWx1ZTogdGhpcy5zdGF0ZS52YWx1ZSB9KVxuICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLnN0YXRlLnZhbHVlID0gcHJldmlvdXNWYWx1ZTtcbiAgICAgICAgICAgICAgICByZXN1bHRCdWlsZGVyLmFkZEFjdChcbiAgICAgICAgICAgICAgICAgICAgbmV3IFJlcXVlc3RWYWx1ZUFjdCh0aGlzKVxuICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICByZXN1bHRCdWlsZGVyLmFkZEFjdChcbiAgICAgICAgICAgICAgICBuZXcgUmVxdWVzdFZhbHVlQWN0KHRoaXMpXG4gICAgICAgICAgICApO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHJpdmF0ZSB3YW50c1RvRWxpY2l0VmFsdWUoaW5wdXQ6IENvbnRyb2xJbnB1dCk6IGJvb2xlYW4ge1xuICAgICAgICByZXR1cm4gdGhpcy5ldmFsdWF0ZUJvb2xlYW5Qcm9wKHRoaXMucHJvcHMucmVxdWlyZWQsIGlucHV0KSAmJiB0aGlzLnN0YXRlLnZhbHVlID09PSB1bmRlZmluZWQ7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSB3YW50c1RvRml4SW52YWxpZFZhbHVlKGlucHV0OiBDb250cm9sSW5wdXQpOiBib29sZWFuIHtcbiAgICAgICAgaWYgKCF0aGlzLmV2YWx1YXRlQm9vbGVhblByb3AodGhpcy5wcm9wcy5yZXF1aXJlZCwgaW5wdXQpIHx8IHRoaXMuc3RhdGUudmFsdWUgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHZhbGlkYXRpb25SZXN1bHQ6IHRydWUgfCBWYWxpZGF0aW9uUmVzdWx0ID0gdGhpcy52YWxpZGF0ZU51bWJlcihpbnB1dCk7XG4gICAgICAgIHJldHVybiB2YWxpZGF0aW9uUmVzdWx0ICE9PSB0cnVlO1xuICAgIH1cblxuICAgIHByaXZhdGUgd2FudHNUb0NvbmZpcm1WYWx1ZShpbnB1dDogQ29udHJvbElucHV0KTogYm9vbGVhbiB7XG4gICAgICAgIGlmICghdGhpcy5ldmFsdWF0ZUJvb2xlYW5Qcm9wKHRoaXMucHJvcHMucmVxdWlyZWQsIGlucHV0KSB8fCB0aGlzLnN0YXRlLnZhbHVlID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5zdGF0ZS5pc1ZhbHVlQ29uZmlybWVkKSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRoaXMuaXNDb25maXJtYXRpb25SZXF1aXJlZChpbnB1dCk7XG4gICAgfVxuXG4gICAgY2xlYXIoKSB7XG4gICAgICAgIHRoaXMuc3RhdGUgPSBuZXcgTnVtYmVyQ29udHJvbFN0YXRlKCk7XG4gICAgfVxuXG4gICAgc2V0VmFsdWUodmFsdWU6IHN0cmluZyB8IG51bWJlcikge1xuICAgICAgICB0aGlzLnN0YXRlLnZhbHVlID0gdHlwZW9mIHZhbHVlID09PSAnc3RyaW5nJyA/IE51bWJlci5wYXJzZUludCh2YWx1ZSEsIDEwKSA6IHZhbHVlO1xuICAgIH1cblxuICAgIHByaXZhdGUgdmFsaWRhdGVOdW1iZXIoaW5wdXQ6IENvbnRyb2xJbnB1dCk6IHRydWUgfCBWYWxpZGF0aW9uUmVzdWx0IHtcbiAgICAgICAgY29uc3QgbGlzdE9mVmFsaWRhdGlvbkZ1bmM6IE51bWJlclZhbGlkYXRpb25GdW5jdGlvbltdID0gdHlwZW9mKHRoaXMucHJvcHMudmFsaWRhdGlvbikgPT09ICdmdW5jdGlvbicgPyBbdGhpcy5wcm9wcy52YWxpZGF0aW9uXSA6IHRoaXMucHJvcHMudmFsaWRhdGlvbjtcbiAgICAgICAgZm9yIChjb25zdCB2YWxpZGF0aW9uRnVuY3Rpb24gb2YgbGlzdE9mVmFsaWRhdGlvbkZ1bmMpIHtcbiAgICAgICAgICAgIGNvbnN0IHZhbGlkYXRpb25SZXN1bHQ6IGJvb2xlYW4gfCBWYWxpZGF0aW9uUmVzdWx0ID0gdmFsaWRhdGlvbkZ1bmN0aW9uKHRoaXMuc3RhdGUsIGlucHV0KTtcbiAgICAgICAgICAgIGlmICh2YWxpZGF0aW9uUmVzdWx0ICE9PSB0cnVlKSB7XG4gICAgICAgICAgICAgICAgbG9nLmRlYnVnKGBOdW1iZXJDb250cm9sLnZhbGlkYXRlKCk6IHZhbGlkYXRpb24gZmFpbGVkLiBSZWFzb246ICR7SlNPTi5zdHJpbmdpZnkodmFsaWRhdGlvblJlc3VsdCwgbnVsbCwgMil9LmApO1xuICAgICAgICAgICAgICAgIHJldHVybiB2YWxpZGF0aW9uUmVzdWx0O1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cblxuICAgIHByaXZhdGUgaXNDb25maXJtYXRpb25SZXF1aXJlZChpbnB1dDogQ29udHJvbElucHV0KSB7XG4gICAgICAgIGlmICh0eXBlb2YgdGhpcy5wcm9wcy5jb25maXJtYXRpb25SZXF1aXJlZCA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMucHJvcHMuY29uZmlybWF0aW9uUmVxdWlyZWQodGhpcy5zdGF0ZSwgaW5wdXQpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKHR5cGVvZiB0aGlzLnByb3BzLmNvbmZpcm1hdGlvblJlcXVpcmVkID09PSAnYm9vbGVhbicpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLnByb3BzLmNvbmZpcm1hdGlvblJlcXVpcmVkO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7IC8vIGJ5IGRlZmF1bHQgY29uZmlybWF0aW9uIGlzIHJlcXVpcmVkXG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwcml2YXRlIGdldEFtYmlndW91c1BhcnRuZXIodmFsdWU/OiBudW1iZXIpOiBudW1iZXIgfCB1bmRlZmluZWQge1xuICAgICAgICBjb25zdCBwYWlycyA9IHRoaXMucHJvcHMuYW1iaWd1b3VzUGFpcnM7XG5cbiAgICAgICAgZm9yIChjb25zdCBwYWlyIG9mIHBhaXJzKSB7XG4gICAgICAgICAgICBpZiAocGFpclswXSA9PT0gdmFsdWUpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gcGFpclsxXTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKHBhaXJbMV0gPT09IHZhbHVlKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHBhaXJbMF07XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgICB9XG59XG5cbmZ1bmN0aW9uIGdlbmVyYXRlU2xvdEVsaWNpdGF0aW9uKCk6IHsgaW50ZW50OiBJbnRlbnQsIHNsb3ROYW1lOiBzdHJpbmcgfSB7XG4gICAgY29uc3QgaW50ZW50OiBJbnRlbnQgPSB7XG4gICAgICAgIG5hbWU6IFwiTnVtYmVyQ29udHJvbEludGVudFwiLFxuICAgICAgICBzbG90czoge1xuICAgICAgICAgICAgXCJBTUFaT04uTlVNQkVSXCI6IHsgbmFtZTogXCJBTUFaT04uTlVNQkVSXCIsIHZhbHVlOiAnJywgY29uZmlybWF0aW9uU3RhdHVzOiAnTk9ORScgfSxcbiAgICAgICAgICAgIFwiZmVlZGJhY2tcIjogeyBuYW1lOiBcImZlZWRiYWNrXCIsIHZhbHVlOiAnJywgY29uZmlybWF0aW9uU3RhdHVzOiAnTk9ORScgfSxcbiAgICAgICAgICAgIFwiYWN0aW9uXCI6IHsgbmFtZTogXCJhY3Rpb25cIiwgdmFsdWU6ICcnLCBjb25maXJtYXRpb25TdGF0dXM6ICdOT05FJyB9LFxuICAgICAgICAgICAgXCJ0YXJnZXRcIjogeyBuYW1lOiBcInRhcmdldFwiLCB2YWx1ZTogJycsIGNvbmZpcm1hdGlvblN0YXR1czogJ05PTkUnIH0sXG4gICAgICAgICAgICBcImhlYWRcIjogeyBuYW1lOiBcImhlYWRcIiwgdmFsdWU6ICcnLCBjb25maXJtYXRpb25TdGF0dXM6ICdOT05FJyB9LFxuICAgICAgICAgICAgXCJ0YWlsXCI6IHsgbmFtZTogXCJ0YWlsXCIsIHZhbHVlOiAnJywgY29uZmlybWF0aW9uU3RhdHVzOiAnTk9ORScgfSxcbiAgICAgICAgICAgIFwicHJlcG9zaXRpb25cIjogeyBuYW1lOiBcInByZXBvc2l0aW9uXCIsIHZhbHVlOiAnJywgY29uZmlybWF0aW9uU3RhdHVzOiAnTk9ORScgfSxcbiAgICAgICAgfSxcbiAgICAgICAgY29uZmlybWF0aW9uU3RhdHVzOiBcIk5PTkVcIlxuICAgIH07XG5cbiAgICByZXR1cm4ge1xuICAgICAgICBpbnRlbnQsXG4gICAgICAgIHNsb3ROYW1lOiAkLlNsb3RUeXBlLkFtYXpvbk51bWJlclxuICAgIH07XG59XG4iXX0=