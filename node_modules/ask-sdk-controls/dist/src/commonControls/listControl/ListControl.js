"use strict";
/*
 * Copyright 2019 Amazon.com, Inc. or its affiliates. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License").
 * You may not use this file except in compliance with the License.
 * A copy of the License is located at
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * or in the "license" file accompanying this file. This file is distributed
 * on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either
 * express or implied. See the License for the specific language governing
 * permissions and limitations under the License.
 */
Object.defineProperty(exports, "__esModule", { value: true });
exports.ListControl = exports.ListControlState = exports.ListControlAPLProps = exports.ListControlPromptProps = exports.ListControlInteractionModelProps = void 0;
const tslib_1 = require("tslib");
const ask_sdk_core_1 = require("ask-sdk-core");
const lodash_1 = tslib_1.__importDefault(require("lodash"));
const i18next_1 = tslib_1.__importDefault(require("i18next"));
const Strings_1 = require("../../constants/Strings");
const Control_1 = require("../../controls/Control");
const AmazonBuiltInSlotType_1 = require("../../intents/AmazonBuiltInSlotType");
const GeneralControlIntent_1 = require("../../intents/GeneralControlIntent");
const OrdinalControlIntent_1 = require("../../intents/OrdinalControlIntent");
const SingleValueControlIntent_1 = require("../../intents/SingleValueControlIntent");
const ModelTypes_1 = require("../../interactionModelGeneration/ModelTypes");
const ListFormat_1 = require("../../intl/ListFormat");
const Logger_1 = require("../../logging/Logger");
const ContentActs_1 = require("../../systemActs/ContentActs");
const InitiativeActs_1 = require("../../systemActs/InitiativeActs");
const InputUtil_1 = require("../../utils/InputUtil");
const Predicates_1 = require("../../utils/Predicates");
const APL_1 = require("./APL");
const log = new Logger_1.Logger('AskSdkControls:ListControl');
class ListControlInteractionModelProps {
}
exports.ListControlInteractionModelProps = ListControlInteractionModelProps;
class ListControlPromptProps {
}
exports.ListControlPromptProps = ListControlPromptProps;
class ListControlAPLProps {
}
exports.ListControlAPLProps = ListControlAPLProps;
class ListControlState {
    constructor() {
        /**
         * Tracks whether the value is confirmed by the user, if confirmationRequired is set to true.
         */
        this.isValueConfirmed = false;
    }
}
exports.ListControlState = ListControlState;
/**
 * Obtains a value of a specific Slot Type using list presentation (voice and visual)
 *
 */
class ListControl extends Control_1.Control {
    constructor(props) {
        super(props.id);
        this.state = new ListControlState();
        if (props.slotType === AmazonBuiltInSlotType_1.AmazonBuiltInSlotType.SEARCH_QUERY) {
            throw new Error('AMAZON.SearchQuery cannot be used with ListControl due to the special rules regarding its use. '
                + 'Specifically, utterances that include SearchQuery must have a carrier phrase and not be comprised entirely of slot references. '
                + 'Use a custom intent to manage SearchQuery slots or create a regular slot for use with ListControl.');
        }
        this.rawProps = props;
        this.props = ListControl.mergeWithDefaultProps(props);
    }
    static mergeWithDefaultProps(props) {
        const defaults = {
            id: 'dummy',
            slotType: 'dummy',
            required: true,
            validation: [],
            pageSize: 3,
            listItemIDs: [],
            confirmationRequired: false,
            interactionModel: {
                actions: {
                    set: [Strings_1.Strings.Action.Set, 'select'],
                    change: [Strings_1.Strings.Action.Change],
                },
                targets: ['choice', Strings_1.Strings.Target.It]
            },
            prompts: {
                confirmValue: (act) => i18next_1.default.t('LIST_CONTROL_DEFAULT_PROMPT_CONFIRM_VALUE', { value: act.payload.value }),
                valueAffirmed: i18next_1.default.t('LIST_CONTROL_DEFAULT_PROMPT_VALUE_AFFIRMED'),
                valueDisaffirmed: i18next_1.default.t('LIST_CONTROL_DEFAULT_PROMPT_VALUE_DISAFFIRMED'),
                valueSet: (act) => i18next_1.default.t('LIST_CONTROL_DEFAULT_PROMPT_VALUE_SET', { value: act.payload.value }),
                valueChanged: (act) => i18next_1.default.t('LIST_CONTROL_DEFAULT_PROMPT_VALUE_CHANGED', { value: act.payload.value }),
                invalidValue: (act) => {
                    if (act.payload.renderedReason !== undefined) {
                        return i18next_1.default.t('LIST_CONTROL_DEFAULT_PROMPT_INVALID_VALUE_WITH_REASON', { value: act.payload.value, reason: act.payload.renderedReason });
                    }
                    return i18next_1.default.t('LIST_CONTROL_DEFAULT_PROMPT_GENERAL_INVALID_VALUE');
                },
                unusableInputValue: (act) => i18next_1.default.t('LIST_CONTROL_DEFAULT_PROMPT_UNUSABLE_INPUT_VALUE'),
                requestValue: (act) => i18next_1.default.t('LIST_CONTROL_DEFAULT_PROMPT_REQUEST_VALUE', { suggestions: ListFormat_1.ListFormatting.format(act.payload.choicesFromActivePage) }),
                requestChangedValue: (act) => i18next_1.default.t('LIST_CONTROL_DEFAULT_PROMPT_REQUEST_CHANGED_VALUE', { suggestions: ListFormat_1.ListFormatting.format(act.payload.choicesFromActivePage) }),
            },
            reprompts: {
                confirmValue: (act) => i18next_1.default.t('LIST_CONTROL_DEFAULT_REPROMPT_CONFIRM_VALUE', { value: act.payload.value }),
                valueAffirmed: i18next_1.default.t('LIST_CONTROL_DEFAULT_REPROMPT_VALUE_AFFIRMED'),
                valueDisaffirmed: i18next_1.default.t('LIST_CONTROL_DEFAULT_REPROMPT_VALUE_DISAFFIRMED'),
                valueSet: (act) => i18next_1.default.t('LIST_CONTROL_DEFAULT_REPROMPT_VALUE_SET', { value: act.payload.value }),
                valueChanged: (act) => i18next_1.default.t('LIST_CONTROL_DEFAULT_REPROMPT_VALUE_CHANGED', { value: act.payload.value }),
                invalidValue: (act) => {
                    if (act.payload.renderedReason !== undefined) {
                        return i18next_1.default.t('LIST_CONTROL_DEFAULT_REPROMPT_INVALID_VALUE_WITH_REASON', { value: act.payload.value, reason: act.payload.renderedReason });
                    }
                    return i18next_1.default.t('LIST_CONTROL_DEFAULT_PROMPT_GENERAL_INVALID_VALUE');
                },
                unusableInputValue: (act) => i18next_1.default.t('LIST_CONTROL_DEFAULT_REPROMPT_UNUSABLE_INPUT_VALUE'),
                requestValue: (act) => i18next_1.default.t('LIST_CONTROL_DEFAULT_REPROMPT_REQUEST_VALUE', { suggestions: ListFormat_1.ListFormatting.format(act.payload.choicesFromActivePage) }),
                requestChangedValue: (act) => i18next_1.default.t('LIST_CONTROL_DEFAULT_REPROMPT_REQUEST_CHANGED_VALUE', { suggestions: ListFormat_1.ListFormatting.format(act.payload.choicesFromActivePage) }),
            },
            apl: {
                enabled: true,
                requestAPLDocument: APL_1.generateTextListDocumentForListControl()
            }
        };
        return lodash_1.default.merge(defaults, props);
    }
    canHandle(input) {
        return this.isSetWithValue(input)
            || this.isChangeWithValue(input)
            || this.isSetWithoutValue(input)
            || this.isChangeWithoutValue(input)
            || this.isBareValue(input)
            || this.isConfirmationAffirmed(input)
            || this.isConfirmationDisAffirmed(input)
            || this.isOrdinalScreenEvent(input)
            || this.isOrdinalSelection(input);
    }
    async handle(input, resultBuilder) {
        if (this.handleFunc === undefined) {
            log.error('ListControl: handle called but no clause matched.  are canHandle/handle out of sync?');
            const intent = input.request.intent;
            throw new Error(`${intent.name} can not be handled by ${this.constructor.name}.`);
        }
        this.handleFunc(input, resultBuilder);
    }
    /**
     * Test if the input is an implicit or explicit set-action with a value provided.
     *
     * @param input
     */
    isSetWithValue(input) {
        try {
            Predicates_1.okIf(InputUtil_1.InputUtil.isIntent(input, SingleValueControlIntent_1.SingleValueControlIntent.intentName(this.props.slotType)));
            const { feedback, action, target, valueStr, valueType } = SingleValueControlIntent_1.unpackSingleValueControlIntent(input.request.intent);
            Predicates_1.okIf(InputUtil_1.InputUtil.targetIsMatchOrUndefined(target, this.props.interactionModel.targets));
            Predicates_1.okIf(InputUtil_1.InputUtil.valueTypeMatch(valueType, this.props.slotType));
            Predicates_1.okIf(InputUtil_1.InputUtil.valueStrDefined(valueStr));
            Predicates_1.okIf(InputUtil_1.InputUtil.feedbackIsMatchOrUndefined(feedback, [Strings_1.Strings.Feedback.Affirm, Strings_1.Strings.Feedback.Disaffirm]));
            Predicates_1.okIf(InputUtil_1.InputUtil.actionIsMatch(action, this.props.interactionModel.actions.set));
            this.handleFunc = this.handleSetWithValue;
            return true;
        }
        catch (e) {
            return Predicates_1.falseIfGuardFailed(e);
        }
    }
    handleSetWithValue(input, resultBuilder) {
        const { valueStr, erMatch } = InputUtil_1.InputUtil.getValueResolution(input);
        this.setValue(valueStr, erMatch);
        this.validateAndAddActs(input, resultBuilder, Strings_1.Strings.Action.Set);
        return;
    }
    /**
     * Test if the input is an implicit or explicit set-action with no value
     *
     * @param input
     */
    isSetWithoutValue(input) {
        try {
            Predicates_1.okIf(InputUtil_1.InputUtil.isIntent(input, GeneralControlIntent_1.GeneralControlIntent.name));
            const { feedback, action, target } = GeneralControlIntent_1.unpackGeneralControlIntent(input.request.intent);
            Predicates_1.okIf(InputUtil_1.InputUtil.targetIsMatchOrUndefined(target, this.props.interactionModel.targets));
            Predicates_1.okIf(InputUtil_1.InputUtil.feedbackIsMatchOrUndefined(feedback, [Strings_1.Strings.Feedback.Affirm, Strings_1.Strings.Feedback.Disaffirm]));
            Predicates_1.okIf(InputUtil_1.InputUtil.actionIsMatch(action, this.props.interactionModel.actions.set));
            this.handleFunc = this.handleSetWithoutValue;
            return true;
        }
        catch (e) {
            return Predicates_1.falseIfGuardFailed(e);
        }
    }
    handleSetWithoutValue(input, resultBuilder) {
        this.askElicitationQuestion(Strings_1.Strings.Action.Set, input, resultBuilder);
        return;
    }
    /**
     * Test if the input is a valid change-action with a value provided.
     *
     * @param input
     */
    isChangeWithValue(input) {
        try {
            Predicates_1.okIf(InputUtil_1.InputUtil.isIntent(input, SingleValueControlIntent_1.SingleValueControlIntent.intentName(this.props.slotType)));
            const { feedback, action, target, valueStr, valueType } = SingleValueControlIntent_1.unpackSingleValueControlIntent(input.request.intent);
            Predicates_1.okIf(InputUtil_1.InputUtil.targetIsMatchOrUndefined(target, this.props.interactionModel.targets));
            Predicates_1.okIf(InputUtil_1.InputUtil.valueTypeMatch(valueType, this.props.slotType));
            Predicates_1.okIf(InputUtil_1.InputUtil.valueStrDefined(valueStr));
            Predicates_1.okIf(InputUtil_1.InputUtil.feedbackIsMatchOrUndefined(feedback, [Strings_1.Strings.Feedback.Affirm, Strings_1.Strings.Feedback.Disaffirm]));
            Predicates_1.okIf(InputUtil_1.InputUtil.actionIsMatch(action, this.props.interactionModel.actions.change));
            this.handleFunc = this.handleChangeWithValue;
            return true;
        }
        catch (e) {
            return Predicates_1.falseIfGuardFailed(e);
        }
    }
    handleChangeWithValue(input, resultBuilder) {
        const { valueStr, erMatch } = InputUtil_1.InputUtil.getValueResolution(input);
        this.setValue(valueStr, erMatch);
        this.validateAndAddActs(input, resultBuilder, this.state.value !== undefined ? Strings_1.Strings.Action.Change : Strings_1.Strings.Action.Set);
        return;
    }
    /**
     * Test if the input is a valid change-action without a value provided.
     *
     * @param input
     */
    isChangeWithoutValue(input) {
        try {
            Predicates_1.okIf(InputUtil_1.InputUtil.isIntent(input, GeneralControlIntent_1.GeneralControlIntent.name));
            const { feedback, action, target } = GeneralControlIntent_1.unpackGeneralControlIntent(input.request.intent);
            Predicates_1.okIf(InputUtil_1.InputUtil.targetIsMatchOrUndefined(target, this.props.interactionModel.targets));
            Predicates_1.okIf(InputUtil_1.InputUtil.feedbackIsMatchOrUndefined(feedback, [Strings_1.Strings.Feedback.Affirm, Strings_1.Strings.Feedback.Disaffirm]));
            Predicates_1.okIf(InputUtil_1.InputUtil.actionIsMatch(action, this.props.interactionModel.actions.change));
            this.handleFunc = this.handleChangeWithoutValue;
            return true;
        }
        catch (e) {
            return Predicates_1.falseIfGuardFailed(e);
        }
    }
    handleChangeWithoutValue(input, resultBuilder) {
        this.askElicitationQuestion(Strings_1.Strings.Action.Change, input, resultBuilder);
        return;
    }
    /**
     * Test if the input is a SingleValueControlIntent with just a slotValue provided.
     * If we aren't asking a question it is assumed the user meant 'set value'.
     * @param input
     */
    isBareValue(input) {
        try {
            Predicates_1.okIf(InputUtil_1.InputUtil.isIntent(input, SingleValueControlIntent_1.SingleValueControlIntent.intentName(this.props.slotType)));
            const { feedback, action, target, valueStr, valueType } = SingleValueControlIntent_1.unpackSingleValueControlIntent(input.request.intent);
            Predicates_1.okIf(InputUtil_1.InputUtil.feedbackIsUndefined(feedback));
            Predicates_1.okIf(InputUtil_1.InputUtil.actionIsUndefined(action));
            Predicates_1.okIf(InputUtil_1.InputUtil.targetIsMatchOrUndefined(target, this.props.interactionModel.targets));
            Predicates_1.okIf(InputUtil_1.InputUtil.valueStrDefined(valueStr));
            Predicates_1.okIf(InputUtil_1.InputUtil.valueTypeMatch(valueType, this.props.slotType));
            this.handleFunc = this.handleBareValue;
            return true;
        }
        catch (e) {
            return Predicates_1.falseIfGuardFailed(e);
        }
    }
    handleBareValue(input, resultBuilder) {
        var _a;
        const { valueStr, erMatch } = InputUtil_1.InputUtil.getValueResolution(input);
        this.setValue(valueStr, erMatch);
        this.validateAndAddActs(input, resultBuilder, (_a = this.state.elicitationAction) !== null && _a !== void 0 ? _a : Strings_1.Strings.Action.Set);
        return;
    }
    isConfirmationAffirmed(input) {
        try {
            Predicates_1.okIf(InputUtil_1.InputUtil.isBareYes(input));
            Predicates_1.okIf(this.state.lastInitiativeAct === 'ConfirmValueAct');
            this.handleFunc = this.handleConfirmationAffirmed;
            return true;
        }
        catch (e) {
            return Predicates_1.falseIfGuardFailed(e);
        }
    }
    handleConfirmationAffirmed(input, resultBuilder) {
        const validationResult = this.validate(input);
        if (validationResult !== true) {
            resultBuilder.addAct(new ContentActs_1.InvalidValueAct(this, {
                value: this.state.value,
                reasonCode: validationResult.reasonCode,
                renderedReason: validationResult.renderedReason
            }));
            this.askElicitationQuestion(Strings_1.Strings.Action.Change, input, resultBuilder);
        }
        else {
            this.state.isValueConfirmed = true;
            resultBuilder.addAct(new ContentActs_1.ValueConfirmedAct(this, { value: this.state.value }));
            if (this.state.elicitationAction === Strings_1.Strings.Action.Change) {
                if (this.state.previousValue !== undefined) {
                    resultBuilder.addAct(new ContentActs_1.ValueChangedAct(this, { previousValue: this.state.previousValue, value: this.state.value }));
                }
                else {
                    throw new Error('ValueChangedAct should only be used if there is an actual previous value');
                }
            }
            else {
                resultBuilder.addAct(new ContentActs_1.ValueSetAct(this, { value: this.state.value }));
            }
        }
    }
    isConfirmationDisAffirmed(input) {
        try {
            Predicates_1.okIf(InputUtil_1.InputUtil.isBareNo(input));
            Predicates_1.okIf(this.state.lastInitiativeAct === 'ConfirmValueAct');
            this.handleFunc = this.handleConfirmationDisAffirmed;
            return true;
        }
        catch (e) {
            return Predicates_1.falseIfGuardFailed(e);
        }
    }
    handleConfirmationDisAffirmed(input, resultBuilder) {
        this.state.isValueConfirmed = false;
        resultBuilder.addAct(new ContentActs_1.ValueDisconfirmedAct(this, { value: this.state.value }));
        const allChoices = this.getChoicesList(input);
        if (allChoices === null) {
            throw new Error('ListControl.listItemIDs is null');
        }
        const choicesFromActivePage = this.getChoicesFromActivePage(allChoices);
        resultBuilder.addAct(new InitiativeActs_1.RequestValueByListAct(this, { choicesFromActivePage, allChoices }));
    }
    isOrdinalScreenEvent(input) {
        try {
            Predicates_1.okIf(InputUtil_1.InputUtil.isAPLUserEventWithMatchingControlId(input, this.id));
            this.handleFunc = this.handleOrdinalScreenEvent;
            return true;
        }
        catch (e) {
            return Predicates_1.falseIfGuardFailed(e);
        }
    }
    handleOrdinalScreenEvent(input, resultBuilder) {
        const onScreenChoices = this.getChoicesList(input);
        if (onScreenChoices === null) {
            throw new Predicates_1.StateConsistencyError('OrdinalScreenEvent received but no known list values.');
        }
        const ordinal = input.request.arguments[1];
        if (ordinal < 0 || ordinal > onScreenChoices.length) {
            throw new Predicates_1.StateConsistencyError(`APL Ordinal out of range. ordinal=${ordinal} valueList=${onScreenChoices}`);
        }
        const value = onScreenChoices[ordinal - 1];
        this.setValue(value, true);
        // feedback
        resultBuilder.addAct(new ContentActs_1.ValueSetAct(this, { value }));
        return;
    }
    isOrdinalSelection(input) {
        try {
            Predicates_1.okIf(InputUtil_1.InputUtil.isIntent(input, OrdinalControlIntent_1.OrdinalControlIntent.name));
            const { feedback, action, target, 'AMAZON.Ordinal': value } = OrdinalControlIntent_1.unpackOrdinalControlIntent(input.request.intent);
            Predicates_1.okIf(InputUtil_1.InputUtil.feedbackIsMatchOrUndefined(feedback, [Strings_1.Strings.Feedback.Affirm, Strings_1.Strings.Feedback.Disaffirm]));
            Predicates_1.okIf(InputUtil_1.InputUtil.actionIsMatchOrUndefined(action, this.props.interactionModel.actions.set));
            Predicates_1.okIf(InputUtil_1.InputUtil.targetIsMatchOrUndefined(target, this.props.interactionModel.targets));
            Predicates_1.okIf(InputUtil_1.InputUtil.valueStrDefined(value));
            this.handleFunc = this.handleOrdinalSelection;
            return true;
        }
        catch (e) {
            return Predicates_1.falseIfGuardFailed(e);
        }
    }
    handleOrdinalSelection(input, resultBuilder) {
        const allChoices = this.getChoicesList(input);
        const spokenChoices = this.getChoicesFromActivePage(allChoices);
        const { 'AMAZON.Ordinal': valueStr } = OrdinalControlIntent_1.unpackOrdinalControlIntent(input.request.intent);
        const value = valueStr !== undefined ? Number.parseInt(valueStr, 10) : undefined;
        if (value !== undefined && value <= spokenChoices.length) {
            this.setValue(spokenChoices[value - 1], true);
            resultBuilder.addAct(new ContentActs_1.ValueSetAct(this, { value: this.state.value }));
            return;
        }
        resultBuilder.addAct(new ContentActs_1.UnusableInputValueAct(this, { value, reasonCode: 'OrdinalOutOfRange', renderedReason: 'I don\'t know which you mean.' }));
        return;
    }
    /**
     * Directly set the (new) value for the control
     *
     * After setting the value, it is usual to call
     * ```ts
     * if (control.wantsToDiscussValue()){
     *   control.discussValue()
     * }
     * ```
     * @param value
     */
    setValue(value, erMatch) {
        this.state.previousValue = this.state.value;
        this.state.value = value;
        this.state.erMatch = erMatch;
        this.state.isValueConfirmed = false;
    }
    clear() {
        this.state.value = undefined;
        this.state.elicitationAction = undefined;
        this.state.spokenItemsPageIndex = undefined;
        this.state.previousValue = undefined;
        this.state.isValueConfirmed = false;
        this.state.lastInitiativeAct = undefined;
    }
    canTakeInitiative(input) {
        return this.wantsToConfirmValue(input)
            || this.wantsToFixInvalidValue(input)
            || this.wantsToElicitValue(input);
    }
    async takeInitiative(input, resultBuilder) {
        if (this.wantsToElicitValue(input)) {
            this.askElicitationQuestion(Strings_1.Strings.Action.Set, input, resultBuilder);
        }
        else if (this.wantsToFixInvalidValue(input)) {
            this.validateAndAddActs(input, resultBuilder, Strings_1.Strings.Action.Change);
        }
        else if (this.wantsToConfirmValue(input)) {
            this.confirmValue(input, resultBuilder);
        }
        return;
    }
    wantsToConfirmValue(input) {
        return this.state.value !== undefined && this.state.isValueConfirmed === false && this.evaluateBooleanProp(this.props.confirmationRequired, input);
    }
    confirmValue(input, resultBuilder) {
        this.state.lastInitiativeAct = 'ConfirmValueAct';
        resultBuilder.addAct(new InitiativeActs_1.ConfirmValueAct(this, { value: this.state.value }));
    }
    wantsToFixInvalidValue(input) {
        return this.state.value !== undefined && this.validate(input) !== true;
    }
    wantsToElicitValue(input) {
        return this.state.value === undefined && this.evaluateBooleanProp(this.props.required, input);
    }
    validateAndAddActs(input, resultBuilder, elicitationAction) {
        this.state.elicitationAction = elicitationAction;
        if (this.wantsToConfirmValue(input)) {
            this.confirmValue(input, resultBuilder);
            return;
        }
        const validationResult = this.validate(input);
        if (validationResult === true) {
            if (elicitationAction === Strings_1.Strings.Action.Change) {
                // if elicitationAction == 'change', then the previousValue must be defined.
                if (this.state.previousValue !== undefined) {
                    resultBuilder.addAct(new ContentActs_1.ValueChangedAct(this, { previousValue: this.state.previousValue, value: this.state.value }));
                }
                else {
                    throw new Error('ValueChangedAct should only be used if there is an actual previous value');
                }
            }
            else {
                resultBuilder.addAct(new ContentActs_1.ValueSetAct(this, { value: this.state.value }));
            }
        }
        else {
            // feedback
            resultBuilder.addAct(new ContentActs_1.InvalidValueAct(this, {
                value: this.state.value,
                reasonCode: validationResult.reasonCode,
                renderedReason: validationResult.renderedReason
            }));
            this.askElicitationQuestion(elicitationAction, input, resultBuilder);
        }
        return;
    }
    validate(input) {
        const listOfValidationFunc = typeof (this.props.validation) === 'function' ? [this.props.validation] : this.props.validation;
        for (const validationFunction of listOfValidationFunc) {
            const validationResult = validationFunction(this.state, input);
            if (validationResult !== true) {
                log.debug(`ListControl.validate(): validation failed. Reason: ${JSON.stringify(validationResult, null, 2)}.`);
                return validationResult;
            }
        }
        return true;
    }
    askElicitationQuestion(elicitationAction, input, resultBuilder) {
        this.state.elicitationAction = elicitationAction;
        const allChoices = this.getChoicesList(input);
        if (allChoices === null) {
            throw new Error('ListControl.listItemIDs is null');
        }
        const choicesFromActivePage = this.getChoicesFromActivePage(allChoices);
        switch (elicitationAction) {
            case Strings_1.Strings.Action.Set:
                resultBuilder.addAct(new InitiativeActs_1.RequestValueByListAct(this, { choicesFromActivePage, allChoices }));
                return;
            case Strings_1.Strings.Action.Change:
                resultBuilder.addAct(new InitiativeActs_1.RequestChangedValueByListAct(this, { currentValue: this.state.value, choicesFromActivePage, allChoices }));
                return;
            default:
                throw new Error(`Unhandled. Unknown elicitationAction: ${elicitationAction}`);
        }
    }
    stringifyStateForDiagram() {
        var _a;
        let text = (_a = this.state.value) !== null && _a !== void 0 ? _a : '<none>';
        if (this.state.elicitationAction !== undefined) {
            text += `[eliciting, ${this.state.elicitationAction}]`;
        }
        return text;
    }
    getChoicesList(input) {
        const slotIds = (typeof this.props.listItemIDs === 'function')
            ? this.props.listItemIDs.call(this, input)
            : this.props.listItemIDs;
        return slotIds;
    }
    getChoicesFromActivePage(allChoices) {
        const start = this.getPageIndex();
        const end = start + this.props.pageSize;
        return allChoices.slice(start, end);
    }
    getPageIndex() {
        if (this.state.spokenItemsPageIndex === undefined) {
            this.state.spokenItemsPageIndex = 0;
        }
        return this.state.spokenItemsPageIndex;
    }
    renderAct(act, input, builder) {
        if (act instanceof InitiativeActs_1.RequestValueByListAct || act instanceof InitiativeActs_1.RequestChangedValueByListAct) {
            const prompt = act instanceof InitiativeActs_1.RequestValueByListAct
                ? this.evaluatePromptProp(act, this.props.prompts.requestValue, input)
                : this.evaluatePromptProp(act, this.props.prompts.requestChangedValue, input);
            const reprompt = act instanceof InitiativeActs_1.RequestValueByListAct
                ? this.evaluatePromptProp(act, this.props.reprompts.requestValue, input)
                : this.evaluatePromptProp(act, this.props.reprompts.requestChangedValue, input);
            builder.addPromptFragment(this.evaluatePromptProp(act, prompt, input));
            builder.addRepromptFragment(this.evaluatePromptProp(act, reprompt, input));
            if (this.evaluateBooleanProp(this.props.apl.enabled, input)) {
                const itemsArray = [];
                for (const choice of act.payload.allChoices) {
                    itemsArray.push({
                        primaryText: choice
                    });
                }
                // If APL is defined in act & users' device support APL
                if (ask_sdk_core_1.getSupportedInterfaces(input.handlerInput.requestEnvelope)['Alexa.Presentation.APL']) {
                    const aplDataSource = {
                        textListData: {
                            controlId: this.id,
                            headerTitle: i18next_1.default.t('LIST_CONTROL_DEFAULT_APL_HEADER_TITLE'),
                            items: itemsArray,
                        }
                    };
                    // TODO: apl merging / combination strategy
                    builder.addAPLRenderDocumentDirective('Token', this.props.apl.requestAPLDocument, aplDataSource);
                }
            }
        }
        else if (act instanceof ContentActs_1.UnusableInputValueAct) {
            builder.addPromptFragment(this.evaluatePromptProp(act, this.props.prompts.unusableInputValue, input));
            builder.addRepromptFragment(this.evaluatePromptProp(act, this.props.reprompts.unusableInputValue, input));
        }
        else if (act instanceof ContentActs_1.InvalidValueAct) {
            builder.addPromptFragment(this.evaluatePromptProp(act, this.props.prompts.invalidValue, input));
            builder.addRepromptFragment(this.evaluatePromptProp(act, this.props.reprompts.invalidValue, input));
        }
        else if (act instanceof ContentActs_1.ValueSetAct) {
            builder.addPromptFragment(this.evaluatePromptProp(act, this.props.prompts.valueSet, input));
            builder.addRepromptFragment(this.evaluatePromptProp(act, this.props.reprompts.valueSet, input));
        }
        else if (act instanceof ContentActs_1.ValueChangedAct) {
            builder.addPromptFragment(this.evaluatePromptProp(act, this.props.prompts.valueChanged, input));
            builder.addRepromptFragment(this.evaluatePromptProp(act, this.props.reprompts.valueChanged, input));
        }
        else if (act instanceof InitiativeActs_1.ConfirmValueAct) {
            builder.addPromptFragment(this.evaluatePromptProp(act, this.props.prompts.confirmValue, input));
            builder.addRepromptFragment(this.evaluatePromptProp(act, this.props.reprompts.confirmValue, input));
        }
        else if (act instanceof ContentActs_1.ValueConfirmedAct) {
            builder.addPromptFragment(this.evaluatePromptProp(act, this.props.prompts.valueAffirmed, input));
            builder.addRepromptFragment(this.evaluatePromptProp(act, this.props.reprompts.valueAffirmed, input));
        }
        else if (act instanceof ContentActs_1.ValueDisconfirmedAct) {
            builder.addPromptFragment(this.evaluatePromptProp(act, this.props.prompts.valueDisaffirmed, input));
            builder.addRepromptFragment(this.evaluatePromptProp(act, this.props.reprompts.valueDisaffirmed, input));
        }
        else {
            this.throwUnhandledActError(act);
        }
    }
    updateInteractionModel(generator, imData) {
        generator.addControlIntent(new GeneralControlIntent_1.GeneralControlIntent(), imData);
        generator.addControlIntent(new SingleValueControlIntent_1.SingleValueControlIntent(this.props.slotType), imData);
        generator.addControlIntent(new OrdinalControlIntent_1.OrdinalControlIntent(), imData);
        generator.addYesAndNoIntents();
        if (this.props.interactionModel.targets.includes('choice')) {
            generator.addValuesToSlotType(ModelTypes_1.SharedSlotType.TARGET, i18next_1.default.t('LIST_CONTROL_DEFAULT_SLOT_VALUES_TARGET_CHOICE', { returnObjects: true }));
        }
        if (this.props.interactionModel.actions.set.includes('select')) {
            generator.addValuesToSlotType(ModelTypes_1.SharedSlotType.ACTION, i18next_1.default.t('LIST_CONTROL_DEFAULT_SLOT_VALUES_ACTION_SELECT', { returnObjects: true }));
        }
    }
    getTargetIds() {
        return this.props.interactionModel.targets;
    }
}
exports.ListControl = ListControl;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiTGlzdENvbnRyb2wuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9zcmMvY29tbW9uQ29udHJvbHMvbGlzdENvbnRyb2wvTGlzdENvbnRyb2wudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBOzs7Ozs7Ozs7OztHQVdHOzs7O0FBRUgsK0NBQXNEO0FBRXRELDREQUF1QjtBQUN2Qiw4REFBOEI7QUFDOUIscURBQXVEO0FBQ3ZELG9EQUE2RTtBQUk3RSwrRUFBNEU7QUFDNUUsNkVBQXNHO0FBQ3RHLDZFQUFzRztBQUN0RyxxRkFBa0g7QUFFbEgsNEVBQXdGO0FBQ3hGLHNEQUF1RDtBQUN2RCxpREFBOEM7QUFFOUMsOERBQTZKO0FBQzdKLG9FQUF1SDtBQUl2SCxxREFBa0Q7QUFDbEQsdURBQXlGO0FBQ3pGLCtCQUE0RTtBQUc1RSxNQUFNLEdBQUcsR0FBRyxJQUFJLGVBQU0sQ0FBQyw0QkFBNEIsQ0FBQyxDQUFDO0FBMkZyRCxNQUFhLGdDQUFnQztDQXdDNUM7QUF4Q0QsNEVBd0NDO0FBRUQsTUFBYSxzQkFBc0I7Q0FVbEM7QUFWRCx3REFVQztBQUVELE1BQWEsbUJBQW1CO0NBYS9CO0FBYkQsa0RBYUM7QUFFRCxNQUFhLGdCQUFnQjtJQUE3QjtRQXNCSTs7V0FFRztRQUNILHFCQUFnQixHQUFZLEtBQUssQ0FBQztJQVd0QyxDQUFDO0NBQUE7QUFwQ0QsNENBb0NDO0FBRUQ7OztHQUdHO0FBRUgsTUFBYSxXQUFZLFNBQVEsaUJBQU87SUFNcEMsWUFBWSxLQUF1QjtRQUMvQixLQUFLLENBQUMsS0FBSyxDQUFDLEVBQUUsQ0FBQyxDQUFDO1FBSGIsVUFBSyxHQUFxQixJQUFJLGdCQUFnQixFQUFFLENBQUM7UUFLcEQsSUFBSSxLQUFLLENBQUMsUUFBUSxLQUFLLDZDQUFxQixDQUFDLFlBQVksRUFBQztZQUN0RCxNQUFNLElBQUksS0FBSyxDQUFDLGlHQUFpRztrQkFDOUcsaUlBQWlJO2tCQUNqSSxvR0FBb0csQ0FBQyxDQUFD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RyxDQUFDLFFBQVEsQ0FBQyxRQUFRLENBQUMsRUFBRTtZQUM1RCxTQUFTLENBQUMsbUJBQW1CLENBQUMsMkJBQWMsQ0FBQyxNQUFNLEVBQUUsaUJBQU8sQ0FBQyxDQUFDLENBQUMsZ0RBQWdELEVBQUUsRUFBRSxhQUFhLEVBQUUsSUFBSSxFQUFFLENBQUMsQ0FBQyxDQUFDO1NBQzlJO0lBQ0wsQ0FBQztJQUVELFlBQVk7UUFDUixPQUFPLElBQUksQ0FBQyxLQUFLLENBQUMsZ0JBQWdCLENBQUMsT0FBTyxDQUFDO0lBQy9DLENBQUM7Q0FDSjtBQXRtQkQsa0NBc21CQyIsInNvdXJjZXNDb250ZW50IjpbIi8qXG4gKiBDb3B5cmlnaHQgMjAxOSBBbWF6b24uY29tLCBJbmMuIG9yIGl0cyBhZmZpbGlhdGVzLiBBbGwgUmlnaHRzIFJlc2VydmVkLlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKS5cbiAqIFlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIEEgY29weSBvZiB0aGUgTGljZW5zZSBpcyBsb2NhdGVkIGF0XG4gKiAgICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIG9yIGluIHRoZSBcImxpY2Vuc2VcIiBmaWxlIGFjY29tcGFueWluZyB0aGlzIGZpbGUuIFRoaXMgZmlsZSBpcyBkaXN0cmlidXRlZFxuICogb24gYW4gXCJBUyBJU1wiIEJBU0lTLCBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyXG4gKiBleHByZXNzIG9yIGltcGxpZWQuIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZ1xuICogcGVybWlzc2lvbnMgYW5kIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG5cbmltcG9ydCB7IGdldFN1cHBvcnRlZEludGVyZmFjZXMgfSBmcm9tICdhc2stc2RrLWNvcmUnO1xuaW1wb3J0IHsgSW50ZW50LCBJbnRlbnRSZXF1ZXN0LCBpbnRlcmZhY2VzIH0gZnJvbSBcImFzay1zZGstbW9kZWxcIjtcbmltcG9ydCBfIGZyb20gXCJsb2Rhc2hcIjtcbmltcG9ydCBpMThuZXh0IGZyb20gJ2kxOG5leHQnO1xuaW1wb3J0IHsgU3RyaW5ncyBhcyAkIH0gZnJvbSBcIi4uLy4uL2NvbnN0YW50cy9TdHJpbmdzXCI7XG5pbXBvcnQgeyBDb250cm9sLCBDb250cm9sUHJvcHMsIENvbnRyb2xTdGF0ZSB9IGZyb20gJy4uLy4uL2NvbnRyb2xzL0NvbnRyb2wnO1xuaW1wb3J0IHsgQ29udHJvbElucHV0IH0gZnJvbSAnLi4vLi4vY29udHJvbHMvQ29udHJvbElucHV0JztcbmltcG9ydCB7IENvbnRyb2xSZXN1bHRCdWlsZGVyIH0gZnJvbSAnLi4vLi4vY29udHJvbHMvQ29udHJvbFJlc3VsdCc7XG5pbXBvcnQgeyBJbnRlcmFjdGlvbk1vZGVsQ29udHJpYnV0b3IgfSBmcm9tICcuLi8uLi9jb250cm9scy9taXhpbnMvSW50ZXJhY3Rpb25Nb2RlbENvbnRyaWJ1dG9yJztcbmltcG9ydCB7IEFtYXpvbkJ1aWx0SW5TbG90VHlwZSB9IGZyb20gJy4uLy4uL2ludGVudHMvQW1hem9uQnVpbHRJblNsb3RUeXBlJztcbmltcG9ydCB7IEdlbmVyYWxDb250cm9sSW50ZW50LCB1bnBhY2tHZW5lcmFsQ29udHJvbEludGVudCB9IGZyb20gJy4uLy4uL2ludGVudHMvR2VuZXJhbENvbnRyb2xJbnRlbnQnO1xuaW1wb3J0IHsgT3JkaW5hbENvbnRyb2xJbnRlbnQsIHVucGFja09yZGluYWxDb250cm9sSW50ZW50IH0gZnJvbSBcIi4uLy4uL2ludGVudHMvT3JkaW5hbENvbnRyb2xJbnRlbnRcIjtcbmltcG9ydCB7IFNpbmdsZVZhbHVlQ29udHJvbEludGVudCwgdW5wYWNrU2luZ2xlVmFsdWVDb250cm9sSW50ZW50IH0gZnJvbSAnLi4vLi4vaW50ZW50cy9TaW5nbGVWYWx1ZUNvbnRyb2xJbnRlbnQnO1xuaW1wb3J0IHsgQ29udHJvbEludGVyYWN0aW9uTW9kZWxHZW5lcmF0b3IgfSBmcm9tICcuLi8uLi9pbnRlcmFjdGlvbk1vZGVsR2VuZXJhdGlvbi9Db250cm9sSW50ZXJhY3Rpb25Nb2RlbEdlbmVyYXRvcic7XG5pbXBvcnQgeyBNb2RlbERhdGEsIFNoYXJlZFNsb3RUeXBlIH0gZnJvbSAnLi4vLi4vaW50ZXJhY3Rpb25Nb2RlbEdlbmVyYXRpb24vTW9kZWxUeXBlcyc7XG5pbXBvcnQgeyBMaXN0Rm9ybWF0dGluZyB9IGZyb20gJy4uLy4uL2ludGwvTGlzdEZvcm1hdCc7XG5pbXBvcnQgeyBMb2dnZXIgfSBmcm9tIFwiLi4vLi4vbG9nZ2luZy9Mb2dnZXJcIjtcbmltcG9ydCB7IENvbnRyb2xSZXNwb25zZUJ1aWxkZXIgfSBmcm9tICcuLi8uLi9yZXNwb25zZUdlbmVyYXRpb24vQ29udHJvbFJlc3BvbnNlQnVpbGRlcic7XG5pbXBvcnQgeyBJbnZhbGlkVmFsdWVBY3QsIFVudXNhYmxlSW5wdXRWYWx1ZUFjdCwgVmFsdWVDaGFuZ2VkQWN0LCBWYWx1ZVNldEFjdCwgVmFsdWVEaXNjb25maXJtZWRBY3QsIFZhbHVlQ29uZmlybWVkQWN0IH0gZnJvbSBcIi4uLy4uL3N5c3RlbUFjdHMvQ29udGVudEFjdHNcIjtcbmltcG9ydCB7IFJlcXVlc3RDaGFuZ2VkVmFsdWVCeUxpc3RBY3QsIFJlcXVlc3RWYWx1ZUJ5TGlzdEFjdCwgQ29uZmlybVZhbHVlQWN0IH0gZnJvbSBcIi4uLy4uL3N5c3RlbUFjdHMvSW5pdGlhdGl2ZUFjdHNcIjtcbmltcG9ydCB7IFN5c3RlbUFjdCB9IGZyb20gJy4uLy4uL3N5c3RlbUFjdHMvU3lzdGVtQWN0JztcbmltcG9ydCB7IFN0cmluZ09yTGlzdCB9IGZyb20gJy4uLy4uL3V0aWxzL0Jhc2ljVHlwZXMnO1xuaW1wb3J0IHsgRGVlcFJlcXVpcmVkIH0gZnJvbSAnLi4vLi4vdXRpbHMvRGVlcFJlcXVpcmVkJztcbmltcG9ydCB7IElucHV0VXRpbCB9IGZyb20gXCIuLi8uLi91dGlscy9JbnB1dFV0aWxcIjtcbmltcG9ydCB7IGZhbHNlSWZHdWFyZEZhaWxlZCwgb2tJZiwgU3RhdGVDb25zaXN0ZW5jeUVycm9yIH0gZnJvbSAnLi4vLi4vdXRpbHMvUHJlZGljYXRlcyc7XG5pbXBvcnQgeyBBUExMaXN0SXRlbSwgZ2VuZXJhdGVUZXh0TGlzdERvY3VtZW50Rm9yTGlzdENvbnRyb2wgfSBmcm9tICcuL0FQTCc7XG5pbXBvcnQgeyBWYWxpZGF0aW9uUmVzdWx0IH0gZnJvbSAnLi4vLi4vY29udHJvbHMvVmFsaWRhdGlvblJlc3VsdCc7XG5cbmNvbnN0IGxvZyA9IG5ldyBMb2dnZXIoJ0Fza1Nka0NvbnRyb2xzOkxpc3RDb250cm9sJyk7XG5cbmV4cG9ydCB0eXBlIFNsb3RWYWxpZGF0aW9uRnVuY3Rpb24gPSAoc3RhdGU6IExpc3RDb250cm9sU3RhdGUsIGlucHV0OiBDb250cm9sSW5wdXQpID0+IHRydWUgfCBWYWxpZGF0aW9uUmVzdWx0O1xuXG4vLyBUT0RPOiBzdXBwb3J0IFwid2hhdCBhcmUgbXkgY2hvaWNlc1wiXG5cbmV4cG9ydCBpbnRlcmZhY2UgTGlzdENvbnRyb2xQcm9wcyBleHRlbmRzIENvbnRyb2xQcm9wcyB7XG4gICAgaWQ6IHN0cmluZztcblxuXG4gICAgLyoqXG4gICAgICogVGhlIFNsb3RUeXBlIHRoYXQgdGhpcyBjb250cm9sIGlzIGNvbGxlY3RpbmcuXG4gICAgICpcbiAgICAgKiBUaGlzIGRlZmluZXMgdGhlIGNvbXBsZXRlIHNldCBvZiBjaG9pY2VzIHRoZSB1c2VyIGNhbiBjaG9vc2UgZnJvbSAocmVnYXJkbGVzcyBvZiB0aGUgY2hvaWNlcyBzYWlkIG9yIHNob3duIGR1cmluZyBlbGljaXRhdGlvbikuXG4gICAgICovXG4gICAgc2xvdFR5cGU6IHN0cmluZztcblxuICAgIC8qKlxuICAgICAqIERldGVybWluZXMgaWYgdGhlIHZhbHVlIGlzIHZhbGlkLlxuICAgICAqXG4gICAgICogRGVmYXVsdDogYHRydWVgLCBpLmUuIGFueSB2YWx1ZSBpcyB2YWxpZC5cbiAgICAgKlxuICAgICAqIFVzYWdlOlxuICAgICAqICAqIFZhbGlkYXRpb24gZnVuY3Rpb25zIHJldHVybiBlaXRoZXIgYHRydWVgIG9yIGFuIGBlcnJvckNvZGVgIHN0cmluZy4gIFRoZSBgZXJyb3JDb2RlYCBjYW5cbiAgICAgKiAgICBiZSBjb252ZXJ0ZWQgaW50byBhIHN1cmZhY2UgZm9ybSBkdXJpbmcgdGhlIHJlbmRlciBwaGFzZS5cbiAgICAgKi9cbiAgICB2YWxpZGF0aW9uPzogU2xvdFZhbGlkYXRpb25GdW5jdGlvbiB8IFNsb3RWYWxpZGF0aW9uRnVuY3Rpb25bXTtcblxuICAgIC8qKlxuICAgICAqIFRoZSBsaXN0IG9mIFNsb3RJZHMgZGVmaW5lZCBieSB0aGUgdXNlciBhcyBjaG9pY2VzIGZvciB0aGUgU2xvdFR5cGVzLlxuICAgICAqL1xuICAgIGxpc3RJdGVtSURzOiBzdHJpbmdbXSB8ICgoaW5wdXQ6IENvbnRyb2xJbnB1dCkgPT4gc3RyaW5nW10pO1xuXG4gICAgLyoqXG4gICAgICogVGhlIG51bWJlciBvZiBTbG90SWRzIHNwb2tlbiBieSBBbGV4YSBmcm9tIHRoZSBjb21wbGV0ZSBsaXN0SXRlbUlEcyBsaXN0LlxuICAgICAqL1xuICAgIHBhZ2VTaXplPzogbnVtYmVyO1xuXG4gICAgLyoqXG4gICAgICogV2hldGhlciB0aGUgQ29udHJvbCBzaG91bGQgZWxpY2l0IHRoZSB1c2VyIGZvciBhIHZhbHVlLlxuICAgICAqXG4gICAgICogQmVoYXZpb3I6XG4gICAgICogIC0gaWYgdHJ1ZSwgdGhlIENvbnRyb2wgd2lsbCBnZW5lcmF0ZSBhIHF1ZXN0aW9uIHdoZW4gZ2l2ZW4gdGhlIG9wcG9ydHVuaXR5LlxuICAgICAqL1xuICAgIHJlcXVpcmVkPzogYm9vbGVhbiB8ICgoaW5wdXQ6IENvbnRyb2xJbnB1dCkgPT4gYm9vbGVhbik7XG5cbiAgICAvKipcbiAgICAgKiBQcm9wcyB0byBjdXN0b21pemUgdGhlIHJlbGF0aW9uc2hpcCBiZXR3ZWVuIHRoZSBpbnRlcmFjdGlvbiBtb2RlbCBhbmQgdGhlIGNvbnRyb2wuXG4gICAgICovXG4gICAgaW50ZXJhY3Rpb25Nb2RlbD86IExpc3RDb250cm9sSW50ZXJhY3Rpb25Nb2RlbFByb3BzO1xuXG4gICAgLyoqXG4gICAgICogUHJvcHMgdG8gY3VzdG9taXplIHRoZSBwcm9tcHQtZnJhZ21lbnRzIGZvciB0aGUgc3lzdGVtIGFjdHMgcHJvZHVjZWQgYnkgdGhlIGNvbnRyb2wuXG4gICAgICovXG4gICAgcHJvbXB0cz86IExpc3RDb250cm9sUHJvbXB0UHJvcHM7XG5cbiAgICAvKipcbiAgICAgKiBQcm9wcyB0byBjdXN0b21pemUgdGhlIHJlcHJvbXB0LWZyYWdtZW50cyBmb3IgdGhlIHN5c3RlbSBhY3RzIHByb2R1Y2VkIGJ5IHRoZSBjb250cm9sLlxuICAgICAqL1xuICAgIHJlcHJvbXB0cz86IExpc3RDb250cm9sUHJvbXB0UHJvcHM7XG5cbiAgICAvKipcbiAgICAgKiBQcm9wcyB0byBjdXN0b21pemUgdGhlIEFQTCBwcm9kdWNlZFxuICAgICAqL1xuICAgIGFwbD86IExpc3RDb250cm9sQVBMUHJvcHM7XG5cbiAgICAvKipcbiAgICAgKiBXaGV0aGVyIHRoZSBDb250cm9sIGhhcyB0byBjb25maXJtIHRoZSB2YWx1ZSB3aGljaCB1c2VyIHByb3ZpZGVzLlxuICAgICAqIFxuICAgICAqIEJlaGF2aW9yOlxuICAgICAqICAtIGlmIHRydWUsIHRoZSBDb250cm9sIHdpbGwgZ2VuZXJhdGUgYSBjb25maXJtYXRpb24gcXVlc3Rpb24gd2hlbiBhIHZhbHVlIGlzIHByb3ZpZGVkLlxuICAgICAqL1xuICAgIGNvbmZpcm1hdGlvblJlcXVpcmVkPzogYm9vbGVhbiB8ICgoaW5wdXQ6IENvbnRyb2xJbnB1dCkgPT4gYm9vbGVhbik7XG59XG5cbi8qKlxuICogTWFwcGluZyBvZiBBY3Rpb24tU2xvdCB2YWx1ZXMgdG8gdGhlIGJlaGF2aW9ycyB0aGF0IHRoaXMgY29udHJvbCBzdXBwb3J0cy5cbiAqXG4gKiBEZWZhdWx0OlxuICogYGBgXG4gKiAgICB7XG4gKiAgICAgICBzZXQ6IFsnc2V0JywgJ3NlbGVjdCddLFxuICogICAgICAgY2hhbmdlOiBbJ2NoYW5nZSddLFxuICogICAgfVxuICogYGBgXG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgTGlzdENvbnRyb2xBY3Rpb25Qcm9wcyB7XG4gICAgc2V0Pzogc3RyaW5nW10sXG4gICAgY2hhbmdlPzogc3RyaW5nW11cbn1cblxuZXhwb3J0IGNsYXNzIExpc3RDb250cm9sSW50ZXJhY3Rpb25Nb2RlbFByb3BzIHtcbiAgICAvKipcbiAgICAgKiBUYXJnZXQtc2xvdC12YWx1ZXMgYXNzb2NpYXRlZCB3aXRoIHRoaXMgQ29udHJvbC5cbiAgICAgKlxuICAgICAqIFVzYWdlOlxuICAgICAqICAqIFRoaXMgYWxsb3dzIHVzZXJzIHRvIHJlZmVyIHRvIGEgY29udHJvbC5cbiAgICAgKiAgKiBBIGNvbnRyb2wgY2FuIGJlIGFzc29jaWF0ZWQgd2l0aCBtYW55IHRhcmdldC1zbG90LXZhbHVlcywgZWcgWydkYXRlJywgJ3N0YXJ0RGF0ZScsICdldmVudFN0YXJ0RGF0ZScsICd2YWNhdGlvblN0YXJ0J11cbiAgICAgKiAgKiBJdCBpcyBhIGdvb2QgaWRlYSB0byBhc3NvY2lhdGUgd2l0aCBnZW5lcmFsIHRhcmdldHMgKGUuZy4gZGF0ZSkgYW5kIHNwZWNpZmljIHRhcmdldHMgKGUuZy4gdmFjYXRpb25TdGFydCkgc28gdGhhdCB0aGVcbiAgICAgKiAgICB1c2VyIGNhbiBzYXkgZWl0aGVyIGdlbmVyYWwgb3Igc3BlY2lmaWMgdGhpbmdzLiAgZS5nLiAnY2hhbmdlIHRoZSBkYXRlIHRvIFR1ZXNkYXknLCBvciAnSSB3YW50IG15IHZhY2F0aW9uIHRvIHN0YXJ0IG9uIFR1ZXNkYXknLlxuICAgICAqICAqIFRoZSBhc3NvY2lhdGlvbiBkb2VzIG5vdCBoYXZlIHRvIGJlIGV4Y2x1c2l2ZSwgYW5kIGdlbmVyYWwgdGFyZ2V0IHNsb3QgdmFsdWVzIHdpbGwgb2Z0ZW4gYmUgYXNzb2NpYXRlZCB3aXRoIG1hbnkgY29udHJvbHMuXG4gICAgICogICAgSW4gc2l0dWF0aW9ucyB3aGVyZSB0aGVyZSBpcyBhbWJpZ3VpdHkgYWJvdXQgd2hhdCB0aGUgdXNlciBpcyByZWZlcnJpbmcgdG8sIHRoZSBwYXJlbnQgY29udHJvbHNcbiAgICAgKiAgICBtdXN0IHJlc29sdmUgdGhlIGNvbmZ1c2lvbi5cbiAgICAgKlxuICAgICAqL1xuICAgIHRhcmdldHM/OiBzdHJpbmdbXTtcblxuICAgIC8qKlxuICAgICAqIEFjdGlvbi1zbG90LXZhbHVlcyBhc3NvY2lhdGVkIHRvIHRoZSBhY3Rpb24tY2FwYWJpbGl0aWVzIG9mIHRoaXMgQ29udHJvbC5cbiAgICAgKlxuICAgICAqIERlZmF1bHQ6XG4gICAgICogYGBgdHNcbiAgICAgKiB7XG4gICAgICogICAgc2V0OiBbJ3NldCddXG4gICAgICogICAgY2hhbmdlOiBbJ2NoYW5nZSddLFxuICAgICAqIH1cbiAgICAgKiBgYGBcbiAgICAgKlxuICAgICAqIFVzYWdlOlxuICAgICAqICAqIFRoaXMgYWxsb3dzIHVzZXJzIHRvIHJlZmVyIHRvIGFuIGFjdGlvbiB1c2luZyBtb3JlIGRvbWFpbi1hcHByb3ByaWF0ZSB3b3Jkcy4gRm9yIGV4YW1wbGUsIGEgdXNlciBtaWdodFxuICAgICAqICAgIGxpa2UgdG8gc2F5ICdzaG93IHR3byBpdGVtcycgcmF0aGVyIHRoYXQgJ3NldCBpdGVtIGNvdW50IHRvIHR3bycuICBUbyBhY2hpZXZlIHRoaXMsIGluY2x1ZGUgdGhlXG4gICAgICogICAgc2xvdC12YWx1ZS1pZCAnc2hvdycgaW4gdGhlIGxpc3QgYXNzb2NpYXRlZCB3aXRoIHRoZSAnc2V0JyBjYXBhYmlsaXR5IGFuZCBlbnN1cmUgdGhlIGludGVyYWN0aW9uLW1vZGVsXG4gICAgICogICAgaW5jbHVkZXMgYW4gYWN0aW9uIHNsb3QgdmFsdWUgd2l0aCBpZD1zaG93IGFuZCBhcHByb3ByaWF0ZSBzeW5vbnltcy5cbiAgICAgKlxuICAgICAqIGBgYFxuICAgICAqIHtcbiAgICAgKiAgICAgc2V0OiBbJ3NldCcsICdzaG93JywgJ3NlbGVjdCddICAvLyBFYWNoIGVudHJ5IGlzIGFuIGFjdGlvbi1zbG90LXZhbHVlIHRoYXQgaXMgY29uc2lkZXJlZCBhIHN5bm9ueW0gdG8gJ3NldCcgZm9yIHRoaXMgY29udHJvbC5cbiAgICAgKiB9XG4gICAgICogYGBgXG4gICAgICovXG4gICAgYWN0aW9ucz86IExpc3RDb250cm9sQWN0aW9uUHJvcHM7XG59XG5cbmV4cG9ydCBjbGFzcyBMaXN0Q29udHJvbFByb21wdFByb3BzIHtcbiAgICB2YWx1ZVNldD86IFN0cmluZ09yTGlzdCB8ICgoYWN0OiBWYWx1ZVNldEFjdDxhbnk+LCBpbnB1dDogQ29udHJvbElucHV0KSA9PiBTdHJpbmdPckxpc3QpO1xuICAgIHZhbHVlQ2hhbmdlZD86IFN0cmluZ09yTGlzdCB8ICgoYWN0OiBWYWx1ZUNoYW5nZWRBY3Q8YW55PiwgaW5wdXQ6IENvbnRyb2xJbnB1dCkgPT4gU3RyaW5nT3JMaXN0KTtcbiAgICBpbnZhbGlkVmFsdWU/OiBTdHJpbmdPckxpc3QgfCAoKGFjdDogSW52YWxpZFZhbHVlQWN0PGFueT4sIGlucHV0OiBDb250cm9sSW5wdXQpID0+IFN0cmluZ09yTGlzdCk7XG4gICAgdW51c2FibGVJbnB1dFZhbHVlPzogU3RyaW5nT3JMaXN0IHwgKChhY3Q6IFVudXNhYmxlSW5wdXRWYWx1ZUFjdDxzdHJpbmc+LCBpbnB1dDogQ29udHJvbElucHV0KSA9PiBTdHJpbmdPckxpc3QpO1xuICAgIHJlcXVlc3RWYWx1ZT86IFN0cmluZ09yTGlzdCB8ICgoYWN0OiBSZXF1ZXN0VmFsdWVCeUxpc3RBY3QsIGlucHV0OiBDb250cm9sSW5wdXQpID0+IFN0cmluZ09yTGlzdCk7XG4gICAgcmVxdWVzdENoYW5nZWRWYWx1ZT86IFN0cmluZ09yTGlzdCB8ICgoYWN0OiBSZXF1ZXN0Q2hhbmdlZFZhbHVlQnlMaXN0QWN0LCBpbnB1dDogQ29udHJvbElucHV0KSA9PiBTdHJpbmdPckxpc3QpO1xuICAgIGNvbmZpcm1WYWx1ZT86IFN0cmluZ09yTGlzdCB8ICgoYWN0OiBDb25maXJtVmFsdWVBY3Q8YW55PiwgaW5wdXQ6IENvbnRyb2xJbnB1dCkgPT4gU3RyaW5nT3JMaXN0KTtcbiAgICB2YWx1ZURpc2FmZmlybWVkPzogU3RyaW5nT3JMaXN0IHwgKChhY3Q6IFZhbHVlRGlzY29uZmlybWVkQWN0PGFueT4sIGlucHV0OiBDb250cm9sSW5wdXQpID0+IFN0cmluZ09yTGlzdCk7XG4gICAgdmFsdWVBZmZpcm1lZD86IFN0cmluZ09yTGlzdCB8ICgoYWN0OiBWYWx1ZUNvbmZpcm1lZEFjdDxhbnk+LCBpbnB1dDogQ29udHJvbElucHV0KSA9PiBTdHJpbmdPckxpc3QpO1xufVxuXG5leHBvcnQgY2xhc3MgTGlzdENvbnRyb2xBUExQcm9wcyB7XG4gICAgLyoqXG4gICAgICogVGhlIEFQTCBkb2N1bWVudCB0byB1c2Ugd2hlbiByZXF1ZXN0aW5nIGEgdmFsdWVcbiAgICAgKlxuICAgICAqIERlZmF1bHQ6IEEgYmFzaWMgQVBMIFRleHRMaXN0TGF5b3V0IGRvY3VtZW50IHdpdGggc2Nyb2xsYWJsZSBhbmQgY2xpY2thYmxlIGxpc3QuXG4gICAgICogU2VlIGh0dHBzOi8vZGV2ZWxvcGVyLmFtYXpvbi5jb20vZW4tVVMvZG9jcy9hbGV4YS9hbGV4YS1wcmVzZW50YXRpb24tbGFuZ3VhZ2UvYXBsLWFsZXhhLXRleHQtbGlzdC1sYXlvdXQuaHRtbFxuICAgICAqL1xuICAgIHJlcXVlc3RBUExEb2N1bWVudD86IHsgW2tleTogc3RyaW5nXTogYW55OyB9IHwgKChhY3Q6IFJlcXVlc3RWYWx1ZUJ5TGlzdEFjdCwgaW5wdXQ6IENvbnRyb2xJbnB1dCkgPT4geyBba2V5OiBzdHJpbmddOiBhbnk7IH0pO1xuXG4gICAgLyoqXG4gICAgICogVG8gaW5kaWNhdGUgaWYgQVBMIG5lZWRzIHRvIGJlIGVuYWJsZWQvZGlzYWJsZWQgZm9yIHRoZSBza2lsbC5cbiAgICAgKi9cbiAgICBlbmFibGVkPzogYm9vbGVhbiB8ICgoaW5wdXQ6IENvbnRyb2xJbnB1dCkgPT4gYm9vbGVhbik7XG59XG5cbmV4cG9ydCBjbGFzcyBMaXN0Q29udHJvbFN0YXRlIGltcGxlbWVudHMgQ29udHJvbFN0YXRlIHtcblxuICAgIC8qKlxuICAgICAqIFZhbHVlLCB3aGljaCBpcyB0aGUgSUQgb2YgYSBTbG90VmFsdWUgZm9yIHRoaXMuVmFsdWVUeXBlLlxuICAgICAqL1xuICAgIHZhbHVlPzogc3RyaW5nO1xuXG4gICAgLyoqXG4gICAgICogVHJhY2tzIHdoZXRoZXIgYW4gZWxpY2l0YXRpb24gaXMgaGFwcGVuaW5nIGFuZCB3aGV0aGVyIGl0IGlzIHRvICdTZXQnIG9yICdDaGFuZ2UnIHRoZSB2YWx1ZS5cbiAgICAgKi9cbiAgICBlbGljaXRhdGlvbkFjdGlvbj86IHN0cmluZzsgIC8vIHJlY29yZHMgd2hhdCBraW5kIG9mIGVsaWNpdGF0aW9uIHdlIGFyZSBwZXJmb3JtaW5nLlxuXG4gICAgLyoqXG4gICAgICogVHJhY2tzIHdoZXRoZXIgdGhlIHZhbHVlIGlzIGFuIEVudGl0eSBSZXNvbHV0aW9uIG1hdGNoLlxuICAgICAqL1xuICAgIGVyTWF0Y2g/OiBib29sZWFuO1xuXG4gICAgLyoqXG4gICAgICogVGhlIHBhZ2UgaW5kZXggdG8gdHJhY2sgdGhlIHNwb2tlbiBsaXN0IG9mIFNsb3RJZHMgYnkgQWxleGEuXG4gICAgICovXG4gICAgc3Bva2VuSXRlbXNQYWdlSW5kZXg/OiBudW1iZXI7XG4gICAgXG4gICAgLyoqXG4gICAgICogVHJhY2tzIHdoZXRoZXIgdGhlIHZhbHVlIGlzIGNvbmZpcm1lZCBieSB0aGUgdXNlciwgaWYgY29uZmlybWF0aW9uUmVxdWlyZWQgaXMgc2V0IHRvIHRydWUuXG4gICAgICovXG4gICAgaXNWYWx1ZUNvbmZpcm1lZDogYm9vbGVhbiA9IGZhbHNlO1xuXG4gICAgLyoqXG4gICAgICogUHJldmlvdXMgdmFsdWUgdXNlZCB0byB0cmFjayBjaGFuZ2Ugb2YgYSBjb250cm9sIHZhbHVlLlxuICAgICAqL1xuICAgIHByZXZpb3VzVmFsdWU/OiBzdHJpbmc7XG5cbiAgICAvKipcbiAgICAgKiBUcmFja3MgdGhlIGxhc3QgaW5pdGlhdGl2ZSBhY3QgZnJvbSB0aGUgY29udHJvbFxuICAgICAqL1xuICAgIGxhc3RJbml0aWF0aXZlQWN0Pzogc3RyaW5nOyAvLyBUT0RPOiBTdG9yZSBhY3R1YWwgYWN0XG59XG5cbi8qKlxuICogT2J0YWlucyBhIHZhbHVlIG9mIGEgc3BlY2lmaWMgU2xvdCBUeXBlIHVzaW5nIGxpc3QgcHJlc2VudGF0aW9uICh2b2ljZSBhbmQgdmlzdWFsKVxuICpcbiAqL1xuXG5leHBvcnQgY2xhc3MgTGlzdENvbnRyb2wgZXh0ZW5kcyBDb250cm9sIGltcGxlbWVudHMgSW50ZXJhY3Rpb25Nb2RlbENvbnRyaWJ1dG9yIHtcblxuICAgIHJhd1Byb3BzOiBMaXN0Q29udHJvbFByb3BzO1xuICAgIHByb3BzOiBEZWVwUmVxdWlyZWQ8TGlzdENvbnRyb2xQcm9wcz47XG4gICAgcHVibGljIHN0YXRlOiBMaXN0Q29udHJvbFN0YXRlID0gbmV3IExpc3RDb250cm9sU3RhdGUoKTtcbiAgICBwcml2YXRlIGhhbmRsZUZ1bmM/OiAoaW5wdXQ6IENvbnRyb2xJbnB1dCwgcmVzdWx0QnVpbGRlcjogQ29udHJvbFJlc3VsdEJ1aWxkZXIpID0+IHZvaWQ7XG4gICAgY29uc3RydWN0b3IocHJvcHM6IExpc3RDb250cm9sUHJvcHMpIHtcbiAgICAgICAgc3VwZXIocHJvcHMuaWQpO1xuXG4gICAgICAgIGlmIChwcm9wcy5zbG90VHlwZSA9PT0gQW1hem9uQnVpbHRJblNsb3RUeXBlLlNFQVJDSF9RVUVSWSl7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0FNQVpPTi5TZWFyY2hRdWVyeSBjYW5ub3QgYmUgdXNlZCB3aXRoIExpc3RDb250cm9sIGR1ZSB0byB0aGUgc3BlY2lhbCBydWxlcyByZWdhcmRpbmcgaXRzIHVzZS4gJ1xuICAgICAgICAgICAgICsgJ1NwZWNpZmljYWxseSwgdXR0ZXJhbmNlcyB0aGF0IGluY2x1ZGUgU2VhcmNoUXVlcnkgbXVzdCBoYXZlIGEgY2FycmllciBwaHJhc2UgYW5kIG5vdCBiZSBjb21wcmlzZWQgZW50aXJlbHkgb2Ygc2xvdCByZWZlcmVuY2VzLiAnXG4gICAgICAgICAgICAgKyAnVXNlIGEgY3VzdG9tIGludGVudCB0byBtYW5hZ2UgU2VhcmNoUXVlcnkgc2xvdHMgb3IgY3JlYXRlIGEgcmVndWxhciBzbG90IGZvciB1c2Ugd2l0aCBMaXN0Q29udHJvbC4nKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMucmF3UHJvcHMgPSBwcm9wcztcbiAgICAgICAgdGhpcy5wcm9wcyA9IExpc3RDb250cm9sLm1lcmdlV2l0aERlZmF1bHRQcm9wcyhwcm9wcyk7XG4gICAgfVxuXG4gICAgc3RhdGljIG1lcmdlV2l0aERlZmF1bHRQcm9wcyhwcm9wczogTGlzdENvbnRyb2xQcm9wcyk6IERlZXBSZXF1aXJlZDxMaXN0Q29udHJvbFByb3BzPiB7XG5cbiAgICAgICAgY29uc3QgZGVmYXVsdHM6IERlZXBSZXF1aXJlZDxMaXN0Q29udHJvbFByb3BzPiA9XG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiAnZHVtbXknLFxuICAgICAgICAgICAgc2xvdFR5cGU6ICdkdW1teScsXG4gICAgICAgICAgICByZXF1aXJlZDogdHJ1ZSxcbiAgICAgICAgICAgIHZhbGlkYXRpb246IFtdLFxuICAgICAgICAgICAgcGFnZVNpemU6IDMsXG4gICAgICAgICAgICBsaXN0SXRlbUlEczogW10sXG4gICAgICAgICAgICBjb25maXJtYXRpb25SZXF1aXJlZDogZmFsc2UsXG4gICAgICAgICAgICBpbnRlcmFjdGlvbk1vZGVsOiB7XG4gICAgICAgICAgICAgICAgYWN0aW9uczoge1xuICAgICAgICAgICAgICAgICAgICBzZXQ6IFskLkFjdGlvbi5TZXQsICdzZWxlY3QnXSxcbiAgICAgICAgICAgICAgICAgICAgY2hhbmdlOiBbJC5BY3Rpb24uQ2hhbmdlXSxcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIHRhcmdldHM6IFsnY2hvaWNlJywgJC5UYXJnZXQuSXRdXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgcHJvbXB0czoge1xuICAgICAgICAgICAgICAgIGNvbmZpcm1WYWx1ZTogKGFjdCkgPT4gaTE4bmV4dC50KCdMSVNUX0NPTlRST0xfREVGQVVMVF9QUk9NUFRfQ09ORklSTV9WQUxVRScsIHsgdmFsdWU6IGFjdC5wYXlsb2FkLnZhbHVlIH0pLFxuICAgICAgICAgICAgICAgIHZhbHVlQWZmaXJtZWQ6IGkxOG5leHQudCgnTElTVF9DT05UUk9MX0RFRkFVTFRfUFJPTVBUX1ZBTFVFX0FGRklSTUVEJyksXG4gICAgICAgICAgICAgICAgdmFsdWVEaXNhZmZpcm1lZDogaTE4bmV4dC50KCdMSVNUX0NPTlRST0xfREVGQVVMVF9QUk9NUFRfVkFMVUVfRElTQUZGSVJNRUQnKSxcbiAgICAgICAgICAgICAgICB2YWx1ZVNldDogKGFjdCkgPT4gaTE4bmV4dC50KCdMSVNUX0NPTlRST0xfREVGQVVMVF9QUk9NUFRfVkFMVUVfU0VUJywgeyB2YWx1ZTogYWN0LnBheWxvYWQudmFsdWUgfSksXG4gICAgICAgICAgICAgICAgdmFsdWVDaGFuZ2VkOiAoYWN0KSA9PiBpMThuZXh0LnQoJ0xJU1RfQ09OVFJPTF9ERUZBVUxUX1BST01QVF9WQUxVRV9DSEFOR0VEJywgeyB2YWx1ZTogYWN0LnBheWxvYWQudmFsdWUgfSksXG4gICAgICAgICAgICAgICAgaW52YWxpZFZhbHVlOiAoYWN0KSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChhY3QucGF5bG9hZC5yZW5kZXJlZFJlYXNvbiAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gaTE4bmV4dC50KCdMSVNUX0NPTlRST0xfREVGQVVMVF9QUk9NUFRfSU5WQUxJRF9WQUxVRV9XSVRIX1JFQVNPTicsIHsgdmFsdWU6IGFjdC5wYXlsb2FkLnZhbHVlLCByZWFzb246IGFjdC5wYXlsb2FkLnJlbmRlcmVkUmVhc29uIH0pO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBpMThuZXh0LnQoJ0xJU1RfQ09OVFJPTF9ERUZBVUxUX1BST01QVF9HRU5FUkFMX0lOVkFMSURfVkFMVUUnKTtcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIHVudXNhYmxlSW5wdXRWYWx1ZTogKGFjdCkgPT4gaTE4bmV4dC50KCdMSVNUX0NPTlRST0xfREVGQVVMVF9QUk9NUFRfVU5VU0FCTEVfSU5QVVRfVkFMVUUnKSxcbiAgICAgICAgICAgICAgICByZXF1ZXN0VmFsdWU6IChhY3QpID0+IGkxOG5leHQudCgnTElTVF9DT05UUk9MX0RFRkFVTFRfUFJPTVBUX1JFUVVFU1RfVkFMVUUnLCB7IHN1Z2dlc3Rpb25zOiBMaXN0Rm9ybWF0dGluZy5mb3JtYXQoYWN0LnBheWxvYWQuY2hvaWNlc0Zyb21BY3RpdmVQYWdlKX0pLFxuICAgICAgICAgICAgICAgIHJlcXVlc3RDaGFuZ2VkVmFsdWU6IChhY3QpID0+IGkxOG5leHQudCgnTElTVF9DT05UUk9MX0RFRkFVTFRfUFJPTVBUX1JFUVVFU1RfQ0hBTkdFRF9WQUxVRScsIHsgc3VnZ2VzdGlvbnM6IExpc3RGb3JtYXR0aW5nLmZvcm1hdChhY3QucGF5bG9hZC5jaG9pY2VzRnJvbUFjdGl2ZVBhZ2UpfSksXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgcmVwcm9tcHRzOiB7XG4gICAgICAgICAgICAgICAgY29uZmlybVZhbHVlOiAoYWN0KSA9PiBpMThuZXh0LnQoJ0xJU1RfQ09OVFJPTF9ERUZBVUxUX1JFUFJPTVBUX0NPTkZJUk1fVkFMVUUnLCB7IHZhbHVlOiBhY3QucGF5bG9hZC52YWx1ZSB9KSxcbiAgICAgICAgICAgICAgICB2YWx1ZUFmZmlybWVkOiBpMThuZXh0LnQoJ0xJU1RfQ09OVFJPTF9ERUZBVUxUX1JFUFJPTVBUX1ZBTFVFX0FGRklSTUVEJyksXG4gICAgICAgICAgICAgICAgdmFsdWVEaXNhZmZpcm1lZDogaTE4bmV4dC50KCdMSVNUX0NPTlRST0xfREVGQVVMVF9SRVBST01QVF9WQUxVRV9ESVNBRkZJUk1FRCcpLFxuICAgICAgICAgICAgICAgIHZhbHVlU2V0OiAoYWN0KSA9PiBpMThuZXh0LnQoJ0xJU1RfQ09OVFJPTF9ERUZBVUxUX1JFUFJPTVBUX1ZBTFVFX1NFVCcsIHsgdmFsdWU6IGFjdC5wYXlsb2FkLnZhbHVlIH0pLFxuICAgICAgICAgICAgICAgIHZhbHVlQ2hhbmdlZDogKGFjdCkgPT4gaTE4bmV4dC50KCdMSVNUX0NPTlRST0xfREVGQVVMVF9SRVBST01QVF9WQUxVRV9DSEFOR0VEJywgeyB2YWx1ZTogYWN0LnBheWxvYWQudmFsdWUgfSksXG4gICAgICAgICAgICAgICAgaW52YWxpZFZhbHVlOiAoYWN0KSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChhY3QucGF5bG9hZC5yZW5kZXJlZFJlYXNvbiAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gaTE4bmV4dC50KCdMSVNUX0NPTlRST0xfREVGQVVMVF9SRVBST01QVF9JTlZBTElEX1ZBTFVFX1dJVEhfUkVBU09OJywgeyB2YWx1ZTogYWN0LnBheWxvYWQudmFsdWUsIHJlYXNvbjogYWN0LnBheWxvYWQucmVuZGVyZWRSZWFzb24gfSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGkxOG5leHQudCgnTElTVF9DT05UUk9MX0RFRkFVTFRfUFJPTVBUX0dFTkVSQUxfSU5WQUxJRF9WQUxVRScpO1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgdW51c2FibGVJbnB1dFZhbHVlOiAoYWN0KSA9PiBpMThuZXh0LnQoJ0xJU1RfQ09OVFJPTF9ERUZBVUxUX1JFUFJPTVBUX1VOVVNBQkxFX0lOUFVUX1ZBTFVFJyksXG4gICAgICAgICAgICAgICAgcmVxdWVzdFZhbHVlOiAoYWN0KSA9PiBpMThuZXh0LnQoJ0xJU1RfQ09OVFJPTF9ERUZBVUxUX1JFUFJPTVBUX1JFUVVFU1RfVkFMVUUnLCB7IHN1Z2dlc3Rpb25zOiBMaXN0Rm9ybWF0dGluZy5mb3JtYXQoYWN0LnBheWxvYWQuY2hvaWNlc0Zyb21BY3RpdmVQYWdlKX0pLFxuICAgICAgICAgICAgICAgIHJlcXVlc3RDaGFuZ2VkVmFsdWU6IChhY3QpID0+IGkxOG5leHQudCgnTElTVF9DT05UUk9MX0RFRkFVTFRfUkVQUk9NUFRfUkVRVUVTVF9DSEFOR0VEX1ZBTFVFJywgeyBzdWdnZXN0aW9uczogTGlzdEZvcm1hdHRpbmcuZm9ybWF0KGFjdC5wYXlsb2FkLmNob2ljZXNGcm9tQWN0aXZlUGFnZSl9KSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBhcGw6IHtcbiAgICAgICAgICAgICAgICBlbmFibGVkOiB0cnVlLFxuICAgICAgICAgICAgICAgIHJlcXVlc3RBUExEb2N1bWVudDogZ2VuZXJhdGVUZXh0TGlzdERvY3VtZW50Rm9yTGlzdENvbnRyb2woKVxuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgIHJldHVybiBfLm1lcmdlKGRlZmF1bHRzLCBwcm9wcyk7XG4gICAgfVxuXG4gICAgY2FuSGFuZGxlKGlucHV0OiBDb250cm9sSW5wdXQpOiBib29sZWFuIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuaXNTZXRXaXRoVmFsdWUoaW5wdXQpXG4gICAgICAgICAgICB8fCB0aGlzLmlzQ2hhbmdlV2l0aFZhbHVlKGlucHV0KVxuICAgICAgICAgICAgfHwgdGhpcy5pc1NldFdpdGhvdXRWYWx1ZShpbnB1dClcbiAgICAgICAgICAgIHx8IHRoaXMuaXNDaGFuZ2VXaXRob3V0VmFsdWUoaW5wdXQpXG4gICAgICAgICAgICB8fCB0aGlzLmlzQmFyZVZhbHVlKGlucHV0KVxuICAgICAgICAgICAgfHwgdGhpcy5pc0NvbmZpcm1hdGlvbkFmZmlybWVkKGlucHV0KVxuICAgICAgICAgICAgfHwgdGhpcy5pc0NvbmZpcm1hdGlvbkRpc0FmZmlybWVkKGlucHV0KVxuICAgICAgICAgICAgfHwgdGhpcy5pc09yZGluYWxTY3JlZW5FdmVudChpbnB1dClcbiAgICAgICAgICAgIHx8IHRoaXMuaXNPcmRpbmFsU2VsZWN0aW9uKGlucHV0KTtcbiAgICB9XG5cbiAgICBhc3luYyBoYW5kbGUoaW5wdXQ6IENvbnRyb2xJbnB1dCwgcmVzdWx0QnVpbGRlcjogQ29udHJvbFJlc3VsdEJ1aWxkZXIpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICAgICAgaWYgKHRoaXMuaGFuZGxlRnVuYyA9PT0gdW5kZWZpbmVkKXtcbiAgICAgICAgICAgIGxvZy5lcnJvcignTGlzdENvbnRyb2w6IGhhbmRsZSBjYWxsZWQgYnV0IG5vIGNsYXVzZSBtYXRjaGVkLiAgYXJlIGNhbkhhbmRsZS9oYW5kbGUgb3V0IG9mIHN5bmM/Jyk7XG4gICAgICAgICAgICBjb25zdCBpbnRlbnQ6IEludGVudCA9IChpbnB1dC5yZXF1ZXN0IGFzIEludGVudFJlcXVlc3QpLmludGVudDtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgJHtpbnRlbnQubmFtZX0gY2FuIG5vdCBiZSBoYW5kbGVkIGJ5ICR7dGhpcy5jb25zdHJ1Y3Rvci5uYW1lfS5gKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuaGFuZGxlRnVuYyhpbnB1dCwgcmVzdWx0QnVpbGRlcik7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogVGVzdCBpZiB0aGUgaW5wdXQgaXMgYW4gaW1wbGljaXQgb3IgZXhwbGljaXQgc2V0LWFjdGlvbiB3aXRoIGEgdmFsdWUgcHJvdmlkZWQuXG4gICAgICpcbiAgICAgKiBAcGFyYW0gaW5wdXRcbiAgICAgKi9cbiAgICBpc1NldFdpdGhWYWx1ZShpbnB1dDogQ29udHJvbElucHV0KTogYm9vbGVhbiB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBva0lmKElucHV0VXRpbC5pc0ludGVudChpbnB1dCwgU2luZ2xlVmFsdWVDb250cm9sSW50ZW50LmludGVudE5hbWUodGhpcy5wcm9wcy5zbG90VHlwZSkpKTtcbiAgICAgICAgICAgIGNvbnN0IHsgZmVlZGJhY2ssIGFjdGlvbiwgdGFyZ2V0LCB2YWx1ZVN0ciwgdmFsdWVUeXBlIH0gPSB1bnBhY2tTaW5nbGVWYWx1ZUNvbnRyb2xJbnRlbnQoKGlucHV0LnJlcXVlc3QgYXMgSW50ZW50UmVxdWVzdCkuaW50ZW50KTtcbiAgICAgICAgICAgIG9rSWYoSW5wdXRVdGlsLnRhcmdldElzTWF0Y2hPclVuZGVmaW5lZCh0YXJnZXQsIHRoaXMucHJvcHMuaW50ZXJhY3Rpb25Nb2RlbC50YXJnZXRzKSk7XG4gICAgICAgICAgICBva0lmKElucHV0VXRpbC52YWx1ZVR5cGVNYXRjaCh2YWx1ZVR5cGUsIHRoaXMucHJvcHMuc2xvdFR5cGUpKTtcbiAgICAgICAgICAgIG9rSWYoSW5wdXRVdGlsLnZhbHVlU3RyRGVmaW5lZCh2YWx1ZVN0cikpO1xuICAgICAgICAgICAgb2tJZihJbnB1dFV0aWwuZmVlZGJhY2tJc01hdGNoT3JVbmRlZmluZWQoZmVlZGJhY2ssIFskLkZlZWRiYWNrLkFmZmlybSwgJC5GZWVkYmFjay5EaXNhZmZpcm1dKSk7XG4gICAgICAgICAgICBva0lmKElucHV0VXRpbC5hY3Rpb25Jc01hdGNoKGFjdGlvbiwgdGhpcy5wcm9wcy5pbnRlcmFjdGlvbk1vZGVsLmFjdGlvbnMuc2V0KSk7XG4gICAgICAgICAgICB0aGlzLmhhbmRsZUZ1bmMgPSB0aGlzLmhhbmRsZVNldFdpdGhWYWx1ZTtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIGNhdGNoIChlKSB7IHJldHVybiBmYWxzZUlmR3VhcmRGYWlsZWQoZSk7IH1cbiAgICB9XG5cbiAgICBoYW5kbGVTZXRXaXRoVmFsdWUoaW5wdXQ6IENvbnRyb2xJbnB1dCwgcmVzdWx0QnVpbGRlcjogQ29udHJvbFJlc3VsdEJ1aWxkZXIpIHtcbiAgICAgICAgY29uc3QgeyB2YWx1ZVN0ciwgZXJNYXRjaCB9ID0gSW5wdXRVdGlsLmdldFZhbHVlUmVzb2x1dGlvbihpbnB1dCk7XG4gICAgICAgIHRoaXMuc2V0VmFsdWUodmFsdWVTdHIsIGVyTWF0Y2gpO1xuICAgICAgICB0aGlzLnZhbGlkYXRlQW5kQWRkQWN0cyhpbnB1dCwgcmVzdWx0QnVpbGRlciwgJC5BY3Rpb24uU2V0KTtcbiAgICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFRlc3QgaWYgdGhlIGlucHV0IGlzIGFuIGltcGxpY2l0IG9yIGV4cGxpY2l0IHNldC1hY3Rpb24gd2l0aCBubyB2YWx1ZVxuICAgICAqXG4gICAgICogQHBhcmFtIGlucHV0XG4gICAgICovXG4gICAgaXNTZXRXaXRob3V0VmFsdWUoaW5wdXQ6IENvbnRyb2xJbnB1dCk6IGJvb2xlYW4ge1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgb2tJZihJbnB1dFV0aWwuaXNJbnRlbnQoaW5wdXQsIEdlbmVyYWxDb250cm9sSW50ZW50Lm5hbWUpKTtcbiAgICAgICAgICAgIGNvbnN0IHsgZmVlZGJhY2ssIGFjdGlvbiwgdGFyZ2V0IH0gPSB1bnBhY2tHZW5lcmFsQ29udHJvbEludGVudCgoaW5wdXQucmVxdWVzdCBhcyBJbnRlbnRSZXF1ZXN0KS5pbnRlbnQpO1xuICAgICAgICAgICAgb2tJZihJbnB1dFV0aWwudGFyZ2V0SXNNYXRjaE9yVW5kZWZpbmVkKHRhcmdldCwgdGhpcy5wcm9wcy5pbnRlcmFjdGlvbk1vZGVsLnRhcmdldHMpKTtcbiAgICAgICAgICAgIG9rSWYoSW5wdXRVdGlsLmZlZWRiYWNrSXNNYXRjaE9yVW5kZWZpbmVkKGZlZWRiYWNrLCBbJC5GZWVkYmFjay5BZmZpcm0sICQuRmVlZGJhY2suRGlzYWZmaXJtXSkpO1xuICAgICAgICAgICAgb2tJZihJbnB1dFV0aWwuYWN0aW9uSXNNYXRjaChhY3Rpb24sIHRoaXMucHJvcHMuaW50ZXJhY3Rpb25Nb2RlbC5hY3Rpb25zLnNldCkpO1xuICAgICAgICAgICAgdGhpcy5oYW5kbGVGdW5jID0gdGhpcy5oYW5kbGVTZXRXaXRob3V0VmFsdWU7XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICBjYXRjaCAoZSkgeyByZXR1cm4gZmFsc2VJZkd1YXJkRmFpbGVkKGUpOyB9XG4gICAgfVxuXG4gICAgaGFuZGxlU2V0V2l0aG91dFZhbHVlKGlucHV0OiBDb250cm9sSW5wdXQsIHJlc3VsdEJ1aWxkZXI6IENvbnRyb2xSZXN1bHRCdWlsZGVyKTogdm9pZCB7XG4gICAgICAgIHRoaXMuYXNrRWxpY2l0YXRpb25RdWVzdGlvbigkLkFjdGlvbi5TZXQsIGlucHV0LCByZXN1bHRCdWlsZGVyKTtcbiAgICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFRlc3QgaWYgdGhlIGlucHV0IGlzIGEgdmFsaWQgY2hhbmdlLWFjdGlvbiB3aXRoIGEgdmFsdWUgcHJvdmlkZWQuXG4gICAgICpcbiAgICAgKiBAcGFyYW0gaW5wdXRcbiAgICAgKi9cbiAgICBpc0NoYW5nZVdpdGhWYWx1ZShpbnB1dDogQ29udHJvbElucHV0KTogYm9vbGVhbiB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBva0lmKElucHV0VXRpbC5pc0ludGVudChpbnB1dCwgU2luZ2xlVmFsdWVDb250cm9sSW50ZW50LmludGVudE5hbWUodGhpcy5wcm9wcy5zbG90VHlwZSkpKTtcbiAgICAgICAgICAgIGNvbnN0IHsgZmVlZGJhY2ssIGFjdGlvbiwgdGFyZ2V0LCB2YWx1ZVN0ciwgdmFsdWVUeXBlIH0gPSB1bnBhY2tTaW5nbGVWYWx1ZUNvbnRyb2xJbnRlbnQoKGlucHV0LnJlcXVlc3QgYXMgSW50ZW50UmVxdWVzdCkuaW50ZW50KTtcbiAgICAgICAgICAgIG9rSWYoSW5wdXRVdGlsLnRhcmdldElzTWF0Y2hPclVuZGVmaW5lZCh0YXJnZXQsIHRoaXMucHJvcHMuaW50ZXJhY3Rpb25Nb2RlbC50YXJnZXRzKSk7XG4gICAgICAgICAgICBva0lmKElucHV0VXRpbC52YWx1ZVR5cGVNYXRjaCh2YWx1ZVR5cGUsIHRoaXMucHJvcHMuc2xvdFR5cGUpKTtcbiAgICAgICAgICAgIG9rSWYoSW5wdXRVdGlsLnZhbHVlU3RyRGVmaW5lZCh2YWx1ZVN0cikpO1xuICAgICAgICAgICAgb2tJZihJbnB1dFV0aWwuZmVlZGJhY2tJc01hdGNoT3JVbmRlZmluZWQoZmVlZGJhY2ssIFskLkZlZWRiYWNrLkFmZmlybSwgJC5GZWVkYmFjay5EaXNhZmZpcm1dKSk7XG4gICAgICAgICAgICBva0lmKElucHV0VXRpbC5hY3Rpb25Jc01hdGNoKGFjdGlvbiwgdGhpcy5wcm9wcy5pbnRlcmFjdGlvbk1vZGVsLmFjdGlvbnMuY2hhbmdlKSk7XG4gICAgICAgICAgICB0aGlzLmhhbmRsZUZ1bmMgPSB0aGlzLmhhbmRsZUNoYW5nZVdpdGhWYWx1ZTtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG5cbiAgICAgICAgY2F0Y2ggKGUpIHsgcmV0dXJuIGZhbHNlSWZHdWFyZEZhaWxlZChlKTsgfVxuICAgIH1cblxuICAgIGhhbmRsZUNoYW5nZVdpdGhWYWx1ZShpbnB1dDogQ29udHJvbElucHV0LCByZXN1bHRCdWlsZGVyOiBDb250cm9sUmVzdWx0QnVpbGRlcik6IHZvaWQge1xuICAgICAgICBjb25zdCB7IHZhbHVlU3RyLCBlck1hdGNoIH0gPSBJbnB1dFV0aWwuZ2V0VmFsdWVSZXNvbHV0aW9uKGlucHV0KTtcbiAgICAgICAgdGhpcy5zZXRWYWx1ZSh2YWx1ZVN0ciwgZXJNYXRjaCk7XG4gICAgICAgIHRoaXMudmFsaWRhdGVBbmRBZGRBY3RzKGlucHV0LCByZXN1bHRCdWlsZGVyLCB0aGlzLnN0YXRlLnZhbHVlICE9PSB1bmRlZmluZWQgPyAkLkFjdGlvbi5DaGFuZ2UgOiAkLkFjdGlvbi5TZXQpO1xuICAgICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogVGVzdCBpZiB0aGUgaW5wdXQgaXMgYSB2YWxpZCBjaGFuZ2UtYWN0aW9uIHdpdGhvdXQgYSB2YWx1ZSBwcm92aWRlZC5cbiAgICAgKlxuICAgICAqIEBwYXJhbSBpbnB1dFxuICAgICAqL1xuICAgIGlzQ2hhbmdlV2l0aG91dFZhbHVlKGlucHV0OiBDb250cm9sSW5wdXQpOiBib29sZWFuIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIG9rSWYoSW5wdXRVdGlsLmlzSW50ZW50KGlucHV0LCBHZW5lcmFsQ29udHJvbEludGVudC5uYW1lKSk7XG4gICAgICAgICAgICBjb25zdCB7IGZlZWRiYWNrLCBhY3Rpb24sIHRhcmdldCB9ID0gdW5wYWNrR2VuZXJhbENvbnRyb2xJbnRlbnQoKGlucHV0LnJlcXVlc3QgYXMgSW50ZW50UmVxdWVzdCkuaW50ZW50KTtcbiAgICAgICAgICAgIG9rSWYoSW5wdXRVdGlsLnRhcmdldElzTWF0Y2hPclVuZGVmaW5lZCh0YXJnZXQsIHRoaXMucHJvcHMuaW50ZXJhY3Rpb25Nb2RlbC50YXJnZXRzKSk7XG4gICAgICAgICAgICBva0lmKElucHV0VXRpbC5mZWVkYmFja0lzTWF0Y2hPclVuZGVmaW5lZChmZWVkYmFjaywgWyQuRmVlZGJhY2suQWZmaXJtLCAkLkZlZWRiYWNrLkRpc2FmZmlybV0pKTtcbiAgICAgICAgICAgIG9rSWYoSW5wdXRVdGlsLmFjdGlvbklzTWF0Y2goYWN0aW9uLCB0aGlzLnByb3BzLmludGVyYWN0aW9uTW9kZWwuYWN0aW9ucy5jaGFuZ2UpKTtcbiAgICAgICAgICAgIHRoaXMuaGFuZGxlRnVuYyA9IHRoaXMuaGFuZGxlQ2hhbmdlV2l0aG91dFZhbHVlO1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgY2F0Y2ggKGUpIHsgcmV0dXJuIGZhbHNlSWZHdWFyZEZhaWxlZChlKTsgfVxuICAgIH1cblxuICAgIGhhbmRsZUNoYW5nZVdpdGhvdXRWYWx1ZShpbnB1dDogQ29udHJvbElucHV0LCByZXN1bHRCdWlsZGVyOiBDb250cm9sUmVzdWx0QnVpbGRlcik6IHZvaWQge1xuICAgICAgICB0aGlzLmFza0VsaWNpdGF0aW9uUXVlc3Rpb24oJC5BY3Rpb24uQ2hhbmdlLCBpbnB1dCwgcmVzdWx0QnVpbGRlcik7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBUZXN0IGlmIHRoZSBpbnB1dCBpcyBhIFNpbmdsZVZhbHVlQ29udHJvbEludGVudCB3aXRoIGp1c3QgYSBzbG90VmFsdWUgcHJvdmlkZWQuXG4gICAgICogSWYgd2UgYXJlbid0IGFza2luZyBhIHF1ZXN0aW9uIGl0IGlzIGFzc3VtZWQgdGhlIHVzZXIgbWVhbnQgJ3NldCB2YWx1ZScuXG4gICAgICogQHBhcmFtIGlucHV0XG4gICAgICovXG4gICAgaXNCYXJlVmFsdWUoaW5wdXQ6IENvbnRyb2xJbnB1dCk6IGFueSB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBva0lmKElucHV0VXRpbC5pc0ludGVudChpbnB1dCwgU2luZ2xlVmFsdWVDb250cm9sSW50ZW50LmludGVudE5hbWUodGhpcy5wcm9wcy5zbG90VHlwZSkpKTtcbiAgICAgICAgICAgIGNvbnN0IHsgZmVlZGJhY2ssIGFjdGlvbiwgdGFyZ2V0LCB2YWx1ZVN0ciwgdmFsdWVUeXBlIH0gPSB1bnBhY2tTaW5nbGVWYWx1ZUNvbnRyb2xJbnRlbnQoKGlucHV0LnJlcXVlc3QgYXMgSW50ZW50UmVxdWVzdCkuaW50ZW50KTtcbiAgICAgICAgICAgIG9rSWYoSW5wdXRVdGlsLmZlZWRiYWNrSXNVbmRlZmluZWQoZmVlZGJhY2spKTtcbiAgICAgICAgICAgIG9rSWYoSW5wdXRVdGlsLmFjdGlvbklzVW5kZWZpbmVkKGFjdGlvbikpO1xuICAgICAgICAgICAgb2tJZihJbnB1dFV0aWwudGFyZ2V0SXNNYXRjaE9yVW5kZWZpbmVkKHRhcmdldCwgdGhpcy5wcm9wcy5pbnRlcmFjdGlvbk1vZGVsLnRhcmdldHMpKTtcbiAgICAgICAgICAgIG9rSWYoSW5wdXRVdGlsLnZhbHVlU3RyRGVmaW5lZCh2YWx1ZVN0cikpO1xuICAgICAgICAgICAgb2tJZihJbnB1dFV0aWwudmFsdWVUeXBlTWF0Y2godmFsdWVUeXBlLCB0aGlzLnByb3BzLnNsb3RUeXBlKSk7XG4gICAgICAgICAgICB0aGlzLmhhbmRsZUZ1bmMgPSB0aGlzLmhhbmRsZUJhcmVWYWx1ZTtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIGNhdGNoIChlKSB7IHJldHVybiBmYWxzZUlmR3VhcmRGYWlsZWQoZSk7IH1cbiAgICB9XG5cblxuICAgIGhhbmRsZUJhcmVWYWx1ZShpbnB1dDogQ29udHJvbElucHV0LCByZXN1bHRCdWlsZGVyOiBDb250cm9sUmVzdWx0QnVpbGRlcik6IHZvaWQge1xuICAgICAgICBjb25zdCB7IHZhbHVlU3RyLCBlck1hdGNoIH0gPSBJbnB1dFV0aWwuZ2V0VmFsdWVSZXNvbHV0aW9uKGlucHV0KTtcbiAgICAgICAgdGhpcy5zZXRWYWx1ZSh2YWx1ZVN0ciwgZXJNYXRjaCk7XG4gICAgICAgIHRoaXMudmFsaWRhdGVBbmRBZGRBY3RzKGlucHV0LCByZXN1bHRCdWlsZGVyLCB0aGlzLnN0YXRlLmVsaWNpdGF0aW9uQWN0aW9uID8/ICQuQWN0aW9uLlNldCk7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBpc0NvbmZpcm1hdGlvbkFmZmlybWVkKGlucHV0OiBDb250cm9sSW5wdXQpOiBhbnkge1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgb2tJZihJbnB1dFV0aWwuaXNCYXJlWWVzKGlucHV0KSk7XG4gICAgICAgICAgICBva0lmKHRoaXMuc3RhdGUubGFzdEluaXRpYXRpdmVBY3QgPT09ICdDb25maXJtVmFsdWVBY3QnKTtcbiAgICAgICAgICAgIHRoaXMuaGFuZGxlRnVuYyA9IHRoaXMuaGFuZGxlQ29uZmlybWF0aW9uQWZmaXJtZWQ7XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICBjYXRjaCAoZSkge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlSWZHdWFyZEZhaWxlZChlKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGhhbmRsZUNvbmZpcm1hdGlvbkFmZmlybWVkKGlucHV0OiBDb250cm9sSW5wdXQsIHJlc3VsdEJ1aWxkZXI6IENvbnRyb2xSZXN1bHRCdWlsZGVyKTogdm9pZCB7XG4gICAgICAgIGNvbnN0IHZhbGlkYXRpb25SZXN1bHQ6IHRydWUgfCBWYWxpZGF0aW9uUmVzdWx0ID0gdGhpcy52YWxpZGF0ZShpbnB1dCk7XG4gICAgICAgIGlmICh2YWxpZGF0aW9uUmVzdWx0ICE9PSB0cnVlKSB7XG4gICAgICAgICAgICByZXN1bHRCdWlsZGVyLmFkZEFjdChuZXcgSW52YWxpZFZhbHVlQWN0PHN0cmluZz4oXG4gICAgICAgICAgICAgICAgdGhpcywgXG4gICAgICAgICAgICAgICAgeyBcbiAgICAgICAgICAgICAgICAgICAgdmFsdWU6IHRoaXMuc3RhdGUudmFsdWUhLCBcbiAgICAgICAgICAgICAgICAgICAgcmVhc29uQ29kZTogdmFsaWRhdGlvblJlc3VsdC5yZWFzb25Db2RlLFxuICAgICAgICAgICAgICAgICAgICByZW5kZXJlZFJlYXNvbjogdmFsaWRhdGlvblJlc3VsdC5yZW5kZXJlZFJlYXNvblxuICAgICAgICAgICAgICAgIH0pKTtcbiAgICAgICAgICAgIHRoaXMuYXNrRWxpY2l0YXRpb25RdWVzdGlvbigkLkFjdGlvbi5DaGFuZ2UsIGlucHV0LCByZXN1bHRCdWlsZGVyKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuc3RhdGUuaXNWYWx1ZUNvbmZpcm1lZCA9IHRydWU7XG4gICAgICAgICAgICByZXN1bHRCdWlsZGVyLmFkZEFjdChuZXcgVmFsdWVDb25maXJtZWRBY3QodGhpcywgeyB2YWx1ZTogdGhpcy5zdGF0ZS52YWx1ZSB9KSk7XG4gICAgICAgICAgICBpZiAodGhpcy5zdGF0ZS5lbGljaXRhdGlvbkFjdGlvbiA9PT0gJC5BY3Rpb24uQ2hhbmdlKSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuc3RhdGUucHJldmlvdXNWYWx1ZSAhPT0gdW5kZWZpbmVkKXtcbiAgICAgICAgICAgICAgICAgICAgcmVzdWx0QnVpbGRlci5hZGRBY3QoXG4gICAgICAgICAgICAgICAgICAgICAgICBuZXcgVmFsdWVDaGFuZ2VkQWN0PHN0cmluZz4odGhpcywge3ByZXZpb3VzVmFsdWU6IHRoaXMuc3RhdGUucHJldmlvdXNWYWx1ZSwgdmFsdWU6IHRoaXMuc3RhdGUudmFsdWUhIH0pXG4gICAgICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1ZhbHVlQ2hhbmdlZEFjdCBzaG91bGQgb25seSBiZSB1c2VkIGlmIHRoZXJlIGlzIGFuIGFjdHVhbCBwcmV2aW91cyB2YWx1ZScpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHJlc3VsdEJ1aWxkZXIuYWRkQWN0KG5ldyBWYWx1ZVNldEFjdCh0aGlzLCB7IHZhbHVlOiB0aGlzLnN0YXRlLnZhbHVlIH0pKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxuICAgIGlzQ29uZmlybWF0aW9uRGlzQWZmaXJtZWQoaW5wdXQ6IENvbnRyb2xJbnB1dCk6IGFueSB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBva0lmKElucHV0VXRpbC5pc0JhcmVObyhpbnB1dCkpO1xuICAgICAgICAgICAgb2tJZih0aGlzLnN0YXRlLmxhc3RJbml0aWF0aXZlQWN0ID09PSAnQ29uZmlybVZhbHVlQWN0Jyk7XG4gICAgICAgICAgICB0aGlzLmhhbmRsZUZ1bmMgPSB0aGlzLmhhbmRsZUNvbmZpcm1hdGlvbkRpc0FmZmlybWVkO1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZUlmR3VhcmRGYWlsZWQoZSk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBoYW5kbGVDb25maXJtYXRpb25EaXNBZmZpcm1lZChpbnB1dDogQ29udHJvbElucHV0LCByZXN1bHRCdWlsZGVyOiBDb250cm9sUmVzdWx0QnVpbGRlcik6IHZvaWQge1xuICAgICAgICB0aGlzLnN0YXRlLmlzVmFsdWVDb25maXJtZWQgPSBmYWxzZTtcbiAgICAgICAgcmVzdWx0QnVpbGRlci5hZGRBY3QobmV3IFZhbHVlRGlzY29uZmlybWVkQWN0KHRoaXMsIHt2YWx1ZTogdGhpcy5zdGF0ZS52YWx1ZX0pKTtcbiAgICAgICAgXG4gICAgICAgIGNvbnN0IGFsbENob2ljZXMgPSB0aGlzLmdldENob2ljZXNMaXN0KGlucHV0KTtcbiAgICAgICAgaWYgKGFsbENob2ljZXMgPT09IG51bGwpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignTGlzdENvbnRyb2wubGlzdEl0ZW1JRHMgaXMgbnVsbCcpO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGNob2ljZXNGcm9tQWN0aXZlUGFnZSA9IHRoaXMuZ2V0Q2hvaWNlc0Zyb21BY3RpdmVQYWdlKGFsbENob2ljZXMpO1xuICAgICAgICByZXN1bHRCdWlsZGVyLmFkZEFjdChuZXcgUmVxdWVzdFZhbHVlQnlMaXN0QWN0KHRoaXMsIHtjaG9pY2VzRnJvbUFjdGl2ZVBhZ2UsIGFsbENob2ljZXN9KSk7XG4gICAgfVxuICAgIFxuICAgIGlzT3JkaW5hbFNjcmVlbkV2ZW50KGlucHV0OiBDb250cm9sSW5wdXQpIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIG9rSWYoSW5wdXRVdGlsLmlzQVBMVXNlckV2ZW50V2l0aE1hdGNoaW5nQ29udHJvbElkKGlucHV0LCB0aGlzLmlkKSk7XG4gICAgICAgICAgICB0aGlzLmhhbmRsZUZ1bmMgPSB0aGlzLmhhbmRsZU9yZGluYWxTY3JlZW5FdmVudDtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIGNhdGNoIChlKSB7IHJldHVybiBmYWxzZUlmR3VhcmRGYWlsZWQoZSk7IH1cbiAgICB9XG5cbiAgICBoYW5kbGVPcmRpbmFsU2NyZWVuRXZlbnQoaW5wdXQ6IENvbnRyb2xJbnB1dCwgcmVzdWx0QnVpbGRlcjogQ29udHJvbFJlc3VsdEJ1aWxkZXIpOiB2b2lkIHtcbiAgICAgICAgY29uc3Qgb25TY3JlZW5DaG9pY2VzID0gdGhpcy5nZXRDaG9pY2VzTGlzdChpbnB1dCk7XG4gICAgICAgIGlmIChvblNjcmVlbkNob2ljZXMgPT09IG51bGwpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBTdGF0ZUNvbnNpc3RlbmN5RXJyb3IoJ09yZGluYWxTY3JlZW5FdmVudCByZWNlaXZlZCBidXQgbm8ga25vd24gbGlzdCB2YWx1ZXMuJyk7XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBvcmRpbmFsID0gKGlucHV0LnJlcXVlc3QgYXMgaW50ZXJmYWNlcy5hbGV4YS5wcmVzZW50YXRpb24uYXBsLlVzZXJFdmVudCkuYXJndW1lbnRzIVsxXTtcbiAgICAgICAgaWYgKG9yZGluYWwgPCAwIHx8IG9yZGluYWwgPiBvblNjcmVlbkNob2ljZXMubGVuZ3RoKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgU3RhdGVDb25zaXN0ZW5jeUVycm9yKGBBUEwgT3JkaW5hbCBvdXQgb2YgcmFuZ2UuIG9yZGluYWw9JHtvcmRpbmFsfSB2YWx1ZUxpc3Q9JHtvblNjcmVlbkNob2ljZXN9YCk7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgdmFsdWUgPSBvblNjcmVlbkNob2ljZXNbb3JkaW5hbCAtIDFdO1xuICAgICAgICB0aGlzLnNldFZhbHVlKHZhbHVlLCB0cnVlKTtcblxuICAgICAgICAvLyBmZWVkYmFja1xuICAgICAgICByZXN1bHRCdWlsZGVyLmFkZEFjdChuZXcgVmFsdWVTZXRBY3QodGhpcywgeyB2YWx1ZSB9KSk7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBpc09yZGluYWxTZWxlY3Rpb24oaW5wdXQ6IENvbnRyb2xJbnB1dCk6IGJvb2xlYW4ge1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgb2tJZihJbnB1dFV0aWwuaXNJbnRlbnQoaW5wdXQsIE9yZGluYWxDb250cm9sSW50ZW50Lm5hbWUpKTtcbiAgICAgICAgICAgIGNvbnN0IHsgZmVlZGJhY2ssIGFjdGlvbiwgdGFyZ2V0LCAnQU1BWk9OLk9yZGluYWwnOiB2YWx1ZX0gPSB1bnBhY2tPcmRpbmFsQ29udHJvbEludGVudCgoaW5wdXQucmVxdWVzdCBhcyBJbnRlbnRSZXF1ZXN0KS5pbnRlbnQpO1xuICAgICAgICAgICAgb2tJZihJbnB1dFV0aWwuZmVlZGJhY2tJc01hdGNoT3JVbmRlZmluZWQoZmVlZGJhY2ssIFskLkZlZWRiYWNrLkFmZmlybSwgJC5GZWVkYmFjay5EaXNhZmZpcm1dKSk7XG4gICAgICAgICAgICBva0lmKElucHV0VXRpbC5hY3Rpb25Jc01hdGNoT3JVbmRlZmluZWQoYWN0aW9uLCB0aGlzLnByb3BzLmludGVyYWN0aW9uTW9kZWwuYWN0aW9ucy5zZXQpKTtcbiAgICAgICAgICAgIG9rSWYoSW5wdXRVdGlsLnRhcmdldElzTWF0Y2hPclVuZGVmaW5lZCh0YXJnZXQsIHRoaXMucHJvcHMuaW50ZXJhY3Rpb25Nb2RlbC50YXJnZXRzKSk7XG4gICAgICAgICAgICBva0lmKElucHV0VXRpbC52YWx1ZVN0ckRlZmluZWQodmFsdWUpKTtcbiAgICAgICAgICAgIHRoaXMuaGFuZGxlRnVuYyA9IHRoaXMuaGFuZGxlT3JkaW5hbFNlbGVjdGlvbjtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIGNhdGNoIChlKSB7IHJldHVybiBmYWxzZUlmR3VhcmRGYWlsZWQoZSk7IH1cbiAgICB9XG5cbiAgICBoYW5kbGVPcmRpbmFsU2VsZWN0aW9uKGlucHV0OiBDb250cm9sSW5wdXQsIHJlc3VsdEJ1aWxkZXI6IENvbnRyb2xSZXN1bHRCdWlsZGVyKTogdm9pZCB7XG4gICAgICAgIGNvbnN0IGFsbENob2ljZXMgPSB0aGlzLmdldENob2ljZXNMaXN0KGlucHV0KTtcbiAgICAgICAgY29uc3Qgc3Bva2VuQ2hvaWNlcyA9IHRoaXMuZ2V0Q2hvaWNlc0Zyb21BY3RpdmVQYWdlKGFsbENob2ljZXMpO1xuICAgICAgICBjb25zdCB7J0FNQVpPTi5PcmRpbmFsJzogdmFsdWVTdHJ9ID0gdW5wYWNrT3JkaW5hbENvbnRyb2xJbnRlbnQoKGlucHV0LnJlcXVlc3QgYXMgSW50ZW50UmVxdWVzdCkuaW50ZW50KTtcblxuICAgICAgICBjb25zdCB2YWx1ZSA9IHZhbHVlU3RyICE9PSB1bmRlZmluZWQgPyBOdW1iZXIucGFyc2VJbnQodmFsdWVTdHIhLCAxMCkgOiB1bmRlZmluZWQ7XG4gICAgICAgIGlmICh2YWx1ZSAhPT0gdW5kZWZpbmVkICYmIHZhbHVlIDw9IHNwb2tlbkNob2ljZXMubGVuZ3RoKXtcbiAgICAgICAgICAgIHRoaXMuc2V0VmFsdWUoc3Bva2VuQ2hvaWNlc1t2YWx1ZSAtIDFdLCB0cnVlKTtcbiAgICAgICAgICAgIHJlc3VsdEJ1aWxkZXIuYWRkQWN0KG5ldyBWYWx1ZVNldEFjdCh0aGlzLCB7IHZhbHVlOiB0aGlzLnN0YXRlLnZhbHVlIH0pKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICByZXN1bHRCdWlsZGVyLmFkZEFjdChcbiAgICAgICAgICAgIG5ldyBVbnVzYWJsZUlucHV0VmFsdWVBY3QodGhpcywge3ZhbHVlLCByZWFzb25Db2RlOiAnT3JkaW5hbE91dE9mUmFuZ2UnLCByZW5kZXJlZFJlYXNvbjogJ0kgZG9uXFwndCBrbm93IHdoaWNoIHlvdSBtZWFuLicgfSlcbiAgICAgICAgKTtcbiAgICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIERpcmVjdGx5IHNldCB0aGUgKG5ldykgdmFsdWUgZm9yIHRoZSBjb250cm9sXG4gICAgICpcbiAgICAgKiBBZnRlciBzZXR0aW5nIHRoZSB2YWx1ZSwgaXQgaXMgdXN1YWwgdG8gY2FsbFxuICAgICAqIGBgYHRzXG4gICAgICogaWYgKGNvbnRyb2wud2FudHNUb0Rpc2N1c3NWYWx1ZSgpKXtcbiAgICAgKiAgIGNvbnRyb2wuZGlzY3Vzc1ZhbHVlKClcbiAgICAgKiB9XG4gICAgICogYGBgXG4gICAgICogQHBhcmFtIHZhbHVlXG4gICAgICovXG4gICAgc2V0VmFsdWUodmFsdWU6IHN0cmluZywgZXJNYXRjaDogYm9vbGVhbikge1xuICAgICAgICB0aGlzLnN0YXRlLnByZXZpb3VzVmFsdWUgPSB0aGlzLnN0YXRlLnZhbHVlO1xuICAgICAgICB0aGlzLnN0YXRlLnZhbHVlID0gdmFsdWU7XG4gICAgICAgIHRoaXMuc3RhdGUuZXJNYXRjaCA9IGVyTWF0Y2g7XG4gICAgICAgIHRoaXMuc3RhdGUuaXNWYWx1ZUNvbmZpcm1lZCA9IGZhbHNlO1xuICAgIH1cblxuICAgIGNsZWFyKCkge1xuICAgICAgICB0aGlzLnN0YXRlLnZhbHVlID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLnN0YXRlLmVsaWNpdGF0aW9uQWN0aW9uID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLnN0YXRlLnNwb2tlbkl0ZW1zUGFnZUluZGV4ID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLnN0YXRlLnByZXZpb3VzVmFsdWUgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMuc3RhdGUuaXNWYWx1ZUNvbmZpcm1lZCA9IGZhbHNlO1xuICAgICAgICB0aGlzLnN0YXRlLmxhc3RJbml0aWF0aXZlQWN0ID0gdW5kZWZpbmVkO1xuICAgIH1cblxuICAgIGNhblRha2VJbml0aWF0aXZlKGlucHV0OiBDb250cm9sSW5wdXQpOiBib29sZWFuIHtcbiAgICAgICAgcmV0dXJuIHRoaXMud2FudHNUb0NvbmZpcm1WYWx1ZShpbnB1dClcbiAgICAgICAgICAgIHx8IHRoaXMud2FudHNUb0ZpeEludmFsaWRWYWx1ZShpbnB1dClcbiAgICAgICAgICAgIHx8IHRoaXMud2FudHNUb0VsaWNpdFZhbHVlKGlucHV0KTtcbiAgICB9XG5cbiAgICBhc3luYyB0YWtlSW5pdGlhdGl2ZShpbnB1dDogQ29udHJvbElucHV0LCByZXN1bHRCdWlsZGVyOiBDb250cm9sUmVzdWx0QnVpbGRlcik6IFByb21pc2U8dm9pZD4geyAvLyBUT0RPOiBDaGFuZ2UgdG8gZm9sbG93IGNhbkhhbmRsZS9oYW5kbGUgbG9naWNcbiAgICAgICAgaWYgKHRoaXMud2FudHNUb0VsaWNpdFZhbHVlKGlucHV0KSkge1xuICAgICAgICAgICAgdGhpcy5hc2tFbGljaXRhdGlvblF1ZXN0aW9uKCQuQWN0aW9uLlNldCwgaW5wdXQsIHJlc3VsdEJ1aWxkZXIpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKHRoaXMud2FudHNUb0ZpeEludmFsaWRWYWx1ZShpbnB1dCkpe1xuICAgICAgICAgICAgdGhpcy52YWxpZGF0ZUFuZEFkZEFjdHMoaW5wdXQsIHJlc3VsdEJ1aWxkZXIsICQuQWN0aW9uLkNoYW5nZSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAodGhpcy53YW50c1RvQ29uZmlybVZhbHVlKGlucHV0KSkge1xuICAgICAgICAgICAgdGhpcy5jb25maXJtVmFsdWUoaW5wdXQsIHJlc3VsdEJ1aWxkZXIpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICB3YW50c1RvQ29uZmlybVZhbHVlKGlucHV0OiBDb250cm9sSW5wdXQpOiBib29sZWFuIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuc3RhdGUudmFsdWUgIT09IHVuZGVmaW5lZCAmJiB0aGlzLnN0YXRlLmlzVmFsdWVDb25maXJtZWQgPT09IGZhbHNlICYmIHRoaXMuZXZhbHVhdGVCb29sZWFuUHJvcCh0aGlzLnByb3BzLmNvbmZpcm1hdGlvblJlcXVpcmVkLCBpbnB1dCk7XG4gICAgfVxuXG4gICAgY29uZmlybVZhbHVlKGlucHV0OiBDb250cm9sSW5wdXQsIHJlc3VsdEJ1aWxkZXI6IENvbnRyb2xSZXN1bHRCdWlsZGVyKTogdm9pZCB7XG4gICAgICAgIHRoaXMuc3RhdGUubGFzdEluaXRpYXRpdmVBY3QgPSAnQ29uZmlybVZhbHVlQWN0JztcbiAgICAgICAgcmVzdWx0QnVpbGRlci5hZGRBY3QobmV3IENvbmZpcm1WYWx1ZUFjdCh0aGlzLCB7IHZhbHVlOiB0aGlzLnN0YXRlLnZhbHVlIH0pKTtcbiAgICB9XG5cbiAgICB3YW50c1RvRml4SW52YWxpZFZhbHVlKGlucHV0OiBDb250cm9sSW5wdXQpOiBib29sZWFuIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuc3RhdGUudmFsdWUgIT09IHVuZGVmaW5lZCAmJiB0aGlzLnZhbGlkYXRlKGlucHV0KSAhPT0gdHJ1ZTtcbiAgICB9XG4gICAgXG4gICAgd2FudHNUb0VsaWNpdFZhbHVlKGlucHV0OiBDb250cm9sSW5wdXQpOiBib29sZWFuIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuc3RhdGUudmFsdWUgPT09IHVuZGVmaW5lZCAmJiB0aGlzLmV2YWx1YXRlQm9vbGVhblByb3AodGhpcy5wcm9wcy5yZXF1aXJlZCwgaW5wdXQpO1xuICAgIH1cblxuICAgIHZhbGlkYXRlQW5kQWRkQWN0cyhpbnB1dDogQ29udHJvbElucHV0LCByZXN1bHRCdWlsZGVyOiBDb250cm9sUmVzdWx0QnVpbGRlciwgZWxpY2l0YXRpb25BY3Rpb246IHN0cmluZyk6IHZvaWQge1xuICAgICAgICB0aGlzLnN0YXRlLmVsaWNpdGF0aW9uQWN0aW9uID0gZWxpY2l0YXRpb25BY3Rpb247XG4gICAgICAgIGlmICh0aGlzLndhbnRzVG9Db25maXJtVmFsdWUoaW5wdXQpKXtcbiAgICAgICAgICAgIHRoaXMuY29uZmlybVZhbHVlKGlucHV0LCByZXN1bHRCdWlsZGVyKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IHZhbGlkYXRpb25SZXN1bHQ6IHRydWUgfCBWYWxpZGF0aW9uUmVzdWx0ID0gdGhpcy52YWxpZGF0ZShpbnB1dCk7XG4gICAgICAgIGlmICh2YWxpZGF0aW9uUmVzdWx0ID09PSB0cnVlKSB7XG4gICAgICAgICAgICBpZiAoZWxpY2l0YXRpb25BY3Rpb24gPT09ICQuQWN0aW9uLkNoYW5nZSkge1xuICAgICAgICAgICAgICAgIC8vIGlmIGVsaWNpdGF0aW9uQWN0aW9uID09ICdjaGFuZ2UnLCB0aGVuIHRoZSBwcmV2aW91c1ZhbHVlIG11c3QgYmUgZGVmaW5lZC5cbiAgICAgICAgICAgICAgICBpZiAodGhpcy5zdGF0ZS5wcmV2aW91c1ZhbHVlICE9PSB1bmRlZmluZWQpe1xuICAgICAgICAgICAgICAgICAgICByZXN1bHRCdWlsZGVyLmFkZEFjdChcbiAgICAgICAgICAgICAgICAgICAgICAgIG5ldyBWYWx1ZUNoYW5nZWRBY3Q8c3RyaW5nPih0aGlzLCB7cHJldmlvdXNWYWx1ZTogdGhpcy5zdGF0ZS5wcmV2aW91c1ZhbHVlLCB2YWx1ZTogdGhpcy5zdGF0ZS52YWx1ZSEgfSlcbiAgICAgICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignVmFsdWVDaGFuZ2VkQWN0IHNob3VsZCBvbmx5IGJlIHVzZWQgaWYgdGhlcmUgaXMgYW4gYWN0dWFsIHByZXZpb3VzIHZhbHVlJyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgcmVzdWx0QnVpbGRlci5hZGRBY3QobmV3IFZhbHVlU2V0QWN0KHRoaXMsIHsgdmFsdWU6IHRoaXMuc3RhdGUudmFsdWUgfSkpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgLy8gZmVlZGJhY2tcbiAgICAgICAgICAgIHJlc3VsdEJ1aWxkZXIuYWRkQWN0KG5ldyBJbnZhbGlkVmFsdWVBY3Q8c3RyaW5nPihcbiAgICAgICAgICAgICAgICB0aGlzLCBcbiAgICAgICAgICAgICAgICB7IFxuICAgICAgICAgICAgICAgICAgICB2YWx1ZTogdGhpcy5zdGF0ZS52YWx1ZSEsIFxuICAgICAgICAgICAgICAgICAgICByZWFzb25Db2RlOiB2YWxpZGF0aW9uUmVzdWx0LnJlYXNvbkNvZGUsIFxuICAgICAgICAgICAgICAgICAgICByZW5kZXJlZFJlYXNvbjogdmFsaWRhdGlvblJlc3VsdC5yZW5kZXJlZFJlYXNvbiBcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIHRoaXMuYXNrRWxpY2l0YXRpb25RdWVzdGlvbihlbGljaXRhdGlvbkFjdGlvbiwgaW5wdXQsIHJlc3VsdEJ1aWxkZXIpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICB2YWxpZGF0ZShpbnB1dDogQ29udHJvbElucHV0KTogdHJ1ZSB8IFZhbGlkYXRpb25SZXN1bHQge1xuICAgICAgICBjb25zdCBsaXN0T2ZWYWxpZGF0aW9uRnVuYzogU2xvdFZhbGlkYXRpb25GdW5jdGlvbltdID0gdHlwZW9mKHRoaXMucHJvcHMudmFsaWRhdGlvbikgPT09ICdmdW5jdGlvbicgPyBbdGhpcy5wcm9wcy52YWxpZGF0aW9uXSA6IHRoaXMucHJvcHMudmFsaWRhdGlvbjtcbiAgICAgICAgZm9yIChjb25zdCB2YWxpZGF0aW9uRnVuY3Rpb24gb2YgbGlzdE9mVmFsaWRhdGlvbkZ1bmMpIHtcbiAgICAgICAgICAgIGNvbnN0IHZhbGlkYXRpb25SZXN1bHQ6IHRydWUgfCBWYWxpZGF0aW9uUmVzdWx0ID0gdmFsaWRhdGlvbkZ1bmN0aW9uKHRoaXMuc3RhdGUsIGlucHV0KTtcbiAgICAgICAgICAgIGlmICh2YWxpZGF0aW9uUmVzdWx0ICE9PSB0cnVlKSB7XG4gICAgICAgICAgICAgICAgbG9nLmRlYnVnKGBMaXN0Q29udHJvbC52YWxpZGF0ZSgpOiB2YWxpZGF0aW9uIGZhaWxlZC4gUmVhc29uOiAke0pTT04uc3RyaW5naWZ5KHZhbGlkYXRpb25SZXN1bHQsIG51bGwsIDIpfS5gKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gdmFsaWRhdGlvblJlc3VsdDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG5cbiAgICBhc2tFbGljaXRhdGlvblF1ZXN0aW9uKGVsaWNpdGF0aW9uQWN0aW9uOiBzdHJpbmcsIGlucHV0OiBDb250cm9sSW5wdXQsIHJlc3VsdEJ1aWxkZXI6IENvbnRyb2xSZXN1bHRCdWlsZGVyKSB7XG4gICAgICAgIHRoaXMuc3RhdGUuZWxpY2l0YXRpb25BY3Rpb24gPSBlbGljaXRhdGlvbkFjdGlvbjtcblxuICAgICAgICBjb25zdCBhbGxDaG9pY2VzID0gdGhpcy5nZXRDaG9pY2VzTGlzdChpbnB1dCk7XG4gICAgICAgIGlmIChhbGxDaG9pY2VzID09PSBudWxsKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0xpc3RDb250cm9sLmxpc3RJdGVtSURzIGlzIG51bGwnKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IGNob2ljZXNGcm9tQWN0aXZlUGFnZSA9IHRoaXMuZ2V0Q2hvaWNlc0Zyb21BY3RpdmVQYWdlKGFsbENob2ljZXMpO1xuICAgICAgICBzd2l0Y2ggKGVsaWNpdGF0aW9uQWN0aW9uKSB7XG4gICAgICAgICAgICBjYXNlICQuQWN0aW9uLlNldDpcbiAgICAgICAgICAgICAgICByZXN1bHRCdWlsZGVyLmFkZEFjdChuZXcgUmVxdWVzdFZhbHVlQnlMaXN0QWN0KHRoaXMsIHtjaG9pY2VzRnJvbUFjdGl2ZVBhZ2UsIGFsbENob2ljZXN9KSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgY2FzZSAkLkFjdGlvbi5DaGFuZ2U6XG4gICAgICAgICAgICAgICAgcmVzdWx0QnVpbGRlci5hZGRBY3QoXG4gICAgICAgICAgICAgICAgICAgIG5ldyBSZXF1ZXN0Q2hhbmdlZFZhbHVlQnlMaXN0QWN0KHRoaXMsIHtjdXJyZW50VmFsdWU6IHRoaXMuc3RhdGUudmFsdWUhLCBjaG9pY2VzRnJvbUFjdGl2ZVBhZ2UsIGFsbENob2ljZXN9KVxuICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYFVuaGFuZGxlZC4gVW5rbm93biBlbGljaXRhdGlvbkFjdGlvbjogJHtlbGljaXRhdGlvbkFjdGlvbn1gKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHN0cmluZ2lmeVN0YXRlRm9yRGlhZ3JhbSgpOiBzdHJpbmcge1xuICAgICAgICBsZXQgdGV4dCA9IHRoaXMuc3RhdGUudmFsdWUgPz8gJzxub25lPic7XG4gICAgICAgIGlmICh0aGlzLnN0YXRlLmVsaWNpdGF0aW9uQWN0aW9uICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRleHQgKz0gYFtlbGljaXRpbmcsICR7dGhpcy5zdGF0ZS5lbGljaXRhdGlvbkFjdGlvbn1dYDtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdGV4dDtcbiAgICB9XG5cbiAgICBnZXRDaG9pY2VzTGlzdChpbnB1dDogQ29udHJvbElucHV0KTogc3RyaW5nW10ge1xuICAgICAgICBjb25zdCBzbG90SWRzOiBzdHJpbmdbXSA9ICh0eXBlb2YgdGhpcy5wcm9wcy5saXN0SXRlbUlEcyA9PT0gJ2Z1bmN0aW9uJylcbiAgICAgICAgICAgID8gdGhpcy5wcm9wcy5saXN0SXRlbUlEcy5jYWxsKHRoaXMsIGlucHV0KVxuICAgICAgICAgICAgOiB0aGlzLnByb3BzLmxpc3RJdGVtSURzO1xuICAgICAgICByZXR1cm4gc2xvdElkcztcbiAgICB9XG5cbiAgICBnZXRDaG9pY2VzRnJvbUFjdGl2ZVBhZ2UoYWxsQ2hvaWNlczogc3RyaW5nW10pOiBzdHJpbmdbXSB7XG4gICAgICAgIGNvbnN0IHN0YXJ0ID0gdGhpcy5nZXRQYWdlSW5kZXgoKTtcbiAgICAgICAgY29uc3QgZW5kID0gc3RhcnQgKyB0aGlzLnByb3BzLnBhZ2VTaXplO1xuICAgICAgICByZXR1cm4gYWxsQ2hvaWNlcy5zbGljZShzdGFydCwgZW5kKTtcbiAgICB9XG5cbiAgICBnZXRQYWdlSW5kZXgoKTogbnVtYmVyIHtcbiAgICAgICAgaWYgKHRoaXMuc3RhdGUuc3Bva2VuSXRlbXNQYWdlSW5kZXggPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGhpcy5zdGF0ZS5zcG9rZW5JdGVtc1BhZ2VJbmRleCA9IDA7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRoaXMuc3RhdGUuc3Bva2VuSXRlbXNQYWdlSW5kZXg7XG4gICAgfVxuXG4gICAgcmVuZGVyQWN0KGFjdDogU3lzdGVtQWN0LCBpbnB1dDogQ29udHJvbElucHV0LCBidWlsZGVyOiBDb250cm9sUmVzcG9uc2VCdWlsZGVyKTogdm9pZCB7XG5cbiAgICAgICAgaWYgKGFjdCBpbnN0YW5jZW9mIFJlcXVlc3RWYWx1ZUJ5TGlzdEFjdCB8fCBhY3QgaW5zdGFuY2VvZiBSZXF1ZXN0Q2hhbmdlZFZhbHVlQnlMaXN0QWN0KSB7XG5cbiAgICAgICAgICAgIGNvbnN0IHByb21wdCA9IGFjdCBpbnN0YW5jZW9mIFJlcXVlc3RWYWx1ZUJ5TGlzdEFjdFxuICAgICAgICAgICAgICAgID8gdGhpcy5ldmFsdWF0ZVByb21wdFByb3AoYWN0LCB0aGlzLnByb3BzLnByb21wdHMucmVxdWVzdFZhbHVlLCBpbnB1dClcbiAgICAgICAgICAgICAgICA6IHRoaXMuZXZhbHVhdGVQcm9tcHRQcm9wKGFjdCwgdGhpcy5wcm9wcy5wcm9tcHRzLnJlcXVlc3RDaGFuZ2VkVmFsdWUsIGlucHV0KTtcbiAgICAgICAgICAgIGNvbnN0IHJlcHJvbXB0ID0gYWN0IGluc3RhbmNlb2YgUmVxdWVzdFZhbHVlQnlMaXN0QWN0XG4gICAgICAgICAgICAgICAgPyB0aGlzLmV2YWx1YXRlUHJvbXB0UHJvcChhY3QsIHRoaXMucHJvcHMucmVwcm9tcHRzLnJlcXVlc3RWYWx1ZSwgaW5wdXQpXG4gICAgICAgICAgICAgICAgOiB0aGlzLmV2YWx1YXRlUHJvbXB0UHJvcChhY3QsIHRoaXMucHJvcHMucmVwcm9tcHRzLnJlcXVlc3RDaGFuZ2VkVmFsdWUsIGlucHV0KTtcblxuICAgICAgICAgICAgYnVpbGRlci5hZGRQcm9tcHRGcmFnbWVudCh0aGlzLmV2YWx1YXRlUHJvbXB0UHJvcChhY3QsIHByb21wdCwgaW5wdXQpKTtcbiAgICAgICAgICAgIGJ1aWxkZXIuYWRkUmVwcm9tcHRGcmFnbWVudCh0aGlzLmV2YWx1YXRlUHJvbXB0UHJvcChhY3QsIHJlcHJvbXB0LCBpbnB1dCkpO1xuXG4gICAgICAgICAgICBpZiAodGhpcy5ldmFsdWF0ZUJvb2xlYW5Qcm9wKHRoaXMucHJvcHMuYXBsLmVuYWJsZWQsIGlucHV0KSkge1xuICAgICAgICAgICAgICAgIGNvbnN0IGl0ZW1zQXJyYXk6IEFQTExpc3RJdGVtW10gPSBbXTtcbiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IGNob2ljZSBvZiBhY3QucGF5bG9hZC5hbGxDaG9pY2VzKSB7XG4gICAgICAgICAgICAgICAgICAgIGl0ZW1zQXJyYXkucHVzaCh7XG4gICAgICAgICAgICAgICAgICAgICAgICBwcmltYXJ5VGV4dDogY2hvaWNlXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIC8vIElmIEFQTCBpcyBkZWZpbmVkIGluIGFjdCAmIHVzZXJzJyBkZXZpY2Ugc3VwcG9ydCBBUExcbiAgICAgICAgICAgICAgICBpZiAoZ2V0U3VwcG9ydGVkSW50ZXJmYWNlcyhpbnB1dC5oYW5kbGVySW5wdXQucmVxdWVzdEVudmVsb3BlKVsnQWxleGEuUHJlc2VudGF0aW9uLkFQTCddKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGFwbERhdGFTb3VyY2UgPSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0ZXh0TGlzdERhdGE6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250cm9sSWQ6IHRoaXMuaWQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaGVhZGVyVGl0bGU6IGkxOG5leHQudCgnTElTVF9DT05UUk9MX0RFRkFVTFRfQVBMX0hFQURFUl9USVRMRScpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW1zOiBpdGVtc0FycmF5LFxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgICAgICAvLyBUT0RPOiBhcGwgbWVyZ2luZyAvIGNvbWJpbmF0aW9uIHN0cmF0ZWd5XG4gICAgICAgICAgICAgICAgICAgIGJ1aWxkZXIuYWRkQVBMUmVuZGVyRG9jdW1lbnREaXJlY3RpdmUoJ1Rva2VuJywgdGhpcy5wcm9wcy5hcGwucmVxdWVzdEFQTERvY3VtZW50LCBhcGxEYXRhU291cmNlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBlbHNlIGlmIChhY3QgaW5zdGFuY2VvZiBVbnVzYWJsZUlucHV0VmFsdWVBY3QpIHtcbiAgICAgICAgICAgIGJ1aWxkZXIuYWRkUHJvbXB0RnJhZ21lbnQodGhpcy5ldmFsdWF0ZVByb21wdFByb3AoYWN0LCB0aGlzLnByb3BzLnByb21wdHMudW51c2FibGVJbnB1dFZhbHVlLCBpbnB1dCkpO1xuICAgICAgICAgICAgYnVpbGRlci5hZGRSZXByb21wdEZyYWdtZW50KHRoaXMuZXZhbHVhdGVQcm9tcHRQcm9wKGFjdCwgdGhpcy5wcm9wcy5yZXByb21wdHMudW51c2FibGVJbnB1dFZhbHVlLCBpbnB1dCkpO1xuICAgICAgICB9XG5cbiAgICAgICAgZWxzZSBpZiAoYWN0IGluc3RhbmNlb2YgSW52YWxpZFZhbHVlQWN0KSB7XG4gICAgICAgICAgICBidWlsZGVyLmFkZFByb21wdEZyYWdtZW50KHRoaXMuZXZhbHVhdGVQcm9tcHRQcm9wKGFjdCwgdGhpcy5wcm9wcy5wcm9tcHRzLmludmFsaWRWYWx1ZSwgaW5wdXQpKTtcbiAgICAgICAgICAgIGJ1aWxkZXIuYWRkUmVwcm9tcHRGcmFnbWVudCh0aGlzLmV2YWx1YXRlUHJvbXB0UHJvcChhY3QsIHRoaXMucHJvcHMucmVwcm9tcHRzLmludmFsaWRWYWx1ZSwgaW5wdXQpKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGVsc2UgaWYgKGFjdCBpbnN0YW5jZW9mIFZhbHVlU2V0QWN0KSB7XG4gICAgICAgICAgICBidWlsZGVyLmFkZFByb21wdEZyYWdtZW50KHRoaXMuZXZhbHVhdGVQcm9tcHRQcm9wKGFjdCwgdGhpcy5wcm9wcy5wcm9tcHRzLnZhbHVlU2V0LCBpbnB1dCkpO1xuICAgICAgICAgICAgYnVpbGRlci5hZGRSZXByb21wdEZyYWdtZW50KHRoaXMuZXZhbHVhdGVQcm9tcHRQcm9wKGFjdCwgdGhpcy5wcm9wcy5yZXByb21wdHMudmFsdWVTZXQsIGlucHV0KSk7XG4gICAgICAgIH1cblxuICAgICAgICBlbHNlIGlmIChhY3QgaW5zdGFuY2VvZiBWYWx1ZUNoYW5nZWRBY3QpIHtcbiAgICAgICAgICAgIGJ1aWxkZXIuYWRkUHJvbXB0RnJhZ21lbnQodGhpcy5ldmFsdWF0ZVByb21wdFByb3AoYWN0LCB0aGlzLnByb3BzLnByb21wdHMudmFsdWVDaGFuZ2VkLCBpbnB1dCkpO1xuICAgICAgICAgICAgYnVpbGRlci5hZGRSZXByb21wdEZyYWdtZW50KHRoaXMuZXZhbHVhdGVQcm9tcHRQcm9wKGFjdCwgdGhpcy5wcm9wcy5yZXByb21wdHMudmFsdWVDaGFuZ2VkLCBpbnB1dCkpO1xuICAgICAgICB9XG5cbiAgICAgICAgZWxzZSBpZiAoYWN0IGluc3RhbmNlb2YgQ29uZmlybVZhbHVlQWN0KSB7XG4gICAgICAgICAgICBidWlsZGVyLmFkZFByb21wdEZyYWdtZW50KHRoaXMuZXZhbHVhdGVQcm9tcHRQcm9wKGFjdCwgdGhpcy5wcm9wcy5wcm9tcHRzLmNvbmZpcm1WYWx1ZSwgaW5wdXQpKTtcbiAgICAgICAgICAgIGJ1aWxkZXIuYWRkUmVwcm9tcHRGcmFnbWVudCh0aGlzLmV2YWx1YXRlUHJvbXB0UHJvcChhY3QsIHRoaXMucHJvcHMucmVwcm9tcHRzLmNvbmZpcm1WYWx1ZSwgaW5wdXQpKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGVsc2UgaWYgKGFjdCBpbnN0YW5jZW9mIFZhbHVlQ29uZmlybWVkQWN0KSB7XG4gICAgICAgICAgICBidWlsZGVyLmFkZFByb21wdEZyYWdtZW50KHRoaXMuZXZhbHVhdGVQcm9tcHRQcm9wKGFjdCwgdGhpcy5wcm9wcy5wcm9tcHRzLnZhbHVlQWZmaXJtZWQsIGlucHV0KSk7XG4gICAgICAgICAgICBidWlsZGVyLmFkZFJlcHJvbXB0RnJhZ21lbnQodGhpcy5ldmFsdWF0ZVByb21wdFByb3AoYWN0LCB0aGlzLnByb3BzLnJlcHJvbXB0cy52YWx1ZUFmZmlybWVkLCBpbnB1dCkpO1xuICAgICAgICB9XG5cbiAgICAgICAgZWxzZSBpZiAoYWN0IGluc3RhbmNlb2YgVmFsdWVEaXNjb25maXJtZWRBY3QpIHtcbiAgICAgICAgICAgIGJ1aWxkZXIuYWRkUHJvbXB0RnJhZ21lbnQodGhpcy5ldmFsdWF0ZVByb21wdFByb3AoYWN0LCB0aGlzLnByb3BzLnByb21wdHMudmFsdWVEaXNhZmZpcm1lZCwgaW5wdXQpKTtcbiAgICAgICAgICAgIGJ1aWxkZXIuYWRkUmVwcm9tcHRGcmFnbWVudCh0aGlzLmV2YWx1YXRlUHJvbXB0UHJvcChhY3QsIHRoaXMucHJvcHMucmVwcm9tcHRzLnZhbHVlRGlzYWZmaXJtZWQsIGlucHV0KSk7XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgdGhpcy50aHJvd1VuaGFuZGxlZEFjdEVycm9yKGFjdCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICB1cGRhdGVJbnRlcmFjdGlvbk1vZGVsKGdlbmVyYXRvcjogQ29udHJvbEludGVyYWN0aW9uTW9kZWxHZW5lcmF0b3IsIGltRGF0YTogTW9kZWxEYXRhKSB7XG4gICAgICAgIGdlbmVyYXRvci5hZGRDb250cm9sSW50ZW50KG5ldyBHZW5lcmFsQ29udHJvbEludGVudCgpLCBpbURhdGEpO1xuICAgICAgICBnZW5lcmF0b3IuYWRkQ29udHJvbEludGVudChuZXcgU2luZ2xlVmFsdWVDb250cm9sSW50ZW50KHRoaXMucHJvcHMuc2xvdFR5cGUpLCBpbURhdGEpO1xuICAgICAgICBnZW5lcmF0b3IuYWRkQ29udHJvbEludGVudChuZXcgT3JkaW5hbENvbnRyb2xJbnRlbnQoKSwgaW1EYXRhKTtcbiAgICAgICAgZ2VuZXJhdG9yLmFkZFllc0FuZE5vSW50ZW50cygpO1xuXG4gICAgICAgIGlmICh0aGlzLnByb3BzLmludGVyYWN0aW9uTW9kZWwudGFyZ2V0cy5pbmNsdWRlcygnY2hvaWNlJykpIHtcbiAgICAgICAgICAgIGdlbmVyYXRvci5hZGRWYWx1ZXNUb1Nsb3RUeXBlKFNoYXJlZFNsb3RUeXBlLlRBUkdFVCwgaTE4bmV4dC50KCdMSVNUX0NPTlRST0xfREVGQVVMVF9TTE9UX1ZBTFVFU19UQVJHRVRfQ0hPSUNFJywgeyByZXR1cm5PYmplY3RzOiB0cnVlIH0pKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICh0aGlzLnByb3BzLmludGVyYWN0aW9uTW9kZWwuYWN0aW9ucy5zZXQuaW5jbHVkZXMoJ3NlbGVjdCcpKSB7XG4gICAgICAgICAgICBnZW5lcmF0b3IuYWRkVmFsdWVzVG9TbG90VHlwZShTaGFyZWRTbG90VHlwZS5BQ1RJT04sIGkxOG5leHQudCgnTElTVF9DT05UUk9MX0RFRkFVTFRfU0xPVF9WQUxVRVNfQUNUSU9OX1NFTEVDVCcsIHsgcmV0dXJuT2JqZWN0czogdHJ1ZSB9KSk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBnZXRUYXJnZXRJZHMoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnByb3BzLmludGVyYWN0aW9uTW9kZWwudGFyZ2V0cztcbiAgICB9XG59XG4iXX0=