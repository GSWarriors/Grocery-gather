"use strict";
/*
 * Copyright 2019 Amazon.com, Inc. or its affiliates. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License").
 * You may not use this file except in compliance with the License.
 * A copy of the License is located at
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * or in the "license" file accompanying this file. This file is distributed
 * on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either
 * express or implied. See the License for the specific language governing
 * permissions and limitations under the License.
 */
Object.defineProperty(exports, "__esModule", { value: true });
exports.ValueControl = exports.ValueControlState = exports.ValueControlPromptProps = exports.ValueControlInteractionModelProps = void 0;
const tslib_1 = require("tslib");
const lodash_1 = tslib_1.__importDefault(require("lodash"));
const i18next_1 = tslib_1.__importDefault(require("i18next"));
const Strings_1 = require("../constants/Strings");
const Control_1 = require("../controls/Control");
const AmazonBuiltInSlotType_1 = require("../intents/AmazonBuiltInSlotType");
const GeneralControlIntent_1 = require("../intents/GeneralControlIntent");
const SingleValueControlIntent_1 = require("../intents/SingleValueControlIntent");
const Logger_1 = require("../logging/Logger");
const ContentActs_1 = require("../systemActs/ContentActs");
const InitiativeActs_1 = require("../systemActs/InitiativeActs");
const InputUtil_1 = require("../utils/InputUtil");
const Predicates_1 = require("../utils/Predicates");
const log = new Logger_1.Logger('AskSdkControls:ValueControl');
class ValueControlInteractionModelProps {
}
exports.ValueControlInteractionModelProps = ValueControlInteractionModelProps;
class ValueControlPromptProps {
}
exports.ValueControlPromptProps = ValueControlPromptProps;
class ValueControlState {
    constructor() {
        /**
         * Tracks whether the value is confirmed by the user, if confirmationRequired is set to true.
         */
        this.isValueConfirmed = false;
    }
}
exports.ValueControlState = ValueControlState;
class ValueControl extends Control_1.Control {
    constructor(props) {
        super(props.id);
        this.state = new ValueControlState();
        if (props.slotType === AmazonBuiltInSlotType_1.AmazonBuiltInSlotType.SEARCH_QUERY) {
            throw new Error('AMAZON.SearchQuery cannot be used with ValueControl due to the special rules regarding its use. '
                + 'Specifically, utterances that include SearchQuery must have a carrier phrase and not be comprised entirely of slot references. '
                + 'Use a custom intent to manage SearchQuery slots or create a regular slot for use with ValueControl.');
        }
        this.rawProps = props;
        this.props = ValueControl.mergeWithDefaultProps(props);
    }
    static mergeWithDefaultProps(props) {
        const defaults = {
            id: 'dummy',
            slotType: 'dummy',
            required: true,
            validation: [],
            confirmationRequired: false,
            interactionModel: {
                actions: {
                    set: [Strings_1.Strings.Action.Set],
                    change: [Strings_1.Strings.Action.Change],
                },
                targets: [Strings_1.Strings.Target.It]
            },
            prompts: {
                confirmValue: (act) => i18next_1.default.t('VALUE_CONTROL_DEFAULT_PROMPT_CONFIRM_VALUE', { value: act.payload.value }),
                valueAffirmed: i18next_1.default.t('VALUE_CONTROL_DEFAULT_PROMPT_VALUE_AFFIRMED'),
                valueDisaffirmed: i18next_1.default.t('VALUE_CONTROL_DEFAULT_PROMPT_VALUE_DISAFFIRMED'),
                valueSet: (act) => i18next_1.default.t('VALUE_CONTROL_DEFAULT_PROMPT_VALUE_SET', { value: act.payload.value }),
                valueChanged: (act) => i18next_1.default.t('VALUE_CONTROL_DEFAULT_PROMPT_VALUE_CHANGED', { value: act.payload.value }),
                invalidValue: (act) => {
                    if (act.payload.renderedReason !== undefined) {
                        return i18next_1.default.t('VALUE_CONTROL_DEFAULT_PROMPT_INVALID_VALUE_WITH_REASON', { value: act.payload.value, reason: act.payload.renderedReason });
                    }
                    return i18next_1.default.t('VALUE_CONTROL_DEFAULT_PROMPT_GENERAL_INVALID_VALUE', { value: act.payload.value });
                },
                requestValue: () => i18next_1.default.t('VALUE_CONTROL_DEFAULT_PROMPT_REQUEST_VALUE'),
                requestChangedValue: () => i18next_1.default.t('VALUE_CONTROL_DEFAULT_PROMPT_REQUEST_CHANGED_VALUE'),
            },
            reprompts: {
                confirmValue: (act) => i18next_1.default.t('VALUE_CONTROL_DEFAULT_REPROMPT_CONFIRM_VALUE', { value: act.payload.value }),
                valueAffirmed: i18next_1.default.t('VALUE_CONTROL_DEFAULT_REPROMPT_VALUE_AFFIRMED'),
                valueDisaffirmed: i18next_1.default.t('VALUE_CONTROL_DEFAULT_REPROMPT_VALUE_DISAFFIRMED'),
                valueSet: (act) => i18next_1.default.t('VALUE_CONTROL_DEFAULT_REPROMPT_VALUE_SET', { value: act.payload.value }),
                valueChanged: (act) => i18next_1.default.t('VALUE_CONTROL_DEFAULT_REPROMPT_VALUE_CHANGED', { value: act.payload.value }),
                invalidValue: (act) => {
                    if (act.payload.renderedReason !== undefined) {
                        return i18next_1.default.t('VALUE_CONTROL_DEFAULT_REPROMPT_INVALID_VALUE_WITH_REASON', { value: act.payload.value, reason: act.payload.renderedReason });
                    }
                    return i18next_1.default.t('VALUE_CONTROL_DEFAULT_REPROMPT_GENERAL_INVALID_VALUE', { value: act.payload.value });
                },
                requestValue: () => i18next_1.default.t('VALUE_CONTROL_DEFAULT_REPROMPT_REQUEST_VALUE'),
                requestChangedValue: () => i18next_1.default.t('VALUE_CONTROL_DEFAULT_REPROMPT_REQUEST_CHANGED_VALUE'),
            }
        };
        return lodash_1.default.merge(defaults, props);
    }
    canHandle(input) {
        return this.isSetWithValue(input)
            || this.isChangeWithValue(input)
            || this.isSetWithoutValue(input)
            || this.isChangeWithoutValue(input)
            || this.isBareValue(input)
            || this.isConfirmationAffirmed(input)
            || this.isConfirmationDisAffirmed(input);
    }
    async handle(input, resultBuilder) {
        if (this.handleFunc === undefined) {
            log.error('ValueControl: handle called but this.handleFunc is not set. canHandle() should be called first to set this.handleFunc.');
            const intent = input.request.intent;
            throw new Error(`${intent.name} can not be handled by ${this.constructor.name}.`);
        }
        this.handleFunc(input, resultBuilder);
    }
    /**
     * Test if the input is an implicit or explicit set-action with a value provided.
     *
     * @param input
     */
    isSetWithValue(input) {
        try {
            Predicates_1.okIf(InputUtil_1.InputUtil.isIntent(input, SingleValueControlIntent_1.SingleValueControlIntent.intentName(this.props.slotType)));
            const { feedback, action, target, valueStr, valueType } = SingleValueControlIntent_1.unpackSingleValueControlIntent(input.request.intent);
            Predicates_1.okIf(InputUtil_1.InputUtil.targetIsMatchOrUndefined(target, this.props.interactionModel.targets));
            Predicates_1.okIf(InputUtil_1.InputUtil.valueTypeMatch(valueType, this.props.slotType));
            Predicates_1.okIf(InputUtil_1.InputUtil.valueStrDefined(valueStr));
            Predicates_1.okIf(InputUtil_1.InputUtil.feedbackIsMatchOrUndefined(feedback, [Strings_1.Strings.Feedback.Affirm, Strings_1.Strings.Feedback.Disaffirm]));
            Predicates_1.okIf(InputUtil_1.InputUtil.actionIsMatch(action, this.props.interactionModel.actions.set));
            this.handleFunc = this.handleSetWithValue;
            return true;
        }
        catch (e) {
            return Predicates_1.falseIfGuardFailed(e);
        }
    }
    handleSetWithValue(input, resultBuilder) {
        const { valueStr, erMatch } = InputUtil_1.InputUtil.getValueResolution(input);
        this.setValue(valueStr, erMatch);
        this.validateAndAddActs(input, resultBuilder, Strings_1.Strings.Action.Set);
        return;
    }
    /**
     * Test if the input is an implicit or explicit set-action with no value
     *
     * @param input
     */
    isSetWithoutValue(input) {
        try {
            Predicates_1.okIf(InputUtil_1.InputUtil.isIntent(input, GeneralControlIntent_1.GeneralControlIntent.name));
            const { feedback, action, target } = GeneralControlIntent_1.unpackGeneralControlIntent(input.request.intent);
            Predicates_1.okIf(InputUtil_1.InputUtil.targetIsMatchOrUndefined(target, this.props.interactionModel.targets));
            Predicates_1.okIf(InputUtil_1.InputUtil.feedbackIsMatchOrUndefined(feedback, [Strings_1.Strings.Feedback.Affirm, Strings_1.Strings.Feedback.Disaffirm]));
            Predicates_1.okIf(InputUtil_1.InputUtil.actionIsMatch(action, this.props.interactionModel.actions.set));
            this.handleFunc = this.handleSetWithoutValue;
            return true;
        }
        catch (e) {
            return Predicates_1.falseIfGuardFailed(e);
        }
    }
    handleSetWithoutValue(input, resultBuilder) {
        this.askElicitationQuestion(Strings_1.Strings.Action.Set, input, resultBuilder);
        return;
    }
    /**
     * Test if the input is a valid change-action with a value provided.
     *
     * @param input
     */
    isChangeWithValue(input) {
        try {
            Predicates_1.okIf(InputUtil_1.InputUtil.isIntent(input, SingleValueControlIntent_1.SingleValueControlIntent.intentName(this.props.slotType)));
            const { feedback, action, target, valueStr, valueType } = SingleValueControlIntent_1.unpackSingleValueControlIntent(input.request.intent);
            Predicates_1.okIf(InputUtil_1.InputUtil.targetIsMatchOrUndefined(target, this.props.interactionModel.targets));
            Predicates_1.okIf(InputUtil_1.InputUtil.valueTypeMatch(valueType, this.props.slotType));
            Predicates_1.okIf(InputUtil_1.InputUtil.valueStrDefined(valueStr));
            Predicates_1.okIf(InputUtil_1.InputUtil.feedbackIsMatchOrUndefined(feedback, [Strings_1.Strings.Feedback.Affirm, Strings_1.Strings.Feedback.Disaffirm]));
            Predicates_1.okIf(InputUtil_1.InputUtil.actionIsMatch(action, this.props.interactionModel.actions.change));
            this.handleFunc = this.handleChangeWithValue;
            return true;
        }
        catch (e) {
            return Predicates_1.falseIfGuardFailed(e);
        }
    }
    handleChangeWithValue(input, resultBuilder) {
        const { valueStr, erMatch } = InputUtil_1.InputUtil.getValueResolution(input);
        this.setValue(valueStr, erMatch);
        this.validateAndAddActs(input, resultBuilder, this.state.value !== undefined ? Strings_1.Strings.Action.Change : Strings_1.Strings.Action.Set);
        return;
    }
    /**
     * Test if the input is a valid change-action without a value provided.
     *
     * @param input
     */
    isChangeWithoutValue(input) {
        try {
            Predicates_1.okIf(InputUtil_1.InputUtil.isIntent(input, GeneralControlIntent_1.GeneralControlIntent.name));
            const { feedback, action, target } = GeneralControlIntent_1.unpackGeneralControlIntent(input.request.intent);
            Predicates_1.okIf(InputUtil_1.InputUtil.targetIsMatchOrUndefined(target, this.props.interactionModel.targets));
            Predicates_1.okIf(InputUtil_1.InputUtil.feedbackIsMatchOrUndefined(feedback, [Strings_1.Strings.Feedback.Affirm, Strings_1.Strings.Feedback.Disaffirm]));
            Predicates_1.okIf(InputUtil_1.InputUtil.actionIsMatch(action, this.props.interactionModel.actions.change));
            this.handleFunc = this.handleChangeWithoutValue;
            return true;
        }
        catch (e) {
            return Predicates_1.falseIfGuardFailed(e);
        }
    }
    handleChangeWithoutValue(input, resultBuilder) {
        this.askElicitationQuestion(Strings_1.Strings.Action.Change, input, resultBuilder);
        return;
    }
    /**
     * Test if the input is a SingleValueControlIntent with just a slotValue provided.
     * If we aren't asking a question it is assumed the user meant 'set value'.
     * @param input
     */
    isBareValue(input) {
        try {
            Predicates_1.okIf(InputUtil_1.InputUtil.isIntent(input, SingleValueControlIntent_1.SingleValueControlIntent.intentName(this.props.slotType)));
            const { feedback, action, target, valueStr, valueType } = SingleValueControlIntent_1.unpackSingleValueControlIntent(input.request.intent);
            Predicates_1.okIf(InputUtil_1.InputUtil.feedbackIsUndefined(feedback));
            Predicates_1.okIf(InputUtil_1.InputUtil.actionIsUndefined(action));
            Predicates_1.okIf(InputUtil_1.InputUtil.targetIsUndefined(target));
            Predicates_1.okIf(InputUtil_1.InputUtil.valueStrDefined(valueStr));
            Predicates_1.okIf(InputUtil_1.InputUtil.valueTypeMatch(valueType, this.props.slotType));
            this.handleFunc = this.handleBareValue;
            return true;
        }
        catch (e) {
            return Predicates_1.falseIfGuardFailed(e);
        }
    }
    handleBareValue(input, resultBuilder) {
        var _a;
        const { valueStr, erMatch } = InputUtil_1.InputUtil.getValueResolution(input);
        this.setValue(valueStr, erMatch);
        this.validateAndAddActs(input, resultBuilder, (_a = this.state.elicitationAction) !== null && _a !== void 0 ? _a : Strings_1.Strings.Action.Set);
        return;
    }
    isConfirmationAffirmed(input) {
        try {
            Predicates_1.okIf(InputUtil_1.InputUtil.isBareYes(input));
            Predicates_1.okIf(this.state.lastInitiativeAct === 'ConfirmValueAct');
            this.handleFunc = this.handleConfirmationAffirmed;
            return true;
        }
        catch (e) {
            return Predicates_1.falseIfGuardFailed(e);
        }
    }
    handleConfirmationAffirmed(input, resultBuilder) {
        const validationResult = this.validate(input);
        if (validationResult !== true) {
            resultBuilder.addAct(new ContentActs_1.InvalidValueAct(this, {
                value: this.state.value,
                reasonCode: validationResult.reasonCode,
                renderedReason: validationResult.renderedReason
            }));
            this.askElicitationQuestion(Strings_1.Strings.Action.Change, input, resultBuilder);
        }
        else {
            this.state.isValueConfirmed = true;
            resultBuilder.addAct(new ContentActs_1.ValueConfirmedAct(this, { value: this.state.value }));
            if (this.state.elicitationAction === Strings_1.Strings.Action.Change) {
                if (this.state.previousValue !== undefined) {
                    resultBuilder.addAct(new ContentActs_1.ValueChangedAct(this, { previousValue: this.state.previousValue, value: this.state.value }));
                }
                else {
                    throw new Error('ValueChangedAct should only be used if there is an actual previous value');
                }
            }
            else {
                resultBuilder.addAct(new ContentActs_1.ValueSetAct(this, { value: this.state.value }));
            }
        }
    }
    isConfirmationDisAffirmed(input) {
        try {
            Predicates_1.okIf(InputUtil_1.InputUtil.isBareNo(input));
            Predicates_1.okIf(this.state.lastInitiativeAct === 'ConfirmValueAct');
            this.handleFunc = this.handleConfirmationDisAffirmed;
            return true;
        }
        catch (e) {
            return Predicates_1.falseIfGuardFailed(e);
        }
    }
    handleConfirmationDisAffirmed(input, resultBuilder) {
        this.state.isValueConfirmed = false;
        resultBuilder.addAct(new ContentActs_1.ValueDisconfirmedAct(this, { value: this.state.value }));
        resultBuilder.addAct(new InitiativeActs_1.RequestValueAct(this));
    }
    /**
     * Directly set the (new) value for the control
     *
     * After setting the value, it is usual to call
     * ```ts
     * if (control.wantsToConfirmValue()){
     *   control.confirmValue()
     * }
     * ```
     * @param value
     */
    setValue(value, erMatch) {
        this.state.previousValue = this.state.value;
        this.state.value = value;
        this.state.erMatch = erMatch;
        this.state.isValueConfirmed = false;
    }
    clear() {
        this.state.value = undefined;
        this.state.erMatch = undefined;
        this.state.elicitationAction = undefined;
        this.state.isValueConfirmed = false;
        this.state.previousValue = undefined;
        this.state.lastInitiativeAct = undefined;
    }
    canTakeInitiative(input) {
        return this.wantsToConfirmValue(input)
            || this.wantsToFixInvalidValue(input)
            || this.wantsToElicitValue(input);
    }
    async takeInitiative(input, resultBuilder) {
        if (this.wantsToElicitValue(input)) {
            this.askElicitationQuestion(Strings_1.Strings.Action.Set, input, resultBuilder);
        }
        else if (this.wantsToFixInvalidValue(input)) {
            this.validateAndAddActs(input, resultBuilder, Strings_1.Strings.Action.Change);
        }
        else if (this.wantsToConfirmValue(input)) {
            this.confirmValue(input, resultBuilder);
        }
        return;
    }
    validateAndAddActs(input, resultBuilder, elicitationAction) {
        this.state.elicitationAction = elicitationAction;
        if (this.wantsToConfirmValue(input)) {
            this.confirmValue(input, resultBuilder);
            return;
        }
        const validationResult = this.validate(input);
        if (typeof validationResult === 'boolean') {
            if (elicitationAction === Strings_1.Strings.Action.Change) {
                // if elicitationAction == 'change', then the previousValue must be defined.
                if (this.state.previousValue !== undefined) {
                    resultBuilder.addAct(new ContentActs_1.ValueChangedAct(this, { previousValue: this.state.previousValue, value: this.state.value }));
                }
                else {
                    throw new Error('ValueChangedAct should only be used if there is an actual previous value');
                }
            }
            else {
                resultBuilder.addAct(new ContentActs_1.ValueSetAct(this, { value: this.state.value }));
            }
        }
        else {
            // feedback
            resultBuilder.addAct(new ContentActs_1.InvalidValueAct(this, { value: this.state.value, reasonCode: validationResult.reasonCode, renderedReason: validationResult.renderedReason }));
            this.askElicitationQuestion(elicitationAction, input, resultBuilder);
        }
        return;
    }
    validate(input) {
        const listOfValidationFunc = typeof (this.props.validation) === 'function' ? [this.props.validation] : this.props.validation;
        for (const validationFunction of listOfValidationFunc) {
            const validationResult = validationFunction(this.state, input);
            if (validationResult !== true) {
                log.debug(`ValueControl.validate(): validation failed. Reason: ${JSON.stringify(validationResult, null, 2)}.`);
                return validationResult;
            }
        }
        return true;
    }
    wantsToConfirmValue(input) {
        return this.state.value !== undefined && this.state.isValueConfirmed === false && this.evaluateBooleanProp(this.props.confirmationRequired, input);
    }
    confirmValue(input, resultBuilder) {
        this.state.lastInitiativeAct = 'ConfirmValueAct';
        resultBuilder.addAct(new InitiativeActs_1.ConfirmValueAct(this, { value: this.state.value }));
    }
    wantsToFixInvalidValue(input) {
        return this.state.value !== undefined && this.validate(input) !== true;
    }
    wantsToElicitValue(input) {
        return this.state.value === undefined && this.evaluateBooleanProp(this.props.required, input);
    }
    askElicitationQuestion(elicitationAction, input, resultBuilder) {
        this.state.elicitationAction = elicitationAction;
        switch (elicitationAction) {
            case Strings_1.Strings.Action.Set:
                resultBuilder.addAct(new InitiativeActs_1.RequestValueAct(this));
                return;
            case Strings_1.Strings.Action.Change:
                resultBuilder.addAct(new InitiativeActs_1.RequestChangedValueAct(this, { currentValue: this.state.value }));
                return;
            default:
                throw new Error(`Unhandled. Unknown elicitationAction: ${elicitationAction}`);
        }
    }
    stringifyStateForDiagram() {
        var _a;
        let text = (_a = this.state.value) !== null && _a !== void 0 ? _a : '<none>';
        if (this.state.elicitationAction !== undefined) {
            text += `[eliciting, ${this.state.elicitationAction}]`;
        }
        return text;
    }
    renderAct(act, input, builder) {
        if (act instanceof ContentActs_1.InvalidValueAct) {
            builder.addPromptFragment(this.evaluatePromptProp(act, this.props.prompts.invalidValue, input));
            builder.addRepromptFragment(this.evaluatePromptProp(act, this.props.reprompts.invalidValue, input));
        }
        else if (act instanceof ContentActs_1.ValueSetAct) {
            // We must choose how to say the value.  The default is to assume that the Slot-type IDs are speakable.
            builder.addPromptFragment(this.evaluatePromptProp(act, this.props.prompts.valueSet, input));
            builder.addRepromptFragment(this.evaluatePromptProp(act, this.props.reprompts.valueSet, input));
        }
        else if (act instanceof ContentActs_1.ValueChangedAct) {
            builder.addPromptFragment(this.evaluatePromptProp(act, this.props.prompts.valueChanged, input));
            builder.addRepromptFragment(this.evaluatePromptProp(act, this.props.reprompts.valueChanged, input));
        }
        else if (act instanceof InitiativeActs_1.RequestValueAct || act instanceof InitiativeActs_1.RequestChangedValueAct) {
            const prompt = act instanceof InitiativeActs_1.RequestValueAct ? this.props.prompts.requestValue : this.props.prompts.requestChangedValue;
            const reprompt = act instanceof InitiativeActs_1.RequestChangedValueAct ? this.props.reprompts.requestValue : this.props.reprompts.requestChangedValue;
            builder.addPromptFragment(this.evaluatePromptProp(act, prompt, input));
            builder.addRepromptFragment(this.evaluatePromptProp(act, reprompt, input));
            const slotElicitation = generateSlotElicitation(this.props.slotType);
            builder.addElicitSlotDirective(slotElicitation.slotName, slotElicitation.intent);
        }
        else if (act instanceof InitiativeActs_1.ConfirmValueAct) {
            builder.addPromptFragment(this.evaluatePromptProp(act, this.props.prompts.confirmValue, input));
            builder.addRepromptFragment(this.evaluatePromptProp(act, this.props.reprompts.confirmValue, input));
        }
        else if (act instanceof ContentActs_1.ValueConfirmedAct) {
            builder.addPromptFragment(this.evaluatePromptProp(act, this.props.prompts.valueAffirmed, input));
            builder.addRepromptFragment(this.evaluatePromptProp(act, this.props.reprompts.valueAffirmed, input));
        }
        else if (act instanceof ContentActs_1.ValueDisconfirmedAct) {
            builder.addPromptFragment(this.evaluatePromptProp(act, this.props.prompts.valueDisaffirmed, input));
            builder.addRepromptFragment(this.evaluatePromptProp(act, this.props.reprompts.valueDisaffirmed, input));
        }
        else {
            this.throwUnhandledActError(act);
        }
    }
    updateInteractionModel(generator, imData) {
        generator.addControlIntent(new SingleValueControlIntent_1.SingleValueControlIntent(this.props.slotType), imData);
        generator.addControlIntent(new GeneralControlIntent_1.GeneralControlIntent(), imData);
        generator.addYesAndNoIntents();
    }
    getTargetIds() {
        return this.props.interactionModel.targets;
    }
}
exports.ValueControl = ValueControl;
function generateSlotElicitation(slotType) {
    const intent = {
        name: `${slotType}_ValueControlIntent`.replace('.', '_'),
        slots: {
            slotType: { name: slotType, value: '', confirmationStatus: 'NONE' },
            feedback: { name: "feedback", value: '', confirmationStatus: 'NONE' },
            action: { name: "action", value: '', confirmationStatus: 'NONE' },
            target: { name: "target", value: '', confirmationStatus: 'NONE' },
            head: { name: "head", value: '', confirmationStatus: 'NONE' },
            tail: { name: "tail", value: '', confirmationStatus: 'NONE' },
            assign: { name: "assign", value: '', confirmationStatus: 'NONE' },
        },
        confirmationStatus: "NONE"
    };
    return {
        intent,
        slotName: slotType
    };
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiVmFsdWVDb250cm9sLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vc3JjL2NvbW1vbkNvbnRyb2xzL1ZhbHVlQ29udHJvbC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUE7Ozs7Ozs7Ozs7O0dBV0c7Ozs7QUFHSCw0REFBdUI7QUFDdkIsOERBQThCO0FBQzlCLGtEQUFvRDtBQUNwRCxpREFBMEU7QUFJMUUsNEVBQXlFO0FBQ3pFLDBFQUFtRztBQUNuRyxrRkFBK0c7QUFHL0csOENBQTJDO0FBRTNDLDJEQUFtSTtBQUNuSSxpRUFBd0c7QUFJeEcsa0RBQStDO0FBQy9DLG9EQUErRDtBQUcvRCxNQUFNLEdBQUcsR0FBRyxJQUFJLGVBQU0sQ0FBQyw2QkFBNkIsQ0FBQyxDQUFDO0FBNEV0RCxNQUFhLGlDQUFpQztDQXdDN0M7QUF4Q0QsOEVBd0NDO0FBRUQsTUFBYSx1QkFBdUI7Q0FTbkM7QUFURCwwREFTQztBQUVELE1BQWEsaUJBQWlCO0lBQTlCO1FBaUJJOztXQUVHO1FBQ0gscUJBQWdCLEdBQVksS0FBSyxDQUFDO0lBV3RDLENBQUM7Q0FBQTtBQS9CRCw4Q0ErQkM7QUFFRCxNQUFhLFlBQWEsU0FBUSxpQkFBTztJQU1yQyxZQUFZLEtBQXdCO1FBQ2hDLEtBQUssQ0FBQyxLQUFLLENBQUMsRUFBRSxDQUFDLENBQUM7UUFIYixVQUFLLEdBQXNCLElBQUksaUJBQWlCLEVBQUUsQ0FBQztRQUt0RCxJQUFJLEtBQUssQ0FBQyxRQUFRLEtBQUssNkNBQXFCLENBQUMsWUFBWSxFQUFDO1lBQ3RELE1BQU0sSUFBSSxLQUFLLENBQUMsa0dBQWtHO2tCQUMvRyxpSUFBaUk7a0JBQ2pJLHFHQUFxRyxDQUFDLENBQUM7U0FDN0c7UUFFRCxJQUFJLENBQUMsUUFBUSxHQUFHLEtBQUssQ0FBQztRQUN0QixJQUFJLENBQUMsS0FBSyxHQUFHLFlBQVksQ0FBQyxxQkFBcUIsQ0FBQyxLQUFLLENBQUMsQ0FBQztJQUMzRCxDQUFDO0lBRUQsTUFBTSxDQUFDLHFCQUFxQixDQUFDLEtBQXdCO1FBRWpELE1BQU0sUUFBUSxHQUNkO1lBQ0ksRUFBRSxFQUFFLE9BQU87WUFDWCxRQUFRLEVBQUUsT0FBTztZQUNqQixRQUFRLEVBQUUsSUFBSTtZQUNkLFVBQVUsRUFBRSxFQUFFO1lBQ2Qsb0JBQW9CLEVBQUUsS0FBSztZQUMzQixnQkFBZ0IsRUFBRTtnQkFDZCxPQUFPLEVBQUU7b0JBQ0wsR0FBRyxFQUFFLENBQUMsaUJBQUMsQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDO29CQUNuQixNQUFNLEVBQUUsQ0FBQyxpQkFBQyxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUM7aUJBQzVCO2dCQUNELE9BQU8sRUFBRSxDQUFDLGlCQUFDLENBQUMsTUFBTSxDQUFDLEVBQUUsQ0FBQzthQUN6QjtZQUNELE9BQU8sRUFBRTtnQkFDTCxZQUFZLEVBQUUsQ0FBQyxHQUFHLEVBQUUsRUFBRSxDQUFDLGlCQUFPLENBQUMsQ0FBQyxDQUFDLDRDQUE0QyxFQUFFLEVBQUUsS0FBSyxFQUFFLEdBQUcsQ0FBQyxPQUFPLENBQUMsS0FBSyxFQUFFLENBQUM7Z0JBQzVHLGFBQWEsRUFBRSxpQkFBTyxDQUFDLENBQUMsQ0FBQyw2Q0FBNkMsQ0FBQztnQkFDdkUsZ0JBQWdCLEVBQUUsaUJBQU8sQ0FBQyxDQUFDLENBQUMsZ0RBQWdELENBQUM7Z0JBQzdFLFFBQVEsRUFBRSxDQUFDLEdBQUcsRUFBRSxFQUFFLENBQUMsaUJBQU8sQ0FBQyxDQUFDLENBQUMsd0NBQXdDLEVBQUUsRUFBRSxLQUFLLEVBQUUsR0FBRyxDQUFDLE9BQU8sQ0FBQyxLQUFLLEVBQUUsQ0FBQztnQkFDcEcsWUFBWSxFQUFFLENBQUMsR0FBRyxFQUFFLEVBQUUsQ0FBQyxpQkFBTyxDQUFDLENBQUMsQ0FBQyw0Q0FBNEMsRUFBRSxFQUFFLEtBQUssRUFBRSxHQUFHLENBQUMsT0FBTyxDQUFDLEtBQUssRUFBRSxDQUFDO2dCQUM1RyxZQUFZLEVBQUUsQ0FBQyxHQUFHLEVBQUUsRUFBRTtvQkFDbEIsSUFBSSxHQUFHLENBQUMsT0FBTyxDQUFDLGNBQWMsS0FBSyxTQUFTLEVBQUU7d0JBQzFDLE9BQU8saUJBQU8sQ0FBQyxDQUFDLENBQUMsd0RBQXdELEVBQUUsRUFBRSxLQUFLLEVBQUUsR0FBRyxDQUFDLE9BQU8sQ0FBQyxLQUFLLEVBQUUsTUFBTSxFQUFFLEdBQUcsQ0FBQyxPQUFPLENBQUMsY0FBYyxFQUFFLENBQUMsQ0FBQztxQkFDaEo7b0JBQ0QsT0FBTyxpQkFBTyxDQUFDLENBQUMsQ0FBQyxvREFBb0QsRUFBRSxFQUFFLEtBQUssRUFBRSxHQUFHLENBQUMsT0FBTyxDQUFDLEtBQUssRUFBRSxDQUFDLENBQUM7Z0JBQ3pHLENBQUM7Z0JBQ0QsWUFBWSxFQUFFLEdBQUcsRUFBRSxDQUFDLGlCQUFPLENBQUMsQ0FBQyxDQUFDLDRDQUE0QyxDQUFDO2dCQUMzRSxtQkFBbUIsRUFBRSxHQUFHLEVBQUUsQ0FBQyxpQkFBTyxDQUFDLENBQUMsQ0FBQyxvREFBb0QsQ0FBQzthQUM3RjtZQUNELFNBQVMsRUFBRTtnQkFDUCxZQUFZLEVBQUUsQ0FBQyxHQUFHLEVBQUUsRUFBRSxDQUFDLGlCQUFPLENBQUMsQ0FBQyxDQUFDLDhDQUE4QyxFQUFFLEVBQUUsS0FBSyxFQUFFLEdBQUcsQ0FBQyxPQUFPLENBQUMsS0FBSyxFQUFFLENBQUM7Z0JBQzlHLGFBQWEsRUFBRSxpQkFBTyxDQUFDLENBQUMsQ0FBQywrQ0FBK0MsQ0FBQztnQkFDekUsZ0JBQWdCLEVBQUUsaUJBQU8sQ0FBQyxDQUFDLENBQUMsa0RBQWtELENBQUM7Z0JBQy9FLFFBQVEsRUFBRSxDQUFDLEdBQUcsRUFBRSxFQUFFLENBQUMsaUJBQU8sQ0FBQyxDQUFDLENBQUMsMENBQTBDLEVBQUUsRUFBRSxLQUFLLEVBQUUsR0FBRyxDQUFDLE9BQU8sQ0FBQyxLQUFLLEVBQUUsQ0FBQztnQkFDdEcsWUFBWSxFQUFFLENBQUMsR0FBRyxFQUFFLEVBQUUsQ0FBQyxpQkFBTyxDQUFDLENBQUMsQ0FBQyw4Q0FBOEMsRUFBRSxFQUFFLEtBQUssRUFBRSxHQUFHLENBQUMsT0FBTyxDQUFDLEtBQUssRUFBRSxDQUFDO2dCQUM5RyxZQUFZLEVBQUUsQ0FBQyxHQUFHLEVBQUUsRUFBRTtvQkFDbEIsSUFBSSxHQUFHLENBQUMsT0FBTyxDQUFDLGNBQWMsS0FBSyxTQUFTLEVBQUU7d0JBQzFDLE9BQU8saUJBQU8sQ0FBQyxDQUFDLENBQUMsMERBQTBELEVBQUUsRUFBRSxLQUFLLEVBQUUsR0FBRyxDQUFDLE9BQU8sQ0FBQyxLQUFLLEVBQUUsTUFBTSxFQUFFLEdBQUcsQ0FBQyxPQUFPLENBQUMsY0FBYyxFQUFFLENBQUMsQ0FBQztxQkFDbEo7b0JBQ0QsT0FBTyxpQkFBTyxDQUFDLENBQUMsQ0FBQyxzREFBc0QsRUFBRSxFQUFFLEtBQUssRUFBRSxHQUFHLENBQUMsT0FBTyxDQUFDLEtBQUssRUFBRSxDQUFDLENBQUM7Z0JBQzNHLENBQUM7Z0JBQ0QsWUFBWSxFQUFFLEdBQUcsRUFBRSxDQUFDLGlCQUFPLENBQUMsQ0FBQyxDQUFDLDhDQUE4QyxDQUFDO2dCQUM3RSxtQkFBbUIsRUFBRSxHQUFHLEVBQUUsQ0FBQyxpQkFBTyxDQUFDLENBQUMsQ0FBQyxzREFBc0QsQ0FBQzthQUMvRjtTQUNKLENBQUM7UUFFRixPQUFPLGdCQUFDLENBQUMsS0FBSyxDQUFDLFFBQVEsRUFBRSxLQUFLLENBQUMsQ0FBQztJQUNwQyxDQUFDO0lBRUQsU0FBUyxDQUFDLEtBQW1CO1FBQ3pCLE9BQU8sSUFBSSxDQUFDLGNBQWMsQ0FBQyxLQUFLLENBQUM7ZUFDMUIsSUFBSSxDQUFDLGlCQUFpQixDQUFDLEtBQUssQ0FBQztlQUM3QixJQUFJLENBQUMsaUJBQWlCLENBQUMsS0FBSyxDQUFDO2VBQzdCLElBQUksQ0FBQyxvQkFBb0IsQ0FBQyxLQUFLLENBQUM7ZUFDaEMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxLQUFLLENBQUM7ZUFDdkIsSUFBSSxDQUFDLHNCQUFzQixDQUFDLEtBQUssQ0FBQztlQUNsQyxJQUFJLENBQUMseUJBQXlCLENBQUMsS0FBSyxDQUFDLENBQUM7SUFDakQsQ0FBQztJQUVELEtBQUssQ0FBQyxNQUFNLENBQUMsS0FBbUIsRUFBRSxhQUFtQztRQUNqRSxJQUFJLElBQUksQ0FBQyxVQUFVLEtBQUssU0FBUyxFQUFFO1lBQy9CLEdBQUcsQ0FBQyxLQUFLLENBQUMsd0hBQXdILENBQUMsQ0FBQztZQUNwSSxNQUFNLE1BQU0sR0FBWSxLQUFLLENBQUMsT0FBeUIsQ0FBQyxNQUFNLENBQUM7WUFDL0QsTUFBTSxJQUFJLEtBQUssQ0FBQyxHQUFHLE1BQU0sQ0FBQyxJQUFJLDBCQUEwQixJQUFJLENBQUMsV0FBVyxDQUFDLElBQUksR0FBRyxDQUFDLENBQUM7U0FDckY7UUFFRCxJQUFJLENBQUMsVUFBVSxDQUFDLEtBQUssRUFBRSxhQUFhLENBQUMsQ0FBQztJQUMxQyxDQUFDO0lBRUQ7Ozs7T0FJRztJQUNILGNBQWMsQ0FBQyxLQUFtQjtRQUM5QixJQUFJO1lBQ0EsaUJBQUksQ0FBQyxxQkFBUyxDQUFDLFFBQVEsQ0FBQyxLQUFLLEVBQUUsbURBQXdCLENBQUMsVUFBVSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQzFGLE1BQU0sRUFBRSxRQUFRLEVBQUUsTUFBTSxFQUFFLE1BQU0sRUFBRSxRQUFRLEVBQUUsU0FBUyxFQUFFLEdBQUcseURBQThCLENBQUUsS0FBSyxDQUFDLE9BQXlCLENBQUMsTUFBTSxDQUFDLENBQUM7WUFDbEksaUJBQUksQ0FBQyxxQkFBUyxDQUFDLHdCQUF3QixDQUFDLE1BQU0sRUFBRSxJQUFJLENBQUMsS0FBSyxDQUFDLGdCQUFnQixDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUM7WUFDdEYsaUJBQUksQ0FBQyxxQkFBUyxDQUFDLGNBQWMsQ0FBQyxTQUFTLEVBQUUsSUFBSSxDQUFDLEtBQUssQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDO1lBQy9ELGlCQUFJLENBQUMscUJBQVMsQ0FBQyxlQUFlLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQztZQUMxQyxpQkFBSSxDQUFDLHFCQUFTLENBQUMsMEJBQTBCLENBQUMsUUFBUSxFQUFFLENBQUMsaUJBQUMsQ0FBQyxRQUFRLENBQUMsTUFBTSxFQUFFLGlCQUFDLENBQUMsUUFBUSxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUNoRyxpQkFBSSxDQUFDLHFCQUFTLENBQUMsYUFBYSxDQUFDLE1BQU0sRUFBRSxJQUFJLENBQUMsS0FBSyxDQUFDLGdCQUFnQixDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDO1lBQy9FLElBQUksQ0FBQyxVQUFVLEdBQUcsSUFBSSxDQUFDLGtCQUFrQixDQUFDO1lBQzFDLE9BQU8sSUFBSSxDQUFDO1NBQ2Y7UUFDRCxPQUFPLENBQUMsRUFBRTtZQUFFLE9BQU8sK0JBQWtCLENBQUMsQ0FBQyxDQUFDLENBQUM7U0FBRTtJQUMvQyxDQUFDO0lBRUQsa0JBQWtCLENBQUMsS0FBbUIsRUFBRSxhQUFtQztRQUN2RSxNQUFNLEVBQUUsUUFBUSxFQUFFLE9BQU8sRUFBRSxHQUFHLHFCQUFTLENBQUMsa0JBQWtCLENBQUMsS0FBSyxDQUFDLENBQUM7UUFDbEUsSUFBSSxDQUFDLFFBQVEsQ0FBQyxRQUFRLEVBQUUsT0FBTyxDQUFDLENBQUM7UUFDakMsSUFBSSxDQUFDLGtCQUFrQixDQUFDLEtBQUssRUFBRSxhQUFhLEVBQUUsaUJBQUMsQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUM7UUFDNUQsT0FBTztJQUNYLENBQUM7SUFFRDs7OztPQUlHO0lBQ0gsaUJBQWlCLENBQUMsS0FBbUI7UUFDakMsSUFBSTtZQUNBLGlCQUFJLENBQUMscUJBQVMsQ0FBQyxRQUFRLENBQUMsS0FBSyxFQUFFLDJDQUFvQixDQUFDLElBQUksQ0FBQyxDQUFDLENBQUM7WUFDM0QsTUFBTSxFQUFFLFFBQVEsRUFBRSxNQUFNLEVBQUUsTUFBTSxFQUFFLEdBQUcsaURBQTBCLENBQUUsS0FBSyxDQUFDLE9BQXlCLENBQUMsTUFBTSxDQUFDLENBQUM7WUFDekcsaUJBQUksQ0FBQyxxQkFBUyxDQUFDLHdCQUF3QixDQUFDLE1BQU0sRUFBRSxJQUFJLENBQUMsS0FBSyxDQUFDLGdCQUFnQixDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUM7WUFDdEYsaUJBQUksQ0FBQyxxQkFBUyxDQUFDLDBCQUEwQixDQUFDLFFBQVEsRUFBRSxDQUFDLGlCQUFDLENBQUMsUUFBUSxDQUFDLE1BQU0sRUFBRSxpQkFBQyxDQUFDLFFBQVEsQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDaEcsaUJBQUksQ0FBQyxxQkFBUyxDQUFDLGFBQWEsQ0FBQyxNQUFNLEVBQUUsSUFBSSxDQUFDLEtBQUssQ0FBQyxnQkFBZ0IsQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQztZQUMvRSxJQUFJLENBQUMsVUFBVSxHQUFHLElBQUksQ0FBQyxxQkFBcUIsQ0FBQztZQUM3QyxPQUFPLElBQUksQ0FBQztTQUNmO1FBQ0QsT0FBTyxDQUFDLEVBQUU7WUFBRSxPQUFPLCtCQUFrQixDQUFDLENBQUMsQ0FBQyxDQUFDO1NBQUU7SUFDL0MsQ0FBQztJQUVELHFCQUFxQixDQUFDLEtBQW1CLEVBQUUsYUFBbUM7UUFDMUUsSUFBSSxDQUFDLHNCQUFzQixDQUFDLGlCQUFDLENBQUMsTUFBTSxDQUFDLEdBQUcsRUFBRSxLQUFLLEVBQUUsYUFBYSxDQUFDLENBQUM7UUFDaEUsT0FBTztJQUNYLENBQUM7SUFFRDs7OztPQUlHO0lBQ0gsaUJBQWlCLENBQUMsS0FBbUI7UUFDakMsSUFBSTtZQUNBLGlCQUFJLENBQUMscUJBQVMsQ0FBQyxRQUFRLENBQUMsS0FBSyxFQUFFLG1EQUF3QixDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUMxRixNQUFNLEVBQUUsUUFBUSxFQUFFLE1BQU0sRUFBRSxNQUFNLEVBQUUsUUFBUSxFQUFFLFNBQVMsRUFBRSxHQUFHLHlEQUE4QixDQUFFLEtBQUssQ0FBQyxPQUF5QixDQUFDLE1BQU0sQ0FBQyxDQUFDO1lBQ2xJLGlCQUFJLENBQUMscUJBQVMsQ0FBQyx3QkFBd0IsQ0FBQyxNQUFNLEVBQUUsSUFBSSxDQUFDLEtBQUssQ0FBQyxnQkFBZ0IsQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDO1lBQ3RGLGlCQUFJLENBQUMscUJBQVMsQ0FBQyxjQUFjLENBQUMsU0FBUyxFQUFFLElBQUksQ0FBQyxLQUFLLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQztZQUMvRCxpQkFBSSxDQUFDLHFCQUFTLENBQUMsZUFBZSxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUM7WUFDMUMsaUJBQUksQ0FBQyxxQkFBUyxDQUFDLDBCQUEwQixDQUFDLFFBQVEsRUFBRSxDQUFDLGlCQUFDLENBQUMsUUFBUSxDQUFDLE1BQU0sRUFBRSxpQkFBQyxDQUFDLFFBQVEsQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDaEcsaUJBQUksQ0FBQyxxQkFBUyxDQUFDLGFBQWEsQ0FBQyxNQUFNLEVBQUUsSUFBSSxDQUFDLEtBQUssQ0FBQyxnQkFBZ0IsQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQztZQUNsRixJQUFJLENBQUMsVUFBVSxHQUFHLElBQUksQ0FBQyxxQkFBcUIsQ0FBQztZQUM3QyxPQUFPLElBQUksQ0FBQztTQUNmO1FBRUQsT0FBTyxDQUFDLEVBQUU7WUFBRSxPQUFPLCtCQUFrQixDQUFDLENBQUMsQ0FBQyxDQUFDO1NBQUU7SUFDL0MsQ0FBQztJQUVELHFCQUFxQixDQUFDLEtBQW1CLEVBQUUsYUFBbUM7UUFDMUUsTUFBTSxFQUFFLFFBQVEsRUFBRSxPQUFPLEVBQUUsR0FBRyxxQkFBUyxDQUFDLGtCQUFrQixDQUFDLEtBQUssQ0FBQyxDQUFDO1FBQ2xFLElBQUksQ0FBQyxRQUFRLENBQUMsUUFBUSxFQUFFLE9BQU8sQ0FBQyxDQUFDO1FBQ2pDLElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxLQUFLLEVBQUUsYUFBYSxFQUFFLElBQUksQ0FBQyxLQUFLLENBQUMsS0FBSyxLQUFLLFNBQVMsQ0FBQyxDQUFDLENBQUMsaUJBQUMsQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxpQkFBQyxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQztRQUMvRyxPQUFPO0lBQ1gsQ0FBQztJQUVEOzs7O09BSUc7SUFDSCxvQkFBb0IsQ0FBQyxLQUFtQjtRQUNwQyxJQUFJO1lBQ0EsaUJBQUksQ0FBQyxxQkFBUyxDQUFDLFFBQVEsQ0FBQyxLQUFLLEVBQUUsMkNBQW9CLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQztZQUMzRCxNQUFNLEVBQUUsUUFBUSxFQUFFLE1BQU0sRUFBRSxNQUFNLEVBQUUsR0FBRyxpREFBMEIsQ0FBRSxLQUFLLENBQUMsT0FBeUIsQ0FBQyxNQUFNLENBQUMsQ0FBQztZQUN6RyxpQkFBSSxDQUFDLHFCQUFTLENBQUMsd0JBQXdCLENBQUMsTUFBTSxFQUFFLElBQUksQ0FBQyxLQUFLLENBQUMsZ0JBQWdCLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQztZQUN0RixpQkFBSSxDQUFDLHFCQUFTLENBQUMsMEJBQTBCLENBQUMsUUFBUSxFQUFFLENBQUMsaUJBQUMsQ0FBQyxRQUFRLENBQUMsTUFBTSxFQUFFLGlCQUFDLENBQUMsUUFBUSxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUNoRyxpQkFBSSxDQUFDLHFCQUFTLENBQUMsYUFBYSxDQUFDLE1BQU0sRUFBRSxJQUFJLENBQUMsS0FBSyxDQUFDLGdCQUFnQixDQUFDLE9BQU8sQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDO1lBQ2xGLElBQUksQ0FBQyxVQUFVLEdBQUcsSUFBSSxDQUFDLHdCQUF3QixDQUFDO1lBQ2hELE9BQU8sSUFBSSxDQUFDO1NBQ2Y7UUFDRCxPQUFPLENBQUMsRUFBRTtZQUFFLE9BQU8sK0JBQWtCLENBQUMsQ0FBQyxDQUFDLENBQUM7U0FBRTtJQUMvQyxDQUFDO0lBRUQsd0JBQXdCLENBQUMsS0FBbUIsRUFBRSxhQUFtQztRQUM3RSxJQUFJLENBQUMsc0JBQXNCLENBQUMsaUJBQUMsQ0FBQyxNQUFNLENBQUMsTUFBTSxFQUFFLEtBQUssRUFBRSxhQUFhLENBQUMsQ0FBQztRQUNuRSxPQUFPO0lBQ1gsQ0FBQztJQUdEOzs7O09BSUc7SUFDSCxXQUFXLENBQUMsS0FBbUI7UUFDM0IsSUFBSTtZQUNBLGlCQUFJLENBQUMscUJBQVMsQ0FBQyxRQUFRLENBQUMsS0FBSyxFQUFFLG1EQUF3QixDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUMxRixNQUFNLEVBQUUsUUFBUSxFQUFFLE1BQU0sRUFBRSxNQUFNLEVBQUUsUUFBUSxFQUFFLFNBQVMsRUFBRSxHQUFHLHlEQUE4QixDQUFFLEtBQUssQ0FBQyxPQUF5QixDQUFDLE1BQU0sQ0FBQyxDQUFDO1lBQ2xJLGlCQUFJLENBQUMscUJBQVMsQ0FBQyxtQkFBbUIsQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDO1lBQzlDLGlCQUFJLENBQUMscUJBQVMsQ0FBQyxpQkFBaUIsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDO1lBQzFDLGlCQUFJLENBQUMscUJBQVMsQ0FBQyxpQkFBaUIsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDO1lBQzFDLGlCQUFJLENBQUMscUJBQVMsQ0FBQyxlQUFlLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQztZQUMxQyxpQkFBSSxDQUFDLHFCQUFTLENBQUMsY0FBYyxDQUFDLFNBQVMsRUFBRSxJQUFJLENBQUMsS0FBSyxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUM7WUFDL0QsSUFBSSxDQUFDLFVBQVUsR0FBRyxJQUFJLENBQUMsZUFBZSxDQUFDO1lBQ3ZDLE9BQU8sSUFBSSxDQUFDO1NBQ2Y7UUFDRCxPQUFPLENBQUMsRUFBRTtZQUFFLE9BQU8sK0JBQWtCLENBQUMsQ0FBQyxDQUFDLENBQUM7U0FBRTtJQUMvQyxDQUFDO0lBR0QsZUFBZSxDQUFDLEtBQW1CLEVBQUUsYUFBbUM7O1FBQ3BFLE1BQU0sRUFBRSxRQUFRLEVBQUUsT0FBTyxFQUFFLEdBQUcscUJBQVMsQ0FBQyxrQkFBa0IsQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUNsRSxJQUFJLENBQUMsUUFBUSxDQUFDLFFBQVEsRUFBRSxPQUFPLENBQUMsQ0FBQztRQUNqQyxJQUFJLENBQUMsa0JBQWtCLENBQUMsS0FBSyxFQUFFLGFBQWEsUUFBRSxJQUFJLENBQUMsS0FBSyxDQUFDLGlCQUFpQixtQ0FBSSxpQkFBQyxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQztRQUM1RixPQUFPO0lBQ1gsQ0FBQztJQUVELHNCQUFzQixDQUFDLEtBQW1CO1FBQ3RDLElBQUk7WUFDQSxpQkFBSSxDQUFDLHFCQUFTLENBQUMsU0FBUyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUM7WUFDakMsaUJBQUksQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLGlCQUFpQixLQUFLLGlCQUFpQixDQUFDLENBQUM7WUFDekQsSUFBSSxDQUFDLFVBQVUsR0FBRyxJQUFJLENBQUMsMEJBQTBCLENBQUM7WUFDbEQsT0FBTyxJQUFJLENBQUM7U0FDZjtRQUNELE9BQU8sQ0FBQyxFQUFFO1lBQ04sT0FBTywrQkFBa0IsQ0FBQyxDQUFDLENBQUMsQ0FBQztTQUNoQztJQUNMLENBQUM7SUFFRCwwQkFBMEIsQ0FBQyxLQUFtQixFQUFFLGFBQW1DO1FBQy9FLE1BQU0sZ0JBQWdCLEdBQTRCLElBQUksQ0FBQyxRQUFRLENBQUMsS0FBSyxDQUFDLENBQUM7UUFDdkUsSUFBSSxnQkFBZ0IsS0FBSyxJQUFJLEVBQUU7WUFDM0IsYUFBYSxDQUFDLE1BQU0sQ0FDaEIsSUFBSSw2QkFBZSxDQUNmLElBQUksRUFDSjtnQkFDSSxLQUFLLEVBQUUsSUFBSSxDQUFDLEtBQUssQ0FBQyxLQUFNO2dCQUN4QixVQUFVLEVBQUUsZ0JBQWdCLENBQUMsVUFBVTtnQkFDdkMsY0FBYyxFQUFFLGdCQUFnQixDQUFDLGNBQWM7YUFDbEQsQ0FBQyxDQUNULENBQUM7WUFDRixJQUFJLENBQUMsc0JBQXNCLENBQUMsaUJBQUMsQ0FBQyxNQUFNLENBQUMsTUFBTSxFQUFFLEtBQUssRUFBRSxhQUFhLENBQUMsQ0FBQztTQUN0RTthQUNJO1lBQ0QsSUFBSSxDQUFDLEtBQUssQ0FBQyxnQkFBZ0IsR0FBRyxJQUFJLENBQUM7WUFDbkMsYUFBYSxDQUFDLE1BQU0sQ0FBQyxJQUFJLCtCQUFpQixDQUFDLElBQUksRUFBRSxFQUFFLEtBQUssRUFBRSxJQUFJLENBQUMsS0FBSyxDQUFDLEtBQUssRUFBRSxDQUFDLENBQUMsQ0FBQztZQUMvRSxJQUFJLElBQUksQ0FBQyxLQUFLLENBQUMsaUJBQWlCLEtBQUssaUJBQUMsQ0FBQyxNQUFNLENBQUMsTUFBTSxFQUFFO2dCQUNsRCxJQUFJLElBQUksQ0FBQyxLQUFLLENBQUMsYUFBYSxLQUFLLFNBQVMsRUFBQztvQkFDdkMsYUFBYSxDQUFDLE1BQU0sQ0FDaEIsSUFBSSw2QkFBZSxDQUFTLElBQUksRUFBRSxFQUFDLGFBQWEsRUFBRSxJQUFJLENBQUMsS0FBSyxDQUFDLGFBQWEsRUFBRSxLQUFLLEVBQUUsSUFBSSxDQUFDLEtBQUssQ0FBQyxLQUFNLEVBQUUsQ0FBQyxDQUMxRyxDQUFDO2lCQUNMO3FCQUNJO29CQUNELE1BQU0sSUFBSSxLQUFLLENBQUMsMEVBQTBFLENBQUMsQ0FBQztpQkFDL0Y7YUFDSjtpQkFDSTtnQkFDRCxhQUFhLENBQUMsTUFBTSxDQUFDLElBQUkseUJBQVcsQ0FBQyxJQUFJLEVBQUUsRUFBRSxLQUFLLEVBQUUsSUFBSSxDQUFDLEtBQUssQ0FBQyxLQUFLLEVBQUUsQ0FBQyxDQUFDLENBQUM7YUFDNUU7U0FDSjtJQUNMLENBQUM7SUFFRCx5QkFBeUIsQ0FBQyxLQUFtQjtRQUN6QyxJQUFJO1lBQ0EsaUJBQUksQ0FBQyxxQkFBUyxDQUFDLFFBQVEsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDO1lBQ2hDLGlCQUFJLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxpQkFBaUIsS0FBSyxpQkFBaUIsQ0FBQyxDQUFDO1lBQ3pELElBQUksQ0FBQyxVQUFVLEdBQUcsSUFBSSxDQUFDLDZCQUE2QixDQUFDO1lBQ3JELE9BQU8sSUFBSSxDQUFDO1NBQ2Y7UUFDRCxPQUFPLENBQUMsRUFBRTtZQUNOLE9BQU8sK0JBQWtCLENBQUMsQ0FBQyxDQUFDLENBQUM7U0FDaEM7SUFDTCxDQUFDO0lBRUQsNkJBQTZCLENBQUMsS0FBbUIsRUFBRSxhQUFtQztRQUNsRixJQUFJLENBQUMsS0FBSyxDQUFDLGdCQUFnQixHQUFHLEtBQUssQ0FBQztRQUNwQyxhQUFhLENBQUMsTUFBTSxDQUFDLElBQUksa0NBQW9CLENBQUMsSUFBSSxFQUFFLEVBQUMsS0FBSyxFQUFFLElBQUksQ0FBQyxLQUFLLENBQUMsS0FBSyxFQUFDLENBQUMsQ0FBQyxDQUFDO1FBQ2hGLGFBQWEsQ0FBQyxNQUFNLENBQUMsSUFBSSxnQ0FBZSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUM7SUFDcEQsQ0FBQztJQUVEOzs7Ozs7Ozs7O09BVUc7SUFDSCxRQUFRLENBQUMsS0FBYSxFQUFFLE9BQWdCO1FBQ3BDLElBQUksQ0FBQyxLQUFLLENBQUMsYUFBYSxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsS0FBSyxDQUFDO1FBQzVDLElBQUksQ0FBQyxLQUFLLENBQUMsS0FBSyxHQUFHLEtBQUssQ0FBQztRQUN6QixJQUFJLENBQUMsS0FBSyxDQUFDLE9BQU8sR0FBRyxPQUFPLENBQUM7UUFDN0IsSUFBSSxDQUFDLEtBQUssQ0FBQyxnQkFBZ0IsR0FBRyxLQUFLLENBQUM7SUFDeEMsQ0FBQztJQUVELEtBQUs7UUFDRCxJQUFJLENBQUMsS0FBSyxDQUFDLEtBQUssR0FBRyxTQUFTLENBQUM7UUFDN0IsSUFBSSxDQUFDLEtBQUssQ0FBQyxPQUFPLEdBQUcsU0FBUyxDQUFDO1FBQy9CLElBQUksQ0FBQyxLQUFLLENBQUMsaUJBQWlCLEdBQUcsU0FBUyxDQUFDO1FBQ3pDLElBQUksQ0FBQyxLQUFLLENBQUMsZ0JBQWdCLEdBQUcsS0FBSyxDQUFDO1FBQ3BDLElBQUksQ0FBQyxLQUFLLENBQUMsYUFBYSxHQUFHLFNBQVMsQ0FBQztRQUNyQyxJQUFJLENBQUMsS0FBSyxDQUFDLGlCQUFpQixHQUFHLFNBQVMsQ0FBQztJQUM3QyxDQUFDO0lBRUQsaUJBQWlCLENBQUMsS0FBbUI7UUFDakMsT0FBTyxJQUFJLENBQUMsbUJBQW1CLENBQUMsS0FBSyxDQUFDO2VBQy9CLElBQUksQ0FBQyxzQkFBc0IsQ0FBQyxLQUFLLENBQUM7ZUFDbEMsSUFBSSxDQUFDLGtCQUFrQixDQUFDLEtBQUssQ0FBQyxDQUFDO0lBQzFDLENBQUM7SUFFRCxLQUFLLENBQUMsY0FBYyxDQUFDLEtBQW1CLEVBQUUsYUFBbUM7UUFDekUsSUFBSSxJQUFJLENBQUMsa0JBQWtCLENBQUMsS0FBSyxDQUFDLEVBQUU7WUFDaEMsSUFBSSxDQUFDLHNCQUFzQixDQUFDLGlCQUFDLENBQUMsTUFBTSxDQUFDLEdBQUcsRUFBRSxLQUFLLEVBQUUsYUFBYSxDQUFDLENBQUM7U0FDbkU7YUFDSSxJQUFJLElBQUksQ0FBQyxzQkFBc0IsQ0FBQyxLQUFLLENBQUMsRUFBQztZQUN4QyxJQUFJLENBQUMsa0JBQWtCLENBQUMsS0FBSyxFQUFFLGFBQWEsRUFBRSxpQkFBQyxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQztTQUNsRTthQUNJLElBQUksSUFBSSxDQUFDLG1CQUFtQixDQUFDLEtBQUssQ0FBQyxFQUFFO1lBQ3RDLElBQUksQ0FBQyxZQUFZLENBQUMsS0FBSyxFQUFFLGFBQWEsQ0FBQyxDQUFDO1NBQzNDO1FBQ0QsT0FBTztJQUNYLENBQUM7SUFFRCxrQkFBa0IsQ0FBQyxLQUFtQixFQUFFLGFBQW1DLEVBQUUsaUJBQXlCO1FBQ2xHLElBQUksQ0FBQyxLQUFLLENBQUMsaUJBQWlCLEdBQUcsaUJBQWlCLENBQUM7UUFDakQsSUFBSSxJQUFJLENBQUMsbUJBQW1CLENBQUMsS0FBSyxDQUFDLEVBQUM7WUFDaEMsSUFBSSxDQUFDLFlBQVksQ0FBQyxLQUFLLEVBQUUsYUFBYSxDQUFDLENBQUM7WUFDeEMsT0FBTztTQUNWO1FBQ0QsTUFBTSxnQkFBZ0IsR0FBNEIsSUFBSSxDQUFDLFFBQVEsQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUN2RSxJQUFJLE9BQU8sZ0JBQWdCLEtBQUssU0FBUyxFQUFFO1lBQ3ZDLElBQUksaUJBQWlCLEtBQUssaUJBQUMsQ0FBQyxNQUFNLENBQUMsTUFBTSxFQUFFO2dCQUN2Qyw0RUFBNEU7Z0JBQzVFLElBQUksSUFBSSxDQUFDLEtBQUssQ0FBQyxhQUFhLEtBQUssU0FBUyxFQUFDO29CQUN2QyxhQUFhLENBQUMsTUFBTSxDQUNoQixJQUFJLDZCQUFlLENBQVMsSUFBSSxFQUFFLEVBQUMsYUFBYSxFQUFFLElBQUksQ0FBQyxLQUFLLENBQUMsYUFBYSxFQUFFLEtBQUssRUFBRSxJQUFJLENBQUMsS0FBSyxDQUFDLEtBQU0sRUFBRSxDQUFDLENBQzFHLENBQUM7aUJBQ0w7cUJBQ0k7b0JBQ0QsTUFBTSxJQUFJLEtBQUssQ0FBQywwRUFBMEUsQ0FBQyxDQUFDO2lCQUMvRjthQUNKO2lCQUNJO2dCQUNELGFBQWEsQ0FBQyxNQUFNLENBQUMsSUFBSSx5QkFBVyxDQUFDLElBQUksRUFBRSxFQUFFLEtBQUssRUFBRSxJQUFJLENBQUMsS0FBSyxDQUFDLEtBQUssRUFBRSxDQUFDLENBQUMsQ0FBQzthQUM1RTtTQUNKO2FBQ0k7WUFDRCxXQUFXO1lBQ1gsYUFBYSxDQUFDLE1BQU0sQ0FBQyxJQUFJLDZCQUFlLENBQVMsSUFBSSxFQUFFLEVBQUUsS0FBSyxFQUFFLElBQUksQ0FBQyxLQUFLLENBQUMsS0FBTSxFQUFFLFVBQVUsRUFBRSxnQkFBZ0IsQ0FBQyxVQUFVLEVBQUUsY0FBYyxFQUFFLGdCQUFnQixDQUFDLGNBQWMsRUFBRSxDQUFDLENBQUMsQ0FBQztZQUNoTCxJQUFJLENBQUMsc0JBQXNCLENBQUMsaUJBQWlCLEVBQUUsS0FBSyxFQUFFLGFBQWEsQ0FBQyxDQUFDO1NBQ3hFO1FBQ0QsT0FBTztJQUNYLENBQUM7SUFFRCxRQUFRLENBQUMsS0FBbUI7UUFDeEIsTUFBTSxvQkFBb0IsR0FBNkIsT0FBTSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsVUFBVSxDQUFDLEtBQUssVUFBVSxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsVUFBVSxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsVUFBVSxDQUFDO1FBQ3RKLEtBQUssTUFBTSxrQkFBa0IsSUFBSSxvQkFBb0IsRUFBRTtZQUNuRCxNQUFNLGdCQUFnQixHQUE0QixrQkFBa0IsQ0FBQyxJQUFJLENBQUMsS0FBSyxFQUFFLEtBQUssQ0FBQyxDQUFDO1lBQ3hGLElBQUksZ0JBQWdCLEtBQUssSUFBSSxFQUFFO2dCQUMzQixHQUFHLENBQUMsS0FBSyxDQUFDLHVEQUF1RCxJQUFJLENBQUMsU0FBUyxDQUFDLGdCQUFnQixFQUFFLElBQUksRUFBRSxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUM7Z0JBQy9HLE9BQU8sZ0JBQWdCLENBQUM7YUFDM0I7U0FDSjtRQUNELE9BQU8sSUFBSSxDQUFDO0lBQ2hCLENBQUM7SUFFRCxtQkFBbUIsQ0FBQyxLQUFtQjtRQUNuQyxPQUFPLElBQUksQ0FBQyxLQUFLLENBQUMsS0FBSyxLQUFLLFNBQVMsSUFBSSxJQUFJLENBQUMsS0FBSyxDQUFDLGdCQUFnQixLQUFLLEtBQUssSUFBSSxJQUFJLENBQUMsbUJBQW1CLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxvQkFBb0IsRUFBRSxLQUFLLENBQUMsQ0FBQztJQUN2SixDQUFDO0lBRUQsWUFBWSxDQUFDLEtBQW1CLEVBQUUsYUFBbUM7UUFDakUsSUFBSSxDQUFDLEtBQUssQ0FBQyxpQkFBaUIsR0FBRyxpQkFBaUIsQ0FBQztRQUNqRCxhQUFhLENBQUMsTUFBTSxDQUFDLElBQUksZ0NBQWUsQ0FBQyxJQUFJLEVBQUUsRUFBRSxLQUFLLEVBQUUsSUFBSSxDQUFDLEtBQUssQ0FBQyxLQUFLLEVBQUUsQ0FBQyxDQUFDLENBQUM7SUFDakYsQ0FBQztJQUVELHNCQUFzQixDQUFDLEtBQW1CO1FBQ3RDLE9BQU8sSUFBSSxDQUFDLEtBQUssQ0FBQyxLQUFLLEtBQUssU0FBUyxJQUFJLElBQUksQ0FBQyxRQUFRLENBQUMsS0FBSyxDQUFDLEtBQUssSUFBSSxDQUFDO0lBQzNFLENBQUM7SUFFRCxrQkFBa0IsQ0FBQyxLQUFtQjtRQUNsQyxPQUFPLElBQUksQ0FBQyxLQUFLLENBQUMsS0FBSyxLQUFLLFNBQVMsSUFBSSxJQUFJLENBQUMsbUJBQW1CLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxRQUFRLEVBQUUsS0FBSyxDQUFDLENBQUM7SUFDbEcsQ0FBQztJQUVELHNCQUFzQixDQUFDLGlCQUF5QixFQUFFLEtBQW1CLEVBQUUsYUFBbUM7UUFDdEcsSUFBSSxDQUFDLEtBQUssQ0FBQyxpQkFBaUIsR0FBRyxpQkFBaUIsQ0FBQztRQUVqRCxRQUFRLGlCQUFpQixFQUFFO1lBQ3ZCLEtBQUssaUJBQUMsQ0FBQyxNQUFNLENBQUMsR0FBRztnQkFDYixhQUFhLENBQUMsTUFBTSxDQUFDLElBQUksZ0NBQWUsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDO2dCQUNoRCxPQUFPO1lBQ1gsS0FBSyxpQkFBQyxDQUFDLE1BQU0sQ0FBQyxNQUFNO2dCQUNoQixhQUFhLENBQUMsTUFBTSxDQUFDLElBQUksdUNBQXNCLENBQUMsSUFBSSxFQUFFLEVBQUMsWUFBWSxFQUFFLElBQUksQ0FBQyxLQUFLLENBQUMsS0FBTSxFQUFDLENBQUMsQ0FBQyxDQUFDO2dCQUMxRixPQUFPO1lBQ1g7Z0JBQ0ksTUFBTSxJQUFJLEtBQUssQ0FBQyx5Q0FBeUMsaUJBQWlCLEVBQUUsQ0FBQyxDQUFDO1NBQ3JGO0lBQ0wsQ0FBQztJQUVELHdCQUF3Qjs7UUFDcEIsSUFBSSxJQUFJLFNBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxLQUFLLG1DQUFJLFFBQVEsQ0FBQztRQUN4QyxJQUFJLElBQUksQ0FBQyxLQUFLLENBQUMsaUJBQWlCLEtBQUssU0FBUyxFQUFFO1lBQzVDLElBQUksSUFBSSxlQUFlLElBQUksQ0FBQyxLQUFLLENBQUMsaUJBQWlCLEdBQUcsQ0FBQztTQUMxRDtRQUNELE9BQU8sSUFBSSxDQUFDO0lBQ2hCLENBQUM7SUFFRCxTQUFTLENBQUMsR0FBYyxFQUFFLEtBQW1CLEVBQUUsT0FBK0I7UUFDMUUsSUFBSSxHQUFHLFlBQVksNkJBQWUsRUFBRTtZQUNoQyxPQUFPLENBQUMsaUJBQWlCLENBQUMsSUFBSSxDQUFDLGtCQUFrQixDQUFDLEdBQUcsRUFBRSxJQUFJLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxZQUFZLEVBQUUsS0FBSyxDQUFDLENBQUMsQ0FBQztZQUNoRyxPQUFPLENBQUMsbUJBQW1CLENBQUMsSUFBSSxDQUFDLGtCQUFrQixDQUFDLEdBQUcsRUFBRSxJQUFJLENBQUMsS0FBSyxDQUFDLFNBQVMsQ0FBQyxZQUFZLEVBQUUsS0FBSyxDQUFDLENBQUMsQ0FBQztTQUN2RzthQUVJLElBQUksR0FBRyxZQUFZLHlCQUFXLEVBQUU7WUFDakMsdUdBQXVHO1lBQ3ZHLE9BQU8sQ0FBQyxpQkFBaUIsQ0FBQyxJQUFJLENBQUMsa0JBQWtCLENBQUMsR0FBRyxFQUFFLElBQUksQ0FBQyxLQUFLLENBQUMsT0FBTyxDQUFDLFFBQVEsRUFBRSxLQUFLLENBQUMsQ0FBQyxDQUFDO1lBQzVGLE9BQU8sQ0FBQyxtQkFBbUIsQ0FBQyxJQUFJLENBQUMsa0JBQWtCLENBQUMsR0FBRyxFQUFFLElBQUksQ0FBQyxLQUFLLENBQUMsU0FBUyxDQUFDLFFBQVEsRUFBRSxLQUFLLENBQUMsQ0FBQyxDQUFDO1NBQ25HO2FBRUksSUFBSSxHQUFHLFlBQVksNkJBQWUsRUFBRTtZQUNyQyxPQUFPLENBQUMsaUJBQWlCLENBQUMsSUFBSSxDQUFDLGtCQUFrQixDQUFDLEdBQUcsRUFBRSxJQUFJLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxZQUFZLEVBQUUsS0FBSyxDQUFDLENBQUMsQ0FBQztZQUNoRyxPQUFPLENBQUMsbUJBQW1CLENBQUMsSUFBSSxDQUFDLGtCQUFrQixDQUFDLEdBQUcsRUFBRSxJQUFJLENBQUMsS0FBSyxDQUFDLFNBQVMsQ0FBQyxZQUFZLEVBQUUsS0FBSyxDQUFDLENBQUMsQ0FBQztTQUN2RzthQUVJLElBQUksR0FBRyxZQUFZLGdDQUFlLElBQUksR0FBRyxZQUFZLHVDQUFzQixFQUFFO1lBQzlFLE1BQU0sTUFBTSxHQUFHLEdBQUcsWUFBWSxnQ0FBZSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxZQUFZLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsT0FBTyxDQUFDLG1CQUFtQixDQUFDO1lBQ3pILE1BQU0sUUFBUSxHQUFHLEdBQUcsWUFBWSx1Q0FBc0IsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxTQUFTLENBQUMsWUFBWSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLFNBQVMsQ0FBQyxtQkFBbUIsQ0FBQztZQUV0SSxPQUFPLENBQUMsaUJBQWlCLENBQUMsSUFBSSxDQUFDLGtCQUFrQixDQUFDLEdBQUcsRUFBRSxNQUFNLEVBQUUsS0FBSyxDQUFDLENBQUMsQ0FBQztZQUN2RSxPQUFPLENBQUMsbUJBQW1CLENBQUMsSUFBSSxDQUFDLGtCQUFrQixDQUFDLEdBQUcsRUFBRSxRQUFRLEVBQUUsS0FBSyxDQUFDLENBQUMsQ0FBQztZQUUzRSxNQUFNLGVBQWUsR0FBRyx1QkFBdUIsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLFFBQVEsQ0FBQyxDQUFDO1lBQ3JFLE9BQU8sQ0FBQyxzQkFBc0IsQ0FBQyxlQUFlLENBQUMsUUFBUSxFQUFFLGVBQWUsQ0FBQyxNQUFNLENBQUMsQ0FBQztTQUNwRjthQUVJLElBQUksR0FBRyxZQUFZLGdDQUFlLEVBQUU7WUFDckMsT0FBTyxDQUFDLGlCQUFpQixDQUFDLElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxHQUFHLEVBQUUsSUFBSSxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsWUFBWSxFQUFFLEtBQUssQ0FBQyxDQUFDLENBQUM7WUFDaEcsT0FBTyxDQUFDLG1CQUFtQixDQUFDLElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxHQUFHLEVBQUUsSUFBSSxDQUFDLEtBQUssQ0FBQyxTQUFTLENBQUMsWUFBWSxFQUFFLEtBQUssQ0FBQyxDQUFDLENBQUM7U0FDdkc7YUFFSSxJQUFJLEdBQUcsWUFBWSwrQkFBaUIsRUFBRTtZQUN2QyxPQUFPLENBQUMsaUJBQWlCLENBQUMsSUFBSSxDQUFDLGtCQUFrQixDQUFDLEdBQUcsRUFBRSxJQUFJLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxhQUFhLEVBQUUsS0FBSyxDQUFDLENBQUMsQ0FBQztZQUNqRyxPQUFPLENBQUMsbUJBQW1CLENBQUMsSUFBSSxDQUFDLGtCQUFrQixDQUFDLEdBQUcsRUFBRSxJQUFJLENBQUMsS0FBSyxDQUFDLFNBQVMsQ0FBQyxhQUFhLEVBQUUsS0FBSyxDQUFDLENBQUMsQ0FBQztTQUN4RzthQUVJLElBQUksR0FBRyxZQUFZLGtDQUFvQixFQUFFO1lBQzFDLE9BQU8sQ0FBQyxpQkFBaUIsQ0FBQyxJQUFJLENBQUMsa0JBQWtCLENBQUMsR0FBRyxFQUFFLElBQUksQ0FBQyxLQUFLLENBQUMsT0FBTyxDQUFDLGdCQUFnQixFQUFFLEtBQUssQ0FBQyxDQUFDLENBQUM7WUFDcEcsT0FBTyxDQUFDLG1CQUFtQixDQUFDLElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxHQUFHLEVBQUUsSUFBSSxDQUFDLEtBQUssQ0FBQyxTQUFTLENBQUMsZ0JBQWdCLEVBQUUsS0FBSyxDQUFDLENBQUMsQ0FBQztTQUMzRzthQUNJO1lBQ0QsSUFBSSxDQUFDLHNCQUFzQixDQUFDLEdBQUcsQ0FBQyxDQUFDO1NBQ3BDO0lBQ0wsQ0FBQztJQUVELHNCQUFzQixDQUFDLFNBQTJDLEVBQUUsTUFBaUI7UUFDakYsU0FBUyxDQUFDLGdCQUFnQixDQUFDLElBQUksbURBQXdCLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxRQUFRLENBQUMsRUFBRSxNQUFNLENBQUMsQ0FBQztRQUN0RixTQUFTLENBQUMsZ0JBQWdCLENBQUMsSUFBSSwyQ0FBb0IsRUFBRSxFQUFFLE1BQU0sQ0FBQyxDQUFDO1FBQy9ELFNBQVMsQ0FBQyxrQkFBa0IsRUFBRSxDQUFDO0lBQ25DLENBQUM7SUFFRCxZQUFZO1FBRVIsT0FBTyxJQUFJLENBQUMsS0FBSyxDQUFDLGdCQUFnQixDQUFDLE9BQU8sQ0FBQztJQUMvQyxDQUFDO0NBQ0o7QUFyZEQsb0NBcWRDO0FBRUQsU0FBUyx1QkFBdUIsQ0FBQyxRQUFnQjtJQUM3QyxNQUFNLE1BQU0sR0FBVztRQUNuQixJQUFJLEVBQUUsR0FBRyxRQUFRLHFCQUFxQixDQUFDLE9BQU8sQ0FBQyxHQUFHLEVBQUUsR0FBRyxDQUFDO1FBQ3hELEtBQUssRUFBRTtZQUNILFFBQVEsRUFBRSxFQUFFLElBQUksRUFBRSxRQUFRLEVBQUUsS0FBSyxFQUFFLEVBQUUsRUFBRSxrQkFBa0IsRUFBRSxNQUFNLEVBQUU7WUFDbkUsUUFBUSxFQUFFLEVBQUUsSUFBSSxFQUFFLFVBQVUsRUFBRSxLQUFLLEVBQUUsRUFBRSxFQUFFLGtCQUFrQixFQUFFLE1BQU0sRUFBRTtZQUNyRSxNQUFNLEVBQUUsRUFBRSxJQUFJLEVBQUUsUUFBUSxFQUFFLEtBQUssRUFBRSxFQUFFLEVBQUUsa0JBQWtCLEVBQUUsTUFBTSxFQUFFO1lBQ2pFLE1BQU0sRUFBRSxFQUFFLElBQUksRUFBRSxRQUFRLEVBQUUsS0FBSyxFQUFFLEVBQUUsRUFBRSxrQkFBa0IsRUFBRSxNQUFNLEVBQUU7WUFDakUsSUFBSSxFQUFFLEVBQUUsSUFBSSxFQUFFLE1BQU0sRUFBRSxLQUFLLEVBQUUsRUFBRSxFQUFFLGtCQUFrQixFQUFFLE1BQU0sRUFBRTtZQUM3RCxJQUFJLEVBQUUsRUFBRSxJQUFJLEVBQUUsTUFBTSxFQUFFLEtBQUssRUFBRSxFQUFFLEVBQUUsa0JBQWtCLEVBQUUsTUFBTSxFQUFFO1lBQzdELE1BQU0sRUFBRSxFQUFFLElBQUksRUFBRSxRQUFRLEVBQUUsS0FBSyxFQUFFLEVBQUUsRUFBRSxrQkFBa0IsRUFBRSxNQUFNLEVBQUU7U0FDcEU7UUFDRCxrQkFBa0IsRUFBRSxNQUFNO0tBQzdCLENBQUM7SUFFRixPQUFPO1FBQ0gsTUFBTTtRQUNOLFFBQVEsRUFBRSxRQUFRO0tBQ3JCLENBQUM7QUFDTixDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiLypcbiAqIENvcHlyaWdodCAyMDE5IEFtYXpvbi5jb20sIEluYy4gb3IgaXRzIGFmZmlsaWF0ZXMuIEFsbCBSaWdodHMgUmVzZXJ2ZWQuXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpLlxuICogWW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogQSBjb3B5IG9mIHRoZSBMaWNlbnNlIGlzIGxvY2F0ZWQgYXRcbiAqICAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogb3IgaW4gdGhlIFwibGljZW5zZVwiIGZpbGUgYWNjb21wYW55aW5nIHRoaXMgZmlsZS4gVGhpcyBmaWxlIGlzIGRpc3RyaWJ1dGVkXG4gKiBvbiBhbiBcIkFTIElTXCIgQkFTSVMsIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXJcbiAqIGV4cHJlc3Mgb3IgaW1wbGllZC4gU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nXG4gKiBwZXJtaXNzaW9ucyBhbmQgbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cblxuaW1wb3J0IHsgSW50ZW50LCBJbnRlbnRSZXF1ZXN0IH0gZnJvbSBcImFzay1zZGstbW9kZWxcIjtcbmltcG9ydCBfIGZyb20gXCJsb2Rhc2hcIjtcbmltcG9ydCBpMThuZXh0IGZyb20gJ2kxOG5leHQnO1xuaW1wb3J0IHsgU3RyaW5ncyBhcyAkIH0gZnJvbSBcIi4uL2NvbnN0YW50cy9TdHJpbmdzXCI7XG5pbXBvcnQgeyBDb250cm9sLCBDb250cm9sUHJvcHMsIENvbnRyb2xTdGF0ZSB9IGZyb20gJy4uL2NvbnRyb2xzL0NvbnRyb2wnO1xuaW1wb3J0IHsgQ29udHJvbElucHV0IH0gZnJvbSAnLi4vY29udHJvbHMvQ29udHJvbElucHV0JztcbmltcG9ydCB7IENvbnRyb2xSZXN1bHRCdWlsZGVyIH0gZnJvbSAnLi4vY29udHJvbHMvQ29udHJvbFJlc3VsdCc7XG5pbXBvcnQgeyBJbnRlcmFjdGlvbk1vZGVsQ29udHJpYnV0b3IgfSBmcm9tICcuLi9jb250cm9scy9taXhpbnMvSW50ZXJhY3Rpb25Nb2RlbENvbnRyaWJ1dG9yJztcbmltcG9ydCB7IEFtYXpvbkJ1aWx0SW5TbG90VHlwZSB9IGZyb20gJy4uL2ludGVudHMvQW1hem9uQnVpbHRJblNsb3RUeXBlJztcbmltcG9ydCB7IEdlbmVyYWxDb250cm9sSW50ZW50LCB1bnBhY2tHZW5lcmFsQ29udHJvbEludGVudCB9IGZyb20gJy4uL2ludGVudHMvR2VuZXJhbENvbnRyb2xJbnRlbnQnO1xuaW1wb3J0IHsgU2luZ2xlVmFsdWVDb250cm9sSW50ZW50LCB1bnBhY2tTaW5nbGVWYWx1ZUNvbnRyb2xJbnRlbnQgfSBmcm9tICcuLi9pbnRlbnRzL1NpbmdsZVZhbHVlQ29udHJvbEludGVudCc7XG5pbXBvcnQgeyBDb250cm9sSW50ZXJhY3Rpb25Nb2RlbEdlbmVyYXRvciB9IGZyb20gJy4uL2ludGVyYWN0aW9uTW9kZWxHZW5lcmF0aW9uL0NvbnRyb2xJbnRlcmFjdGlvbk1vZGVsR2VuZXJhdG9yJztcbmltcG9ydCB7IE1vZGVsRGF0YSwgU2hhcmVkU2xvdFR5cGUgfSBmcm9tICcuLi9pbnRlcmFjdGlvbk1vZGVsR2VuZXJhdGlvbi9Nb2RlbFR5cGVzJztcbmltcG9ydCB7IExvZ2dlciB9IGZyb20gXCIuLi9sb2dnaW5nL0xvZ2dlclwiO1xuaW1wb3J0IHsgQ29udHJvbFJlc3BvbnNlQnVpbGRlciB9IGZyb20gJy4uL3Jlc3BvbnNlR2VuZXJhdGlvbi9Db250cm9sUmVzcG9uc2VCdWlsZGVyJztcbmltcG9ydCB7IEludmFsaWRWYWx1ZUFjdCwgVmFsdWVDaGFuZ2VkQWN0LCBWYWx1ZVNldEFjdCwgVmFsdWVDb25maXJtZWRBY3QsIFZhbHVlRGlzY29uZmlybWVkQWN0IH0gZnJvbSBcIi4uL3N5c3RlbUFjdHMvQ29udGVudEFjdHNcIjtcbmltcG9ydCB7IFJlcXVlc3RDaGFuZ2VkVmFsdWVBY3QsIFJlcXVlc3RWYWx1ZUFjdCwgQ29uZmlybVZhbHVlQWN0IH0gZnJvbSBcIi4uL3N5c3RlbUFjdHMvSW5pdGlhdGl2ZUFjdHNcIjtcbmltcG9ydCB7IFN5c3RlbUFjdCB9IGZyb20gJy4uL3N5c3RlbUFjdHMvU3lzdGVtQWN0JztcbmltcG9ydCB7IFN0cmluZ09yTGlzdCB9IGZyb20gJy4uL3V0aWxzL0Jhc2ljVHlwZXMnO1xuaW1wb3J0IHsgRGVlcFJlcXVpcmVkIH0gZnJvbSAnLi4vdXRpbHMvRGVlcFJlcXVpcmVkJztcbmltcG9ydCB7IElucHV0VXRpbCB9IGZyb20gXCIuLi91dGlscy9JbnB1dFV0aWxcIjtcbmltcG9ydCB7IGZhbHNlSWZHdWFyZEZhaWxlZCwgb2tJZiB9IGZyb20gJy4uL3V0aWxzL1ByZWRpY2F0ZXMnO1xuaW1wb3J0IHsgVmFsaWRhdGlvblJlc3VsdCB9IGZyb20gJy4uL2NvbnRyb2xzL1ZhbGlkYXRpb25SZXN1bHQnO1xuXG5jb25zdCBsb2cgPSBuZXcgTG9nZ2VyKCdBc2tTZGtDb250cm9sczpWYWx1ZUNvbnRyb2wnKTtcblxuXG5leHBvcnQgdHlwZSBTbG90VmFsaWRhdGlvbkZ1bmN0aW9uID0gKHN0YXRlOiBWYWx1ZUNvbnRyb2xTdGF0ZSwgaW5wdXQ6IENvbnRyb2xJbnB1dCkgPT4gdHJ1ZSB8IFZhbGlkYXRpb25SZXN1bHQ7XG5cbmV4cG9ydCBpbnRlcmZhY2UgVmFsdWVDb250cm9sUHJvcHMgZXh0ZW5kcyBDb250cm9sUHJvcHMge1xuICAgIGlkOiBzdHJpbmc7XG5cbiAgICAvKipcbiAgICAgKiBUaGUgc2xvdFR5cGUgdGhhdCB0aGlzIGNvbnRyb2wgaXMgY29sbGVjdGluZy5cbiAgICAgKlxuICAgICAqIFVzYWdlOlxuICAgICAqIFRoZSBzbG90IHR5cGUgZGVmaW5lcyB0aGUgc2V0IG9mIGV4cGVjdGVkIHZhbHVlIGl0ZW1zLlxuICAgICAqIE5MVSB3aWxsLCBvbiBvY2Nhc2lvbiwgYWNjZXB0IG5vdmVsIHNsb3QgdmFsdWUgYW5kIG1hcmsgdGhlbSBhcyBFUl9OT19NQVRDSC4gIElmIHlvdSBvbmx5IHdhbnQgdG8gYWNjZXB0IHZhbHVlcyB0aGF0IGFyZSBleHBsaWNpdGx5IGRlZmluZWQgYWRkIGEgdmFsaWRhdGlvbiBmdW5jdGlvbiB0aGF0IHRlc3RzIGZvciBFUl9NQVRDSCAoLy9leGFtcGxlLy8pXG4gICAgICovXG4gICAgc2xvdFR5cGU6IHN0cmluZztcblxuICAgIC8qKlxuICAgICAqIERldGVybWluZXMgaWYgdGhlIHZhbHVlIGlzIHZhbGlkLlxuICAgICAqXG4gICAgICogRGVmYXVsdDogYHRydWVgLCBpLmUuIGFueSB2YWx1ZSBpcyB2YWxpZC5cbiAgICAgKlxuICAgICAqIFVzYWdlOlxuICAgICAqICAqIFZhbGlkYXRpb24gZnVuY3Rpb25zIHJldHVybiBlaXRoZXIgYHRydWVgIG9yIGFuIGBlcnJvckNvZGVgIHN0cmluZy4gIFRoZSBgZXJyb3JDb2RlYCBjYW5cbiAgICAgKiAgICBiZSBjb252ZXJ0ZWQgaW50byBhIHN1cmZhY2UgZm9ybSBkdXJpbmcgdGhlIHJlbmRlciBwaGFzZS5cbiAgICAgKi9cbiAgICB2YWxpZGF0aW9uPzogU2xvdFZhbGlkYXRpb25GdW5jdGlvbiB8IFNsb3RWYWxpZGF0aW9uRnVuY3Rpb25bXTtcblxuICAgIC8qKlxuICAgICAqIFdoZXRoZXIgdGhlIENvbnRyb2wgc2hvdWxkIGVsaWNpdCB0aGUgdXNlciBmb3IgYSB2YWx1ZS5cbiAgICAgKlxuICAgICAqIEJlaGF2aW9yOlxuICAgICAqICAtIGlmIHRydWUsIHRoZSBDb250cm9sIHdpbGwgZ2VuZXJhdGUgYSBxdWVzdGlvbiB3aGVuIGdpdmVuIHRoZSBvcHBvcnR1bml0eS5cbiAgICAgKi9cbiAgICByZXF1aXJlZD86IGJvb2xlYW4gfCAoKGlucHV0OiBDb250cm9sSW5wdXQpID0+IGJvb2xlYW4pO1xuXG4gICAgLyoqXG4gICAgICogUHJvcHMgdG8gY3VzdG9taXplIHRoZSByZWxhdGlvbnNoaXAgYmV0d2VlbiB0aGUgaW50ZXJhY3Rpb24gbW9kZWwgYW5kIHRoZSBjb250cm9sLlxuICAgICAqL1xuICAgIGludGVyYWN0aW9uTW9kZWw/OiBWYWx1ZUNvbnRyb2xJbnRlcmFjdGlvbk1vZGVsUHJvcHM7XG5cbiAgICAvKipcbiAgICAgKiBQcm9wcyB0byBjdXN0b21pemUgdGhlIHByb21wdC1mcmFnbWVudHMgZm9yIHRoZSBzeXN0ZW0gYWN0cyBwcm9kdWNlZCBieSB0aGUgY29udHJvbC5cbiAgICAgKi9cbiAgICBwcm9tcHRzPzogVmFsdWVDb250cm9sUHJvbXB0UHJvcHM7XG5cbiAgICAvKipcbiAgICAgKiBQcm9wcyB0byBjdXN0b21pemUgdGhlIHJlcHJvbXB0LWZyYWdtZW50cyBmb3IgdGhlIHN5c3RlbSBhY3RzIHByb2R1Y2VkIGJ5IHRoZSBjb250cm9sLlxuICAgICAqL1xuICAgIHJlcHJvbXB0cz86IFZhbHVlQ29udHJvbFByb21wdFByb3BzO1xuXG4gICAgLyoqXG4gICAgICogV2hldGhlciB0aGUgQ29udHJvbCBoYXMgdG8gY29uZmlybSB0aGUgdmFsdWUgd2hpY2ggdXNlciBwcm92aWRlcy5cbiAgICAgKiBcbiAgICAgKiBCZWhhdmlvcjpcbiAgICAgKiAgLSBpZiB0cnVlLCB0aGUgQ29udHJvbCB3aWxsIGdlbmVyYXRlIGEgY29uZmlybWF0aW9uIHF1ZXN0aW9uIHdoZW4gYSB2YWx1ZSBpcyBwcm92aWRlZC5cbiAgICAgKi9cbiAgICBjb25maXJtYXRpb25SZXF1aXJlZD86IGJvb2xlYW4gfCAoKGlucHV0OiBDb250cm9sSW5wdXQpID0+IGJvb2xlYW4pO1xufVxuXG4vKipcbiAqIE1hcHBpbmcgb2YgQWN0aW9uLVNsb3QgdmFsdWVzIHRvIHRoZSBiZWhhdmlvcnMgdGhhdCB0aGlzIGNvbnRyb2wgc3VwcG9ydHMuXG4gKlxuICogRGVmYXVsdDpcbiAqIGBgYFxuICogICAge1xuICogICAgICAgc2V0OiBbJ3NldCcsICdzZWxlY3QnXSxcbiAqICAgICAgIGNoYW5nZTogWydjaGFuZ2UnXSxcbiAqICAgIH1cbiAqIGBgYFxuICovXG5leHBvcnQgaW50ZXJmYWNlIFZhbHVlQ29udHJvbEFjdGlvblByb3BzIHtcbiAgICBzZXQ/OiBzdHJpbmdbXSxcbiAgICBjaGFuZ2U/OiBzdHJpbmdbXVxufVxuXG5leHBvcnQgY2xhc3MgVmFsdWVDb250cm9sSW50ZXJhY3Rpb25Nb2RlbFByb3BzIHtcbiAgICAvKipcbiAgICAgKiBUYXJnZXQtc2xvdC12YWx1ZXMgYXNzb2NpYXRlZCB3aXRoIHRoaXMgQ29udHJvbC5cbiAgICAgKlxuICAgICAqIFVzYWdlOlxuICAgICAqICAqIFRoaXMgYWxsb3dzIHVzZXJzIHRvIHJlZmVyIHRvIGEgY29udHJvbC5cbiAgICAgKiAgKiBBIGNvbnRyb2wgY2FuIGJlIGFzc29jaWF0ZWQgd2l0aCBtYW55IHRhcmdldC1zbG90LXZhbHVlcywgZWcgWydkYXRlJywgJ3N0YXJ0RGF0ZScsICdldmVudFN0YXJ0RGF0ZScsICd2YWNhdGlvblN0YXJ0J11cbiAgICAgKiAgKiBJdCBpcyBhIGdvb2QgaWRlYSB0byBhc3NvY2lhdGUgd2l0aCBnZW5lcmFsIHRhcmdldHMgKGUuZy4gZGF0ZSkgYW5kIHNwZWNpZmljIHRhcmdldHMgKGUuZy4gdmFjYXRpb25TdGFydCkgc28gdGhhdCB0aGVcbiAgICAgKiAgICB1c2VyIGNhbiBzYXkgZWl0aGVyIGdlbmVyYWwgb3Igc3BlY2lmaWMgdGhpbmdzLiAgZS5nLiAnY2hhbmdlIHRoZSBkYXRlIHRvIFR1ZXNkYXknLCBvciAnSSB3YW50IG15IHZhY2F0aW9uIHRvIHN0YXJ0IG9uIFR1ZXNkYXknLlxuICAgICAqICAqIFRoZSBhc3NvY2lhdGlvbiBkb2VzIG5vdCBoYXZlIHRvIGJlIGV4Y2x1c2l2ZSwgYW5kIGdlbmVyYWwgdGFyZ2V0IHNsb3QgdmFsdWVzIHdpbGwgb2Z0ZW4gYmUgYXNzb2NpYXRlZCB3aXRoIG1hbnkgY29udHJvbHMuXG4gICAgICogICAgSW4gc2l0dWF0aW9ucyB3aGVyZSB0aGVyZSBpcyBhbWJpZ3VpdHkgYWJvdXQgd2hhdCB0aGUgdXNlciBpcyByZWZlcnJpbmcgdG8sIHRoZSBwYXJlbnQgY29udHJvbHNcbiAgICAgKiAgICBtdXN0IHJlc29sdmUgdGhlIGNvbmZ1c2lvbi5cbiAgICAgKlxuICAgICAqL1xuICAgIHRhcmdldHM/OiBzdHJpbmdbXTtcblxuICAgIC8qKlxuICAgICAqIEFjdGlvbi1zbG90LXZhbHVlcyBhc3NvY2lhdGVkIHRvIHRoZSBhY3Rpb24tY2FwYWJpbGl0aWVzIG9mIHRoaXMgQ29udHJvbC5cbiAgICAgKlxuICAgICAqIERlZmF1bHQ6XG4gICAgICogYGBgdHNcbiAgICAgKiB7XG4gICAgICogICAgc2V0OiBbJ3NldCddXG4gICAgICogICAgY2hhbmdlOiBbJ2NoYW5nZSddLFxuICAgICAqIH1cbiAgICAgKiBgYGBcbiAgICAgKlxuICAgICAqIFVzYWdlOlxuICAgICAqICAqIFRoaXMgYWxsb3dzIHVzZXJzIHRvIHJlZmVyIHRvIGFuIGFjdGlvbiB1c2luZyBtb3JlIGRvbWFpbi1hcHByb3ByaWF0ZSB3b3Jkcy4gRm9yIGV4YW1wbGUsIGEgdXNlciBtaWdodFxuICAgICAqICAgIGxpa2UgdG8gc2F5ICdzaG93IHR3byBpdGVtcycgcmF0aGVyIHRoYXQgJ3NldCBpdGVtIGNvdW50IHRvIHR3bycuICBUbyBhY2hpZXZlIHRoaXMsIGluY2x1ZGUgdGhlXG4gICAgICogICAgc2xvdC12YWx1ZS1pZCAnc2hvdycgaW4gdGhlIGxpc3QgYXNzb2NpYXRlZCB3aXRoIHRoZSAnc2V0JyBjYXBhYmlsaXR5IGFuZCBlbnN1cmUgdGhlIGludGVyYWN0aW9uLW1vZGVsXG4gICAgICogICAgaW5jbHVkZXMgYW4gYWN0aW9uIHNsb3QgdmFsdWUgd2l0aCBpZD1zaG93IGFuZCBhcHByb3ByaWF0ZSBzeW5vbnltcy5cbiAgICAgKlxuICAgICAqIGBgYFxuICAgICAqIHtcbiAgICAgKiAgICAgc2V0OiBbJ3NldCcsICdzaG93JywgJ3NlbGVjdCddICAvLyBFYWNoIGVudHJ5IGlzIGFuIGFjdGlvbi1zbG90LXZhbHVlIHRoYXQgaXMgY29uc2lkZXJlZCBhIHN5bm9ueW0gdG8gJ3NldCcgZm9yIHRoaXMgY29udHJvbC5cbiAgICAgKiB9XG4gICAgICogYGBgXG4gICAgICovXG4gICAgYWN0aW9ucz86IFZhbHVlQ29udHJvbEFjdGlvblByb3BzO1xufVxuXG5leHBvcnQgY2xhc3MgVmFsdWVDb250cm9sUHJvbXB0UHJvcHMge1xuICAgIHZhbHVlU2V0PzogU3RyaW5nT3JMaXN0IHwgKChhY3Q6IFZhbHVlU2V0QWN0PGFueT4sIGlucHV0OiBDb250cm9sSW5wdXQpID0+IFN0cmluZ09yTGlzdCk7XG4gICAgdmFsdWVDaGFuZ2VkPzogU3RyaW5nT3JMaXN0IHwgKChhY3Q6IFZhbHVlQ2hhbmdlZEFjdDxhbnk+LCBpbnB1dDogQ29udHJvbElucHV0KSA9PiBTdHJpbmdPckxpc3QpO1xuICAgIGludmFsaWRWYWx1ZT86IFN0cmluZ09yTGlzdCB8ICgoYWN0OiBJbnZhbGlkVmFsdWVBY3Q8YW55PiwgaW5wdXQ6IENvbnRyb2xJbnB1dCkgPT4gU3RyaW5nT3JMaXN0KTtcbiAgICByZXF1ZXN0VmFsdWU/OiBTdHJpbmdPckxpc3QgfCAoKGFjdDogUmVxdWVzdFZhbHVlQWN0LCBpbnB1dDogQ29udHJvbElucHV0KSA9PiBTdHJpbmdPckxpc3QpO1xuICAgIHJlcXVlc3RDaGFuZ2VkVmFsdWU/OiBTdHJpbmdPckxpc3QgfCAoKGFjdDogUmVxdWVzdENoYW5nZWRWYWx1ZUFjdCwgaW5wdXQ6IENvbnRyb2xJbnB1dCkgPT4gU3RyaW5nT3JMaXN0KTtcbiAgICBjb25maXJtVmFsdWU/OiBTdHJpbmdPckxpc3QgfCAoKGFjdDogQ29uZmlybVZhbHVlQWN0PGFueT4sIGlucHV0OiBDb250cm9sSW5wdXQpID0+IFN0cmluZ09yTGlzdCk7XG4gICAgdmFsdWVEaXNhZmZpcm1lZD86IFN0cmluZ09yTGlzdCB8ICgoYWN0OiBWYWx1ZURpc2NvbmZpcm1lZEFjdDxhbnk+LCBpbnB1dDogQ29udHJvbElucHV0KSA9PiBTdHJpbmdPckxpc3QpO1xuICAgIHZhbHVlQWZmaXJtZWQ/OiBTdHJpbmdPckxpc3QgfCAoKGFjdDogVmFsdWVDb25maXJtZWRBY3Q8YW55PiwgaW5wdXQ6IENvbnRyb2xJbnB1dCkgPT4gU3RyaW5nT3JMaXN0KTtcbn1cblxuZXhwb3J0IGNsYXNzIFZhbHVlQ29udHJvbFN0YXRlIGltcGxlbWVudHMgQ29udHJvbFN0YXRlIHtcblxuICAgIC8qKlxuICAgICAqIFZhbHVlLCB3aGljaCBpcyB0aGUgSUQgb2YgYSBTbG90VmFsdWUgZm9yIHRoaXMuc2xvdFR5cGUuXG4gICAgICovXG4gICAgdmFsdWU/OiBzdHJpbmc7XG5cbiAgICAvKipcbiAgICAgKiBUcmFja3Mgd2hldGhlciBhbiBlbGljaXRhdGlvbiBpcyBoYXBwZW5pbmcgYW5kIHdoZXRoZXIgaXQgaXMgdG8gJ1NldCcgb3IgJ0NoYW5nZScgdGhlIHZhbHVlLlxuICAgICAqL1xuICAgIGVsaWNpdGF0aW9uQWN0aW9uPzogc3RyaW5nOyAgLy8gcmVjb3JkcyB3aGF0IGtpbmQgb2YgZWxpY2l0YXRpb24gd2UgYXJlIHBlcmZvcm1pbmcuXG5cbiAgICAvKipcbiAgICAgKiBUcmFja3Mgd2hldGhlciB0aGUgdmFsdWUgaXMgYW4gRW50aXR5IFJlc29sdXRpb24gbWF0Y2guXG4gICAgICovXG4gICAgZXJNYXRjaD86IGJvb2xlYW47XG5cbiAgICAvKipcbiAgICAgKiBUcmFja3Mgd2hldGhlciB0aGUgdmFsdWUgaXMgY29uZmlybWVkIGJ5IHRoZSB1c2VyLCBpZiBjb25maXJtYXRpb25SZXF1aXJlZCBpcyBzZXQgdG8gdHJ1ZS5cbiAgICAgKi9cbiAgICBpc1ZhbHVlQ29uZmlybWVkOiBib29sZWFuID0gZmFsc2U7XG5cbiAgICAvKipcbiAgICAgKiBQcmV2aW91cyB2YWx1ZSB1c2VkIHRvIHRyYWNrIGNoYW5nZSBvZiBhIGNvbnRyb2wgdmFsdWUuXG4gICAgICovXG4gICAgcHJldmlvdXNWYWx1ZT86IHN0cmluZztcbiAgICAgICAgXG4gICAgLyoqXG4gICAgICogVHJhY2tzIHRoZSBsYXN0IGluaXRpYXRpdmUgYWN0IGZyb20gdGhlIGNvbnRyb2xcbiAgICAgKi9cbiAgICBsYXN0SW5pdGlhdGl2ZUFjdD86IHN0cmluZzsgLy8gVE9ETzogU3RvcmUgYWN0dWFsIGFjdFxufVxuXG5leHBvcnQgY2xhc3MgVmFsdWVDb250cm9sIGV4dGVuZHMgQ29udHJvbCBpbXBsZW1lbnRzIEludGVyYWN0aW9uTW9kZWxDb250cmlidXRvciB7XG5cbiAgICByYXdQcm9wczogVmFsdWVDb250cm9sUHJvcHM7XG4gICAgcHJvcHM6IERlZXBSZXF1aXJlZDxWYWx1ZUNvbnRyb2xQcm9wcz47XG4gICAgcHVibGljIHN0YXRlOiBWYWx1ZUNvbnRyb2xTdGF0ZSA9IG5ldyBWYWx1ZUNvbnRyb2xTdGF0ZSgpO1xuICAgIHByaXZhdGUgaGFuZGxlRnVuYz86IChpbnB1dDogQ29udHJvbElucHV0LCByZXN1bHRCdWlsZGVyOiBDb250cm9sUmVzdWx0QnVpbGRlcikgPT4gdm9pZDtcbiAgICBjb25zdHJ1Y3Rvcihwcm9wczogVmFsdWVDb250cm9sUHJvcHMpIHtcbiAgICAgICAgc3VwZXIocHJvcHMuaWQpO1xuXG4gICAgICAgIGlmIChwcm9wcy5zbG90VHlwZSA9PT0gQW1hem9uQnVpbHRJblNsb3RUeXBlLlNFQVJDSF9RVUVSWSl7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0FNQVpPTi5TZWFyY2hRdWVyeSBjYW5ub3QgYmUgdXNlZCB3aXRoIFZhbHVlQ29udHJvbCBkdWUgdG8gdGhlIHNwZWNpYWwgcnVsZXMgcmVnYXJkaW5nIGl0cyB1c2UuICdcbiAgICAgICAgICAgICArICdTcGVjaWZpY2FsbHksIHV0dGVyYW5jZXMgdGhhdCBpbmNsdWRlIFNlYXJjaFF1ZXJ5IG11c3QgaGF2ZSBhIGNhcnJpZXIgcGhyYXNlIGFuZCBub3QgYmUgY29tcHJpc2VkIGVudGlyZWx5IG9mIHNsb3QgcmVmZXJlbmNlcy4gJ1xuICAgICAgICAgICAgICsgJ1VzZSBhIGN1c3RvbSBpbnRlbnQgdG8gbWFuYWdlIFNlYXJjaFF1ZXJ5IHNsb3RzIG9yIGNyZWF0ZSBhIHJlZ3VsYXIgc2xvdCBmb3IgdXNlIHdpdGggVmFsdWVDb250cm9sLicpO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5yYXdQcm9wcyA9IHByb3BzO1xuICAgICAgICB0aGlzLnByb3BzID0gVmFsdWVDb250cm9sLm1lcmdlV2l0aERlZmF1bHRQcm9wcyhwcm9wcyk7XG4gICAgfVxuXG4gICAgc3RhdGljIG1lcmdlV2l0aERlZmF1bHRQcm9wcyhwcm9wczogVmFsdWVDb250cm9sUHJvcHMpOiBEZWVwUmVxdWlyZWQ8VmFsdWVDb250cm9sUHJvcHM+IHtcblxuICAgICAgICBjb25zdCBkZWZhdWx0czogRGVlcFJlcXVpcmVkPFZhbHVlQ29udHJvbFByb3BzPiA9XG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiAnZHVtbXknLFxuICAgICAgICAgICAgc2xvdFR5cGU6ICdkdW1teScsXG4gICAgICAgICAgICByZXF1aXJlZDogdHJ1ZSxcbiAgICAgICAgICAgIHZhbGlkYXRpb246IFtdLFxuICAgICAgICAgICAgY29uZmlybWF0aW9uUmVxdWlyZWQ6IGZhbHNlLFxuICAgICAgICAgICAgaW50ZXJhY3Rpb25Nb2RlbDoge1xuICAgICAgICAgICAgICAgIGFjdGlvbnM6IHtcbiAgICAgICAgICAgICAgICAgICAgc2V0OiBbJC5BY3Rpb24uU2V0XSxcbiAgICAgICAgICAgICAgICAgICAgY2hhbmdlOiBbJC5BY3Rpb24uQ2hhbmdlXSxcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIHRhcmdldHM6IFskLlRhcmdldC5JdF1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBwcm9tcHRzOiB7XG4gICAgICAgICAgICAgICAgY29uZmlybVZhbHVlOiAoYWN0KSA9PiBpMThuZXh0LnQoJ1ZBTFVFX0NPTlRST0xfREVGQVVMVF9QUk9NUFRfQ09ORklSTV9WQUxVRScsIHsgdmFsdWU6IGFjdC5wYXlsb2FkLnZhbHVlIH0pLFxuICAgICAgICAgICAgICAgIHZhbHVlQWZmaXJtZWQ6IGkxOG5leHQudCgnVkFMVUVfQ09OVFJPTF9ERUZBVUxUX1BST01QVF9WQUxVRV9BRkZJUk1FRCcpLFxuICAgICAgICAgICAgICAgIHZhbHVlRGlzYWZmaXJtZWQ6IGkxOG5leHQudCgnVkFMVUVfQ09OVFJPTF9ERUZBVUxUX1BST01QVF9WQUxVRV9ESVNBRkZJUk1FRCcpLFxuICAgICAgICAgICAgICAgIHZhbHVlU2V0OiAoYWN0KSA9PiBpMThuZXh0LnQoJ1ZBTFVFX0NPTlRST0xfREVGQVVMVF9QUk9NUFRfVkFMVUVfU0VUJywgeyB2YWx1ZTogYWN0LnBheWxvYWQudmFsdWUgfSksXG4gICAgICAgICAgICAgICAgdmFsdWVDaGFuZ2VkOiAoYWN0KSA9PiBpMThuZXh0LnQoJ1ZBTFVFX0NPTlRST0xfREVGQVVMVF9QUk9NUFRfVkFMVUVfQ0hBTkdFRCcsIHsgdmFsdWU6IGFjdC5wYXlsb2FkLnZhbHVlIH0pLFxuICAgICAgICAgICAgICAgIGludmFsaWRWYWx1ZTogKGFjdCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBpZiAoYWN0LnBheWxvYWQucmVuZGVyZWRSZWFzb24gIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGkxOG5leHQudCgnVkFMVUVfQ09OVFJPTF9ERUZBVUxUX1BST01QVF9JTlZBTElEX1ZBTFVFX1dJVEhfUkVBU09OJywgeyB2YWx1ZTogYWN0LnBheWxvYWQudmFsdWUsIHJlYXNvbjogYWN0LnBheWxvYWQucmVuZGVyZWRSZWFzb24gfSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGkxOG5leHQudCgnVkFMVUVfQ09OVFJPTF9ERUZBVUxUX1BST01QVF9HRU5FUkFMX0lOVkFMSURfVkFMVUUnLCB7IHZhbHVlOiBhY3QucGF5bG9hZC52YWx1ZSB9KTtcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIHJlcXVlc3RWYWx1ZTogKCkgPT4gaTE4bmV4dC50KCdWQUxVRV9DT05UUk9MX0RFRkFVTFRfUFJPTVBUX1JFUVVFU1RfVkFMVUUnKSxcbiAgICAgICAgICAgICAgICByZXF1ZXN0Q2hhbmdlZFZhbHVlOiAoKSA9PiBpMThuZXh0LnQoJ1ZBTFVFX0NPTlRST0xfREVGQVVMVF9QUk9NUFRfUkVRVUVTVF9DSEFOR0VEX1ZBTFVFJyksXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgcmVwcm9tcHRzOiB7XG4gICAgICAgICAgICAgICAgY29uZmlybVZhbHVlOiAoYWN0KSA9PiBpMThuZXh0LnQoJ1ZBTFVFX0NPTlRST0xfREVGQVVMVF9SRVBST01QVF9DT05GSVJNX1ZBTFVFJywgeyB2YWx1ZTogYWN0LnBheWxvYWQudmFsdWUgfSksXG4gICAgICAgICAgICAgICAgdmFsdWVBZmZpcm1lZDogaTE4bmV4dC50KCdWQUxVRV9DT05UUk9MX0RFRkFVTFRfUkVQUk9NUFRfVkFMVUVfQUZGSVJNRUQnKSxcbiAgICAgICAgICAgICAgICB2YWx1ZURpc2FmZmlybWVkOiBpMThuZXh0LnQoJ1ZBTFVFX0NPTlRST0xfREVGQVVMVF9SRVBST01QVF9WQUxVRV9ESVNBRkZJUk1FRCcpLFxuICAgICAgICAgICAgICAgIHZhbHVlU2V0OiAoYWN0KSA9PiBpMThuZXh0LnQoJ1ZBTFVFX0NPTlRST0xfREVGQVVMVF9SRVBST01QVF9WQUxVRV9TRVQnLCB7IHZhbHVlOiBhY3QucGF5bG9hZC52YWx1ZSB9KSxcbiAgICAgICAgICAgICAgICB2YWx1ZUNoYW5nZWQ6IChhY3QpID0+IGkxOG5leHQudCgnVkFMVUVfQ09OVFJPTF9ERUZBVUxUX1JFUFJPTVBUX1ZBTFVFX0NIQU5HRUQnLCB7IHZhbHVlOiBhY3QucGF5bG9hZC52YWx1ZSB9KSxcbiAgICAgICAgICAgICAgICBpbnZhbGlkVmFsdWU6IChhY3QpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGFjdC5wYXlsb2FkLnJlbmRlcmVkUmVhc29uICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBpMThuZXh0LnQoJ1ZBTFVFX0NPTlRST0xfREVGQVVMVF9SRVBST01QVF9JTlZBTElEX1ZBTFVFX1dJVEhfUkVBU09OJywgeyB2YWx1ZTogYWN0LnBheWxvYWQudmFsdWUsIHJlYXNvbjogYWN0LnBheWxvYWQucmVuZGVyZWRSZWFzb24gfSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGkxOG5leHQudCgnVkFMVUVfQ09OVFJPTF9ERUZBVUxUX1JFUFJPTVBUX0dFTkVSQUxfSU5WQUxJRF9WQUxVRScsIHsgdmFsdWU6IGFjdC5wYXlsb2FkLnZhbHVlIH0pO1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgcmVxdWVzdFZhbHVlOiAoKSA9PiBpMThuZXh0LnQoJ1ZBTFVFX0NPTlRST0xfREVGQVVMVF9SRVBST01QVF9SRVFVRVNUX1ZBTFVFJyksXG4gICAgICAgICAgICAgICAgcmVxdWVzdENoYW5nZWRWYWx1ZTogKCkgPT4gaTE4bmV4dC50KCdWQUxVRV9DT05UUk9MX0RFRkFVTFRfUkVQUk9NUFRfUkVRVUVTVF9DSEFOR0VEX1ZBTFVFJyksXG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICAgICAgcmV0dXJuIF8ubWVyZ2UoZGVmYXVsdHMsIHByb3BzKTtcbiAgICB9XG5cbiAgICBjYW5IYW5kbGUoaW5wdXQ6IENvbnRyb2xJbnB1dCk6IGJvb2xlYW4ge1xuICAgICAgICByZXR1cm4gdGhpcy5pc1NldFdpdGhWYWx1ZShpbnB1dClcbiAgICAgICAgICAgIHx8IHRoaXMuaXNDaGFuZ2VXaXRoVmFsdWUoaW5wdXQpXG4gICAgICAgICAgICB8fCB0aGlzLmlzU2V0V2l0aG91dFZhbHVlKGlucHV0KVxuICAgICAgICAgICAgfHwgdGhpcy5pc0NoYW5nZVdpdGhvdXRWYWx1ZShpbnB1dClcbiAgICAgICAgICAgIHx8IHRoaXMuaXNCYXJlVmFsdWUoaW5wdXQpXG4gICAgICAgICAgICB8fCB0aGlzLmlzQ29uZmlybWF0aW9uQWZmaXJtZWQoaW5wdXQpXG4gICAgICAgICAgICB8fCB0aGlzLmlzQ29uZmlybWF0aW9uRGlzQWZmaXJtZWQoaW5wdXQpO1xuICAgIH1cblxuICAgIGFzeW5jIGhhbmRsZShpbnB1dDogQ29udHJvbElucHV0LCByZXN1bHRCdWlsZGVyOiBDb250cm9sUmVzdWx0QnVpbGRlcik6IFByb21pc2U8dm9pZD4ge1xuICAgICAgICBpZiAodGhpcy5oYW5kbGVGdW5jID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIGxvZy5lcnJvcignVmFsdWVDb250cm9sOiBoYW5kbGUgY2FsbGVkIGJ1dCB0aGlzLmhhbmRsZUZ1bmMgaXMgbm90IHNldC4gY2FuSGFuZGxlKCkgc2hvdWxkIGJlIGNhbGxlZCBmaXJzdCB0byBzZXQgdGhpcy5oYW5kbGVGdW5jLicpO1xuICAgICAgICAgICAgY29uc3QgaW50ZW50OiBJbnRlbnQgPSAoaW5wdXQucmVxdWVzdCBhcyBJbnRlbnRSZXF1ZXN0KS5pbnRlbnQ7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYCR7aW50ZW50Lm5hbWV9IGNhbiBub3QgYmUgaGFuZGxlZCBieSAke3RoaXMuY29uc3RydWN0b3IubmFtZX0uYCk7XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLmhhbmRsZUZ1bmMoaW5wdXQsIHJlc3VsdEJ1aWxkZXIpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFRlc3QgaWYgdGhlIGlucHV0IGlzIGFuIGltcGxpY2l0IG9yIGV4cGxpY2l0IHNldC1hY3Rpb24gd2l0aCBhIHZhbHVlIHByb3ZpZGVkLlxuICAgICAqXG4gICAgICogQHBhcmFtIGlucHV0XG4gICAgICovXG4gICAgaXNTZXRXaXRoVmFsdWUoaW5wdXQ6IENvbnRyb2xJbnB1dCk6IGJvb2xlYW4ge1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgb2tJZihJbnB1dFV0aWwuaXNJbnRlbnQoaW5wdXQsIFNpbmdsZVZhbHVlQ29udHJvbEludGVudC5pbnRlbnROYW1lKHRoaXMucHJvcHMuc2xvdFR5cGUpKSk7XG4gICAgICAgICAgICBjb25zdCB7IGZlZWRiYWNrLCBhY3Rpb24sIHRhcmdldCwgdmFsdWVTdHIsIHZhbHVlVHlwZSB9ID0gdW5wYWNrU2luZ2xlVmFsdWVDb250cm9sSW50ZW50KChpbnB1dC5yZXF1ZXN0IGFzIEludGVudFJlcXVlc3QpLmludGVudCk7XG4gICAgICAgICAgICBva0lmKElucHV0VXRpbC50YXJnZXRJc01hdGNoT3JVbmRlZmluZWQodGFyZ2V0LCB0aGlzLnByb3BzLmludGVyYWN0aW9uTW9kZWwudGFyZ2V0cykpO1xuICAgICAgICAgICAgb2tJZihJbnB1dFV0aWwudmFsdWVUeXBlTWF0Y2godmFsdWVUeXBlLCB0aGlzLnByb3BzLnNsb3RUeXBlKSk7XG4gICAgICAgICAgICBva0lmKElucHV0VXRpbC52YWx1ZVN0ckRlZmluZWQodmFsdWVTdHIpKTtcbiAgICAgICAgICAgIG9rSWYoSW5wdXRVdGlsLmZlZWRiYWNrSXNNYXRjaE9yVW5kZWZpbmVkKGZlZWRiYWNrLCBbJC5GZWVkYmFjay5BZmZpcm0sICQuRmVlZGJhY2suRGlzYWZmaXJtXSkpO1xuICAgICAgICAgICAgb2tJZihJbnB1dFV0aWwuYWN0aW9uSXNNYXRjaChhY3Rpb24sIHRoaXMucHJvcHMuaW50ZXJhY3Rpb25Nb2RlbC5hY3Rpb25zLnNldCkpO1xuICAgICAgICAgICAgdGhpcy5oYW5kbGVGdW5jID0gdGhpcy5oYW5kbGVTZXRXaXRoVmFsdWU7XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICBjYXRjaCAoZSkgeyByZXR1cm4gZmFsc2VJZkd1YXJkRmFpbGVkKGUpOyB9XG4gICAgfVxuXG4gICAgaGFuZGxlU2V0V2l0aFZhbHVlKGlucHV0OiBDb250cm9sSW5wdXQsIHJlc3VsdEJ1aWxkZXI6IENvbnRyb2xSZXN1bHRCdWlsZGVyKSB7XG4gICAgICAgIGNvbnN0IHsgdmFsdWVTdHIsIGVyTWF0Y2ggfSA9IElucHV0VXRpbC5nZXRWYWx1ZVJlc29sdXRpb24oaW5wdXQpO1xuICAgICAgICB0aGlzLnNldFZhbHVlKHZhbHVlU3RyLCBlck1hdGNoKTtcbiAgICAgICAgdGhpcy52YWxpZGF0ZUFuZEFkZEFjdHMoaW5wdXQsIHJlc3VsdEJ1aWxkZXIsICQuQWN0aW9uLlNldCk7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBUZXN0IGlmIHRoZSBpbnB1dCBpcyBhbiBpbXBsaWNpdCBvciBleHBsaWNpdCBzZXQtYWN0aW9uIHdpdGggbm8gdmFsdWVcbiAgICAgKlxuICAgICAqIEBwYXJhbSBpbnB1dFxuICAgICAqL1xuICAgIGlzU2V0V2l0aG91dFZhbHVlKGlucHV0OiBDb250cm9sSW5wdXQpOiBib29sZWFuIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIG9rSWYoSW5wdXRVdGlsLmlzSW50ZW50KGlucHV0LCBHZW5lcmFsQ29udHJvbEludGVudC5uYW1lKSk7XG4gICAgICAgICAgICBjb25zdCB7IGZlZWRiYWNrLCBhY3Rpb24sIHRhcmdldCB9ID0gdW5wYWNrR2VuZXJhbENvbnRyb2xJbnRlbnQoKGlucHV0LnJlcXVlc3QgYXMgSW50ZW50UmVxdWVzdCkuaW50ZW50KTtcbiAgICAgICAgICAgIG9rSWYoSW5wdXRVdGlsLnRhcmdldElzTWF0Y2hPclVuZGVmaW5lZCh0YXJnZXQsIHRoaXMucHJvcHMuaW50ZXJhY3Rpb25Nb2RlbC50YXJnZXRzKSk7XG4gICAgICAgICAgICBva0lmKElucHV0VXRpbC5mZWVkYmFja0lzTWF0Y2hPclVuZGVmaW5lZChmZWVkYmFjaywgWyQuRmVlZGJhY2suQWZmaXJtLCAkLkZlZWRiYWNrLkRpc2FmZmlybV0pKTtcbiAgICAgICAgICAgIG9rSWYoSW5wdXRVdGlsLmFjdGlvbklzTWF0Y2goYWN0aW9uLCB0aGlzLnByb3BzLmludGVyYWN0aW9uTW9kZWwuYWN0aW9ucy5zZXQpKTtcbiAgICAgICAgICAgIHRoaXMuaGFuZGxlRnVuYyA9IHRoaXMuaGFuZGxlU2V0V2l0aG91dFZhbHVlO1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgY2F0Y2ggKGUpIHsgcmV0dXJuIGZhbHNlSWZHdWFyZEZhaWxlZChlKTsgfVxuICAgIH1cblxuICAgIGhhbmRsZVNldFdpdGhvdXRWYWx1ZShpbnB1dDogQ29udHJvbElucHV0LCByZXN1bHRCdWlsZGVyOiBDb250cm9sUmVzdWx0QnVpbGRlcik6IHZvaWQge1xuICAgICAgICB0aGlzLmFza0VsaWNpdGF0aW9uUXVlc3Rpb24oJC5BY3Rpb24uU2V0LCBpbnB1dCwgcmVzdWx0QnVpbGRlcik7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBUZXN0IGlmIHRoZSBpbnB1dCBpcyBhIHZhbGlkIGNoYW5nZS1hY3Rpb24gd2l0aCBhIHZhbHVlIHByb3ZpZGVkLlxuICAgICAqXG4gICAgICogQHBhcmFtIGlucHV0XG4gICAgICovXG4gICAgaXNDaGFuZ2VXaXRoVmFsdWUoaW5wdXQ6IENvbnRyb2xJbnB1dCk6IGJvb2xlYW4ge1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgb2tJZihJbnB1dFV0aWwuaXNJbnRlbnQoaW5wdXQsIFNpbmdsZVZhbHVlQ29udHJvbEludGVudC5pbnRlbnROYW1lKHRoaXMucHJvcHMuc2xvdFR5cGUpKSk7XG4gICAgICAgICAgICBjb25zdCB7IGZlZWRiYWNrLCBhY3Rpb24sIHRhcmdldCwgdmFsdWVTdHIsIHZhbHVlVHlwZSB9ID0gdW5wYWNrU2luZ2xlVmFsdWVDb250cm9sSW50ZW50KChpbnB1dC5yZXF1ZXN0IGFzIEludGVudFJlcXVlc3QpLmludGVudCk7XG4gICAgICAgICAgICBva0lmKElucHV0VXRpbC50YXJnZXRJc01hdGNoT3JVbmRlZmluZWQodGFyZ2V0LCB0aGlzLnByb3BzLmludGVyYWN0aW9uTW9kZWwudGFyZ2V0cykpO1xuICAgICAgICAgICAgb2tJZihJbnB1dFV0aWwudmFsdWVUeXBlTWF0Y2godmFsdWVUeXBlLCB0aGlzLnByb3BzLnNsb3RUeXBlKSk7XG4gICAgICAgICAgICBva0lmKElucHV0VXRpbC52YWx1ZVN0ckRlZmluZWQodmFsdWVTdHIpKTtcbiAgICAgICAgICAgIG9rSWYoSW5wdXRVdGlsLmZlZWRiYWNrSXNNYXRjaE9yVW5kZWZpbmVkKGZlZWRiYWNrLCBbJC5GZWVkYmFjay5BZmZpcm0sICQuRmVlZGJhY2suRGlzYWZmaXJtXSkpO1xuICAgICAgICAgICAgb2tJZihJbnB1dFV0aWwuYWN0aW9uSXNNYXRjaChhY3Rpb24sIHRoaXMucHJvcHMuaW50ZXJhY3Rpb25Nb2RlbC5hY3Rpb25zLmNoYW5nZSkpO1xuICAgICAgICAgICAgdGhpcy5oYW5kbGVGdW5jID0gdGhpcy5oYW5kbGVDaGFuZ2VXaXRoVmFsdWU7XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuXG4gICAgICAgIGNhdGNoIChlKSB7IHJldHVybiBmYWxzZUlmR3VhcmRGYWlsZWQoZSk7IH1cbiAgICB9XG5cbiAgICBoYW5kbGVDaGFuZ2VXaXRoVmFsdWUoaW5wdXQ6IENvbnRyb2xJbnB1dCwgcmVzdWx0QnVpbGRlcjogQ29udHJvbFJlc3VsdEJ1aWxkZXIpOiB2b2lkIHtcbiAgICAgICAgY29uc3QgeyB2YWx1ZVN0ciwgZXJNYXRjaCB9ID0gSW5wdXRVdGlsLmdldFZhbHVlUmVzb2x1dGlvbihpbnB1dCk7XG4gICAgICAgIHRoaXMuc2V0VmFsdWUodmFsdWVTdHIsIGVyTWF0Y2gpO1xuICAgICAgICB0aGlzLnZhbGlkYXRlQW5kQWRkQWN0cyhpbnB1dCwgcmVzdWx0QnVpbGRlciwgdGhpcy5zdGF0ZS52YWx1ZSAhPT0gdW5kZWZpbmVkID8gJC5BY3Rpb24uQ2hhbmdlIDogJC5BY3Rpb24uU2V0KTtcbiAgICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFRlc3QgaWYgdGhlIGlucHV0IGlzIGEgdmFsaWQgY2hhbmdlLWFjdGlvbiB3aXRob3V0IGEgdmFsdWUgcHJvdmlkZWQuXG4gICAgICpcbiAgICAgKiBAcGFyYW0gaW5wdXRcbiAgICAgKi9cbiAgICBpc0NoYW5nZVdpdGhvdXRWYWx1ZShpbnB1dDogQ29udHJvbElucHV0KTogYm9vbGVhbiB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBva0lmKElucHV0VXRpbC5pc0ludGVudChpbnB1dCwgR2VuZXJhbENvbnRyb2xJbnRlbnQubmFtZSkpO1xuICAgICAgICAgICAgY29uc3QgeyBmZWVkYmFjaywgYWN0aW9uLCB0YXJnZXQgfSA9IHVucGFja0dlbmVyYWxDb250cm9sSW50ZW50KChpbnB1dC5yZXF1ZXN0IGFzIEludGVudFJlcXVlc3QpLmludGVudCk7XG4gICAgICAgICAgICBva0lmKElucHV0VXRpbC50YXJnZXRJc01hdGNoT3JVbmRlZmluZWQodGFyZ2V0LCB0aGlzLnByb3BzLmludGVyYWN0aW9uTW9kZWwudGFyZ2V0cykpO1xuICAgICAgICAgICAgb2tJZihJbnB1dFV0aWwuZmVlZGJhY2tJc01hdGNoT3JVbmRlZmluZWQoZmVlZGJhY2ssIFskLkZlZWRiYWNrLkFmZmlybSwgJC5GZWVkYmFjay5EaXNhZmZpcm1dKSk7XG4gICAgICAgICAgICBva0lmKElucHV0VXRpbC5hY3Rpb25Jc01hdGNoKGFjdGlvbiwgdGhpcy5wcm9wcy5pbnRlcmFjdGlvbk1vZGVsLmFjdGlvbnMuY2hhbmdlKSk7XG4gICAgICAgICAgICB0aGlzLmhhbmRsZUZ1bmMgPSB0aGlzLmhhbmRsZUNoYW5nZVdpdGhvdXRWYWx1ZTtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIGNhdGNoIChlKSB7IHJldHVybiBmYWxzZUlmR3VhcmRGYWlsZWQoZSk7IH1cbiAgICB9XG5cbiAgICBoYW5kbGVDaGFuZ2VXaXRob3V0VmFsdWUoaW5wdXQ6IENvbnRyb2xJbnB1dCwgcmVzdWx0QnVpbGRlcjogQ29udHJvbFJlc3VsdEJ1aWxkZXIpOiB2b2lkIHtcbiAgICAgICAgdGhpcy5hc2tFbGljaXRhdGlvblF1ZXN0aW9uKCQuQWN0aW9uLkNoYW5nZSwgaW5wdXQsIHJlc3VsdEJ1aWxkZXIpO1xuICAgICAgICByZXR1cm47XG4gICAgfVxuXG5cbiAgICAvKipcbiAgICAgKiBUZXN0IGlmIHRoZSBpbnB1dCBpcyBhIFNpbmdsZVZhbHVlQ29udHJvbEludGVudCB3aXRoIGp1c3QgYSBzbG90VmFsdWUgcHJvdmlkZWQuXG4gICAgICogSWYgd2UgYXJlbid0IGFza2luZyBhIHF1ZXN0aW9uIGl0IGlzIGFzc3VtZWQgdGhlIHVzZXIgbWVhbnQgJ3NldCB2YWx1ZScuXG4gICAgICogQHBhcmFtIGlucHV0XG4gICAgICovXG4gICAgaXNCYXJlVmFsdWUoaW5wdXQ6IENvbnRyb2xJbnB1dCk6IGFueSB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBva0lmKElucHV0VXRpbC5pc0ludGVudChpbnB1dCwgU2luZ2xlVmFsdWVDb250cm9sSW50ZW50LmludGVudE5hbWUodGhpcy5wcm9wcy5zbG90VHlwZSkpKTtcbiAgICAgICAgICAgIGNvbnN0IHsgZmVlZGJhY2ssIGFjdGlvbiwgdGFyZ2V0LCB2YWx1ZVN0ciwgdmFsdWVUeXBlIH0gPSB1bnBhY2tTaW5nbGVWYWx1ZUNvbnRyb2xJbnRlbnQoKGlucHV0LnJlcXVlc3QgYXMgSW50ZW50UmVxdWVzdCkuaW50ZW50KTtcbiAgICAgICAgICAgIG9rSWYoSW5wdXRVdGlsLmZlZWRiYWNrSXNVbmRlZmluZWQoZmVlZGJhY2spKTtcbiAgICAgICAgICAgIG9rSWYoSW5wdXRVdGlsLmFjdGlvbklzVW5kZWZpbmVkKGFjdGlvbikpO1xuICAgICAgICAgICAgb2tJZihJbnB1dFV0aWwudGFyZ2V0SXNVbmRlZmluZWQodGFyZ2V0KSk7XG4gICAgICAgICAgICBva0lmKElucHV0VXRpbC52YWx1ZVN0ckRlZmluZWQodmFsdWVTdHIpKTtcbiAgICAgICAgICAgIG9rSWYoSW5wdXRVdGlsLnZhbHVlVHlwZU1hdGNoKHZhbHVlVHlwZSwgdGhpcy5wcm9wcy5zbG90VHlwZSkpO1xuICAgICAgICAgICAgdGhpcy5oYW5kbGVGdW5jID0gdGhpcy5oYW5kbGVCYXJlVmFsdWU7XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICBjYXRjaCAoZSkgeyByZXR1cm4gZmFsc2VJZkd1YXJkRmFpbGVkKGUpOyB9XG4gICAgfVxuXG5cbiAgICBoYW5kbGVCYXJlVmFsdWUoaW5wdXQ6IENvbnRyb2xJbnB1dCwgcmVzdWx0QnVpbGRlcjogQ29udHJvbFJlc3VsdEJ1aWxkZXIpOiB2b2lkIHtcbiAgICAgICAgY29uc3QgeyB2YWx1ZVN0ciwgZXJNYXRjaCB9ID0gSW5wdXRVdGlsLmdldFZhbHVlUmVzb2x1dGlvbihpbnB1dCk7XG4gICAgICAgIHRoaXMuc2V0VmFsdWUodmFsdWVTdHIsIGVyTWF0Y2gpO1xuICAgICAgICB0aGlzLnZhbGlkYXRlQW5kQWRkQWN0cyhpbnB1dCwgcmVzdWx0QnVpbGRlciwgdGhpcy5zdGF0ZS5lbGljaXRhdGlvbkFjdGlvbiA/PyAkLkFjdGlvbi5TZXQpO1xuICAgICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgaXNDb25maXJtYXRpb25BZmZpcm1lZChpbnB1dDogQ29udHJvbElucHV0KTogYW55IHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIG9rSWYoSW5wdXRVdGlsLmlzQmFyZVllcyhpbnB1dCkpO1xuICAgICAgICAgICAgb2tJZih0aGlzLnN0YXRlLmxhc3RJbml0aWF0aXZlQWN0ID09PSAnQ29uZmlybVZhbHVlQWN0Jyk7XG4gICAgICAgICAgICB0aGlzLmhhbmRsZUZ1bmMgPSB0aGlzLmhhbmRsZUNvbmZpcm1hdGlvbkFmZmlybWVkO1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZUlmR3VhcmRGYWlsZWQoZSk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBoYW5kbGVDb25maXJtYXRpb25BZmZpcm1lZChpbnB1dDogQ29udHJvbElucHV0LCByZXN1bHRCdWlsZGVyOiBDb250cm9sUmVzdWx0QnVpbGRlcik6IHZvaWQge1xuICAgICAgICBjb25zdCB2YWxpZGF0aW9uUmVzdWx0OiB0cnVlIHwgVmFsaWRhdGlvblJlc3VsdCA9IHRoaXMudmFsaWRhdGUoaW5wdXQpO1xuICAgICAgICBpZiAodmFsaWRhdGlvblJlc3VsdCAhPT0gdHJ1ZSkge1xuICAgICAgICAgICAgcmVzdWx0QnVpbGRlci5hZGRBY3QoXG4gICAgICAgICAgICAgICAgbmV3IEludmFsaWRWYWx1ZUFjdDxzdHJpbmc+KFxuICAgICAgICAgICAgICAgICAgICB0aGlzLCBcbiAgICAgICAgICAgICAgICAgICAgeyBcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiB0aGlzLnN0YXRlLnZhbHVlISwgXG4gICAgICAgICAgICAgICAgICAgICAgICByZWFzb25Db2RlOiB2YWxpZGF0aW9uUmVzdWx0LnJlYXNvbkNvZGUsXG4gICAgICAgICAgICAgICAgICAgICAgICByZW5kZXJlZFJlYXNvbjogdmFsaWRhdGlvblJlc3VsdC5yZW5kZXJlZFJlYXNvbiBcbiAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgICB0aGlzLmFza0VsaWNpdGF0aW9uUXVlc3Rpb24oJC5BY3Rpb24uQ2hhbmdlLCBpbnB1dCwgcmVzdWx0QnVpbGRlcik7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICB0aGlzLnN0YXRlLmlzVmFsdWVDb25maXJtZWQgPSB0cnVlO1xuICAgICAgICAgICAgcmVzdWx0QnVpbGRlci5hZGRBY3QobmV3IFZhbHVlQ29uZmlybWVkQWN0KHRoaXMsIHsgdmFsdWU6IHRoaXMuc3RhdGUudmFsdWUgfSkpO1xuICAgICAgICAgICAgaWYgKHRoaXMuc3RhdGUuZWxpY2l0YXRpb25BY3Rpb24gPT09ICQuQWN0aW9uLkNoYW5nZSkge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLnN0YXRlLnByZXZpb3VzVmFsdWUgIT09IHVuZGVmaW5lZCl7XG4gICAgICAgICAgICAgICAgICAgIHJlc3VsdEJ1aWxkZXIuYWRkQWN0KFxuICAgICAgICAgICAgICAgICAgICAgICAgbmV3IFZhbHVlQ2hhbmdlZEFjdDxzdHJpbmc+KHRoaXMsIHtwcmV2aW91c1ZhbHVlOiB0aGlzLnN0YXRlLnByZXZpb3VzVmFsdWUsIHZhbHVlOiB0aGlzLnN0YXRlLnZhbHVlISB9KVxuICAgICAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdWYWx1ZUNoYW5nZWRBY3Qgc2hvdWxkIG9ubHkgYmUgdXNlZCBpZiB0aGVyZSBpcyBhbiBhY3R1YWwgcHJldmlvdXMgdmFsdWUnKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICByZXN1bHRCdWlsZGVyLmFkZEFjdChuZXcgVmFsdWVTZXRBY3QodGhpcywgeyB2YWx1ZTogdGhpcy5zdGF0ZS52YWx1ZSB9KSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBpc0NvbmZpcm1hdGlvbkRpc0FmZmlybWVkKGlucHV0OiBDb250cm9sSW5wdXQpOiBhbnkge1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgb2tJZihJbnB1dFV0aWwuaXNCYXJlTm8oaW5wdXQpKTtcbiAgICAgICAgICAgIG9rSWYodGhpcy5zdGF0ZS5sYXN0SW5pdGlhdGl2ZUFjdCA9PT0gJ0NvbmZpcm1WYWx1ZUFjdCcpO1xuICAgICAgICAgICAgdGhpcy5oYW5kbGVGdW5jID0gdGhpcy5oYW5kbGVDb25maXJtYXRpb25EaXNBZmZpcm1lZDtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIGNhdGNoIChlKSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2VJZkd1YXJkRmFpbGVkKGUpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgaGFuZGxlQ29uZmlybWF0aW9uRGlzQWZmaXJtZWQoaW5wdXQ6IENvbnRyb2xJbnB1dCwgcmVzdWx0QnVpbGRlcjogQ29udHJvbFJlc3VsdEJ1aWxkZXIpOiB2b2lkIHtcbiAgICAgICAgdGhpcy5zdGF0ZS5pc1ZhbHVlQ29uZmlybWVkID0gZmFsc2U7XG4gICAgICAgIHJlc3VsdEJ1aWxkZXIuYWRkQWN0KG5ldyBWYWx1ZURpc2NvbmZpcm1lZEFjdCh0aGlzLCB7dmFsdWU6IHRoaXMuc3RhdGUudmFsdWV9KSk7XG4gICAgICAgIHJlc3VsdEJ1aWxkZXIuYWRkQWN0KG5ldyBSZXF1ZXN0VmFsdWVBY3QodGhpcykpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIERpcmVjdGx5IHNldCB0aGUgKG5ldykgdmFsdWUgZm9yIHRoZSBjb250cm9sXG4gICAgICpcbiAgICAgKiBBZnRlciBzZXR0aW5nIHRoZSB2YWx1ZSwgaXQgaXMgdXN1YWwgdG8gY2FsbFxuICAgICAqIGBgYHRzXG4gICAgICogaWYgKGNvbnRyb2wud2FudHNUb0NvbmZpcm1WYWx1ZSgpKXtcbiAgICAgKiAgIGNvbnRyb2wuY29uZmlybVZhbHVlKClcbiAgICAgKiB9XG4gICAgICogYGBgXG4gICAgICogQHBhcmFtIHZhbHVlXG4gICAgICovXG4gICAgc2V0VmFsdWUodmFsdWU6IHN0cmluZywgZXJNYXRjaDogYm9vbGVhbikge1xuICAgICAgICB0aGlzLnN0YXRlLnByZXZpb3VzVmFsdWUgPSB0aGlzLnN0YXRlLnZhbHVlO1xuICAgICAgICB0aGlzLnN0YXRlLnZhbHVlID0gdmFsdWU7XG4gICAgICAgIHRoaXMuc3RhdGUuZXJNYXRjaCA9IGVyTWF0Y2g7XG4gICAgICAgIHRoaXMuc3RhdGUuaXNWYWx1ZUNvbmZpcm1lZCA9IGZhbHNlO1xuICAgIH1cblxuICAgIGNsZWFyKCkge1xuICAgICAgICB0aGlzLnN0YXRlLnZhbHVlID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLnN0YXRlLmVyTWF0Y2ggPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMuc3RhdGUuZWxpY2l0YXRpb25BY3Rpb24gPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMuc3RhdGUuaXNWYWx1ZUNvbmZpcm1lZCA9IGZhbHNlO1xuICAgICAgICB0aGlzLnN0YXRlLnByZXZpb3VzVmFsdWUgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMuc3RhdGUubGFzdEluaXRpYXRpdmVBY3QgPSB1bmRlZmluZWQ7XG4gICAgfVxuXG4gICAgY2FuVGFrZUluaXRpYXRpdmUoaW5wdXQ6IENvbnRyb2xJbnB1dCk6IGJvb2xlYW4ge1xuICAgICAgICByZXR1cm4gdGhpcy53YW50c1RvQ29uZmlybVZhbHVlKGlucHV0KVxuICAgICAgICAgICAgfHwgdGhpcy53YW50c1RvRml4SW52YWxpZFZhbHVlKGlucHV0KVxuICAgICAgICAgICAgfHwgdGhpcy53YW50c1RvRWxpY2l0VmFsdWUoaW5wdXQpO1xuICAgIH1cblxuICAgIGFzeW5jIHRha2VJbml0aWF0aXZlKGlucHV0OiBDb250cm9sSW5wdXQsIHJlc3VsdEJ1aWxkZXI6IENvbnRyb2xSZXN1bHRCdWlsZGVyKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgICAgIGlmICh0aGlzLndhbnRzVG9FbGljaXRWYWx1ZShpbnB1dCkpIHtcbiAgICAgICAgICAgIHRoaXMuYXNrRWxpY2l0YXRpb25RdWVzdGlvbigkLkFjdGlvbi5TZXQsIGlucHV0LCByZXN1bHRCdWlsZGVyKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmICh0aGlzLndhbnRzVG9GaXhJbnZhbGlkVmFsdWUoaW5wdXQpKXtcbiAgICAgICAgICAgIHRoaXMudmFsaWRhdGVBbmRBZGRBY3RzKGlucHV0LCByZXN1bHRCdWlsZGVyLCAkLkFjdGlvbi5DaGFuZ2UpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKHRoaXMud2FudHNUb0NvbmZpcm1WYWx1ZShpbnB1dCkpIHtcbiAgICAgICAgICAgIHRoaXMuY29uZmlybVZhbHVlKGlucHV0LCByZXN1bHRCdWlsZGVyKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgdmFsaWRhdGVBbmRBZGRBY3RzKGlucHV0OiBDb250cm9sSW5wdXQsIHJlc3VsdEJ1aWxkZXI6IENvbnRyb2xSZXN1bHRCdWlsZGVyLCBlbGljaXRhdGlvbkFjdGlvbjogc3RyaW5nKTogdm9pZCB7XG4gICAgICAgIHRoaXMuc3RhdGUuZWxpY2l0YXRpb25BY3Rpb24gPSBlbGljaXRhdGlvbkFjdGlvbjtcbiAgICAgICAgaWYgKHRoaXMud2FudHNUb0NvbmZpcm1WYWx1ZShpbnB1dCkpe1xuICAgICAgICAgICAgdGhpcy5jb25maXJtVmFsdWUoaW5wdXQsIHJlc3VsdEJ1aWxkZXIpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHZhbGlkYXRpb25SZXN1bHQ6IHRydWUgfCBWYWxpZGF0aW9uUmVzdWx0ID0gdGhpcy52YWxpZGF0ZShpbnB1dCk7XG4gICAgICAgIGlmICh0eXBlb2YgdmFsaWRhdGlvblJlc3VsdCA9PT0gJ2Jvb2xlYW4nKSB7XG4gICAgICAgICAgICBpZiAoZWxpY2l0YXRpb25BY3Rpb24gPT09ICQuQWN0aW9uLkNoYW5nZSkge1xuICAgICAgICAgICAgICAgIC8vIGlmIGVsaWNpdGF0aW9uQWN0aW9uID09ICdjaGFuZ2UnLCB0aGVuIHRoZSBwcmV2aW91c1ZhbHVlIG11c3QgYmUgZGVmaW5lZC5cbiAgICAgICAgICAgICAgICBpZiAodGhpcy5zdGF0ZS5wcmV2aW91c1ZhbHVlICE9PSB1bmRlZmluZWQpe1xuICAgICAgICAgICAgICAgICAgICByZXN1bHRCdWlsZGVyLmFkZEFjdChcbiAgICAgICAgICAgICAgICAgICAgICAgIG5ldyBWYWx1ZUNoYW5nZWRBY3Q8c3RyaW5nPih0aGlzLCB7cHJldmlvdXNWYWx1ZTogdGhpcy5zdGF0ZS5wcmV2aW91c1ZhbHVlLCB2YWx1ZTogdGhpcy5zdGF0ZS52YWx1ZSEgfSlcbiAgICAgICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignVmFsdWVDaGFuZ2VkQWN0IHNob3VsZCBvbmx5IGJlIHVzZWQgaWYgdGhlcmUgaXMgYW4gYWN0dWFsIHByZXZpb3VzIHZhbHVlJyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgcmVzdWx0QnVpbGRlci5hZGRBY3QobmV3IFZhbHVlU2V0QWN0KHRoaXMsIHsgdmFsdWU6IHRoaXMuc3RhdGUudmFsdWUgfSkpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgLy8gZmVlZGJhY2tcbiAgICAgICAgICAgIHJlc3VsdEJ1aWxkZXIuYWRkQWN0KG5ldyBJbnZhbGlkVmFsdWVBY3Q8c3RyaW5nPih0aGlzLCB7IHZhbHVlOiB0aGlzLnN0YXRlLnZhbHVlISwgcmVhc29uQ29kZTogdmFsaWRhdGlvblJlc3VsdC5yZWFzb25Db2RlLCByZW5kZXJlZFJlYXNvbjogdmFsaWRhdGlvblJlc3VsdC5yZW5kZXJlZFJlYXNvbiB9KSk7XG4gICAgICAgICAgICB0aGlzLmFza0VsaWNpdGF0aW9uUXVlc3Rpb24oZWxpY2l0YXRpb25BY3Rpb24sIGlucHV0LCByZXN1bHRCdWlsZGVyKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgdmFsaWRhdGUoaW5wdXQ6IENvbnRyb2xJbnB1dCk6IHRydWUgfCBWYWxpZGF0aW9uUmVzdWx0IHtcbiAgICAgICAgY29uc3QgbGlzdE9mVmFsaWRhdGlvbkZ1bmM6IFNsb3RWYWxpZGF0aW9uRnVuY3Rpb25bXSA9IHR5cGVvZih0aGlzLnByb3BzLnZhbGlkYXRpb24pID09PSAnZnVuY3Rpb24nID8gW3RoaXMucHJvcHMudmFsaWRhdGlvbl0gOiB0aGlzLnByb3BzLnZhbGlkYXRpb247XG4gICAgICAgIGZvciAoY29uc3QgdmFsaWRhdGlvbkZ1bmN0aW9uIG9mIGxpc3RPZlZhbGlkYXRpb25GdW5jKSB7XG4gICAgICAgICAgICBjb25zdCB2YWxpZGF0aW9uUmVzdWx0OiB0cnVlIHwgVmFsaWRhdGlvblJlc3VsdCA9IHZhbGlkYXRpb25GdW5jdGlvbih0aGlzLnN0YXRlLCBpbnB1dCk7XG4gICAgICAgICAgICBpZiAodmFsaWRhdGlvblJlc3VsdCAhPT0gdHJ1ZSkge1xuICAgICAgICAgICAgICAgIGxvZy5kZWJ1ZyhgVmFsdWVDb250cm9sLnZhbGlkYXRlKCk6IHZhbGlkYXRpb24gZmFpbGVkLiBSZWFzb246ICR7SlNPTi5zdHJpbmdpZnkodmFsaWRhdGlvblJlc3VsdCwgbnVsbCwgMil9LmApO1xuICAgICAgICAgICAgICAgIHJldHVybiB2YWxpZGF0aW9uUmVzdWx0O1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cblxuICAgIHdhbnRzVG9Db25maXJtVmFsdWUoaW5wdXQ6IENvbnRyb2xJbnB1dCk6IGJvb2xlYW4ge1xuICAgICAgICByZXR1cm4gdGhpcy5zdGF0ZS52YWx1ZSAhPT0gdW5kZWZpbmVkICYmIHRoaXMuc3RhdGUuaXNWYWx1ZUNvbmZpcm1lZCA9PT0gZmFsc2UgJiYgdGhpcy5ldmFsdWF0ZUJvb2xlYW5Qcm9wKHRoaXMucHJvcHMuY29uZmlybWF0aW9uUmVxdWlyZWQsIGlucHV0KTtcbiAgICB9XG5cbiAgICBjb25maXJtVmFsdWUoaW5wdXQ6IENvbnRyb2xJbnB1dCwgcmVzdWx0QnVpbGRlcjogQ29udHJvbFJlc3VsdEJ1aWxkZXIpOiB2b2lkIHtcbiAgICAgICAgdGhpcy5zdGF0ZS5sYXN0SW5pdGlhdGl2ZUFjdCA9ICdDb25maXJtVmFsdWVBY3QnO1xuICAgICAgICByZXN1bHRCdWlsZGVyLmFkZEFjdChuZXcgQ29uZmlybVZhbHVlQWN0KHRoaXMsIHsgdmFsdWU6IHRoaXMuc3RhdGUudmFsdWUgfSkpO1xuICAgIH1cblxuICAgIHdhbnRzVG9GaXhJbnZhbGlkVmFsdWUoaW5wdXQ6IENvbnRyb2xJbnB1dCk6IGJvb2xlYW4ge1xuICAgICAgICByZXR1cm4gdGhpcy5zdGF0ZS52YWx1ZSAhPT0gdW5kZWZpbmVkICYmIHRoaXMudmFsaWRhdGUoaW5wdXQpICE9PSB0cnVlO1xuICAgIH1cblxuICAgIHdhbnRzVG9FbGljaXRWYWx1ZShpbnB1dDogQ29udHJvbElucHV0KTogYm9vbGVhbiB7XG4gICAgICAgIHJldHVybiB0aGlzLnN0YXRlLnZhbHVlID09PSB1bmRlZmluZWQgJiYgdGhpcy5ldmFsdWF0ZUJvb2xlYW5Qcm9wKHRoaXMucHJvcHMucmVxdWlyZWQsIGlucHV0KTtcbiAgICB9XG5cbiAgICBhc2tFbGljaXRhdGlvblF1ZXN0aW9uKGVsaWNpdGF0aW9uQWN0aW9uOiBzdHJpbmcsIGlucHV0OiBDb250cm9sSW5wdXQsIHJlc3VsdEJ1aWxkZXI6IENvbnRyb2xSZXN1bHRCdWlsZGVyKSB7XG4gICAgICAgIHRoaXMuc3RhdGUuZWxpY2l0YXRpb25BY3Rpb24gPSBlbGljaXRhdGlvbkFjdGlvbjtcblxuICAgICAgICBzd2l0Y2ggKGVsaWNpdGF0aW9uQWN0aW9uKSB7XG4gICAgICAgICAgICBjYXNlICQuQWN0aW9uLlNldDpcbiAgICAgICAgICAgICAgICByZXN1bHRCdWlsZGVyLmFkZEFjdChuZXcgUmVxdWVzdFZhbHVlQWN0KHRoaXMpKTtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICBjYXNlICQuQWN0aW9uLkNoYW5nZTpcbiAgICAgICAgICAgICAgICByZXN1bHRCdWlsZGVyLmFkZEFjdChuZXcgUmVxdWVzdENoYW5nZWRWYWx1ZUFjdCh0aGlzLCB7Y3VycmVudFZhbHVlOiB0aGlzLnN0YXRlLnZhbHVlIX0pKTtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgVW5oYW5kbGVkLiBVbmtub3duIGVsaWNpdGF0aW9uQWN0aW9uOiAke2VsaWNpdGF0aW9uQWN0aW9ufWApO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgc3RyaW5naWZ5U3RhdGVGb3JEaWFncmFtKCk6IHN0cmluZyB7XG4gICAgICAgIGxldCB0ZXh0ID0gdGhpcy5zdGF0ZS52YWx1ZSA/PyAnPG5vbmU+JztcbiAgICAgICAgaWYgKHRoaXMuc3RhdGUuZWxpY2l0YXRpb25BY3Rpb24gIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGV4dCArPSBgW2VsaWNpdGluZywgJHt0aGlzLnN0YXRlLmVsaWNpdGF0aW9uQWN0aW9ufV1gO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0ZXh0O1xuICAgIH1cblxuICAgIHJlbmRlckFjdChhY3Q6IFN5c3RlbUFjdCwgaW5wdXQ6IENvbnRyb2xJbnB1dCwgYnVpbGRlcjogQ29udHJvbFJlc3BvbnNlQnVpbGRlcik6IHZvaWQge1xuICAgICAgICBpZiAoYWN0IGluc3RhbmNlb2YgSW52YWxpZFZhbHVlQWN0KSB7XG4gICAgICAgICAgICBidWlsZGVyLmFkZFByb21wdEZyYWdtZW50KHRoaXMuZXZhbHVhdGVQcm9tcHRQcm9wKGFjdCwgdGhpcy5wcm9wcy5wcm9tcHRzLmludmFsaWRWYWx1ZSwgaW5wdXQpKTtcbiAgICAgICAgICAgIGJ1aWxkZXIuYWRkUmVwcm9tcHRGcmFnbWVudCh0aGlzLmV2YWx1YXRlUHJvbXB0UHJvcChhY3QsIHRoaXMucHJvcHMucmVwcm9tcHRzLmludmFsaWRWYWx1ZSwgaW5wdXQpKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGVsc2UgaWYgKGFjdCBpbnN0YW5jZW9mIFZhbHVlU2V0QWN0KSB7XG4gICAgICAgICAgICAvLyBXZSBtdXN0IGNob29zZSBob3cgdG8gc2F5IHRoZSB2YWx1ZS4gIFRoZSBkZWZhdWx0IGlzIHRvIGFzc3VtZSB0aGF0IHRoZSBTbG90LXR5cGUgSURzIGFyZSBzcGVha2FibGUuXG4gICAgICAgICAgICBidWlsZGVyLmFkZFByb21wdEZyYWdtZW50KHRoaXMuZXZhbHVhdGVQcm9tcHRQcm9wKGFjdCwgdGhpcy5wcm9wcy5wcm9tcHRzLnZhbHVlU2V0LCBpbnB1dCkpO1xuICAgICAgICAgICAgYnVpbGRlci5hZGRSZXByb21wdEZyYWdtZW50KHRoaXMuZXZhbHVhdGVQcm9tcHRQcm9wKGFjdCwgdGhpcy5wcm9wcy5yZXByb21wdHMudmFsdWVTZXQsIGlucHV0KSk7XG4gICAgICAgIH1cblxuICAgICAgICBlbHNlIGlmIChhY3QgaW5zdGFuY2VvZiBWYWx1ZUNoYW5nZWRBY3QpIHtcbiAgICAgICAgICAgIGJ1aWxkZXIuYWRkUHJvbXB0RnJhZ21lbnQodGhpcy5ldmFsdWF0ZVByb21wdFByb3AoYWN0LCB0aGlzLnByb3BzLnByb21wdHMudmFsdWVDaGFuZ2VkLCBpbnB1dCkpO1xuICAgICAgICAgICAgYnVpbGRlci5hZGRSZXByb21wdEZyYWdtZW50KHRoaXMuZXZhbHVhdGVQcm9tcHRQcm9wKGFjdCwgdGhpcy5wcm9wcy5yZXByb21wdHMudmFsdWVDaGFuZ2VkLCBpbnB1dCkpO1xuICAgICAgICB9XG5cbiAgICAgICAgZWxzZSBpZiAoYWN0IGluc3RhbmNlb2YgUmVxdWVzdFZhbHVlQWN0IHx8IGFjdCBpbnN0YW5jZW9mIFJlcXVlc3RDaGFuZ2VkVmFsdWVBY3QpIHtcbiAgICAgICAgICAgIGNvbnN0IHByb21wdCA9IGFjdCBpbnN0YW5jZW9mIFJlcXVlc3RWYWx1ZUFjdCA/IHRoaXMucHJvcHMucHJvbXB0cy5yZXF1ZXN0VmFsdWUgOiB0aGlzLnByb3BzLnByb21wdHMucmVxdWVzdENoYW5nZWRWYWx1ZTtcbiAgICAgICAgICAgIGNvbnN0IHJlcHJvbXB0ID0gYWN0IGluc3RhbmNlb2YgUmVxdWVzdENoYW5nZWRWYWx1ZUFjdCA/IHRoaXMucHJvcHMucmVwcm9tcHRzLnJlcXVlc3RWYWx1ZSA6IHRoaXMucHJvcHMucmVwcm9tcHRzLnJlcXVlc3RDaGFuZ2VkVmFsdWU7XG5cbiAgICAgICAgICAgIGJ1aWxkZXIuYWRkUHJvbXB0RnJhZ21lbnQodGhpcy5ldmFsdWF0ZVByb21wdFByb3AoYWN0LCBwcm9tcHQsIGlucHV0KSk7XG4gICAgICAgICAgICBidWlsZGVyLmFkZFJlcHJvbXB0RnJhZ21lbnQodGhpcy5ldmFsdWF0ZVByb21wdFByb3AoYWN0LCByZXByb21wdCwgaW5wdXQpKTtcblxuICAgICAgICAgICAgY29uc3Qgc2xvdEVsaWNpdGF0aW9uID0gZ2VuZXJhdGVTbG90RWxpY2l0YXRpb24odGhpcy5wcm9wcy5zbG90VHlwZSk7XG4gICAgICAgICAgICBidWlsZGVyLmFkZEVsaWNpdFNsb3REaXJlY3RpdmUoc2xvdEVsaWNpdGF0aW9uLnNsb3ROYW1lLCBzbG90RWxpY2l0YXRpb24uaW50ZW50KTtcbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgZWxzZSBpZiAoYWN0IGluc3RhbmNlb2YgQ29uZmlybVZhbHVlQWN0KSB7XG4gICAgICAgICAgICBidWlsZGVyLmFkZFByb21wdEZyYWdtZW50KHRoaXMuZXZhbHVhdGVQcm9tcHRQcm9wKGFjdCwgdGhpcy5wcm9wcy5wcm9tcHRzLmNvbmZpcm1WYWx1ZSwgaW5wdXQpKTtcbiAgICAgICAgICAgIGJ1aWxkZXIuYWRkUmVwcm9tcHRGcmFnbWVudCh0aGlzLmV2YWx1YXRlUHJvbXB0UHJvcChhY3QsIHRoaXMucHJvcHMucmVwcm9tcHRzLmNvbmZpcm1WYWx1ZSwgaW5wdXQpKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGVsc2UgaWYgKGFjdCBpbnN0YW5jZW9mIFZhbHVlQ29uZmlybWVkQWN0KSB7XG4gICAgICAgICAgICBidWlsZGVyLmFkZFByb21wdEZyYWdtZW50KHRoaXMuZXZhbHVhdGVQcm9tcHRQcm9wKGFjdCwgdGhpcy5wcm9wcy5wcm9tcHRzLnZhbHVlQWZmaXJtZWQsIGlucHV0KSk7XG4gICAgICAgICAgICBidWlsZGVyLmFkZFJlcHJvbXB0RnJhZ21lbnQodGhpcy5ldmFsdWF0ZVByb21wdFByb3AoYWN0LCB0aGlzLnByb3BzLnJlcHJvbXB0cy52YWx1ZUFmZmlybWVkLCBpbnB1dCkpO1xuICAgICAgICB9XG5cbiAgICAgICAgZWxzZSBpZiAoYWN0IGluc3RhbmNlb2YgVmFsdWVEaXNjb25maXJtZWRBY3QpIHtcbiAgICAgICAgICAgIGJ1aWxkZXIuYWRkUHJvbXB0RnJhZ21lbnQodGhpcy5ldmFsdWF0ZVByb21wdFByb3AoYWN0LCB0aGlzLnByb3BzLnByb21wdHMudmFsdWVEaXNhZmZpcm1lZCwgaW5wdXQpKTtcbiAgICAgICAgICAgIGJ1aWxkZXIuYWRkUmVwcm9tcHRGcmFnbWVudCh0aGlzLmV2YWx1YXRlUHJvbXB0UHJvcChhY3QsIHRoaXMucHJvcHMucmVwcm9tcHRzLnZhbHVlRGlzYWZmaXJtZWQsIGlucHV0KSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICB0aGlzLnRocm93VW5oYW5kbGVkQWN0RXJyb3IoYWN0KTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHVwZGF0ZUludGVyYWN0aW9uTW9kZWwoZ2VuZXJhdG9yOiBDb250cm9sSW50ZXJhY3Rpb25Nb2RlbEdlbmVyYXRvciwgaW1EYXRhOiBNb2RlbERhdGEpIHtcbiAgICAgICAgZ2VuZXJhdG9yLmFkZENvbnRyb2xJbnRlbnQobmV3IFNpbmdsZVZhbHVlQ29udHJvbEludGVudCh0aGlzLnByb3BzLnNsb3RUeXBlKSwgaW1EYXRhKTtcbiAgICAgICAgZ2VuZXJhdG9yLmFkZENvbnRyb2xJbnRlbnQobmV3IEdlbmVyYWxDb250cm9sSW50ZW50KCksIGltRGF0YSk7XG4gICAgICAgIGdlbmVyYXRvci5hZGRZZXNBbmROb0ludGVudHMoKTtcbiAgICB9XG5cbiAgICBnZXRUYXJnZXRJZHMoKTogc3RyaW5nW10ge1xuXG4gICAgICAgIHJldHVybiB0aGlzLnByb3BzLmludGVyYWN0aW9uTW9kZWwudGFyZ2V0cztcbiAgICB9XG59XG5cbmZ1bmN0aW9uIGdlbmVyYXRlU2xvdEVsaWNpdGF0aW9uKHNsb3RUeXBlOiBzdHJpbmcpOiB7IGludGVudDogSW50ZW50LCBzbG90TmFtZTogc3RyaW5nIH0ge1xuICAgIGNvbnN0IGludGVudDogSW50ZW50ID0ge1xuICAgICAgICBuYW1lOiBgJHtzbG90VHlwZX1fVmFsdWVDb250cm9sSW50ZW50YC5yZXBsYWNlKCcuJywgJ18nKSxcbiAgICAgICAgc2xvdHM6IHtcbiAgICAgICAgICAgIHNsb3RUeXBlOiB7IG5hbWU6IHNsb3RUeXBlLCB2YWx1ZTogJycsIGNvbmZpcm1hdGlvblN0YXR1czogJ05PTkUnIH0sXG4gICAgICAgICAgICBmZWVkYmFjazogeyBuYW1lOiBcImZlZWRiYWNrXCIsIHZhbHVlOiAnJywgY29uZmlybWF0aW9uU3RhdHVzOiAnTk9ORScgfSxcbiAgICAgICAgICAgIGFjdGlvbjogeyBuYW1lOiBcImFjdGlvblwiLCB2YWx1ZTogJycsIGNvbmZpcm1hdGlvblN0YXR1czogJ05PTkUnIH0sXG4gICAgICAgICAgICB0YXJnZXQ6IHsgbmFtZTogXCJ0YXJnZXRcIiwgdmFsdWU6ICcnLCBjb25maXJtYXRpb25TdGF0dXM6ICdOT05FJyB9LFxuICAgICAgICAgICAgaGVhZDogeyBuYW1lOiBcImhlYWRcIiwgdmFsdWU6ICcnLCBjb25maXJtYXRpb25TdGF0dXM6ICdOT05FJyB9LFxuICAgICAgICAgICAgdGFpbDogeyBuYW1lOiBcInRhaWxcIiwgdmFsdWU6ICcnLCBjb25maXJtYXRpb25TdGF0dXM6ICdOT05FJyB9LFxuICAgICAgICAgICAgYXNzaWduOiB7IG5hbWU6IFwiYXNzaWduXCIsIHZhbHVlOiAnJywgY29uZmlybWF0aW9uU3RhdHVzOiAnTk9ORScgfSxcbiAgICAgICAgfSxcbiAgICAgICAgY29uZmlybWF0aW9uU3RhdHVzOiBcIk5PTkVcIlxuICAgIH07XG5cbiAgICByZXR1cm4ge1xuICAgICAgICBpbnRlbnQsXG4gICAgICAgIHNsb3ROYW1lOiBzbG90VHlwZVxuICAgIH07XG59XG4iXX0=