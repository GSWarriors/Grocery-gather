"use strict";
/*
 * Copyright 2019 Amazon.com, Inc. or its affiliates. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License").
 * You may not use this file except in compliance with the License.
 * A copy of the License is located at
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * or in the "license" file accompanying this file. This file is distributed
 * on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either
 * express or implied. See the License for the specific language governing
 * permissions and limitations under the License.
 */
Object.defineProperty(exports, "__esModule", { value: true });
exports.OrdinalControlIntent = exports.unpackOrdinalControlIntent = void 0;
const ModelTypes_1 = require("../interactionModelGeneration/ModelTypes");
const BaseControlIntent_1 = require("./BaseControlIntent");
const IntentUtils_1 = require("../utils/IntentUtils");
const AmazonBuiltInSlotType_1 = require("./AmazonBuiltInSlotType");
/**
 *
 *
 * empty slots are unpacked as 'undefined' to be more explicit about what is going on.
 * (this helps makes boolean tests in Controls more obvious and consistent)
 */
function unpackOrdinalControlIntent(intent) {
    if (!intent.name.startsWith('OrdinalControlIntent')) {
        throw new Error(`Not a compatible intent: ${intent.name}`);
    }
    let action;
    let feedback;
    let target;
    let valueStr;
    for (const [name, slot] of Object.entries(intent.slots)) {
        const slotObject = IntentUtils_1.getSlotResolutions(slot);
        const slotValue = slotObject ? slotObject.slotValue : undefined;
        switch (name) {
            case 'feedback':
                feedback = slotValue !== undefined ? slotValue : undefined;
                break;
            case 'action':
                action = slotValue !== undefined ? slotValue : undefined;
                break;
            case 'target':
                target = slotValue !== undefined ? slotValue : undefined;
                break;
            case 'AMAZON.Ordinal':
                valueStr = slotValue !== undefined ? slotValue : undefined;
                break;
            // default: ignore content-free slots
        }
    }
    return {
        feedback,
        action,
        target,
        'AMAZON.Ordinal': valueStr
    };
}
exports.unpackOrdinalControlIntent = unpackOrdinalControlIntent;
/**
 * Intent to capture an AMAZON.Ordinal, following the "ControlIntent" conventions
 */
class OrdinalControlIntent extends BaseControlIntent_1.BaseControlIntent {
    static of(slots) {
        return IntentUtils_1.IntentBuilder.of(this.prototype.constructor.name, slots);
    }
    generateIntent() {
        return {
            name: this.name,
            slots: this.generateSlots(),
            samples: [],
        };
    }
    generateSlots() {
        const slots = [
            {
                name: 'feedback',
                type: ModelTypes_1.SharedSlotType.FEEDBACK
            },
            {
                name: 'action',
                type: ModelTypes_1.SharedSlotType.ACTION
            },
            {
                name: 'target',
                type: ModelTypes_1.SharedSlotType.TARGET
            },
            {
                name: 'AMAZON.Ordinal',
                type: AmazonBuiltInSlotType_1.AmazonBuiltInSlotType.ORDINAL
            },
            {
                name: 'preposition',
                type: ModelTypes_1.SharedSlotType.PREPOSITION
            },
            {
                name: 'head',
                type: ModelTypes_1.SharedSlotType.HEAD
            },
            {
                name: 'tail',
                type: ModelTypes_1.SharedSlotType.TAIL
            }
        ];
        return slots;
    }
    generateSlotTypes() {
        return [];
    }
}
exports.OrdinalControlIntent = OrdinalControlIntent;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiT3JkaW5hbENvbnRyb2xJbnRlbnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi9zcmMvaW50ZW50cy9PcmRpbmFsQ29udHJvbEludGVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUE7Ozs7Ozs7Ozs7O0dBV0c7OztBQUlILHlFQUEwRTtBQUMxRSwyREFBd0Q7QUFDeEQsc0RBQXlFO0FBRXpFLG1FQUFnRTtBQVVoRTs7Ozs7R0FLRztBQUNILFNBQWdCLDBCQUEwQixDQUFDLE1BQWM7SUFDckQsSUFBSSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLHNCQUFzQixDQUFDLEVBQUU7UUFDakQsTUFBTSxJQUFJLEtBQUssQ0FBQyw0QkFBNEIsTUFBTSxDQUFDLElBQUksRUFBRSxDQUFDLENBQUM7S0FDOUQ7SUFFRCxJQUFJLE1BQTBCLENBQUM7SUFDL0IsSUFBSSxRQUE0QixDQUFDO0lBQ2pDLElBQUksTUFBMEIsQ0FBQztJQUMvQixJQUFJLFFBQTRCLENBQUM7SUFFakMsS0FBSyxNQUFNLENBQUMsSUFBSSxFQUFFLElBQUksQ0FBQyxJQUFJLE1BQU0sQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDLEtBQU0sQ0FBQyxFQUFFO1FBQ3RELE1BQU0sVUFBVSxHQUFHLGdDQUFrQixDQUFDLElBQUksQ0FBQyxDQUFDO1FBQzVDLE1BQU0sU0FBUyxHQUFHLFVBQVUsQ0FBQyxDQUFDLENBQUMsVUFBVSxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUMsU0FBUyxDQUFDO1FBRWhFLFFBQVEsSUFBSSxFQUFFO1lBQ1YsS0FBSyxVQUFVO2dCQUFFLFFBQVEsR0FBRyxTQUFTLEtBQUssU0FBUyxDQUFDLENBQUMsQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDLFNBQVMsQ0FBQztnQkFBQyxNQUFNO1lBQ25GLEtBQUssUUFBUTtnQkFBRSxNQUFNLEdBQUcsU0FBUyxLQUFLLFNBQVMsQ0FBQyxDQUFDLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQyxTQUFTLENBQUM7Z0JBQUMsTUFBTTtZQUMvRSxLQUFLLFFBQVE7Z0JBQUUsTUFBTSxHQUFHLFNBQVMsS0FBSyxTQUFTLENBQUMsQ0FBQyxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUMsU0FBUyxDQUFDO2dCQUFDLE1BQU07WUFDL0UsS0FBSyxnQkFBZ0I7Z0JBQUUsUUFBUSxHQUFHLFNBQVMsS0FBSyxTQUFTLENBQUMsQ0FBQyxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUMsU0FBUyxDQUFDO2dCQUFDLE1BQU07WUFDekYscUNBQXFDO1NBQ3hDO0tBQ0o7SUFFRCxPQUFPO1FBQ0gsUUFBUTtRQUNSLE1BQU07UUFDTixNQUFNO1FBQ04sZ0JBQWdCLEVBQUUsUUFBUTtLQUM3QixDQUFDO0FBQ04sQ0FBQztBQTdCRCxnRUE2QkM7QUFFRDs7R0FFRztBQUNILE1BQWEsb0JBQXFCLFNBQVEscUNBQWlCO0lBRXZELE1BQU0sQ0FBQyxFQUFFLENBQUMsS0FBZ0M7UUFDdEMsT0FBTywyQkFBYSxDQUFDLEVBQUUsQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLFdBQVcsQ0FBQyxJQUFJLEVBQUUsS0FBSyxDQUFDLENBQUM7SUFDcEUsQ0FBQztJQUVELGNBQWM7UUFDVixPQUFPO1lBQ0gsSUFBSSxFQUFFLElBQUksQ0FBQyxJQUFJO1lBQ2YsS0FBSyxFQUFFLElBQUksQ0FBQyxhQUFhLEVBQUU7WUFDM0IsT0FBTyxFQUFFLEVBQUU7U0FDZCxDQUFDO0lBQ04sQ0FBQztJQUVELGFBQWE7UUFDVCxNQUFNLEtBQUssR0FBK0M7WUFDdEQ7Z0JBQ0ksSUFBSSxFQUFFLFVBQVU7Z0JBQ2hCLElBQUksRUFBRSwyQkFBYyxDQUFDLFFBQVE7YUFDaEM7WUFDRDtnQkFDSSxJQUFJLEVBQUUsUUFBUTtnQkFDZCxJQUFJLEVBQUUsMkJBQWMsQ0FBQyxNQUFNO2FBQzlCO1lBQ0Q7Z0JBQ0ksSUFBSSxFQUFFLFFBQVE7Z0JBQ2QsSUFBSSxFQUFFLDJCQUFjLENBQUMsTUFBTTthQUM5QjtZQUNEO2dCQUNJLElBQUksRUFBRSxnQkFBZ0I7Z0JBQ3RCLElBQUksRUFBRSw2Q0FBcUIsQ0FBQyxPQUFPO2FBQ3RDO1lBQ0Q7Z0JBQ0ksSUFBSSxFQUFFLGFBQWE7Z0JBQ25CLElBQUksRUFBRSwyQkFBYyxDQUFDLFdBQVc7YUFDbkM7WUFDRDtnQkFDSSxJQUFJLEVBQUUsTUFBTTtnQkFDWixJQUFJLEVBQUUsMkJBQWMsQ0FBQyxJQUFJO2FBQzVCO1lBQ0Q7Z0JBQ0ksSUFBSSxFQUFFLE1BQU07Z0JBQ1osSUFBSSxFQUFFLDJCQUFjLENBQUMsSUFBSTthQUM1QjtTQUNKLENBQUM7UUFFRixPQUFPLEtBQUssQ0FBQztJQUNqQixDQUFDO0lBRUQsaUJBQWlCO1FBQ2IsT0FBTyxFQUFFLENBQUM7SUFDZCxDQUFDO0NBQ0o7QUFwREQsb0RBb0RDIiwic291cmNlc0NvbnRlbnQiOlsiLypcbiAqIENvcHlyaWdodCAyMDE5IEFtYXpvbi5jb20sIEluYy4gb3IgaXRzIGFmZmlsaWF0ZXMuIEFsbCBSaWdodHMgUmVzZXJ2ZWQuXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpLlxuICogWW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogQSBjb3B5IG9mIHRoZSBMaWNlbnNlIGlzIGxvY2F0ZWQgYXRcbiAqICAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogb3IgaW4gdGhlIFwibGljZW5zZVwiIGZpbGUgYWNjb21wYW55aW5nIHRoaXMgZmlsZS4gVGhpcyBmaWxlIGlzIGRpc3RyaWJ1dGVkXG4gKiBvbiBhbiBcIkFTIElTXCIgQkFTSVMsIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXJcbiAqIGV4cHJlc3Mgb3IgaW1wbGllZC4gU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nXG4gKiBwZXJtaXNzaW9ucyBhbmQgbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cblxuaW1wb3J0IHsgSW50ZW50IH0gZnJvbSBcImFzay1zZGstbW9kZWxcIjtcbmltcG9ydCB7IHYxIH0gZnJvbSAnYXNrLXNtYXBpLW1vZGVsJztcbmltcG9ydCB7IFNoYXJlZFNsb3RUeXBlIH0gZnJvbSAnLi4vaW50ZXJhY3Rpb25Nb2RlbEdlbmVyYXRpb24vTW9kZWxUeXBlcyc7XG5pbXBvcnQgeyBCYXNlQ29udHJvbEludGVudCB9IGZyb20gJy4vQmFzZUNvbnRyb2xJbnRlbnQnO1xuaW1wb3J0IHsgZ2V0U2xvdFJlc29sdXRpb25zLCBJbnRlbnRCdWlsZGVyIH0gZnJvbSAnLi4vdXRpbHMvSW50ZW50VXRpbHMnO1xuaW1wb3J0IFNsb3RUeXBlID0gdjEuc2tpbGwuaW50ZXJhY3Rpb25Nb2RlbC5TbG90VHlwZTtcbmltcG9ydCB7IEFtYXpvbkJ1aWx0SW5TbG90VHlwZSB9IGZyb20gJy4vQW1hem9uQnVpbHRJblNsb3RUeXBlJztcblxuXG5leHBvcnQgaW50ZXJmYWNlIE9yZGluYWxDb250cm9sSW50ZW50U2xvdHMge1xuICAgIGZlZWRiYWNrPzogc3RyaW5nO1xuICAgIGFjdGlvbj86IHN0cmluZztcbiAgICB0YXJnZXQ/OiBzdHJpbmc7XG4gICAgJ0FNQVpPTi5PcmRpbmFsJz86IHN0cmluZztcbn1cblxuLyoqXG4gKiBcbiAqIFxuICogZW1wdHkgc2xvdHMgYXJlIHVucGFja2VkIGFzICd1bmRlZmluZWQnIHRvIGJlIG1vcmUgZXhwbGljaXQgYWJvdXQgd2hhdCBpcyBnb2luZyBvbi5cbiAqICh0aGlzIGhlbHBzIG1ha2VzIGJvb2xlYW4gdGVzdHMgaW4gQ29udHJvbHMgbW9yZSBvYnZpb3VzIGFuZCBjb25zaXN0ZW50KVxuICovXG5leHBvcnQgZnVuY3Rpb24gdW5wYWNrT3JkaW5hbENvbnRyb2xJbnRlbnQoaW50ZW50OiBJbnRlbnQpOiBPcmRpbmFsQ29udHJvbEludGVudFNsb3RzIHtcbiAgICBpZiAoIWludGVudC5uYW1lLnN0YXJ0c1dpdGgoJ09yZGluYWxDb250cm9sSW50ZW50JykpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBOb3QgYSBjb21wYXRpYmxlIGludGVudDogJHtpbnRlbnQubmFtZX1gKTtcbiAgICB9XG5cbiAgICBsZXQgYWN0aW9uOiBzdHJpbmcgfCB1bmRlZmluZWQ7XG4gICAgbGV0IGZlZWRiYWNrOiBzdHJpbmcgfCB1bmRlZmluZWQ7XG4gICAgbGV0IHRhcmdldDogc3RyaW5nIHwgdW5kZWZpbmVkO1xuICAgIGxldCB2YWx1ZVN0cjogc3RyaW5nIHwgdW5kZWZpbmVkO1xuXG4gICAgZm9yIChjb25zdCBbbmFtZSwgc2xvdF0gb2YgT2JqZWN0LmVudHJpZXMoaW50ZW50LnNsb3RzISkpIHtcbiAgICAgICAgY29uc3Qgc2xvdE9iamVjdCA9IGdldFNsb3RSZXNvbHV0aW9ucyhzbG90KTtcbiAgICAgICAgY29uc3Qgc2xvdFZhbHVlID0gc2xvdE9iamVjdCA/IHNsb3RPYmplY3Quc2xvdFZhbHVlIDogdW5kZWZpbmVkO1xuXG4gICAgICAgIHN3aXRjaCAobmFtZSkge1xuICAgICAgICAgICAgY2FzZSAnZmVlZGJhY2snOiBmZWVkYmFjayA9IHNsb3RWYWx1ZSAhPT0gdW5kZWZpbmVkID8gc2xvdFZhbHVlIDogdW5kZWZpbmVkOyBicmVhaztcbiAgICAgICAgICAgIGNhc2UgJ2FjdGlvbic6IGFjdGlvbiA9IHNsb3RWYWx1ZSAhPT0gdW5kZWZpbmVkID8gc2xvdFZhbHVlIDogdW5kZWZpbmVkOyBicmVhaztcbiAgICAgICAgICAgIGNhc2UgJ3RhcmdldCc6IHRhcmdldCA9IHNsb3RWYWx1ZSAhPT0gdW5kZWZpbmVkID8gc2xvdFZhbHVlIDogdW5kZWZpbmVkOyBicmVhaztcbiAgICAgICAgICAgIGNhc2UgJ0FNQVpPTi5PcmRpbmFsJzogdmFsdWVTdHIgPSBzbG90VmFsdWUgIT09IHVuZGVmaW5lZCA/IHNsb3RWYWx1ZSA6IHVuZGVmaW5lZDsgYnJlYWs7XG4gICAgICAgICAgICAvLyBkZWZhdWx0OiBpZ25vcmUgY29udGVudC1mcmVlIHNsb3RzXG4gICAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4ge1xuICAgICAgICBmZWVkYmFjayxcbiAgICAgICAgYWN0aW9uLFxuICAgICAgICB0YXJnZXQsXG4gICAgICAgICdBTUFaT04uT3JkaW5hbCc6IHZhbHVlU3RyXG4gICAgfTtcbn1cblxuLyoqXG4gKiBJbnRlbnQgdG8gY2FwdHVyZSBhbiBBTUFaT04uT3JkaW5hbCwgZm9sbG93aW5nIHRoZSBcIkNvbnRyb2xJbnRlbnRcIiBjb252ZW50aW9uc1xuICovXG5leHBvcnQgY2xhc3MgT3JkaW5hbENvbnRyb2xJbnRlbnQgZXh0ZW5kcyBCYXNlQ29udHJvbEludGVudCB7XG5cbiAgICBzdGF0aWMgb2Yoc2xvdHM6IE9yZGluYWxDb250cm9sSW50ZW50U2xvdHMpOiBJbnRlbnQge1xuICAgICAgICByZXR1cm4gSW50ZW50QnVpbGRlci5vZih0aGlzLnByb3RvdHlwZS5jb25zdHJ1Y3Rvci5uYW1lLCBzbG90cyk7XG4gICAgfVxuXG4gICAgZ2VuZXJhdGVJbnRlbnQoKTogdjEuc2tpbGwuaW50ZXJhY3Rpb25Nb2RlbC5JbnRlbnQge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgbmFtZTogdGhpcy5uYW1lLFxuICAgICAgICAgICAgc2xvdHM6IHRoaXMuZ2VuZXJhdGVTbG90cygpLFxuICAgICAgICAgICAgc2FtcGxlczogW10sXG4gICAgICAgIH07XG4gICAgfVxuXG4gICAgZ2VuZXJhdGVTbG90cygpOiB2MS5za2lsbC5pbnRlcmFjdGlvbk1vZGVsLlNsb3REZWZpbml0aW9uW10ge1xuICAgICAgICBjb25zdCBzbG90czogdjEuc2tpbGwuaW50ZXJhY3Rpb25Nb2RlbC5TbG90RGVmaW5pdGlvbltdID0gW1xuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIG5hbWU6ICdmZWVkYmFjaycsXG4gICAgICAgICAgICAgICAgdHlwZTogU2hhcmVkU2xvdFR5cGUuRkVFREJBQ0tcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgbmFtZTogJ2FjdGlvbicsXG4gICAgICAgICAgICAgICAgdHlwZTogU2hhcmVkU2xvdFR5cGUuQUNUSU9OXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIG5hbWU6ICd0YXJnZXQnLFxuICAgICAgICAgICAgICAgIHR5cGU6IFNoYXJlZFNsb3RUeXBlLlRBUkdFVFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBuYW1lOiAnQU1BWk9OLk9yZGluYWwnLFxuICAgICAgICAgICAgICAgIHR5cGU6IEFtYXpvbkJ1aWx0SW5TbG90VHlwZS5PUkRJTkFMXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIG5hbWU6ICdwcmVwb3NpdGlvbicsXG4gICAgICAgICAgICAgICAgdHlwZTogU2hhcmVkU2xvdFR5cGUuUFJFUE9TSVRJT05cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgbmFtZTogJ2hlYWQnLFxuICAgICAgICAgICAgICAgIHR5cGU6IFNoYXJlZFNsb3RUeXBlLkhFQURcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgbmFtZTogJ3RhaWwnLFxuICAgICAgICAgICAgICAgIHR5cGU6IFNoYXJlZFNsb3RUeXBlLlRBSUxcbiAgICAgICAgICAgIH1cbiAgICAgICAgXTtcblxuICAgICAgICByZXR1cm4gc2xvdHM7XG4gICAgfVxuXG4gICAgZ2VuZXJhdGVTbG90VHlwZXMoKTogU2xvdFR5cGVbXSB7XG4gICAgICAgIHJldHVybiBbXTtcbiAgICB9XG59XG4iXX0=