"use strict";
/*
 * Copyright 2019 Amazon.com, Inc. or its affiliates. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License").
 * You may not use this file except in compliance with the License.
 * A copy of the License is located at
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * or in the "license" file accompanying this file. This file is distributed
 * on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either
 * express or implied. See the License for the specific language governing
 * permissions and limitations under the License.
 */
Object.defineProperty(exports, "__esModule", { value: true });
exports.SingleValueControlIntent = exports.unpackSingleValueControlIntent = void 0;
const ModelTypes_1 = require("../interactionModelGeneration/ModelTypes");
const IntentUtils_1 = require("../utils/IntentUtils");
const BaseControlIntent_1 = require("./BaseControlIntent");
function unpackSingleValueControlIntent(intent) {
    if (!intent.name.endsWith('ControlIntent')) {
        throw new Error(`Not a ControlIntent: ${intent.name}`);
    }
    let action;
    let feedback;
    let target;
    let valueStr;
    let valueType;
    let erMatch;
    for (const [name, slot] of Object.entries(intent.slots)) {
        const slotObject = IntentUtils_1.getSlotResolutions(slot);
        const slotValue = slotObject !== undefined ? slotObject.slotValue : undefined;
        switch (name) {
            case 'action':
                action = slotValue;
                break;
            case 'feedback':
                feedback = slotValue;
                break;
            case 'target':
                target = slotValue;
                break;
            case 'head': break;
            case 'tail': break;
            case 'preposition': break;
            default:
                // did we already capture a value?
                if (valueType !== undefined) {
                    throw new Error('a SingleValueControlIntent should only have one value slot');
                }
                // treat it as a slot whose name is an NLU slot type.
                valueStr = slotValue;
                valueType = name;
                erMatch = slotObject !== undefined ? slotObject.isEntityResolutionMatch : undefined;
        }
    }
    if (valueStr === undefined) {
        throw new Error(`SingleValueControlIntent did not have value slot filled.  This should have mapped to GeneralControlIntent. intent: ${JSON.stringify(intent)}`);
    }
    return {
        feedback,
        action,
        target,
        valueStr,
        valueType,
        erMatch
    };
}
exports.unpackSingleValueControlIntent = unpackSingleValueControlIntent;
/**
 * Intent to capture a value from a specified SlotType, following the "ControlIntent" conventions
 */
class SingleValueControlIntent extends BaseControlIntent_1.BaseControlIntent {
    constructor(valueSlotType) {
        super();
        if (valueSlotType === 'AMAZON.SearchQuery') {
            throw new Error('AMAZON.SearchQuery cannot be used with SingleValueControlIntent due to the special rules regarding its use. '
                + 'Specifically, utterances that include SearchQuery must have a carrier phrase and not be comprised entirely of slot references.');
        }
        this.valueSlotType = valueSlotType;
        this.name = SingleValueControlIntent.intentName(valueSlotType);
    }
    /**
     * Generate the intent name for a SingleValueControlIntent with value-slot of type slotType
     * @param slotTypeId
     */
    static intentName(slotType) {
        return `${slotType}_ValueControlIntent`.replace('.', '_');
    }
    /**
     * Create Intent from specification of the slots
     *
     * Usage:
     *  * the value should be provided as a property with name = <SlotType>
     *    Example single-value-control-intent for certain slotTypes:
     *    * AMAZON.NUMBER:
     *  ```
     *   {
     *      name: AMAZON_NUMBER_ValueControlIntent
     *      slots: { target: 'count', 'AMAZON.NUMBER': '2' }
     *      confirmationStatus: 'NONE'
     *   }
     *  ```
     *    * AMAZON.Ordinal:
     * ```
     *   {
     *        name: AMAZON_ORDINAL_ValueControlIntent
     *      slots: { action: 'set', 'AMAZON.Ordinal': 'first'}
     *           confirmationStatus: 'NONE'
     *   }
     * ```
     */
    static of(slotType, slots) {
        return IntentUtils_1.IntentBuilder.of(SingleValueControlIntent.intentName(slotType), slots);
    }
    generateIntent() {
        return {
            name: this.name,
            slots: this.generateSlots(),
            samples: [],
        };
    }
    generateSlots() {
        const slots = [
            {
                name: 'feedback',
                type: ModelTypes_1.SharedSlotType.FEEDBACK
            },
            {
                name: 'action',
                type: ModelTypes_1.SharedSlotType.ACTION
            },
            {
                name: 'target',
                type: ModelTypes_1.SharedSlotType.TARGET
            },
            {
                name: 'preposition',
                type: ModelTypes_1.SharedSlotType.PREPOSITION
            },
            {
                name: 'head',
                type: ModelTypes_1.SharedSlotType.HEAD
            },
            {
                name: 'tail',
                type: ModelTypes_1.SharedSlotType.TAIL
            },
            {
                name: `${this.valueSlotType}`,
                type: `${this.valueSlotType}`
            }
        ];
        return slots;
    }
    generateSlotTypes() {
        return [];
    }
}
exports.SingleValueControlIntent = SingleValueControlIntent;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiU2luZ2xlVmFsdWVDb250cm9sSW50ZW50LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vc3JjL2ludGVudHMvU2luZ2xlVmFsdWVDb250cm9sSW50ZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQTs7Ozs7Ozs7Ozs7R0FXRzs7O0FBSUgseUVBQTBFO0FBQzFFLHNEQUF5RTtBQUV6RSwyREFBd0Q7QUE0QnhELFNBQWdCLDhCQUE4QixDQUFDLE1BQWM7SUFDekQsSUFBSSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLGVBQWUsQ0FBQyxFQUFFO1FBQ3hDLE1BQU0sSUFBSSxLQUFLLENBQUMsd0JBQXdCLE1BQU0sQ0FBQyxJQUFJLEVBQUUsQ0FBQyxDQUFDO0tBQzFEO0lBRUQsSUFBSSxNQUEwQixDQUFDO0lBQy9CLElBQUksUUFBNEIsQ0FBQztJQUNqQyxJQUFJLE1BQTBCLENBQUM7SUFDL0IsSUFBSSxRQUE0QixDQUFDO0lBQ2pDLElBQUksU0FBNkIsQ0FBQztJQUNsQyxJQUFJLE9BQTRCLENBQUM7SUFFakMsS0FBSyxNQUFNLENBQUMsSUFBSSxFQUFFLElBQUksQ0FBQyxJQUFJLE1BQU0sQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDLEtBQU0sQ0FBQyxFQUFFO1FBQ3RELE1BQU0sVUFBVSxHQUFHLGdDQUFrQixDQUFDLElBQUksQ0FBQyxDQUFDO1FBQzVDLE1BQU0sU0FBUyxHQUFHLFVBQVUsS0FBSyxTQUFTLENBQUMsQ0FBQyxDQUFDLFVBQVUsQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDLFNBQVMsQ0FBQztRQUU5RSxRQUFRLElBQUksRUFBRTtZQUNWLEtBQUssUUFBUTtnQkFBRSxNQUFNLEdBQUcsU0FBUyxDQUFDO2dCQUFDLE1BQU07WUFDekMsS0FBSyxVQUFVO2dCQUFFLFFBQVEsR0FBRyxTQUFTLENBQUM7Z0JBQUMsTUFBTTtZQUM3QyxLQUFLLFFBQVE7Z0JBQUUsTUFBTSxHQUFHLFNBQVMsQ0FB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Q2hDO1NBQ0osQ0FBQztRQUVGLE9BQU8sS0FBSyxDQUFDO0lBQ2pCLENBQUM7SUFJRCxpQkFBaUI7UUFDYixPQUFPLEVBQUUsQ0FBQztJQUNkLENBQUM7Q0FDSjtBQXBHRCw0REFvR0MiLCJzb3VyY2VzQ29udGVudCI6WyIvKlxuICogQ29weXJpZ2h0IDIwMTkgQW1hem9uLmNvbSwgSW5jLiBvciBpdHMgYWZmaWxpYXRlcy4gQWxsIFJpZ2h0cyBSZXNlcnZlZC5cbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIikuXG4gKiBZb3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBBIGNvcHkgb2YgdGhlIExpY2Vuc2UgaXMgbG9jYXRlZCBhdFxuICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBvciBpbiB0aGUgXCJsaWNlbnNlXCIgZmlsZSBhY2NvbXBhbnlpbmcgdGhpcyBmaWxlLiBUaGlzIGZpbGUgaXMgZGlzdHJpYnV0ZWRcbiAqIG9uIGFuIFwiQVMgSVNcIiBCQVNJUywgV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlclxuICogZXhwcmVzcyBvciBpbXBsaWVkLiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmdcbiAqIHBlcm1pc3Npb25zIGFuZCBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuXG5pbXBvcnQgeyBJbnRlbnQgfSBmcm9tIFwiYXNrLXNkay1tb2RlbFwiO1xuaW1wb3J0IHsgdjEgfSBmcm9tICdhc2stc21hcGktbW9kZWwnO1xuaW1wb3J0IHsgU2hhcmVkU2xvdFR5cGUgfSBmcm9tICcuLi9pbnRlcmFjdGlvbk1vZGVsR2VuZXJhdGlvbi9Nb2RlbFR5cGVzJztcbmltcG9ydCB7IGdldFNsb3RSZXNvbHV0aW9ucywgSW50ZW50QnVpbGRlciB9IGZyb20gJy4uL3V0aWxzL0ludGVudFV0aWxzJztcbmltcG9ydCB7IEFtYXpvbkJ1aWx0SW5TbG90VHlwZSB9IGZyb20gJy4vQW1hem9uQnVpbHRJblNsb3RUeXBlJztcbmltcG9ydCB7IEJhc2VDb250cm9sSW50ZW50IH0gZnJvbSAnLi9CYXNlQ29udHJvbEludGVudCc7XG5pbXBvcnQgU2xvdFR5cGUgPSB2MS5za2lsbC5pbnRlcmFjdGlvbk1vZGVsLlNsb3RUeXBlO1xuXG4vKipcbiAqIEludGVudCBzaGFwZSB0byBwcm92aWRlIGEgc2luZ2xlIHZhbHVlIG9mIGFuIGFyYml0cmFyeSBzbG90IHR5cGVcbiAqXG4gKiBVc2FnZTpcbiAqICAqIHRoZSB2YWx1ZSBzaG91bGQgYmUgcHJvdmlkZWQgYXMgYSBwcm9wZXJ0eSB3aXRoIG5hbWUgPSA8U2xvdFR5cGU+XG4gKiAgICBlLmcuIHsgJ0FNQVpPTi5OVU1CRVInOiAnMicgfVxuICogICAgIG9yICB7ICdBTUFaT04uT3JkaW5hbCc6ICdmaXJzdCcgfVxuICovXG5leHBvcnQgaW50ZXJmYWNlIFNpbmdsZVZhbHVlQ29udHJvbEludGVudFNsb3RzIHtcbiAgICBmZWVkYmFjaz86IHN0cmluZztcbiAgICBhY3Rpb24/OiBzdHJpbmc7XG4gICAgdGFyZ2V0Pzogc3RyaW5nO1xuICAgIFtrZXk6IHN0cmluZ106IHN0cmluZyB8IHVuZGVmaW5lZDtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBTaW5nbGVWYWx1ZVBheWxvYWQge1xuICAgIGZlZWRiYWNrPzogc3RyaW5nO1xuICAgIGFjdGlvbj86IHN0cmluZztcbiAgICB0YXJnZXQ/OiBzdHJpbmc7XG4gICAgdmFsdWVTdHI6IHN0cmluZztcbiAgICB2YWx1ZVR5cGU/OiBzdHJpbmc7XG4gICAgZXJNYXRjaD86IGJvb2xlYW47XG59XG5cblxuZXhwb3J0IGZ1bmN0aW9uIHVucGFja1NpbmdsZVZhbHVlQ29udHJvbEludGVudChpbnRlbnQ6IEludGVudCk6IFNpbmdsZVZhbHVlUGF5bG9hZCB7XG4gICAgaWYgKCFpbnRlbnQubmFtZS5lbmRzV2l0aCgnQ29udHJvbEludGVudCcpKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihgTm90IGEgQ29udHJvbEludGVudDogJHtpbnRlbnQubmFtZX1gKTtcbiAgICB9XG5cbiAgICBsZXQgYWN0aW9uOiBzdHJpbmcgfCB1bmRlZmluZWQ7XG4gICAgbGV0IGZlZWRiYWNrOiBzdHJpbmcgfCB1bmRlZmluZWQ7XG4gICAgbGV0IHRhcmdldDogc3RyaW5nIHwgdW5kZWZpbmVkO1xuICAgIGxldCB2YWx1ZVN0cjogc3RyaW5nIHwgdW5kZWZpbmVkO1xuICAgIGxldCB2YWx1ZVR5cGU6IHN0cmluZyB8IHVuZGVmaW5lZDtcbiAgICBsZXQgZXJNYXRjaDogYm9vbGVhbiB8IHVuZGVmaW5lZDtcblxuICAgIGZvciAoY29uc3QgW25hbWUsIHNsb3RdIG9mIE9iamVjdC5lbnRyaWVzKGludGVudC5zbG90cyEpKSB7XG4gICAgICAgIGNvbnN0IHNsb3RPYmplY3QgPSBnZXRTbG90UmVzb2x1dGlvbnMoc2xvdCk7XG4gICAgICAgIGNvbnN0IHNsb3RWYWx1ZSA9IHNsb3RPYmplY3QgIT09IHVuZGVmaW5lZCA/IHNsb3RPYmplY3Quc2xvdFZhbHVlIDogdW5kZWZpbmVkO1xuXG4gICAgICAgIHN3aXRjaCAobmFtZSkge1xuICAgICAgICAgICAgY2FzZSAnYWN0aW9uJzogYWN0aW9uID0gc2xvdFZhbHVlOyBicmVhaztcbiAgICAgICAgICAgIGNhc2UgJ2ZlZWRiYWNrJzogZmVlZGJhY2sgPSBzbG90VmFsdWU7IGJyZWFrO1xuICAgICAgICAgICAgY2FzZSAndGFyZ2V0JzogdGFyZ2V0ID0gc2xvdFZhbHVlOyBicmVhaztcbiAgICAgICAgICAgIGNhc2UgJ2hlYWQnOiBicmVhaztcbiAgICAgICAgICAgIGNhc2UgJ3RhaWwnOiBicmVhaztcbiAgICAgICAgICAgIGNhc2UgJ3ByZXBvc2l0aW9uJzogYnJlYWs7XG4gICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgIC8vIGRpZCB3ZSBhbHJlYWR5IGNhcHR1cmUgYSB2YWx1ZT9cbiAgICAgICAgICAgICAgICBpZiAodmFsdWVUeXBlICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdhIFNpbmdsZVZhbHVlQ29udHJvbEludGVudCBzaG91bGQgb25seSBoYXZlIG9uZSB2YWx1ZSBzbG90Jyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIC8vIHRyZWF0IGl0IGFzIGEgc2xvdCB3aG9zZSBuYW1lIGlzIGFuIE5MVSBzbG90IHR5cGUuXG4gICAgICAgICAgICAgICAgdmFsdWVTdHIgPSBzbG90VmFsdWU7XG4gICAgICAgICAgICAgICAgdmFsdWVUeXBlID0gbmFtZTtcbiAgICAgICAgICAgICAgICBlck1hdGNoID0gc2xvdE9iamVjdCAhPT0gdW5kZWZpbmVkID8gc2xvdE9iamVjdC5pc0VudGl0eVJlc29sdXRpb25NYXRjaCA6IHVuZGVmaW5lZDtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGlmICh2YWx1ZVN0ciA9PT0gdW5kZWZpbmVkKXtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBTaW5nbGVWYWx1ZUNvbnRyb2xJbnRlbnQgZGlkIG5vdCBoYXZlIHZhbHVlIHNsb3QgZmlsbGVkLiAgVGhpcyBzaG91bGQgaGF2ZSBtYXBwZWQgdG8gR2VuZXJhbENvbnRyb2xJbnRlbnQuIGludGVudDogJHtKU09OLnN0cmluZ2lmeShpbnRlbnQpfWApO1xuICAgIH1cblxuICAgIHJldHVybiB7XG4gICAgICAgIGZlZWRiYWNrLFxuICAgICAgICBhY3Rpb24sXG4gICAgICAgIHRhcmdldCxcbiAgICAgICAgdmFsdWVTdHIsXG4gICAgICAgIHZhbHVlVHlwZSxcbiAgICAgICAgZXJNYXRjaFxuICAgIH07XG59XG5cbi8qKlxuICogSW50ZW50IHRvIGNhcHR1cmUgYSB2YWx1ZSBmcm9tIGEgc3BlY2lmaWVkIFNsb3RUeXBlLCBmb2xsb3dpbmcgdGhlIFwiQ29udHJvbEludGVudFwiIGNvbnZlbnRpb25zXG4gKi9cbmV4cG9ydCBjbGFzcyBTaW5nbGVWYWx1ZUNvbnRyb2xJbnRlbnQgZXh0ZW5kcyBCYXNlQ29udHJvbEludGVudCB7XG4gICAgdmFsdWVTbG90VHlwZTogc3RyaW5nO1xuXG4gICAgY29uc3RydWN0b3IodmFsdWVTbG90VHlwZTogc3RyaW5nKSB7XG4gICAgICAgIHN1cGVyKCk7XG5cbiAgICAgICAgaWYgKHZhbHVlU2xvdFR5cGUgPT09ICdBTUFaT04uU2VhcmNoUXVlcnknKXtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignQU1BWk9OLlNlYXJjaFF1ZXJ5IGNhbm5vdCBiZSB1c2VkIHdpdGggU2luZ2xlVmFsdWVDb250cm9sSW50ZW50IGR1ZSB0byB0aGUgc3BlY2lhbCBydWxlcyByZWdhcmRpbmcgaXRzIHVzZS4gJ1xuICAgICAgICAgICAgICsgJ1NwZWNpZmljYWxseSwgdXR0ZXJhbmNlcyB0aGF0IGluY2x1ZGUgU2VhcmNoUXVlcnkgbXVzdCBoYXZlIGEgY2FycmllciBwaHJhc2UgYW5kIG5vdCBiZSBjb21wcmlzZWQgZW50aXJlbHkgb2Ygc2xvdCByZWZlcmVuY2VzLicpO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy52YWx1ZVNsb3RUeXBlID0gdmFsdWVTbG90VHlwZTtcbiAgICAgICAgdGhpcy5uYW1lID0gU2luZ2xlVmFsdWVDb250cm9sSW50ZW50LmludGVudE5hbWUodmFsdWVTbG90VHlwZSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogR2VuZXJhdGUgdGhlIGludGVudCBuYW1lIGZvciBhIFNpbmdsZVZhbHVlQ29udHJvbEludGVudCB3aXRoIHZhbHVlLXNsb3Qgb2YgdHlwZSBzbG90VHlwZVxuICAgICAqIEBwYXJhbSBzbG90VHlwZUlkXG4gICAgICovXG4gICAgc3RhdGljIGludGVudE5hbWUoc2xvdFR5cGU6IHN0cmluZyl7XG4gICAgICAgIHJldHVybiBgJHtzbG90VHlwZX1fVmFsdWVDb250cm9sSW50ZW50YC5yZXBsYWNlKCcuJywgJ18nKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBDcmVhdGUgSW50ZW50IGZyb20gc3BlY2lmaWNhdGlvbiBvZiB0aGUgc2xvdHNcbiAgICAgKlxuICAgICAqIFVzYWdlOlxuICAgICAqICAqIHRoZSB2YWx1ZSBzaG91bGQgYmUgcHJvdmlkZWQgYXMgYSBwcm9wZXJ0eSB3aXRoIG5hbWUgPSA8U2xvdFR5cGU+XG4gICAgICogICAgRXhhbXBsZSBzaW5nbGUtdmFsdWUtY29udHJvbC1pbnRlbnQgZm9yIGNlcnRhaW4gc2xvdFR5cGVzOlxuICAgICAqICAgICogQU1BWk9OLk5VTUJFUjpcbiAgICAgKiAgYGBgXG4gICAgICogICB7XG4gICAgICogICAgICBuYW1lOiBBTUFaT05fTlVNQkVSX1ZhbHVlQ29udHJvbEludGVudFxuICAgICAqICAgICAgc2xvdHM6IHsgdGFyZ2V0OiAnY291bnQnLCAnQU1BWk9OLk5VTUJFUic6ICcyJyB9XG4gICAgICogICAgICBjb25maXJtYXRpb25TdGF0dXM6ICdOT05FJ1xuICAgICAqICAgfVxuICAgICAqICBgYGBcbiAgICAgKiAgICAqIEFNQVpPTi5PcmRpbmFsOlxuICAgICAqIGBgYFxuICAgICAqICAge1xuICAgICAqICAgICAgICBuYW1lOiBBTUFaT05fT1JESU5BTF9WYWx1ZUNvbnRyb2xJbnRlbnRcbiAgICAgKiAgICAgIHNsb3RzOiB7IGFjdGlvbjogJ3NldCcsICdBTUFaT04uT3JkaW5hbCc6ICdmaXJzdCd9XG4gICAgICogICAgICAgICAgIGNvbmZpcm1hdGlvblN0YXR1czogJ05PTkUnXG4gICAgICogICB9XG4gICAgICogYGBgXG4gICAgICovXG4gICAgc3RhdGljIG9mKHNsb3RUeXBlOiBzdHJpbmcsIHNsb3RzOiBTaW5nbGVWYWx1ZUNvbnRyb2xJbnRlbnRTbG90cyk6IEludGVudCB7XG4gICAgICAgIHJldHVybiBJbnRlbnRCdWlsZGVyLm9mKFxuICAgICAgICAgICAgU2luZ2xlVmFsdWVDb250cm9sSW50ZW50LmludGVudE5hbWUoc2xvdFR5cGUpLCBzbG90c1xuICAgICAgICApO1xuICAgIH1cblxuICAgIGdlbmVyYXRlSW50ZW50KCk6IHYxLnNraWxsLmludGVyYWN0aW9uTW9kZWwuSW50ZW50IHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIG5hbWU6IHRoaXMubmFtZSxcbiAgICAgICAgICAgIHNsb3RzOiB0aGlzLmdlbmVyYXRlU2xvdHMoKSxcbiAgICAgICAgICAgIHNhbXBsZXM6IFtdLFxuICAgICAgICB9O1xuICAgIH1cblxuICAgIGdlbmVyYXRlU2xvdHMoKTogdjEuc2tpbGwuaW50ZXJhY3Rpb25Nb2RlbC5TbG90RGVmaW5pdGlvbltdIHtcbiAgICAgICAgY29uc3Qgc2xvdHM6IHYxLnNraWxsLmludGVyYWN0aW9uTW9kZWwuU2xvdERlZmluaXRpb25bXSA9IFtcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBuYW1lOiAnZmVlZGJhY2snLFxuICAgICAgICAgICAgICAgIHR5cGU6IFNoYXJlZFNsb3RUeXBlLkZFRURCQUNLXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIG5hbWU6ICdhY3Rpb24nLFxuICAgICAgICAgICAgICAgIHR5cGU6IFNoYXJlZFNsb3RUeXBlLkFDVElPTlxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBuYW1lOiAndGFyZ2V0JyxcbiAgICAgICAgICAgICAgICB0eXBlOiBTaGFyZWRTbG90VHlwZS5UQVJHRVRcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgbmFtZTogJ3ByZXBvc2l0aW9uJyxcbiAgICAgICAgICAgICAgICB0eXBlOiBTaGFyZWRTbG90VHlwZS5QUkVQT1NJVElPTlxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBuYW1lOiAnaGVhZCcsXG4gICAgICAgICAgICAgICAgdHlwZTogU2hhcmVkU2xvdFR5cGUuSEVBRFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBuYW1lOiAndGFpbCcsXG4gICAgICAgICAgICAgICAgdHlwZTogU2hhcmVkU2xvdFR5cGUuVEFJTFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBuYW1lOiBgJHt0aGlzLnZhbHVlU2xvdFR5cGV9YCxcbiAgICAgICAgICAgICAgICB0eXBlOiBgJHt0aGlzLnZhbHVlU2xvdFR5cGV9YFxuICAgICAgICAgICAgfVxuICAgICAgICBdO1xuXG4gICAgICAgIHJldHVybiBzbG90cztcbiAgICB9XG5cblxuXG4gICAgZ2VuZXJhdGVTbG90VHlwZXMoKTogU2xvdFR5cGVbXSB7XG4gICAgICAgIHJldHVybiBbXTtcbiAgICB9XG59XG4iXX0=