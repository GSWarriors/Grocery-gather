"use strict";
/*
 * Copyright 2019 Amazon.com, Inc. or its affiliates. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License").
 * You may not use this file except in compliance with the License.
 * A copy of the License is located at
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * or in the "license" file accompanying this file. This file is distributed
 * on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either
 * express or implied. See the License for the specific language governing
 * permissions and limitations under the License.
 */
Object.defineProperty(exports, "__esModule", { value: true });
exports.InputUtil = void 0;
const Strings_1 = require("../constants/Strings");
const SingleValueControlIntent_1 = require("../intents/SingleValueControlIntent");
const AmazonBuiltInIntent_1 = require("../intents/AmazonBuiltInIntent");
const GeneralControlIntent_1 = require("../intents/GeneralControlIntent");
var InputUtil;
(function (InputUtil) {
    /**
     * Test and assert if an object looks like an Intent.
     * (user-defined type guard)
     */
    function isIntentShape(x) {
        return (x.name !== undefined && x.confirmationStatus);
    }
    InputUtil.isIntentShape = isIntentShape;
    function isLaunchRequest(input) {
        return input.request.type === 'LaunchRequest';
    }
    InputUtil.isLaunchRequest = isLaunchRequest;
    function isSessionEndedRequest(input) {
        return input.request.type === 'SessionEndedRequest';
    }
    InputUtil.isSessionEndedRequest = isSessionEndedRequest;
    function isIntent(input, intentName) {
        return input.request.type === 'IntentRequest' && input.request.intent.name === intentName;
    }
    InputUtil.isIntent = isIntent;
    function isSingleValueControlIntent(input, slotType) {
        return input.request.type === 'IntentRequest' && input.request.intent.name === SingleValueControlIntent_1.SingleValueControlIntent.intentName(slotType);
    }
    InputUtil.isSingleValueControlIntent = isSingleValueControlIntent;
    function isFallbackIntent(input) {
        return input.request.type === 'IntentRequest' && input.request.intent.name === 'AMAZON.FallbackIntent';
    }
    InputUtil.isFallbackIntent = isFallbackIntent;
    function isAPLUserEventWithArgs(input) {
        return input.request.type === 'Alexa.Presentation.APL.UserEvent' && input.request.arguments !== undefined && input.request.arguments.length > 0;
    }
    InputUtil.isAPLUserEventWithArgs = isAPLUserEventWithArgs;
    function isAPLUserEventWithMatchingControlId(input, controlId) {
        return isAPLUserEventWithArgs(input) && (input.request.arguments[0] === controlId);
    }
    InputUtil.isAPLUserEventWithMatchingControlId = isAPLUserEventWithMatchingControlId;
    function feedbackIsTrue(feedback) {
        return (feedback === Strings_1.Strings.Feedback.Affirm);
    }
    InputUtil.feedbackIsTrue = feedbackIsTrue;
    function feedbackIsFalse(feedback) {
        return (feedback === Strings_1.Strings.Feedback.Disaffirm);
    }
    InputUtil.feedbackIsFalse = feedbackIsFalse;
    function feedbackIsUndefined(feedback) {
        return (feedback === undefined);
    }
    InputUtil.feedbackIsUndefined = feedbackIsUndefined;
    function feedbackIsMatchOrUndefined(feedback, feedbackIds) {
        return slotIsUndefinedOrMatch(feedback, feedbackIds);
    }
    InputUtil.feedbackIsMatchOrUndefined = feedbackIsMatchOrUndefined;
    function slotIsUndefinedOrMatch(slotValue, expectedValues) {
        return slotValue === undefined || expectedValues.includes(slotValue);
    }
    InputUtil.slotIsUndefinedOrMatch = slotIsUndefinedOrMatch;
    function actionIsSetOrUndefined(action, slotValueIdsForSet) {
        return slotIsUndefinedOrMatch(action, slotValueIdsForSet);
    }
    InputUtil.actionIsSetOrUndefined = actionIsSetOrUndefined;
    function actionIsMatch(action, slotValueIdsForChange) {
        return action !== undefined && slotValueIdsForChange.includes(action);
    }
    InputUtil.actionIsMatch = actionIsMatch;
    function actionIsUndefined(action) {
        return action === undefined;
    }
    InputUtil.actionIsUndefined = actionIsUndefined;
    function targetIsMatch(target, targetIds) {
        return target !== undefined && targetIds.includes(target);
    }
    InputUtil.targetIsMatch = targetIsMatch;
    function targetIsUndefined(target) {
        return target === undefined;
    }
    InputUtil.targetIsUndefined = targetIsUndefined;
    function targetIsMatchOrUndefined(target, targetIds) {
        return slotIsUndefinedOrMatch(target, targetIds);
    }
    InputUtil.targetIsMatchOrUndefined = targetIsMatchOrUndefined;
    function actionIsMatchOrUndefined(action, actionIds) {
        return slotIsUndefinedOrMatch(action, actionIds);
    }
    InputUtil.actionIsMatchOrUndefined = actionIsMatchOrUndefined;
    function valueTypeMatch(valueType, expectedValueType) {
        return valueType !== undefined && valueType === expectedValueType;
    }
    InputUtil.valueTypeMatch = valueTypeMatch;
    function valueTypeIsUndefined(valueType) {
        return valueType === undefined;
    }
    InputUtil.valueTypeIsUndefined = valueTypeIsUndefined;
    function valueStrDefined(valueStr) {
        return valueStr !== undefined && valueStr !== '?'; // ? is produced if SlotElicitation on but value can't be parsed.
    }
    InputUtil.valueStrDefined = valueStrDefined;
    function valueStrIsUndefined(valueStr) {
        return valueStr === undefined || valueStr === '?'; // ? is produced if SlotElicitation on but value can't be parsed.
    }
    InputUtil.valueStrIsUndefined = valueStrIsUndefined;
    function isBareYes(input) {
        if (input.request.type !== 'IntentRequest') {
            return false;
        }
        else if (input.request.intent.name === AmazonBuiltInIntent_1.AmazonIntent.YesIntent) {
            return true;
        }
        else if (input.request.intent.name === GeneralControlIntent_1.GeneralControlIntent.name) {
            const { feedback, action, target } = GeneralControlIntent_1.unpackGeneralControlIntent(input.request.intent);
            if (feedback === Strings_1.Strings.Feedback.Affirm && action === undefined && target === undefined) {
                return true;
            }
        }
        return false;
    }
    InputUtil.isBareYes = isBareYes;
    function isBareNo(input) {
        if (input.request.type !== 'IntentRequest') {
            return false;
        }
        else if (input.request.intent.name === AmazonBuiltInIntent_1.AmazonIntent.NoIntent) {
            return true;
        }
        else if (input.request.intent.name === GeneralControlIntent_1.GeneralControlIntent.name) {
            const { feedback, action, target } = GeneralControlIntent_1.unpackGeneralControlIntent(input.request.intent);
            if (feedback === Strings_1.Strings.Feedback.Disaffirm && action === undefined && target === undefined) {
                return true;
            }
        }
        return false;
    }
    InputUtil.isBareNo = isBareNo;
    function getValueResolution(input) {
        const { valueStr, erMatch } = SingleValueControlIntent_1.unpackSingleValueControlIntent(input.request.intent);
        return { valueStr: valueStr, erMatch: erMatch };
    }
    InputUtil.getValueResolution = getValueResolution;
})(InputUtil = exports.InputUtil || (exports.InputUtil = {}));
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiSW5wdXRVdGlsLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vc3JjL3V0aWxzL0lucHV0VXRpbC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUE7Ozs7Ozs7Ozs7O0dBV0c7OztBQUVILGtEQUFvRDtBQUVwRCxrRkFBK0c7QUFFL0csd0VBQThEO0FBQzlELDBFQUFtRztBQUVuRyxJQUFpQixTQUFTLENBbUp6QjtBQW5KRCxXQUFpQixTQUFTO0lBRXRCOzs7T0FHRztJQUNILFNBQWdCLGFBQWEsQ0FBQyxDQUFNO1FBQ2hDLE9BQU8sQ0FBQyxDQUFDLENBQUMsSUFBSSxLQUFLLFNBQVMsSUFBSSxDQUFDLENBQUMsa0JBQWtCLENBQUMsQ0FBQztJQUMxRCxDQUFDO0lBRmUsdUJBQWEsZ0JBRTVCLENBQUE7SUFFRCxTQUFnQixlQUFlLENBQUMsS0FBbUI7UUFDL0MsT0FBTyxLQUFLLENBQUMsT0FBTyxDQUFDLElBQUksS0FBSyxlQUFlLENBQUM7SUFDbEQsQ0FBQztJQUZlLHlCQUFlLGtCQUU5QixDQUFBO0lBRUQsU0FBZ0IscUJBQXFCLENBQUMsS0FBbUI7UUFDckQsT0FBTyxLQUFLLENBQUMsT0FBTyxDQUFDLElBQUksS0FBSyxxQkFBcUIsQ0FBQztJQUN4RCxDQUFDO0lBRmUsK0JBQXFCLHdCQUVwQyxDQUFBO0lBRUQsU0FBZ0IsUUFBUSxDQUFDLEtBQW1CLEVBQUUsVUFBa0I7UUFDNUQsT0FBTyxLQUFLLENBQUMsT0FBTyxDQUFDLElBQUksS0FBSyxlQUFlLElBQUksS0FBSyxDQUFDLE9BQU8sQ0FBQyxNQUFNLENBQUMsSUFBSSxLQUFLLFVBQVUsQ0FBQztJQUM5RixDQUFDO0lBRmUsa0JBQVEsV0FFdkIsQ0FBQTtJQUVELFNBQWdCLDBCQUEwQixDQUFDLEtBQW1CLEVBQUUsUUFBZ0I7UUFDNUUsT0FBTyxLQUFLLENBQUMsT0FBTyxDQUFDLElBQUksS0FBSyxlQUFlLElBQUksS0FBSyxDQUFDLE9BQU8sQ0FBQyxNQUFNLENB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QUM7YUFDZjtTQUNKO1FBQ0QsT0FBTyxLQUFLLENBQUM7SUFDakIsQ0FBQztJQWRlLGtCQUFRLFdBY3ZCLENBQUE7SUFFRCxTQUFnQixrQkFBa0IsQ0FBQyxLQUFtQjtRQUNsRCxNQUFNLEVBQUUsUUFBUSxFQUFFLE9BQU8sRUFBRSxHQUFHLHlEQUE4QixDQUFFLEtBQUssQ0FBQyxPQUF5QixDQUFDLE1BQU0sQ0FBQyxDQUFDO1FBQ3RHLE9BQU8sRUFBRSxRQUFRLEVBQUUsUUFBUyxFQUFFLE9BQU8sRUFBRSxPQUFRLEVBQUUsQ0FBQztJQUN0RCxDQUFDO0lBSGUsNEJBQWtCLHFCQUdqQyxDQUFBO0FBQ0wsQ0FBQyxFQW5KZ0IsU0FBUyxHQUFULGlCQUFTLEtBQVQsaUJBQVMsUUFtSnpCIiwic291cmNlc0NvbnRlbnQiOlsiLypcbiAqIENvcHlyaWdodCAyMDE5IEFtYXpvbi5jb20sIEluYy4gb3IgaXRzIGFmZmlsaWF0ZXMuIEFsbCBSaWdodHMgUmVzZXJ2ZWQuXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpLlxuICogWW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogQSBjb3B5IG9mIHRoZSBMaWNlbnNlIGlzIGxvY2F0ZWQgYXRcbiAqICAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogb3IgaW4gdGhlIFwibGljZW5zZVwiIGZpbGUgYWNjb21wYW55aW5nIHRoaXMgZmlsZS4gVGhpcyBmaWxlIGlzIGRpc3RyaWJ1dGVkXG4gKiBvbiBhbiBcIkFTIElTXCIgQkFTSVMsIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXJcbiAqIGV4cHJlc3Mgb3IgaW1wbGllZC4gU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nXG4gKiBwZXJtaXNzaW9ucyBhbmQgbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cblxuaW1wb3J0IHsgU3RyaW5ncyBhcyAkIH0gZnJvbSBcIi4uL2NvbnN0YW50cy9TdHJpbmdzXCI7XG5pbXBvcnQgeyBDb250cm9sSW5wdXQgfSBmcm9tICcuLi9jb250cm9scy9Db250cm9sSW5wdXQnO1xuaW1wb3J0IHsgdW5wYWNrU2luZ2xlVmFsdWVDb250cm9sSW50ZW50LCBTaW5nbGVWYWx1ZUNvbnRyb2xJbnRlbnQgfSBmcm9tICcuLi9pbnRlbnRzL1NpbmdsZVZhbHVlQ29udHJvbEludGVudCc7XG5pbXBvcnQgeyBJbnRlbnRSZXF1ZXN0LCBpbnRlcmZhY2VzLCBJbnRlbnQgfSBmcm9tICdhc2stc2RrLW1vZGVsJztcbmltcG9ydCB7IEFtYXpvbkludGVudCB9IGZyb20gJy4uL2ludGVudHMvQW1hem9uQnVpbHRJbkludGVudCc7XG5pbXBvcnQgeyBHZW5lcmFsQ29udHJvbEludGVudCwgdW5wYWNrR2VuZXJhbENvbnRyb2xJbnRlbnQgfSBmcm9tICcuLi9pbnRlbnRzL0dlbmVyYWxDb250cm9sSW50ZW50JztcblxuZXhwb3J0IG5hbWVzcGFjZSBJbnB1dFV0aWwge1xuXG4gICAgLyoqXG4gICAgICogVGVzdCBhbmQgYXNzZXJ0IGlmIGFuIG9iamVjdCBsb29rcyBsaWtlIGFuIEludGVudC5cbiAgICAgKiAodXNlci1kZWZpbmVkIHR5cGUgZ3VhcmQpXG4gICAgICovXG4gICAgZXhwb3J0IGZ1bmN0aW9uIGlzSW50ZW50U2hhcGUoeDogYW55KTogeCBpcyBJbnRlbnQge1xuICAgICAgICByZXR1cm4gKHgubmFtZSAhPT0gdW5kZWZpbmVkICYmIHguY29uZmlybWF0aW9uU3RhdHVzKTtcbiAgICB9XG5cbiAgICBleHBvcnQgZnVuY3Rpb24gaXNMYXVuY2hSZXF1ZXN0KGlucHV0OiBDb250cm9sSW5wdXQpIHtcbiAgICAgICAgcmV0dXJuIGlucHV0LnJlcXVlc3QudHlwZSA9PT0gJ0xhdW5jaFJlcXVlc3QnO1xuICAgIH1cblxuICAgIGV4cG9ydCBmdW5jdGlvbiBpc1Nlc3Npb25FbmRlZFJlcXVlc3QoaW5wdXQ6IENvbnRyb2xJbnB1dCkge1xuICAgICAgICByZXR1cm4gaW5wdXQucmVxdWVzdC50eXBlID09PSAnU2Vzc2lvbkVuZGVkUmVxdWVzdCc7XG4gICAgfVxuXG4gICAgZXhwb3J0IGZ1bmN0aW9uIGlzSW50ZW50KGlucHV0OiBDb250cm9sSW5wdXQsIGludGVudE5hbWU6IHN0cmluZykge1xuICAgICAgICByZXR1cm4gaW5wdXQucmVxdWVzdC50eXBlID09PSAnSW50ZW50UmVxdWVzdCcgJiYgaW5wdXQucmVxdWVzdC5pbnRlbnQubmFtZSA9PT0gaW50ZW50TmFtZTtcbiAgICB9XG5cbiAgICBleHBvcnQgZnVuY3Rpb24gaXNTaW5nbGVWYWx1ZUNvbnRyb2xJbnRlbnQoaW5wdXQ6IENvbnRyb2xJbnB1dCwgc2xvdFR5cGU6IHN0cmluZykge1xuICAgICAgICByZXR1cm4gaW5wdXQucmVxdWVzdC50eXBlID09PSAnSW50ZW50UmVxdWVzdCcgJiYgaW5wdXQucmVxdWVzdC5pbnRlbnQubmFtZSA9PT0gU2luZ2xlVmFsdWVDb250cm9sSW50ZW50LmludGVudE5hbWUoc2xvdFR5cGUpO1xuICAgIH1cblxuICAgIGV4cG9ydCBmdW5jdGlvbiBpc0ZhbGxiYWNrSW50ZW50KGlucHV0OiBDb250cm9sSW5wdXQpIHtcbiAgICAgICAgcmV0dXJuIGlucHV0LnJlcXVlc3QudHlwZSA9PT0gJ0ludGVudFJlcXVlc3QnICYmIGlucHV0LnJlcXVlc3QuaW50ZW50Lm5hbWUgPT09ICdBTUFaT04uRmFsbGJhY2tJbnRlbnQnO1xuICAgIH1cblxuXG4gICAgZXhwb3J0IGZ1bmN0aW9uIGlzQVBMVXNlckV2ZW50V2l0aEFyZ3MoaW5wdXQ6IENvbnRyb2xJbnB1dCk6IGJvb2xlYW4ge1xuICAgICAgICByZXR1cm4gaW5wdXQucmVxdWVzdC50eXBlID09PSAnQWxleGEuUHJlc2VudGF0aW9uLkFQTC5Vc2VyRXZlbnQnICYmIGlucHV0LnJlcXVlc3QuYXJndW1lbnRzICE9PSB1bmRlZmluZWQgJiYgaW5wdXQucmVxdWVzdC5hcmd1bWVudHMubGVuZ3RoID4gMDtcbiAgICB9XG5cblxuICAgIGV4cG9ydCBmdW5jdGlvbiBpc0FQTFVzZXJFdmVudFdpdGhNYXRjaGluZ0NvbnRyb2xJZChpbnB1dDogQ29udHJvbElucHV0LCBjb250cm9sSWQ6IHN0cmluZyk6IGJvb2xlYW4ge1xuICAgICAgICByZXR1cm4gaXNBUExVc2VyRXZlbnRXaXRoQXJncyhpbnB1dCkgJiYgKChpbnB1dC5yZXF1ZXN0IGFzIGludGVyZmFjZXMuYWxleGEucHJlc2VudGF0aW9uLmFwbC5Vc2VyRXZlbnQpLmFyZ3VtZW50cyFbMF0gPT09IGNvbnRyb2xJZCk7XG4gICAgfVxuXG4gICAgZXhwb3J0IGZ1bmN0aW9uIGZlZWRiYWNrSXNUcnVlKGZlZWRiYWNrOiBzdHJpbmcgfCB1bmRlZmluZWQpOiBib29sZWFuIHtcbiAgICAgICAgcmV0dXJuIChmZWVkYmFjayA9PT0gJC5GZWVkYmFjay5BZmZpcm0pO1xuICAgIH1cblxuICAgIGV4cG9ydCBmdW5jdGlvbiBmZWVkYmFja0lzRmFsc2UoZmVlZGJhY2s6IHN0cmluZyB8IHVuZGVmaW5lZCk6IGJvb2xlYW4ge1xuICAgICAgICByZXR1cm4gKGZlZWRiYWNrID09PSAkLkZlZWRiYWNrLkRpc2FmZmlybSk7XG4gICAgfVxuXG4gICAgZXhwb3J0IGZ1bmN0aW9uIGZlZWRiYWNrSXNVbmRlZmluZWQoZmVlZGJhY2s6IHN0cmluZyB8IHVuZGVmaW5lZCk6IGJvb2xlYW4ge1xuICAgICAgICByZXR1cm4gKGZlZWRiYWNrID09PSB1bmRlZmluZWQpO1xuICAgIH1cblxuICAgIGV4cG9ydCBmdW5jdGlvbiBmZWVkYmFja0lzTWF0Y2hPclVuZGVmaW5lZChmZWVkYmFjazogc3RyaW5nIHwgdW5kZWZpbmVkLCBmZWVkYmFja0lkczogc3RyaW5nW10pOiBib29sZWFuIHtcbiAgICAgICAgcmV0dXJuIHNsb3RJc1VuZGVmaW5lZE9yTWF0Y2goZmVlZGJhY2ssIGZlZWRiYWNrSWRzKTtcbiAgICB9XG5cbiAgICBleHBvcnQgZnVuY3Rpb24gc2xvdElzVW5kZWZpbmVkT3JNYXRjaChzbG90VmFsdWU6IHN0cmluZyB8IHVuZGVmaW5lZCwgZXhwZWN0ZWRWYWx1ZXM6IHN0cmluZ1tdKTogYm9vbGVhbiB7XG4gICAgICAgIHJldHVybiBzbG90VmFsdWUgPT09IHVuZGVmaW5lZCB8fCBleHBlY3RlZFZhbHVlcy5pbmNsdWRlcyhzbG90VmFsdWUpO1xuICAgIH1cblxuXG4gICAgZXhwb3J0IGZ1bmN0aW9uIGFjdGlvbklzU2V0T3JVbmRlZmluZWQoYWN0aW9uOiBzdHJpbmcgfCB1bmRlZmluZWQsIHNsb3RWYWx1ZUlkc0ZvclNldDogc3RyaW5nW10pOiBib29sZWFuIHtcbiAgICAgICAgcmV0dXJuIHNsb3RJc1VuZGVmaW5lZE9yTWF0Y2goYWN0aW9uLCBzbG90VmFsdWVJZHNGb3JTZXQpO1xuICAgIH1cblxuXG4gICAgZXhwb3J0IGZ1bmN0aW9uIGFjdGlvbklzTWF0Y2goYWN0aW9uOiBzdHJpbmcgfCB1bmRlZmluZWQsIHNsb3RWYWx1ZUlkc0ZvckNoYW5nZTogc3RyaW5nW10pOiBib29sZWFuIHtcbiAgICAgICAgcmV0dXJuIGFjdGlvbiAhPT0gdW5kZWZpbmVkICYmIHNsb3RWYWx1ZUlkc0ZvckNoYW5nZS5pbmNsdWRlcyhhY3Rpb24pO1xuICAgIH1cblxuICAgIGV4cG9ydCBmdW5jdGlvbiBhY3Rpb25Jc1VuZGVmaW5lZChhY3Rpb246IHN0cmluZyB8IHVuZGVmaW5lZCk6IGJvb2xlYW4ge1xuICAgICAgICByZXR1cm4gYWN0aW9uID09PSB1bmRlZmluZWQ7XG4gICAgfVxuXG4gICAgZXhwb3J0IGZ1bmN0aW9uIHRhcmdldElzTWF0Y2godGFyZ2V0OiBzdHJpbmcgfCB1bmRlZmluZWQsIHRhcmdldElkczogc3RyaW5nW10pOiBib29sZWFuIHtcbiAgICAgICAgcmV0dXJuIHRhcmdldCAhPT0gdW5kZWZpbmVkICYmIHRhcmdldElkcy5pbmNsdWRlcyh0YXJnZXQpO1xuICAgIH1cblxuICAgIGV4cG9ydCBmdW5jdGlvbiB0YXJnZXRJc1VuZGVmaW5lZCh0YXJnZXQ6IHN0cmluZyB8IHVuZGVmaW5lZCk6IGJvb2xlYW4ge1xuICAgICAgICByZXR1cm4gdGFyZ2V0ID09PSB1bmRlZmluZWQ7XG4gICAgfVxuXG4gICAgZXhwb3J0IGZ1bmN0aW9uIHRhcmdldElzTWF0Y2hPclVuZGVmaW5lZCh0YXJnZXQ6IHN0cmluZyB8IHVuZGVmaW5lZCwgdGFyZ2V0SWRzOiBzdHJpbmdbXSk6IGJvb2xlYW4ge1xuICAgICAgICByZXR1cm4gc2xvdElzVW5kZWZpbmVkT3JNYXRjaCh0YXJnZXQsIHRhcmdldElkcyk7XG4gICAgfVxuXG5cbiAgICBleHBvcnQgZnVuY3Rpb24gYWN0aW9uSXNNYXRjaE9yVW5kZWZpbmVkKGFjdGlvbjogc3RyaW5nIHwgdW5kZWZpbmVkLCBhY3Rpb25JZHM6IHN0cmluZ1tdKTogYm9vbGVhbiB7XG4gICAgICAgIHJldHVybiBzbG90SXNVbmRlZmluZWRPck1hdGNoKGFjdGlvbiwgYWN0aW9uSWRzKTtcbiAgICB9XG5cblxuICAgIGV4cG9ydCBmdW5jdGlvbiB2YWx1ZVR5cGVNYXRjaCh2YWx1ZVR5cGU6IHN0cmluZyB8IHVuZGVmaW5lZCwgZXhwZWN0ZWRWYWx1ZVR5cGU6IHN0cmluZyk6IGJvb2xlYW4ge1xuICAgICAgICByZXR1cm4gdmFsdWVUeXBlICE9PSB1bmRlZmluZWQgJiYgdmFsdWVUeXBlID09PSBleHBlY3RlZFZhbHVlVHlwZTtcbiAgICB9XG5cblxuICAgIGV4cG9ydCBmdW5jdGlvbiB2YWx1ZVR5cGVJc1VuZGVmaW5lZCh2YWx1ZVR5cGU6IHN0cmluZyB8IHVuZGVmaW5lZCk6IGJvb2xlYW4ge1xuICAgICAgICByZXR1cm4gdmFsdWVUeXBlID09PSB1bmRlZmluZWQ7XG4gICAgfVxuXG5cbiAgICBleHBvcnQgZnVuY3Rpb24gdmFsdWVTdHJEZWZpbmVkKHZhbHVlU3RyOiBzdHJpbmcgfCB1bmRlZmluZWQpOiBib29sZWFuIHtcbiAgICAgICAgcmV0dXJuIHZhbHVlU3RyICE9PSB1bmRlZmluZWQgJiYgdmFsdWVTdHIgIT09ICc/JzsgLy8gPyBpcyBwcm9kdWNlZCBpZiBTbG90RWxpY2l0YXRpb24gb24gYnV0IHZhbHVlIGNhbid0IGJlIHBhcnNlZC5cbiAgICB9XG5cblxuICAgIGV4cG9ydCBmdW5jdGlvbiB2YWx1ZVN0cklzVW5kZWZpbmVkKHZhbHVlU3RyOiBzdHJpbmcgfCB1bmRlZmluZWQpOiBib29sZWFuIHtcbiAgICAgICAgcmV0dXJuIHZhbHVlU3RyID09PSB1bmRlZmluZWQgfHwgdmFsdWVTdHIgPT09ICc/JzsgLy8gPyBpcyBwcm9kdWNlZCBpZiBTbG90RWxpY2l0YXRpb24gb24gYnV0IHZhbHVlIGNhbid0IGJlIHBhcnNlZC5cbiAgICB9XG5cbiAgICBleHBvcnQgZnVuY3Rpb24gaXNCYXJlWWVzKGlucHV0OiBDb250cm9sSW5wdXQpIHtcbiAgICAgICAgaWYgKGlucHV0LnJlcXVlc3QudHlwZSAhPT0gJ0ludGVudFJlcXVlc3QnKSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoaW5wdXQucmVxdWVzdC5pbnRlbnQubmFtZSA9PT0gQW1hem9uSW50ZW50Llllc0ludGVudCkge1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoaW5wdXQucmVxdWVzdC5pbnRlbnQubmFtZSA9PT0gR2VuZXJhbENvbnRyb2xJbnRlbnQubmFtZSkge1xuICAgICAgICAgICAgY29uc3QgeyBmZWVkYmFjaywgYWN0aW9uLCB0YXJnZXQgfSA9IHVucGFja0dlbmVyYWxDb250cm9sSW50ZW50KChpbnB1dC5yZXF1ZXN0IGFzIEludGVudFJlcXVlc3QpLmludGVudCk7XG4gICAgICAgICAgICBpZiAoZmVlZGJhY2sgPT09ICQuRmVlZGJhY2suQWZmaXJtICYmIGFjdGlvbiA9PT0gdW5kZWZpbmVkICYmIHRhcmdldCA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgIGV4cG9ydCBmdW5jdGlvbiBpc0JhcmVObyhpbnB1dDogQ29udHJvbElucHV0KSB7XG4gICAgICAgIGlmIChpbnB1dC5yZXF1ZXN0LnR5cGUgIT09ICdJbnRlbnRSZXF1ZXN0Jykge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKGlucHV0LnJlcXVlc3QuaW50ZW50Lm5hbWUgPT09IEFtYXpvbkludGVudC5Ob0ludGVudCkge1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoaW5wdXQucmVxdWVzdC5pbnRlbnQubmFtZSA9PT0gR2VuZXJhbENvbnRyb2xJbnRlbnQubmFtZSkge1xuICAgICAgICAgICAgY29uc3QgeyBmZWVkYmFjaywgYWN0aW9uLCB0YXJnZXQgfSA9IHVucGFja0dlbmVyYWxDb250cm9sSW50ZW50KChpbnB1dC5yZXF1ZXN0IGFzIEludGVudFJlcXVlc3QpLmludGVudCk7XG4gICAgICAgICAgICBpZiAoZmVlZGJhY2sgPT09ICQuRmVlZGJhY2suRGlzYWZmaXJtICYmIGFjdGlvbiA9PT0gdW5kZWZpbmVkICYmIHRhcmdldCA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgIGV4cG9ydCBmdW5jdGlvbiBnZXRWYWx1ZVJlc29sdXRpb24oaW5wdXQ6IENvbnRyb2xJbnB1dCk6IHsgdmFsdWVTdHI6IHN0cmluZywgZXJNYXRjaDogYm9vbGVhbiB9IHtcbiAgICAgICAgY29uc3QgeyB2YWx1ZVN0ciwgZXJNYXRjaCB9ID0gdW5wYWNrU2luZ2xlVmFsdWVDb250cm9sSW50ZW50KChpbnB1dC5yZXF1ZXN0IGFzIEludGVudFJlcXVlc3QpLmludGVudCk7XG4gICAgICAgIHJldHVybiB7IHZhbHVlU3RyOiB2YWx1ZVN0ciEsIGVyTWF0Y2g6IGVyTWF0Y2ghIH07XG4gICAgfVxufVxuIl19