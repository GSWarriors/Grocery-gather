"use strict";
/*
 * Copyright 2019 Amazon.com, Inc. or its affiliates. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License").
 * You may not use this file except in compliance with the License.
 * A copy of the License is located at
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * or in the "license" file accompanying this file. This file is distributed
 * on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either
 * express or implied. See the License for the specific language governing
 * permissions and limitations under the License.
 */
Object.defineProperty(exports, "__esModule", { value: true });
exports.GameManager = void 0;
const chai_1 = require("chai");
const mocha_1 = require("mocha");
const src_1 = require("../src");
const Strings_1 = require("../src/constants/Strings");
const ControlManager_1 = require("../src/controls/ControlManager");
const GeneralControlIntent_1 = require("../src/intents/GeneralControlIntent");
const OrdinalControlIntent_1 = require("../src/intents/OrdinalControlIntent");
const ControlHandler_1 = require("../src/runtime/ControlHandler");
const SessionBehavior_1 = require("../src/runtime/SessionBehavior");
const InitiativeActs_1 = require("../src/systemActs/InitiativeActs");
const InputUtil_1 = require("../src/utils/InputUtil");
const IntentUtils_1 = require("../src/utils/IntentUtils");
const SkillInvoker_1 = require("../src/utils/testSupport/SkillInvoker");
const SkillWrapper_1 = require("../src/utils/testSupport/SkillWrapper");
const TestingUtils_1 = require("../src/utils/testSupport/TestingUtils");
const game_strings_1 = require("./game_strings");
TestingUtils_1.waitForDebugger();
mocha_1.suite("== game_e2e.ts ==", () => {
    mocha_1.suite("== demo game UI, directly hitting coreProcess() ==", () => {
        mocha_1.test("direct set a few values across player and pet containers", async () => {
            const rootControl = new GameManager().createControlTree();
            const result1 = await TestingUtils_1.simpleInvoke(rootControl, TestingUtils_1.TestInput.of(src_1.SingleValueControlIntent.of('CUSTOM.name', { 'action': Strings_1.Strings.Action.Set, 'target': game_strings_1.GameStrings.Target.Name, 'CUSTOM.name': "Mike" })));
            const result2 = await TestingUtils_1.simpleInvoke(rootControl, TestingUtils_1.TestInput.of(src_1.SingleValueControlIntent.of(src_1.AmazonBuiltInSlotType.NUMBER, { 'action': Strings_1.Strings.Action.Set, 'target': game_strings_1.GameStrings.Target.Age, 'AMAZON.NUMBER': "20" })));
            const result3 = await TestingUtils_1.simpleInvoke(rootControl, TestingUtils_1.TestInput.of(src_1.SingleValueControlIntent.of('PlayerClass', { action: Strings_1.Strings.Action.Set, target: game_strings_1.GameStrings.Target.CharClass, PlayerClass: 'elf' })));
            chai_1.expect(result3.acts).length(2);
            chai_1.expect(result3.acts[0]).instanceOf(src_1.ValueSetAct);
            chai_1.expect(result3.acts[1]).instanceOf(InitiativeActs_1.RequestValueByListAct);
            chai_1.expect(result3.acts[1].control.id).equals(game_strings_1.GameStrings.ID.PetSpecies);
            const result4 = await TestingUtils_1.simpleInvoke(rootControl, TestingUtils_1.TestInput.of(src_1.SingleValueControlIntent.of('PetSpecies', { action: Strings_1.Strings.Action.Set, target: game_strings_1.GameStrings.Target.Species, PetSpecies: 'cat' })));
            const result5 = await TestingUtils_1.simpleInvoke(rootControl, TestingUtils_1.TestInput.of(src_1.SingleValueControlIntent.of('CUSTOM.name', { 'action': Strings_1.Strings.Action.Set, 'target': game_strings_1.GameStrings.Target.PetName, 'CUSTOM.name': "Coco" })));
            chai_1.expect(result5.acts).length(1);
            chai_1.expect(result5.acts[0]).instanceOf(src_1.ValueSetAct);
            chai_1.expect(result5.sessionBehavior).equals(SessionBehavior_1.SessionBehavior.OPEN);
            chai_1.expect(TestingUtils_1.findControlById(rootControl, game_strings_1.GameStrings.ID.PetName).state.value).eq("Coco");
        });
        mocha_1.test("request class value (by list)", async () => {
            const rootControl = new GameManager().createControlTree();
            const result1 = await TestingUtils_1.simpleInvoke(rootControl, TestingUtils_1.TestInput.of(GeneralControlIntent_1.GeneralControlIntent.of({ action: Strings_1.Strings.Action.Set, target: game_strings_1.GameStrings.Target.CharClass })));
            chai_1.expect(result1.acts).length(1);
            chai_1.expect(result1.acts[0]).instanceOf(InitiativeActs_1.RequestValueByListAct);
            const result2 = await TestingUtils_1.simpleInvoke(rootControl, TestingUtils_1.TestInput.of(src_1.SingleValueControlIntent.of('PlayerClass', { action: Strings_1.Strings.Action.Set, target: game_strings_1.GameStrings.Target.CharClass, PlayerClass: game_strings_1.GameStrings.Value.Elf })));
            chai_1.expect(result2.acts).length(2);
            chai_1.expect(result2.acts[0]).instanceOf(src_1.ValueSetAct);
            chai_1.expect(result2.acts[1]).instanceOf(src_1.RequestValueAct);
            chai_1.expect(result2.acts[1].control.id).equal(game_strings_1.GameStrings.ID.PlayerName);
        });
        mocha_1.test("custom intent setting multiple values via MultiValueContainerControl", async () => {
            const rootControl = new GameManager().createControlTree();
            const input = TestingUtils_1.TestInput.of(IntentUtils_1.IntentBuilder.of("MySetPlayerIntent", {
                name: "Mike",
                class: "human",
                age: "20"
            }));
            const result = await TestingUtils_1.simpleInvoke(rootControl, input);
            chai_1.expect(result.acts).length(1);
            chai_1.expect(result.acts[0]).instanceOf(InitiativeActs_1.RequestValueByListAct);
            chai_1.expect(result.acts[0].control.id).equals(game_strings_1.GameStrings.ID.PetSpecies);
            chai_1.expect(result.sessionBehavior).equals(SessionBehavior_1.SessionBehavior.OPEN);
        });
        mocha_1.test("Set and Change a player name, check act generations due to validation fails", async () => {
            const rootControl = new GameManager().createControlTree();
            const result1 = await TestingUtils_1.simpleInvoke(rootControl, TestingUtils_1.TestInput.of(src_1.SingleValueControlIntent.of('CUSTOM.name', { 'action': Strings_1.Strings.Action.Set, 'target': game_strings_1.GameStrings.Target.Name, 'CUSTOM.name': "Mike" })));
            const result2 = await TestingUtils_1.simpleInvoke(rootControl, TestingUtils_1.TestInput.of(src_1.SingleValueControlIntent.of('CUSTOM.name', { 'action': Strings_1.Strings.Action.Change, 'target': game_strings_1.GameStrings.Target.Name, 'CUSTOM.name': "Alexa" })));
            chai_1.expect(result2.acts).length(2);
            chai_1.expect(result2.acts[0]).instanceOf(src_1.InvalidValueAct);
            chai_1.expect(result2.acts[1]).instanceOf(src_1.RequestChangedValueAct);
        });
        mocha_1.test("User selection of player class by choices number", async () => {
            const rootControl = new GameManager().createControlTree();
            const result1 = await TestingUtils_1.simpleInvoke(rootControl, TestingUtils_1.TestInput.of(GeneralControlIntent_1.GeneralControlIntent.of({ action: Strings_1.Strings.Action.Set, target: game_strings_1.GameStrings.Target.CharClass })));
            chai_1.expect(result1.acts).length(1);
            chai_1.expect(result1.acts[0]).instanceOf(InitiativeActs_1.RequestValueByListAct);
            const result2 = await TestingUtils_1.simpleInvoke(rootControl, TestingUtils_1.TestInput.of(OrdinalControlIntent_1.OrdinalControlIntent.of({ "action": Strings_1.Strings.Action.Select, "target": game_strings_1.GameStrings.Target.CharClass, 'AMAZON.Ordinal': '3' })));
            chai_1.expect(result2.acts[0].control.id).equal(game_strings_1.GameStrings.ID.PlayerClass);
            chai_1.expect(TestingUtils_1.findControlById(rootControl, game_strings_1.GameStrings.ID.PlayerClass).state.value).eq(game_strings_1.GameStrings.Value.Human);
        });
    });
    mocha_1.suite("== demo game UI, e2e with SPI, serde  ==", () => {
        mocha_1.test("e2e", async () => {
            const requestHandler = new ControlHandler_1.ControlHandler(new GameManager());
            const skill = new SkillInvoker_1.SkillInvoker(SkillWrapper_1.wrapRequestHandlerAsSkill(requestHandler));
            let response;
            response = await skill.invoke(TestingUtils_1.TestInput.of(src_1.SingleValueControlIntent.of('CUSTOM.name', { 'action': Strings_1.Strings.Action.Set, 'target': game_strings_1.GameStrings.Target.Name, 'CUSTOM.name': "Alexa" })));
            chai_1.expect(response.prompt).equals("Sorry, Alexa is not a valid choice because playerName Validation Failed What is your avatar's name?");
            response = await skill.invoke(TestingUtils_1.TestInput.of(src_1.SingleValueControlIntent.of('CUSTOM.name', { 'action': Strings_1.Strings.Action.Set, 'target': game_strings_1.GameStrings.Target.Name, 'CUSTOM.name': "Mike" })));
            chai_1.expect(response.prompt).equals("OK, Mike. How old is your avatar?");
            response = await skill.invoke(TestingUtils_1.TestInput.of(src_1.SingleValueControlIntent.of(src_1.AmazonBuiltInSlotType.NUMBER, { 'AMAZON.NUMBER': "25" })));
            chai_1.expect(response.prompt).equals("Hey, that's my age! Will you be an elf, a dwarf or a human?"); // control specific NLG for feedback
            response = await skill.invoke(TestingUtils_1.TestInput.of(src_1.SingleValueControlIntent.of(src_1.AmazonBuiltInSlotType.NUMBER, { 'action': Strings_1.Strings.Action.Change, 'target': game_strings_1.GameStrings.Target.Age, 'AMAZON.NUMBER': "24" })));
            chai_1.expect(response.prompt).equals("Cool. Will you be an elf, a dwarf or a human?"); // control specific NLG for feedback
            response = await skill.invoke(TestingUtils_1.TestInput.of(src_1.SingleValueControlIntent.of('PlayerClass', { PlayerClass: "Hobbit" })));
            chai_1.expect(response.prompt).equals("Sorry, Hobbit is not a valid choice because playerClass validation Failed Will you be an elf, a dwarf or a human?");
            response = await skill.invoke(TestingUtils_1.TestInput.of(src_1.SingleValueControlIntent.of('PlayerClass', { PlayerClass: 'elf' })));
            chai_1.expect(response.prompt).equals("Got it. Will your pet be a cat or dog?");
            response = await skill.invoke(TestingUtils_1.TestInput.of(src_1.SingleValueControlIntent.of('PetSpecies', { PetSpecies: 'cat' })));
            chai_1.expect(response.prompt).equals("OK, cat. What shall we name your cat?"); // contextual NLG.  lambda picking up value of "pet species"
        });
    });
});
class GameManager extends ControlManager_1.ControlManager {
    createControlTree(state, input) {
        const topControl = new src_1.ContainerControl({ id: game_strings_1.GameStrings.ID.GameContainer });
        // --- Player
        const playerContainer = new PlayerContainer({ id: game_strings_1.GameStrings.ID.PlayerContainer });
        topControl.addChild(playerContainer);
        // --- Pet
        const petContainer = new src_1.ContainerControl({ id: game_strings_1.GameStrings.ID.PetContainer });
        topControl.addChild(petContainer);
        petContainer.addChild(new src_1.ListControl({
            id: game_strings_1.GameStrings.ID.PetSpecies,
            listItemIDs: this.getPetSpecies(),
            slotType: 'PetSpecies',
            validation: [(state, input) => this.getPetSpecies().includes(state.value) ? true : { renderedReason: 'petSpecies validation failed' }],
            prompts: {
                requestValue: "Will your pet be a cat or dog?"
            },
            interactionModel: { targets: [game_strings_1.GameStrings.Target.Species] }
        })).addChild(new src_1.ValueControl({
            id: game_strings_1.GameStrings.ID.PetName,
            slotType: 'CUSTOM.name',
            prompts: {
                requestValue: (act, input) => { var _a; return `What shall we name your ${(_a = input.controls[game_strings_1.GameStrings.ID.PetSpecies].state.value) !== null && _a !== void 0 ? _a : 'pet'}?`; }
            },
            interactionModel: { targets: [game_strings_1.GameStrings.Target.Name, game_strings_1.GameStrings.Target.PetName] }
        }));
        return topControl;
    }
    getPetSpecies() {
        return [game_strings_1.GameStrings.Value.Cat, game_strings_1.GameStrings.Target.Species, game_strings_1.GameStrings.Value.Dog, game_strings_1.GameStrings.Target.Species];
    }
}
exports.GameManager = GameManager;
class PlayerContainer extends src_1.ContainerControl {
    constructor(props) {
        super(props);
        this.playerNameControl = new src_1.ValueControl({
            id: game_strings_1.GameStrings.ID.PlayerName,
            slotType: 'CUSTOM.name',
            validation: [(state, input) => ['Mike', 'Dave'].includes(state.value) ? true : { renderedReason: 'playerName Validation Failed' }],
            prompts: {
                requestValue: "What is your avatar's name?",
            },
            interactionModel: { targets: [game_strings_1.GameStrings.Target.Name, game_strings_1.GameStrings.Target.AvatarName] }
        });
        this.playerAgeControl = new src_1.NumberControl({
            id: game_strings_1.GameStrings.ID.PlayerAge,
            prompts: {
                requestValue: "How old is your avatar?",
                valueSet: act => act.payload.value === 25 ? "Hey, that's my age!" : 'Cool.',
            },
            interactionModel: { targets: [game_strings_1.GameStrings.Target.Age] }
        });
        this.playerClassControl = new src_1.ListControl({
            id: game_strings_1.GameStrings.ID.PlayerClass,
            listItemIDs: this.getPlayerClass(),
            slotType: 'PlayerClass',
            validation: [(state, input) => this.getPlayerClass().includes(state.value) ? true : { renderedReason: 'playerClass validation Failed' }],
            prompts: {
                requestValue: "Will you be an elf, a dwarf or a human?",
                valueSet: 'Got it.'
            },
            interactionModel: { targets: [game_strings_1.GameStrings.Target.CharClass] }
        });
        this.addChild(this.playerNameControl)
            .addChild(this.playerAgeControl)
            .addChild(this.playerClassControl);
    }
    getPlayerClass() {
        return [game_strings_1.GameStrings.Value.Elf, game_strings_1.GameStrings.Value.Dwarf, game_strings_1.GameStrings.Value.Human];
    }
    async canHandle(input) {
        return InputUtil_1.InputUtil.isIntent(input, 'MySetPlayerIntent')
            || this.canHandleByChild(input);
    }
    async handle(input, resultBuilder) {
        if (InputUtil_1.InputUtil.isIntent(input, 'MySetPlayerIntent')) {
            const intent = IntentUtils_1.SimplifiedIntent.fromIntent(input.request.intent);
            if (intent.slotResolutions.name !== undefined) {
                const nameSlotResolution = intent.slotResolutions.name;
                this.playerNameControl.setValue(nameSlotResolution.slotValue, nameSlotResolution.isEntityResolutionMatch);
            }
            if (intent.slotResolutions.age !== undefined) {
                const ageSlotResolution = intent.slotResolutions.age;
                this.playerAgeControl.setValue(Number.parseInt(ageSlotResolution.slotValue, 10));
            }
            if (intent.slotResolutions.class !== undefined) {
                const classSlotResolution = intent.slotResolutions.class;
                this.playerClassControl.setValue(classSlotResolution.slotValue, classSlotResolution.isEntityResolutionMatch);
            }
            return;
        }
        return this.handleByChild(input, resultBuilder);
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZ2FtZV9lMmUuc3BlYy5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uL3Rlc3QvZ2FtZV9lMmUuc3BlYy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUE7Ozs7Ozs7Ozs7O0dBV0c7OztBQUdILCtCQUE4QjtBQUM5QixpQ0FBb0M7QUFDcEMsZ0NBR2dCO0FBQ2hCLHNEQUF3RDtBQUV4RCxtRUFBZ0U7QUFDaEUsOEVBQTJFO0FBQzNFLDhFQUEyRTtBQUMzRSxrRUFBK0Q7QUFDL0Qsb0VBQWlFO0FBQ2pFLHFFQUF5RTtBQUN6RSxzREFBbUQ7QUFDbkQsMERBQTJFO0FBQzNFLHdFQUFxRTtBQUNyRSx3RUFBa0Y7QUFDbEYsd0VBQWtIO0FBQ2xILGlEQUFtRDtBQUduRCw4QkFBZSxFQUFFLENBQUM7QUFFbEIsYUFBSyxDQUFDLG1CQUFtQixFQUFFLEdBQUcsRUFBRTtJQUM1QixhQUFLLENBQUMsb0RBQW9ELEVBQUUsR0FBRyxFQUFFO1FBQzdELFlBQUksQ0FBQywwREFBMEQsRUFBRSxLQUFLLElBQUksRUFBRTtZQUN4RSxNQUFNLFdBQVcsR0FBRyxJQUFJLFdBQVcsRUFBRSxDQUFDLGlCQUFpQixFQUFFLENBQUM7WUFFMUQsTUFBTSxPQUFPLEdBQUcsTUFBTSwyQkFBWSxDQUFDLFdBQVcsRUFBRSx3QkFBUyxDQUFDLEVBQUUsQ0FBQyw4QkFBd0IsQ0FBQyxFQUFFLENBQUMsYUFBYSxFQUFFLEVBQUUsUUFBUSxFQUFFLGlCQUFDLENBQUMsTUFBTSxDQUFDLEdBQUcsRUFBRSxRQUFRLEVBQUUsMEJBQUUsQ0FBQyxNQUFNLENBQUMsSUFBSSxFQUFFLGFBQWEsRUFBRSxNQUFNLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUN2TCxNQUFNLE9BQU8sR0FBRyxNQUFNLDJCQUFZLENBQUMsV0FBVyxFQUFFLHdCQUFTLENBQUMsRUFBRSxDQUFDLDhCQUF3QixDQUFDLEVBQUUsQ0FBQywyQkFBcUIsQ0FBQyxNQUFNLEVBQUUsRUFBRSxRQUFRLEVB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QUMsZUFBZSxDQUFDLEdBQUcsQ0FBQztnQkFDckQsSUFBSSxDQUFDLGdCQUFnQixDQUFDLFFBQVEsQ0FBQyxNQUFNLENBQUMsUUFBUSxDQUFDLGlCQUFpQixDQUFDLFNBQVMsRUFBRSxFQUFFLENBQUMsQ0FBQyxDQUFDO2FBQ3BGO1lBQ0QsSUFBSSxNQUFNLENBQUMsZUFBZSxDQUFDLEtBQUssS0FBSyxTQUFTLEVBQUU7Z0JBQzVDLE1BQU0sbUJBQW1CLEdBQUcsTUFBTSxDQUFDLGVBQWUsQ0FBQyxLQUFLLENBQUM7Z0JBQ3pELElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxRQUFRLENBQUMsbUJBQW1CLENBQUMsU0FBUyxFQUFFLG1CQUFtQixDQUFDLHVCQUF1QixDQUFDLENBQUM7YUFDaEg7WUFDRCxPQUFPO1NBQ1Y7UUFDRCxPQUFPLElBQUksQ0FBQyxhQUFhLENBQUMsS0FBSyxFQUFFLGFBQWEsQ0FBQyxDQUFDO0lBQ3BELENBQUM7Q0FDSiIsInNvdXJjZXNDb250ZW50IjpbIi8qXG4gKiBDb3B5cmlnaHQgMjAxOSBBbWF6b24uY29tLCBJbmMuIG9yIGl0cyBhZmZpbGlhdGVzLiBBbGwgUmlnaHRzIFJlc2VydmVkLlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKS5cbiAqIFlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIEEgY29weSBvZiB0aGUgTGljZW5zZSBpcyBsb2NhdGVkIGF0XG4gKiAgICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIG9yIGluIHRoZSBcImxpY2Vuc2VcIiBmaWxlIGFjY29tcGFueWluZyB0aGlzIGZpbGUuIFRoaXMgZmlsZSBpcyBkaXN0cmlidXRlZFxuICogb24gYW4gXCJBUyBJU1wiIEJBU0lTLCBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyXG4gKiBleHByZXNzIG9yIGltcGxpZWQuIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZ1xuICogcGVybWlzc2lvbnMgYW5kIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG5cbmltcG9ydCB7IEludGVudFJlcXVlc3QgfSBmcm9tICdhc2stc2RrLW1vZGVsJztcbmltcG9ydCB7IGV4cGVjdCB9IGZyb20gXCJjaGFpXCI7XG5pbXBvcnQgeyBzdWl0ZSwgdGVzdCB9IGZyb20gXCJtb2NoYVwiO1xuaW1wb3J0IHtcbiAgICBBbWF6b25CdWlsdEluU2xvdFR5cGUsIENvbnRhaW5lckNvbnRyb2wsIENvbnRhaW5lckNvbnRyb2xQcm9wcywgQ29udHJvbCwgQ29udHJvbFJlc3VsdEJ1aWxkZXIsIEludmFsaWRWYWx1ZUFjdCwgTGlzdENvbnRyb2wsXG4gICAgTnVtYmVyQ29udHJvbCwgUmVxdWVzdENoYW5nZWRWYWx1ZUFjdCwgUmVxdWVzdFZhbHVlQWN0LCBTaW5nbGVWYWx1ZUNvbnRyb2xJbnRlbnQsIFN5c3RlbUFjdCwgVmFsdWVDb250cm9sLCBWYWx1ZVNldEFjdFxufSBmcm9tICcuLi9zcmMnO1xuaW1wb3J0IHsgU3RyaW5ncyBhcyAkIH0gZnJvbSBcIi4uL3NyYy9jb25zdGFudHMvU3RyaW5nc1wiO1xuaW1wb3J0IHsgQ29udHJvbElucHV0IH0gZnJvbSAnLi4vc3JjL2NvbnRyb2xzL0NvbnRyb2xJbnB1dCc7XG5pbXBvcnQgeyBDb250cm9sTWFuYWdlciB9IGZyb20gJy4uL3NyYy9jb250cm9scy9Db250cm9sTWFuYWdlcic7XG5pbXBvcnQgeyBHZW5lcmFsQ29udHJvbEludGVudCB9IGZyb20gJy4uL3NyYy9pbnRlbnRzL0dlbmVyYWxDb250cm9sSW50ZW50JztcbmltcG9ydCB7IE9yZGluYWxDb250cm9sSW50ZW50IH0gZnJvbSAnLi4vc3JjL2ludGVudHMvT3JkaW5hbENvbnRyb2xJbnRlbnQnO1xuaW1wb3J0IHsgQ29udHJvbEhhbmRsZXIgfSBmcm9tICcuLi9zcmMvcnVudGltZS9Db250cm9sSGFuZGxlcic7XG5pbXBvcnQgeyBTZXNzaW9uQmVoYXZpb3IgfSBmcm9tICcuLi9zcmMvcnVudGltZS9TZXNzaW9uQmVoYXZpb3InO1xuaW1wb3J0IHsgUmVxdWVzdFZhbHVlQnlMaXN0QWN0IH0gZnJvbSBcIi4uL3NyYy9zeXN0ZW1BY3RzL0luaXRpYXRpdmVBY3RzXCI7XG5pbXBvcnQgeyBJbnB1dFV0aWwgfSBmcm9tIFwiLi4vc3JjL3V0aWxzL0lucHV0VXRpbFwiO1xuaW1wb3J0IHsgSW50ZW50QnVpbGRlciwgU2ltcGxpZmllZEludGVudCB9IGZyb20gJy4uL3NyYy91dGlscy9JbnRlbnRVdGlscyc7XG5pbXBvcnQgeyBTa2lsbEludm9rZXIgfSBmcm9tICcuLi9zcmMvdXRpbHMvdGVzdFN1cHBvcnQvU2tpbGxJbnZva2VyJztcbmltcG9ydCB7IHdyYXBSZXF1ZXN0SGFuZGxlckFzU2tpbGwgfSBmcm9tICcuLi9zcmMvdXRpbHMvdGVzdFN1cHBvcnQvU2tpbGxXcmFwcGVyJztcbmltcG9ydCB7IGZpbmRDb250cm9sQnlJZCwgc2ltcGxlSW52b2tlLCBUZXN0SW5wdXQsIHdhaXRGb3JEZWJ1Z2dlciB9IGZyb20gJy4uL3NyYy91dGlscy90ZXN0U3VwcG9ydC9UZXN0aW5nVXRpbHMnO1xuaW1wb3J0IHsgR2FtZVN0cmluZ3MgYXMgJCQgfSBmcm9tIFwiLi9nYW1lX3N0cmluZ3NcIjtcblxuXG53YWl0Rm9yRGVidWdnZXIoKTtcblxuc3VpdGUoXCI9PSBnYW1lX2UyZS50cyA9PVwiLCAoKSA9PiB7XG4gICAgc3VpdGUoXCI9PSBkZW1vIGdhbWUgVUksIGRpcmVjdGx5IGhpdHRpbmcgY29yZVByb2Nlc3MoKSA9PVwiLCAoKSA9PiB7XG4gICAgICAgIHRlc3QoXCJkaXJlY3Qgc2V0IGEgZmV3IHZhbHVlcyBhY3Jvc3MgcGxheWVyIGFuZCBwZXQgY29udGFpbmVyc1wiLCBhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCByb290Q29udHJvbCA9IG5ldyBHYW1lTWFuYWdlcigpLmNyZWF0ZUNvbnRyb2xUcmVlKCk7XG5cbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdDEgPSBhd2FpdCBzaW1wbGVJbnZva2Uocm9vdENvbnRyb2wsIFRlc3RJbnB1dC5vZihTaW5nbGVWYWx1ZUNvbnRyb2xJbnRlbnQub2YoJ0NVU1RPTS5uYW1lJywgeyAnYWN0aW9uJzogJC5BY3Rpb24uU2V0LCAndGFyZ2V0JzogJCQuVGFyZ2V0Lk5hbWUsICdDVVNUT00ubmFtZSc6IFwiTWlrZVwiIH0pKSk7XG4gICAgICAgICAgICBjb25zdCByZXN1bHQyID0gYXdhaXQgc2ltcGxlSW52b2tlKHJvb3RDb250cm9sLCBUZXN0SW5wdXQub2YoU2luZ2xlVmFsdWVDb250cm9sSW50ZW50Lm9mKEFtYXpvbkJ1aWx0SW5TbG90VHlwZS5OVU1CRVIsIHsgJ2FjdGlvbic6ICQuQWN0aW9uLlNldCwgJ3RhcmdldCc6ICQkLlRhcmdldC5BZ2UsICdBTUFaT04uTlVNQkVSJzogXCIyMFwiIH0pKSk7XG4gICAgICAgICAgICBjb25zdCByZXN1bHQzID0gYXdhaXQgc2ltcGxlSW52b2tlKHJvb3RDb250cm9sLCBUZXN0SW5wdXQub2YoU2luZ2xlVmFsdWVDb250cm9sSW50ZW50Lm9mKCdQbGF5ZXJDbGFzcycsIHsgYWN0aW9uOiAkLkFjdGlvbi5TZXQsIHRhcmdldDogJCQuVGFyZ2V0LkNoYXJDbGFzcywgUGxheWVyQ2xhc3M6ICdlbGYnIH0pKSk7XG4gICAgICAgICAgICBleHBlY3QocmVzdWx0My5hY3RzKS5sZW5ndGgoMik7XG4gICAgICAgICAgICBleHBlY3QocmVzdWx0My5hY3RzWzBdKS5pbnN0YW5jZU9mKFZhbHVlU2V0QWN0KTtcbiAgICAgICAgICAgIGV4cGVjdChyZXN1bHQzLmFjdHNbMV0pLmluc3RhbmNlT2YoUmVxdWVzdFZhbHVlQnlMaXN0QWN0KTtcbiAgICAgICAgICAgIGV4cGVjdCgocmVzdWx0My5hY3RzWzFdIGFzIFN5c3RlbUFjdCkuY29udHJvbC5pZCkuZXF1YWxzKCQkLklELlBldFNwZWNpZXMpO1xuXG4gICAgICAgICAgICBjb25zdCByZXN1bHQ0ID0gYXdhaXQgc2ltcGxlSW52b2tlKHJvb3RDb250cm9sLCBUZXN0SW5wdXQub2YoU2luZ2xlVmFsdWVDb250cm9sSW50ZW50Lm9mKCdQZXRTcGVjaWVzJywgeyBhY3Rpb246ICQuQWN0aW9uLlNldCwgdGFyZ2V0OiAkJC5UYXJnZXQuU3BlY2llcywgUGV0U3BlY2llczogJ2NhdCcgfSkpKTtcbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdDUgPSBhd2FpdCBzaW1wbGVJbnZva2Uocm9vdENvbnRyb2wsIFRlc3RJbnB1dC5vZihTaW5nbGVWYWx1ZUNvbnRyb2xJbnRlbnQub2YoJ0NVU1RPTS5uYW1lJywgeyAnYWN0aW9uJzogJC5BY3Rpb24uU2V0LCAndGFyZ2V0JzogJCQuVGFyZ2V0LlBldE5hbWUsICdDVVNUT00ubmFtZSc6IFwiQ29jb1wiIH0pKSk7XG4gICAgICAgICAgICBleHBlY3QocmVzdWx0NS5hY3RzKS5sZW5ndGgoMSk7XG4gICAgICAgICAgICBleHBlY3QocmVzdWx0NS5hY3RzWzBdKS5pbnN0YW5jZU9mKFZhbHVlU2V0QWN0KTtcbiAgICAgICAgICAgIGV4cGVjdChyZXN1bHQ1LnNlc3Npb25CZWhhdmlvcikuZXF1YWxzKFNlc3Npb25CZWhhdmlvci5PUEVOKTtcbiAgICAgICAgICAgIGV4cGVjdChmaW5kQ29udHJvbEJ5SWQocm9vdENvbnRyb2wsICQkLklELlBldE5hbWUpLnN0YXRlLnZhbHVlKS5lcShcIkNvY29cIik7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHRlc3QoXCJyZXF1ZXN0IGNsYXNzIHZhbHVlIChieSBsaXN0KVwiLCBhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCByb290Q29udHJvbCA9IG5ldyBHYW1lTWFuYWdlcigpLmNyZWF0ZUNvbnRyb2xUcmVlKCk7XG5cbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdDEgPSBhd2FpdCBzaW1wbGVJbnZva2Uocm9vdENvbnRyb2wsIFRlc3RJbnB1dC5vZihHZW5lcmFsQ29udHJvbEludGVudC5vZih7IGFjdGlvbjogJC5BY3Rpb24uU2V0LCB0YXJnZXQ6ICQkLlRhcmdldC5DaGFyQ2xhc3MgfSkpKTtcbiAgICAgICAgICAgIGV4cGVjdChyZXN1bHQxLmFjdHMpLmxlbmd0aCgxKTtcbiAgICAgICAgICAgIGV4cGVjdChyZXN1bHQxLmFjdHNbMF0pLmluc3RhbmNlT2YoUmVxdWVzdFZhbHVlQnlMaXN0QWN0KTtcblxuICAgICAgICAgICAgY29uc3QgcmVzdWx0MiA9IGF3YWl0IHNpbXBsZUludm9rZShyb290Q29udHJvbCwgVGVzdElucHV0Lm9mKFNpbmdsZVZhbHVlQ29udHJvbEludGVudC5vZignUGxheWVyQ2xhc3MnLCB7IGFjdGlvbjogJC5BY3Rpb24uU2V0LCB0YXJnZXQ6ICQkLlRhcmdldC5DaGFyQ2xhc3MsIFBsYXllckNsYXNzOiAkJC5WYWx1ZS5FbGYgfSkpKTtcbiAgICAgICAgICAgIGV4cGVjdChyZXN1bHQyLmFjdHMpLmxlbmd0aCgyKTtcbiAgICAgICAgICAgIGV4cGVjdChyZXN1bHQyLmFjdHNbMF0pLmluc3RhbmNlT2YoVmFsdWVTZXRBY3QpO1xuICAgICAgICAgICAgZXhwZWN0KHJlc3VsdDIuYWN0c1sxXSkuaW5zdGFuY2VPZihSZXF1ZXN0VmFsdWVBY3QpO1xuICAgICAgICAgICAgZXhwZWN0KChyZXN1bHQyLmFjdHNbMV0gYXMgU3lzdGVtQWN0KS5jb250cm9sLmlkKS5lcXVhbCgkJC5JRC5QbGF5ZXJOYW1lKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgdGVzdChcImN1c3RvbSBpbnRlbnQgc2V0dGluZyBtdWx0aXBsZSB2YWx1ZXMgdmlhIE11bHRpVmFsdWVDb250YWluZXJDb250cm9sXCIsIGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHJvb3RDb250cm9sID0gbmV3IEdhbWVNYW5hZ2VyKCkuY3JlYXRlQ29udHJvbFRyZWUoKTtcblxuICAgICAgICAgICAgY29uc3QgaW5wdXQgPSBUZXN0SW5wdXQub2YoSW50ZW50QnVpbGRlci5vZihcbiAgICAgICAgICAgICAgICBcIk15U2V0UGxheWVySW50ZW50XCIsXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICBuYW1lOiBcIk1pa2VcIixcbiAgICAgICAgICAgICAgICAgICAgY2xhc3M6IFwiaHVtYW5cIixcbiAgICAgICAgICAgICAgICAgICAgYWdlOiBcIjIwXCJcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICApKTtcblxuICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgc2ltcGxlSW52b2tlKHJvb3RDb250cm9sLCBpbnB1dCk7XG4gICAgICAgICAgICBleHBlY3QocmVzdWx0LmFjdHMpLmxlbmd0aCgxKTtcbiAgICAgICAgICAgIGV4cGVjdChyZXN1bHQuYWN0c1swXSkuaW5zdGFuY2VPZihSZXF1ZXN0VmFsdWVCeUxpc3RBY3QpO1xuICAgICAgICAgICAgZXhwZWN0KChyZXN1bHQuYWN0c1swXSBhcyBTeXN0ZW1BY3QpLmNvbnRyb2wuaWQpLmVxdWFscygkJC5JRC5QZXRTcGVjaWVzKTtcbiAgICAgICAgICAgIGV4cGVjdChyZXN1bHQuc2Vzc2lvbkJlaGF2aW9yKS5lcXVhbHMoU2Vzc2lvbkJlaGF2aW9yLk9QRU4pO1xuICAgICAgICB9KTtcblxuICAgICAgICB0ZXN0KFwiU2V0IGFuZCBDaGFuZ2UgYSBwbGF5ZXIgbmFtZSwgY2hlY2sgYWN0IGdlbmVyYXRpb25zIGR1ZSB0byB2YWxpZGF0aW9uIGZhaWxzXCIsIGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHJvb3RDb250cm9sID0gbmV3IEdhbWVNYW5hZ2VyKCkuY3JlYXRlQ29udHJvbFRyZWUoKTtcbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdDEgPSBhd2FpdCBzaW1wbGVJbnZva2Uocm9vdENvbnRyb2wsIFRlc3RJbnB1dC5vZihTaW5nbGVWYWx1ZUNvbnRyb2xJbnRlbnQub2YoJ0NVU1RPTS5uYW1lJywgeyAnYWN0aW9uJzogJC5BY3Rpb24uU2V0LCAndGFyZ2V0JzogJCQuVGFyZ2V0Lk5hbWUsICdDVVNUT00ubmFtZSc6IFwiTWlrZVwiIH0pKSk7XG4gICAgICAgICAgICBjb25zdCByZXN1bHQyID0gYXdhaXQgc2ltcGxlSW52b2tlKHJvb3RDb250cm9sLCBUZXN0SW5wdXQub2YoU2luZ2xlVmFsdWVDb250cm9sSW50ZW50Lm9mKCdDVVNUT00ubmFtZScsIHsgJ2FjdGlvbic6ICQuQWN0aW9uLkNoYW5nZSwgJ3RhcmdldCc6ICQkLlRhcmdldC5OYW1lLCAnQ1VTVE9NLm5hbWUnOiBcIkFsZXhhXCIgfSkpKTtcbiAgICAgICAgICAgIGV4cGVjdChyZXN1bHQyLmFjdHMpLmxlbmd0aCgyKTtcbiAgICAgICAgICAgIGV4cGVjdChyZXN1bHQyLmFjdHNbMF0pLmluc3RhbmNlT2YoSW52YWxpZFZhbHVlQWN0KTtcbiAgICAgICAgICAgIGV4cGVjdChyZXN1bHQyLmFjdHNbMV0pLmluc3RhbmNlT2YoUmVxdWVzdENoYW5nZWRWYWx1ZUFjdCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHRlc3QoXCJVc2VyIHNlbGVjdGlvbiBvZiBwbGF5ZXIgY2xhc3MgYnkgY2hvaWNlcyBudW1iZXJcIiwgYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgY29uc3Qgcm9vdENvbnRyb2wgPSBuZXcgR2FtZU1hbmFnZXIoKS5jcmVhdGVDb250cm9sVHJlZSgpO1xuICAgICAgICAgICAgY29uc3QgcmVzdWx0MSA9IGF3YWl0IHNpbXBsZUludm9rZShyb290Q29udHJvbCwgVGVzdElucHV0Lm9mKEdlbmVyYWxDb250cm9sSW50ZW50Lm9mKHsgYWN0aW9uOiAkLkFjdGlvbi5TZXQsIHRhcmdldDogJCQuVGFyZ2V0LkNoYXJDbGFzcyB9KSkpO1xuICAgICAgICAgICAgZXhwZWN0KHJlc3VsdDEuYWN0cykubGVuZ3RoKDEpO1xuICAgICAgICAgICAgZXhwZWN0KHJlc3VsdDEuYWN0c1swXSkuaW5zdGFuY2VPZihSZXF1ZXN0VmFsdWVCeUxpc3RBY3QpO1xuICAgICAgICAgICAgY29uc3QgcmVzdWx0MiA9IGF3YWl0IHNpbXBsZUludm9rZShyb290Q29udHJvbCwgVGVzdElucHV0Lm9mKE9yZGluYWxDb250cm9sSW50ZW50Lm9mKHsgXCJhY3Rpb25cIjogJC5BY3Rpb24uU2VsZWN0LCBcInRhcmdldFwiOiAkJC5UYXJnZXQuQ2hhckNsYXNzLCAnQU1BWk9OLk9yZGluYWwnOiAnMycgfSkpKTtcbiAgICAgICAgICAgIGV4cGVjdCgocmVzdWx0Mi5hY3RzWzBdIGFzIFN5c3RlbUFjdCkuY29udHJvbC5pZCkuZXF1YWwoJCQuSUQuUGxheWVyQ2xhc3MpO1xuICAgICAgICAgICAgZXhwZWN0KGZpbmRDb250cm9sQnlJZChyb290Q29udHJvbCwgJCQuSUQuUGxheWVyQ2xhc3MpLnN0YXRlLnZhbHVlKS5lcSgkJC5WYWx1ZS5IdW1hbik7XG4gICAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgc3VpdGUoXCI9PSBkZW1vIGdhbWUgVUksIGUyZSB3aXRoIFNQSSwgc2VyZGUgID09XCIsICgpID0+IHtcbiAgICAgICAgdGVzdChcImUyZVwiLCBhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCByZXF1ZXN0SGFuZGxlciA9IG5ldyBDb250cm9sSGFuZGxlcihuZXcgR2FtZU1hbmFnZXIoKSk7XG4gICAgICAgICAgICBjb25zdCBza2lsbCA9IG5ldyBTa2lsbEludm9rZXIod3JhcFJlcXVlc3RIYW5kbGVyQXNTa2lsbChyZXF1ZXN0SGFuZGxlcikpO1xuICAgICAgICAgICAgbGV0IHJlc3BvbnNlO1xuICAgICAgICAgICAgcmVzcG9uc2UgPSBhd2FpdCBza2lsbC5pbnZva2UoVGVzdElucHV0Lm9mKFNpbmdsZVZhbHVlQ29udHJvbEludGVudC5vZignQ1VTVE9NLm5hbWUnLCB7ICdhY3Rpb24nOiAkLkFjdGlvbi5TZXQsICd0YXJnZXQnOiAkJC5UYXJnZXQuTmFtZSwgJ0NVU1RPTS5uYW1lJzogXCJBbGV4YVwiIH0pKSk7XG4gICAgICAgICAgICBleHBlY3QocmVzcG9uc2UucHJvbXB0KS5lcXVhbHMoXCJTb3JyeSwgQWxleGEgaXMgbm90IGEgdmFsaWQgY2hvaWNlIGJlY2F1c2UgcGxheWVyTmFtZSBWYWxpZGF0aW9uIEZhaWxlZCBXaGF0IGlzIHlvdXIgYXZhdGFyJ3MgbmFtZT9cIik7XG5cbiAgICAgICAgICAgIHJlc3BvbnNlID0gYXdhaXQgc2tpbGwuaW52b2tlKFRlc3RJbnB1dC5vZihTaW5nbGVWYWx1ZUNvbnRyb2xJbnRlbnQub2YoJ0NVU1RPTS5uYW1lJywgeyAnYWN0aW9uJzogJC5BY3Rpb24uU2V0LCAndGFyZ2V0JzogJCQuVGFyZ2V0Lk5hbWUsICdDVVNUT00ubmFtZSc6IFwiTWlrZVwiIH0pKSk7XG4gICAgICAgICAgICBleHBlY3QocmVzcG9uc2UucHJvbXB0KS5lcXVhbHMoXCJPSywgTWlrZS4gSG93IG9sZCBpcyB5b3VyIGF2YXRhcj9cIik7XG5cbiAgICAgICAgICAgIHJlc3BvbnNlID0gYXdhaXQgc2tpbGwuaW52b2tlKFRlc3RJbnB1dC5vZihTaW5nbGVWYWx1ZUNvbnRyb2xJbnRlbnQub2YoQW1hem9uQnVpbHRJblNsb3RUeXBlLk5VTUJFUiwgeydBTUFaT04uTlVNQkVSJzogXCIyNVwiIH0pKSk7XG4gICAgICAgICAgICBleHBlY3QocmVzcG9uc2UucHJvbXB0KS5lcXVhbHMoXCJIZXksIHRoYXQncyBteSBhZ2UhIFdpbGwgeW91IGJlIGFuIGVsZiwgYSBkd2FyZiBvciBhIGh1bWFuP1wiKTsgLy8gY29udHJvbCBzcGVjaWZpYyBOTEcgZm9yIGZlZWRiYWNrXG5cbiAgICAgICAgICAgIHJlc3BvbnNlID0gYXdhaXQgc2tpbGwuaW52b2tlKFRlc3RJbnB1dC5vZihTaW5nbGVWYWx1ZUNvbnRyb2xJbnRlbnQub2YoQW1hem9uQnVpbHRJblNsb3RUeXBlLk5VTUJFUiwgeyAnYWN0aW9uJzogJC5BY3Rpb24uQ2hhbmdlLCAndGFyZ2V0JzogJCQuVGFyZ2V0LkFnZSwgJ0FNQVpPTi5OVU1CRVInOiBcIjI0XCIgfSkpKTtcbiAgICAgICAgICAgIGV4cGVjdChyZXNwb25zZS5wcm9tcHQpLmVxdWFscyhcIkNvb2wuIFdpbGwgeW91IGJlIGFuIGVsZiwgYSBkd2FyZiBvciBhIGh1bWFuP1wiKTsgLy8gY29udHJvbCBzcGVjaWZpYyBOTEcgZm9yIGZlZWRiYWNrXG5cbiAgICAgICAgICAgIHJlc3BvbnNlID0gYXdhaXQgc2tpbGwuaW52b2tlKFRlc3RJbnB1dC5vZihTaW5nbGVWYWx1ZUNvbnRyb2xJbnRlbnQub2YoJ1BsYXllckNsYXNzJywgeyBQbGF5ZXJDbGFzczogXCJIb2JiaXRcIiB9KSkpO1xuICAgICAgICAgICAgZXhwZWN0KHJlc3BvbnNlLnByb21wdCkuZXF1YWxzKFwiU29ycnksIEhvYmJpdCBpcyBub3QgYSB2YWxpZCBjaG9pY2UgYmVjYXVzZSBwbGF5ZXJDbGFzcyB2YWxpZGF0aW9uIEZhaWxlZCBXaWxsIHlvdSBiZSBhbiBlbGYsIGEgZHdhcmYgb3IgYSBodW1hbj9cIik7XG5cbiAgICAgICAgICAgIHJlc3BvbnNlID0gYXdhaXQgc2tpbGwuaW52b2tlKFRlc3RJbnB1dC5vZihTaW5nbGVWYWx1ZUNvbnRyb2xJbnRlbnQub2YoJ1BsYXllckNsYXNzJywgeyBQbGF5ZXJDbGFzczogJ2VsZicgfSkpKTtcbiAgICAgICAgICAgIGV4cGVjdChyZXNwb25zZS5wcm9tcHQpLmVxdWFscyhcIkdvdCBpdC4gV2lsbCB5b3VyIHBldCBiZSBhIGNhdCBvciBkb2c/XCIpO1xuXG4gICAgICAgICAgICByZXNwb25zZSA9IGF3YWl0IHNraWxsLmludm9rZShUZXN0SW5wdXQub2YoU2luZ2xlVmFsdWVDb250cm9sSW50ZW50Lm9mKCdQZXRTcGVjaWVzJywgeyBQZXRTcGVjaWVzOiAnY2F0JyB9KSkpO1xuICAgICAgICAgICAgZXhwZWN0KHJlc3BvbnNlLnByb21wdCkuZXF1YWxzKFwiT0ssIGNhdC4gV2hhdCBzaGFsbCB3ZSBuYW1lIHlvdXIgY2F0P1wiKTsgLy8gY29udGV4dHVhbCBOTEcuICBsYW1iZGEgcGlja2luZyB1cCB2YWx1ZSBvZiBcInBldCBzcGVjaWVzXCJcbiAgICAgICAgfSk7XG4gICAgfSk7XG59KTtcblxuZXhwb3J0IGNsYXNzIEdhbWVNYW5hZ2VyIGV4dGVuZHMgQ29udHJvbE1hbmFnZXIge1xuXG4gICAgcHVibGljIGNyZWF0ZUNvbnRyb2xUcmVlKHN0YXRlPzogYW55LCBpbnB1dD86IENvbnRyb2xJbnB1dCk6IENvbnRyb2wge1xuXG4gICAgICAgIGNvbnN0IHRvcENvbnRyb2wgPSBuZXcgQ29udGFpbmVyQ29udHJvbCh7IGlkOiAkJC5JRC5HYW1lQ29udGFpbmVyIH0pO1xuXG4gICAgICAgIC8vIC0tLSBQbGF5ZXJcbiAgICAgICAgY29uc3QgcGxheWVyQ29udGFpbmVyID0gbmV3IFBsYXllckNvbnRhaW5lcih7IGlkOiAkJC5JRC5QbGF5ZXJDb250YWluZXIgfSk7XG4gICAgICAgIHRvcENvbnRyb2wuYWRkQ2hpbGQocGxheWVyQ29udGFpbmVyKTtcblxuXG4gICAgICAgIC8vIC0tLSBQZXRcbiAgICAgICAgY29uc3QgcGV0Q29udGFpbmVyID0gbmV3IENvbnRhaW5lckNvbnRyb2woeyBpZDogJCQuSUQuUGV0Q29udGFpbmVyIH0pO1xuICAgICAgICB0b3BDb250cm9sLmFkZENoaWxkKHBldENvbnRhaW5lcik7XG5cbiAgICAgICAgcGV0Q29udGFpbmVyLmFkZENoaWxkKG5ldyBMaXN0Q29udHJvbChcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBpZDogJCQuSUQuUGV0U3BlY2llcyxcbiAgICAgICAgICAgICAgICBsaXN0SXRlbUlEczogdGhpcy5nZXRQZXRTcGVjaWVzKCksXG4gICAgICAgICAgICAgICAgc2xvdFR5cGU6ICdQZXRTcGVjaWVzJyxcbiAgICAgICAgICAgICAgICB2YWxpZGF0aW9uOiBbKHN0YXRlLCBpbnB1dCkgPT4gdGhpcy5nZXRQZXRTcGVjaWVzKCkuaW5jbHVkZXMoc3RhdGUudmFsdWUhKSA/IHRydWUgOiB7IHJlbmRlcmVkUmVhc29uOiAncGV0U3BlY2llcyB2YWxpZGF0aW9uIGZhaWxlZCd9XSxcbiAgICAgICAgICAgICAgICBwcm9tcHRzOiB7XG4gICAgICAgICAgICAgICAgICAgIHJlcXVlc3RWYWx1ZTogXCJXaWxsIHlvdXIgcGV0IGJlIGEgY2F0IG9yIGRvZz9cIlxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgaW50ZXJhY3Rpb25Nb2RlbDogeyB0YXJnZXRzOiBbJCQuVGFyZ2V0LlNwZWNpZXNdIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgKSkuYWRkQ2hpbGQobmV3IFZhbHVlQ29udHJvbChcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBpZDogJCQuSUQuUGV0TmFtZSxcbiAgICAgICAgICAgICAgICBzbG90VHlwZTogJ0NVU1RPTS5uYW1lJyxcbiAgICAgICAgICAgICAgICBwcm9tcHRzOiB7XG4gICAgICAgICAgICAgICAgICAgIHJlcXVlc3RWYWx1ZTogKGFjdCwgaW5wdXQpID0+IGBXaGF0IHNoYWxsIHdlIG5hbWUgeW91ciAkeyhpbnB1dC5jb250cm9sc1skJC5JRC5QZXRTcGVjaWVzXSBhcyBMaXN0Q29udHJvbCkuc3RhdGUudmFsdWUgPz8gJ3BldCd9P2BcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGludGVyYWN0aW9uTW9kZWw6IHsgdGFyZ2V0czogWyQkLlRhcmdldC5OYW1lLCAkJC5UYXJnZXQuUGV0TmFtZV0gfVxuICAgICAgICAgICAgfVxuICAgICAgICApKTtcbiAgICAgICAgcmV0dXJuIHRvcENvbnRyb2w7XG4gICAgfVxuXG4gICAgZ2V0UGV0U3BlY2llcygpOiBzdHJpbmdbXSB7XG4gICAgICAgIHJldHVybiBbJCQuVmFsdWUuQ2F0LCAkJC5UYXJnZXQuU3BlY2llcywgJCQuVmFsdWUuRG9nLCAkJC5UYXJnZXQuU3BlY2llc107XG4gICAgfVxuXG5cbn1cblxuY2xhc3MgUGxheWVyQ29udGFpbmVyIGV4dGVuZHMgQ29udGFpbmVyQ29udHJvbCB7XG5cbiAgICBwbGF5ZXJOYW1lQ29udHJvbCA9IG5ldyBWYWx1ZUNvbnRyb2woXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiAkJC5JRC5QbGF5ZXJOYW1lLFxuICAgICAgICAgICAgc2xvdFR5cGU6ICdDVVNUT00ubmFtZScsXG4gICAgICAgICAgICB2YWxpZGF0aW9uOiBbKHN0YXRlLCBpbnB1dCkgPT4gWydNaWtlJywgJ0RhdmUnXS5pbmNsdWRlcyhzdGF0ZS52YWx1ZSEpID8gdHJ1ZSA6IHsgcmVuZGVyZWRSZWFzb246ICdwbGF5ZXJOYW1lIFZhbGlkYXRpb24gRmFpbGVkJyB9XSxcbiAgICAgICAgICAgIHByb21wdHM6IHtcbiAgICAgICAgICAgICAgICByZXF1ZXN0VmFsdWU6IFwiV2hhdCBpcyB5b3VyIGF2YXRhcidzIG5hbWU/XCIsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgaW50ZXJhY3Rpb25Nb2RlbDogeyB0YXJnZXRzOiBbJCQuVGFyZ2V0Lk5hbWUsICQkLlRhcmdldC5BdmF0YXJOYW1lXSB9XG4gICAgICAgIH1cbiAgICApO1xuXG4gICAgcGxheWVyQWdlQ29udHJvbCA9IG5ldyBOdW1iZXJDb250cm9sKFxuICAgICAgICB7XG4gICAgICAgICAgICBpZDogJCQuSUQuUGxheWVyQWdlLFxuICAgICAgICAgICAgcHJvbXB0czoge1xuICAgICAgICAgICAgICAgIHJlcXVlc3RWYWx1ZTogXCJIb3cgb2xkIGlzIHlvdXIgYXZhdGFyP1wiLFxuICAgICAgICAgICAgICAgIHZhbHVlU2V0OiBhY3QgPT4gYWN0LnBheWxvYWQudmFsdWUgPT09IDI1ID8gXCJIZXksIHRoYXQncyBteSBhZ2UhXCIgOiAnQ29vbC4nLFxuICAgICAgICAgICAgICAgIC8vIHZhbHVlQ2hhbmdlZDogJ0Nvb2wuJ1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGludGVyYWN0aW9uTW9kZWw6IHsgdGFyZ2V0czogWyQkLlRhcmdldC5BZ2VdIH1cbiAgICAgICAgfVxuICAgICk7XG5cbiAgICBwbGF5ZXJDbGFzc0NvbnRyb2wgPSBuZXcgTGlzdENvbnRyb2woXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlkOiAkJC5JRC5QbGF5ZXJDbGFzcyxcbiAgICAgICAgICAgIGxpc3RJdGVtSURzOiB0aGlzLmdldFBsYXllckNsYXNzKCksXG4gICAgICAgICAgICBzbG90VHlwZTogJ1BsYXllckNsYXNzJyxcbiAgICAgICAgICAgIHZhbGlkYXRpb246IFsoc3RhdGUsIGlucHV0KSA9PiB0aGlzLmdldFBsYXllckNsYXNzKCkuaW5jbHVkZXMoc3RhdGUudmFsdWUhKSA/IHRydWUgOiB7IHJlbmRlcmVkUmVhc29uOiAncGxheWVyQ2xhc3MgdmFsaWRhdGlvbiBGYWlsZWQnIH1dLFxuICAgICAgICAgICAgcHJvbXB0czoge1xuICAgICAgICAgICAgICAgIHJlcXVlc3RWYWx1ZTogXCJXaWxsIHlvdSBiZSBhbiBlbGYsIGEgZHdhcmYgb3IgYSBodW1hbj9cIixcbiAgICAgICAgICAgICAgICB2YWx1ZVNldDogJ0dvdCBpdC4nXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgaW50ZXJhY3Rpb25Nb2RlbDogeyB0YXJnZXRzOiBbJCQuVGFyZ2V0LkNoYXJDbGFzc10gfVxuICAgICAgICB9XG4gICAgKTtcblxuICAgIGNvbnN0cnVjdG9yKHByb3BzOiBDb250YWluZXJDb250cm9sUHJvcHMpIHtcbiAgICAgICAgc3VwZXIocHJvcHMpO1xuICAgICAgICB0aGlzLmFkZENoaWxkKHRoaXMucGxheWVyTmFtZUNvbnRyb2wpXG4gICAgICAgICAgICAuYWRkQ2hpbGQodGhpcy5wbGF5ZXJBZ2VDb250cm9sKVxuICAgICAgICAgICAgLmFkZENoaWxkKHRoaXMucGxheWVyQ2xhc3NDb250cm9sKTtcbiAgICB9XG5cbiAgICBnZXRQbGF5ZXJDbGFzcygpOiBzdHJpbmdbXSB7XG4gICAgICAgIHJldHVybiBbJCQuVmFsdWUuRWxmLCAkJC5WYWx1ZS5Ed2FyZiwgJCQuVmFsdWUuSHVtYW5dO1xuICAgIH1cblxuICAgIGFzeW5jIGNhbkhhbmRsZShpbnB1dDogQ29udHJvbElucHV0KTogUHJvbWlzZTxib29sZWFuPiB7XG4gICAgICAgIHJldHVybiBJbnB1dFV0aWwuaXNJbnRlbnQoaW5wdXQsICdNeVNldFBsYXllckludGVudCcpXG4gICAgICAgICAgICB8fCB0aGlzLmNhbkhhbmRsZUJ5Q2hpbGQoaW5wdXQpO1xuICAgIH1cblxuICAgIGFzeW5jIGhhbmRsZShpbnB1dDogQ29udHJvbElucHV0LCByZXN1bHRCdWlsZGVyOiBDb250cm9sUmVzdWx0QnVpbGRlcik6IFByb21pc2U8dm9pZD4ge1xuICAgICAgICBpZiAoSW5wdXRVdGlsLmlzSW50ZW50KGlucHV0LCAnTXlTZXRQbGF5ZXJJbnRlbnQnKSkge1xuICAgICAgICAgICAgY29uc3QgaW50ZW50ID0gU2ltcGxpZmllZEludGVudC5mcm9tSW50ZW50KChpbnB1dC5yZXF1ZXN0IGFzIEludGVudFJlcXVlc3QpLmludGVudCk7XG4gICAgICAgICAgICBpZiAoaW50ZW50LnNsb3RSZXNvbHV0aW9ucy5uYW1lICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBuYW1lU2xvdFJlc29sdXRpb24gPSBpbnRlbnQuc2xvdFJlc29sdXRpb25zLm5hbWU7XG4gICAgICAgICAgICAgICAgdGhpcy5wbGF5ZXJOYW1lQ29udHJvbC5zZXRWYWx1ZShuYW1lU2xvdFJlc29sdXRpb24uc2xvdFZhbHVlLCBuYW1lU2xvdFJlc29sdXRpb24uaXNFbnRpdHlSZXNvbHV0aW9uTWF0Y2gpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGludGVudC5zbG90UmVzb2x1dGlvbnMuYWdlICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBhZ2VTbG90UmVzb2x1dGlvbiA9IGludGVudC5zbG90UmVzb2x1dGlvbnMuYWdlO1xuICAgICAgICAgICAgICAgIHRoaXMucGxheWVyQWdlQ29udHJvbC5zZXRWYWx1ZShOdW1iZXIucGFyc2VJbnQoYWdlU2xvdFJlc29sdXRpb24uc2xvdFZhbHVlLCAxMCkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGludGVudC5zbG90UmVzb2x1dGlvbnMuY2xhc3MgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgIGNvbnN0IGNsYXNzU2xvdFJlc29sdXRpb24gPSBpbnRlbnQuc2xvdFJlc29sdXRpb25zLmNsYXNzO1xuICAgICAgICAgICAgICAgIHRoaXMucGxheWVyQ2xhc3NDb250cm9sLnNldFZhbHVlKGNsYXNzU2xvdFJlc29sdXRpb24uc2xvdFZhbHVlLCBjbGFzc1Nsb3RSZXNvbHV0aW9uLmlzRW50aXR5UmVzb2x1dGlvbk1hdGNoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdGhpcy5oYW5kbGVCeUNoaWxkKGlucHV0LCByZXN1bHRCdWlsZGVyKTtcbiAgICB9XG59Il19