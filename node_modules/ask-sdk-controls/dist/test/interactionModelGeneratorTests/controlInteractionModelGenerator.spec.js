"use strict";
/*
 * Copyright 2019 Amazon.com, Inc. or its affiliates. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License").
 * You may not use this file except in compliance with the License.
 * A copy of the License is located at
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * or in the "license" file accompanying this file. This file is distributed
 * on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either
 * express or implied. See the License for the specific language governing
 * permissions and limitations under the License.
 */
Object.defineProperty(exports, "__esModule", { value: true });
const tslib_1 = require("tslib");
const mocha_1 = require("mocha");
const chai_1 = require("chai");
const sinon_1 = tslib_1.__importDefault(require("sinon"));
const src_1 = require("../../src");
const SingleValueControlIntent_1 = require("../../src/intents/SingleValueControlIntent");
const GeneralControlIntent_1 = require("../../src/intents/GeneralControlIntent");
const ControlInteractionModelGenerator_1 = require("../../src/interactionModelGeneration/ControlInteractionModelGenerator");
const interactionModelForTest_1 = require("./interactionModelForTest");
const ModelTypes_1 = require("../../src/interactionModelGeneration/ModelTypes");
const Logger_1 = require("../../src/logging/Logger");
class SingleValueTestControl extends src_1.Control {
    // dummy canHandle, handle, canTakeInitiative and takeInitiative cause 
    // the ControlInteractionModelGenerator only cares about updateInteractionModel and getTargetIds
    canHandle() {
        return true;
    }
    handle() { }
    canTakeInitiative() {
        return true;
    }
    takeInitiative() { }
    updateInteractionModel(generator, imData) {
        generator.addControlIntent(new SingleValueControlIntent_1.SingleValueControlIntent('TEST'), imData);
    }
    getTargetIds() {
        return ['test'];
    }
}
class SimpleTestControl extends src_1.Control {
    canHandle() {
        return true;
    }
    handle() { }
    canTakeInitiative() {
        return true;
    }
    takeInitiative() { }
    updateInteractionModel(generator, imData) {
        generator.addControlIntent(new GeneralControlIntent_1.GeneralControlIntent(), imData);
    }
    getTargetIds() {
        return ['test'];
    }
}
class TestControlManager extends src_1.ControlManager {
    createControlTree() {
        const rootControl = new src_1.ContainerControl({
            id: 'testRootControl',
        });
        rootControl
            .addChild(new SingleValueTestControl('singleValueTestControl'))
            .addChild(new SimpleTestControl('simpleTestControl'));
        return rootControl;
    }
}
const TEST_INVOCATION_NAME = 'TEST_INVOCATION_NAME';
mocha_1.suite('ControlInteractionModel Generator tests', () => {
    afterEach(() => {
        sinon_1.default.restore();
    });
    mocha_1.suite('buildCoreModelForControls tests', () => {
        mocha_1.test('buildCoreModelForControls should successfully build IM for controls tree', () => {
            sinon_1.default.stub(Logger_1.Logger.prototype, 'warn');
            const interactionModel = new ControlInteractionModelGenerator_1.ControlInteractionModelGenerator()
                .buildCoreModelForControls(new TestControlManager())
                .withInvocationName(TEST_INVOCATION_NAME)
                .build();
            const expectedInteractionModel = interactionModelForTest_1.jsonProvider.loadFromMockControls();
            chai_1.expect(interactionModel).deep.equal(expectedInteractionModel);
        });
        mocha_1.test('When locale is not supported, it should use default i18n resources ', () => {
            const interactionModel = new ControlInteractionModelGenerator_1.ControlInteractionModelGenerator()
                .buildCoreModelForControls(new TestControlManager({ locale: 'fr-FR' }))
                .withInvocationName(TEST_INVOCATION_NAME)
                .build();
            const expectedInteractionModel = interactionModelForTest_1.jsonProvider.loadFromMockControls();
            chai_1.expect(interactionModel).deep.equal(expectedInteractionModel);
        });
        mocha_1.test('i18nOverride should work as expected', () => {
            var _a, _b, _c;
            sinon_1.default.stub(Logger_1.Logger.prototype, 'warn');
            const targetInFR = {
                name: ModelTypes_1.SharedSlotType.TARGET,
                values: [
                    {
                        id: 'it',
                        name: {
                            value: 'la',
                            synonyms: [
                                'it',
                                "il",
                                "le"
                            ]
                        }
                    },
                ]
            };
            const i18nOverride = {
                fr: {
                    translation: {
                        SHARED_SLOT_TYPES_TARGET: targetInFR
                    }
                }
            };
            const interactionModel = new ControlInteractionModelGenerator_1.ControlInteractionModelGenerator()
                .buildCoreModelForControls(new TestControlManager({ locale: 'fr-FR', i18nOverride }))
                .withInvocationName(TEST_INVOCATION_NAME)
                .build();
            const expectedInteractionModel = interactionModelForTest_1.jsonProvider.loadFromMockControls();
            (_c = (_b = (_a = expectedInteractionModel.interactionModel) === null || _a === void 0 ? void 0 : _a.languageModel) === null || _b === void 0 ? void 0 : _b.types) === null || _c === void 0 ? void 0 : _c.map(slotType => {
                if (slotType.name === ModelTypes_1.SharedSlotType.TARGET) {
                    slotType.values = targetInFR.values;
                }
                return slotType;
            });
            chai_1.expect(interactionModel).deep.equal(expectedInteractionModel);
        });
        mocha_1.test('When provided override is is not complete, should use the default resource', () => {
            const emptyResourceInEN = {
                en: {
                    translation: {}
                }
            };
            const interactionModel = new ControlInteractionModelGenerator_1.ControlInteractionModelGenerator()
                .buildCoreModelForControls(new TestControlManager({ i18nOverride: emptyResourceInEN }))
                .withInvocationName(TEST_INVOCATION_NAME)
                .build();
            const expectedInteractionModel = interactionModelForTest_1.jsonProvider.loadFromMockControls();
            chai_1.expect(interactionModel).deep.equal(expectedInteractionModel);
        });
        mocha_1.test('3P controls without dependency on ControlIntent should be allowed to update IM', () => {
            class TESTControl extends src_1.Control {
                canHandle() {
                    return true;
                }
                handle() { }
                canTakeInitiative() {
                    return true;
                }
                takeInitiative() { }
                updateInteractionModel(generator) {
                    generator.addIntents({
                        name: 'testIntent',
                        samples: ['hello world']
                    });
                }
                getTargetIds() {
                    return [];
                }
            }
            class SimpleControlManager extends src_1.ControlManager {
                createControlTree() {
                    return new TESTControl('test');
                }
            }
            const interactionModel = new ControlInteractionModelGenerator_1.ControlInteractionModelGenerator()
                .buildCoreModelForControls(new SimpleControlManager())
                .withInvocationName(TEST_INVOCATION_NAME)
                .build();
            chai_1.expect(interactionModel).deep.equal({
                interactionModel: {
                    languageModel: {
                        intents: [
                            {
                                name: 'testIntent',
                                samples: ['hello world']
                            }
                        ],
                        invocationName: TEST_INVOCATION_NAME,
                        types: [],
                    },
                    prompts: []
                },
            });
        });
    });
    mocha_1.suite('build tests', () => {
        mocha_1.test('build should throw warning message if targetSlotIds are missing', () => {
            const spy = sinon_1.default.stub(Logger_1.Logger.prototype, 'warn');
            const interactionModel = new ControlInteractionModelGenerator_1.ControlInteractionModelGenerator()
                .buildCoreModelForControls(new TestControlManager())
                .withInvocationName(TEST_INVOCATION_NAME)
                .build();
            chai_1.expect(spy.calledOnceWith('target slot with id test is not present in InteractionModel.')).eq(true);
        });
    });
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29udHJvbEludGVyYWN0aW9uTW9kZWxHZW5lcmF0b3Iuc3BlYy5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3Rlc3QvaW50ZXJhY3Rpb25Nb2RlbEdlbmVyYXRvclRlc3RzL2NvbnRyb2xJbnRlcmFjdGlvbk1vZGVsR2VuZXJhdG9yLnNwZWMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBOzs7Ozs7Ozs7OztHQVdHOzs7QUFFSCxpQ0FBb0M7QUFHcEMsK0JBQThCO0FBQzlCLDBEQUEwQjtBQUMxQixtQ0FBaUY7QUFDakYseUZBQXNGO0FBQ3RGLGlGQUE4RTtBQUM5RSw0SEFBeUg7QUFDekgsdUVBQXlEO0FBRXpELGdGQUFpRjtBQUNqRixxREFBa0Q7QUFNbEQsTUFBTSxzQkFBdUIsU0FBUSxhQUFPO0lBQ3hDLHVFQUF1RTtJQUN2RSxnR0FBZ0c7SUFDaEcsU0FBUztRQUNMLE9BQU8sSUFBSSxDQUFDO0lBQ2hCLENBQUM7SUFDRCxNQUFNLEtBQVUsQ0FBQztJQUNqQixpQkFBaUI7UUFDYixPQUFPLElBQUksQ0FBQztJQUNoQixDQUFDO0lBQ0QsY0FBYyxLQUFVLENBQUM7SUFFekIsc0JBQXNCLENBQUMsU0FBMkMsRUFBRSxNQUFpQjtRQUNqRixTQUFTLENBQUMsZ0JBQWdCLENBQUMsSUFBSSxtREFBd0IsQ0FBQyxNQUFNLENBQUMsRUFBRSxNQUFNLENBQUMsQ0FBQztJQUM3RSxDQUFDO0lBRUQsWUFBWTtRQUVSLE9BQU8sQ0FBQyxNQUFNLENBQUMsQ0FBQztJQUNwQixDQUFDO0NBQ0o7QUFDRCxNQUFNLGlCQUFrQixTQUFRLGFBQU87SUFDbkMsU0FBUztRQUNMLE9BQU8sSUFBSSxDQUFDO0lBQ2hCLENBQUM7SUFDRCxNQUFNLEtBQVUsQ0FBQztJQUNqQixpQkFBaUI7UUFDYixPQUFPLElBQUksQ0FBQztJQUNoQixDQUFDO0lBQ0QsY0FBYyxLQUFVLENBQUM7SUFDekIsc0JBQXNCLENBQUMsU0FBMkMsRUFBRSxNQUFpQjtR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QztJQUVILGFBQUssQ0FBQyxhQUFhLEVBQUUsR0FBRyxFQUFFO1FBQ3RCLFlBQUksQ0FBQyxpRUFBaUUsRUFBRSxHQUFHLEVBQUU7WUFDekUsTUFBTSxHQUFHLEdBQUcsZUFBSyxDQUFDLElBQUksQ0FBQyxlQUFNLENBQUMsU0FBUyxFQUFFLE1BQU0sQ0FBQyxDQUFDO1lBQ2pELE1BQU0sZ0JBQWdCLEdBQUcsSUFBSSxtRUFBZ0MsRUFBRTtpQkFDMUQseUJBQXlCLENBQUMsSUFBSSxrQkFBa0IsRUFBRSxDQUFDO2lCQUNuRCxrQkFBa0IsQ0FBQyxvQkFBb0IsQ0FBQztpQkFDeEMsS0FBSyxFQUFFLENBQUM7WUFFYixhQUFNLENBQUMsR0FBRyxDQUFDLGNBQWMsQ0FBQyw4REFBOEQsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQ3hHLENBQUMsQ0FBQyxDQUFDO0lBQ1AsQ0FBQyxDQUFDLENBQUM7QUFDUCxDQUFDLENBQUMsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbIi8qXG4gKiBDb3B5cmlnaHQgMjAxOSBBbWF6b24uY29tLCBJbmMuIG9yIGl0cyBhZmZpbGlhdGVzLiBBbGwgUmlnaHRzIFJlc2VydmVkLlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKS5cbiAqIFlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIEEgY29weSBvZiB0aGUgTGljZW5zZSBpcyBsb2NhdGVkIGF0XG4gKiAgICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIG9yIGluIHRoZSBcImxpY2Vuc2VcIiBmaWxlIGFjY29tcGFueWluZyB0aGlzIGZpbGUuIFRoaXMgZmlsZSBpcyBkaXN0cmlidXRlZFxuICogb24gYW4gXCJBUyBJU1wiIEJBU0lTLCBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyXG4gKiBleHByZXNzIG9yIGltcGxpZWQuIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZ1xuICogcGVybWlzc2lvbnMgYW5kIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG5cbmltcG9ydCB7IHN1aXRlLCB0ZXN0IH0gZnJvbSAnbW9jaGEnO1xuaW1wb3J0ICogYXMgXyBmcm9tICdsb2Rhc2gnO1xuaW1wb3J0IHsgdjEgfSBmcm9tICdhc2stc21hcGktbW9kZWwnO1xuaW1wb3J0IHsgZXhwZWN0IH0gZnJvbSBcImNoYWlcIjtcbmltcG9ydCBzaW5vbiBmcm9tICdzaW5vbic7XG5pbXBvcnQgeyBDb250YWluZXJDb250cm9sLCBDb250cm9sTWFuYWdlciwgTW9kZWxEYXRhLCBDb250cm9sIH0gZnJvbSAnLi4vLi4vc3JjJztcbmltcG9ydCB7IFNpbmdsZVZhbHVlQ29udHJvbEludGVudCB9IGZyb20gJy4uLy4uL3NyYy9pbnRlbnRzL1NpbmdsZVZhbHVlQ29udHJvbEludGVudCc7XG5pbXBvcnQgeyBHZW5lcmFsQ29udHJvbEludGVudCB9IGZyb20gJy4uLy4uL3NyYy9pbnRlbnRzL0dlbmVyYWxDb250cm9sSW50ZW50JztcbmltcG9ydCB7IENvbnRyb2xJbnRlcmFjdGlvbk1vZGVsR2VuZXJhdG9yIH0gZnJvbSAnLi4vLi4vc3JjL2ludGVyYWN0aW9uTW9kZWxHZW5lcmF0aW9uL0NvbnRyb2xJbnRlcmFjdGlvbk1vZGVsR2VuZXJhdG9yJztcbmltcG9ydCB7IGpzb25Qcm92aWRlciB9IGZyb20gJy4vaW50ZXJhY3Rpb25Nb2RlbEZvclRlc3QnO1xuaW1wb3J0IHsgSW50ZXJhY3Rpb25Nb2RlbENvbnRyaWJ1dG9yIH0gZnJvbSAnLi4vLi4vc3JjL2NvbnRyb2xzL21peGlucy9JbnRlcmFjdGlvbk1vZGVsQ29udHJpYnV0b3InO1xuaW1wb3J0IHsgU2hhcmVkU2xvdFR5cGUgfSBmcm9tICcuLi8uLi9zcmMvaW50ZXJhY3Rpb25Nb2RlbEdlbmVyYXRpb24vTW9kZWxUeXBlcyc7XG5pbXBvcnQgeyBMb2dnZXIgfSBmcm9tICcuLi8uLi9zcmMvbG9nZ2luZy9Mb2dnZXInO1xuXG5pbXBvcnQgSW50ZXJhY3Rpb25Nb2RlbERhdGEgPSB2MS5za2lsbC5pbnRlcmFjdGlvbk1vZGVsLkludGVyYWN0aW9uTW9kZWxEYXRhO1xuaW1wb3J0IHsgUmVzb3VyY2UgfSBmcm9tICdpMThuZXh0JztcblxuXG5jbGFzcyBTaW5nbGVWYWx1ZVRlc3RDb250cm9sIGV4dGVuZHMgQ29udHJvbCBpbXBsZW1lbnRzIEludGVyYWN0aW9uTW9kZWxDb250cmlidXRvciB7XG4gICAgLy8gZHVtbXkgY2FuSGFuZGxlLCBoYW5kbGUsIGNhblRha2VJbml0aWF0aXZlIGFuZCB0YWtlSW5pdGlhdGl2ZSBjYXVzZSBcbiAgICAvLyB0aGUgQ29udHJvbEludGVyYWN0aW9uTW9kZWxHZW5lcmF0b3Igb25seSBjYXJlcyBhYm91dCB1cGRhdGVJbnRlcmFjdGlvbk1vZGVsIGFuZCBnZXRUYXJnZXRJZHNcbiAgICBjYW5IYW5kbGUoKTogYm9vbGVhbiB7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgICBoYW5kbGUoKTogdm9pZCB7fVxuICAgIGNhblRha2VJbml0aWF0aXZlKCk6IGJvb2xlYW4ge1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gICAgdGFrZUluaXRpYXRpdmUoKTogdm9pZCB7fVxuXG4gICAgdXBkYXRlSW50ZXJhY3Rpb25Nb2RlbChnZW5lcmF0b3I6IENvbnRyb2xJbnRlcmFjdGlvbk1vZGVsR2VuZXJhdG9yLCBpbURhdGE6IE1vZGVsRGF0YSkge1xuICAgICAgICBnZW5lcmF0b3IuYWRkQ29udHJvbEludGVudChuZXcgU2luZ2xlVmFsdWVDb250cm9sSW50ZW50KCdURVNUJyksIGltRGF0YSk7XG4gICAgfVxuXG4gICAgZ2V0VGFyZ2V0SWRzKCk6IHN0cmluZ1tdIHtcblxuICAgICAgICByZXR1cm4gWyd0ZXN0J107XG4gICAgfVxufVxuY2xhc3MgU2ltcGxlVGVzdENvbnRyb2wgZXh0ZW5kcyBDb250cm9sIGltcGxlbWVudHMgSW50ZXJhY3Rpb25Nb2RlbENvbnRyaWJ1dG9yIHtcbiAgICBjYW5IYW5kbGUoKTogYm9vbGVhbiB7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgICBoYW5kbGUoKTogdm9pZCB7fVxuICAgIGNhblRha2VJbml0aWF0aXZlKCk6IGJvb2xlYW4ge1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gICAgdGFrZUluaXRpYXRpdmUoKTogdm9pZCB7fVxuICAgIHVwZGF0ZUludGVyYWN0aW9uTW9kZWwoZ2VuZXJhdG9yOiBDb250cm9sSW50ZXJhY3Rpb25Nb2RlbEdlbmVyYXRvciwgaW1EYXRhOiBNb2RlbERhdGEpIHtcbiAgICAgICAgZ2VuZXJhdG9yLmFkZENvbnRyb2xJbnRlbnQobmV3IEdlbmVyYWxDb250cm9sSW50ZW50KCksIGltRGF0YSk7XG4gICAgfVxuXG4gICAgZ2V0VGFyZ2V0SWRzKCk6IHN0cmluZ1tdIHtcblxuICAgICAgICByZXR1cm4gWyd0ZXN0J107XG4gICAgfVxufVxuY2xhc3MgVGVzdENvbnRyb2xNYW5hZ2VyIGV4dGVuZHMgQ29udHJvbE1hbmFnZXIge1xuICAgIGNyZWF0ZUNvbnRyb2xUcmVlKCkge1xuICAgICAgICBjb25zdCByb290Q29udHJvbCA9IG5ldyBDb250YWluZXJDb250cm9sKHtcbiAgICAgICAgICAgIGlkOiAndGVzdFJvb3RDb250cm9sJyxcbiAgICAgICAgfSk7XG4gICAgICAgIHJvb3RDb250cm9sXG4gICAgICAgICAgICAuYWRkQ2hpbGQobmV3IFNpbmdsZVZhbHVlVGVzdENvbnRyb2woJ3NpbmdsZVZhbHVlVGVzdENvbnRyb2wnKSlcbiAgICAgICAgICAgIC5hZGRDaGlsZChuZXcgU2ltcGxlVGVzdENvbnRyb2woJ3NpbXBsZVRlc3RDb250cm9sJykpO1xuXG4gICAgICAgIHJldHVybiByb290Q29udHJvbDtcbiAgICB9XG59XG5cblxuY29uc3QgVEVTVF9JTlZPQ0FUSU9OX05BTUU6IHN0cmluZyA9ICdURVNUX0lOVk9DQVRJT05fTkFNRSc7XG5cbnN1aXRlKCdDb250cm9sSW50ZXJhY3Rpb25Nb2RlbCBHZW5lcmF0b3IgdGVzdHMnLCAoKSA9PiB7XG5cbiAgICBhZnRlckVhY2goKCkgPT4ge1xuICAgICAgICBzaW5vbi5yZXN0b3JlKCk7XG4gICAgfSk7XG4gICAgc3VpdGUoJ2J1aWxkQ29yZU1vZGVsRm9yQ29udHJvbHMgdGVzdHMnLCAoKSA9PiB7XG4gICAgICAgIHRlc3QoJ2J1aWxkQ29yZU1vZGVsRm9yQ29udHJvbHMgc2hvdWxkIHN1Y2Nlc3NmdWxseSBidWlsZCBJTSBmb3IgY29udHJvbHMgdHJlZScsICgpID0+IHtcbiAgICAgICAgICAgIHNpbm9uLnN0dWIoTG9nZ2VyLnByb3RvdHlwZSwgJ3dhcm4nKTtcbiAgICAgICAgICAgIGNvbnN0IGludGVyYWN0aW9uTW9kZWwgPSBuZXcgQ29udHJvbEludGVyYWN0aW9uTW9kZWxHZW5lcmF0b3IoKVxuICAgICAgICAgICAgICAgIC5idWlsZENvcmVNb2RlbEZvckNvbnRyb2xzKG5ldyBUZXN0Q29udHJvbE1hbmFnZXIoKSlcbiAgICAgICAgICAgICAgICAud2l0aEludm9jYXRpb25OYW1lKFRFU1RfSU5WT0NBVElPTl9OQU1FKVxuICAgICAgICAgICAgICAgIC5idWlsZCgpO1xuXG4gICAgICAgICAgICBjb25zdCBleHBlY3RlZEludGVyYWN0aW9uTW9kZWw6IEludGVyYWN0aW9uTW9kZWxEYXRhID0ganNvblByb3ZpZGVyLmxvYWRGcm9tTW9ja0NvbnRyb2xzKCk7XG5cbiAgICAgICAgICAgIGV4cGVjdChpbnRlcmFjdGlvbk1vZGVsKS5kZWVwLmVxdWFsKGV4cGVjdGVkSW50ZXJhY3Rpb25Nb2RlbCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHRlc3QoJ1doZW4gbG9jYWxlIGlzIG5vdCBzdXBwb3J0ZWQsIGl0IHNob3VsZCB1c2UgZGVmYXVsdCBpMThuIHJlc291cmNlcyAnLCAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBpbnRlcmFjdGlvbk1vZGVsID0gbmV3IENvbnRyb2xJbnRlcmFjdGlvbk1vZGVsR2VuZXJhdG9yKClcbiAgICAgICAgICAgICAgICAuYnVpbGRDb3JlTW9kZWxGb3JDb250cm9scyhuZXcgVGVzdENvbnRyb2xNYW5hZ2VyKHsgbG9jYWxlOiAnZnItRlInIH0pKVxuICAgICAgICAgICAgICAgIC53aXRoSW52b2NhdGlvbk5hbWUoVEVTVF9JTlZPQ0FUSU9OX05BTUUpXG4gICAgICAgICAgICAgICAgLmJ1aWxkKCk7XG5cbiAgICAgICAgICAgIGNvbnN0IGV4cGVjdGVkSW50ZXJhY3Rpb25Nb2RlbDogSW50ZXJhY3Rpb25Nb2RlbERhdGEgPSBqc29uUHJvdmlkZXIubG9hZEZyb21Nb2NrQ29udHJvbHMoKTtcblxuICAgICAgICAgICAgZXhwZWN0KGludGVyYWN0aW9uTW9kZWwpLmRlZXAuZXF1YWwoZXhwZWN0ZWRJbnRlcmFjdGlvbk1vZGVsKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgdGVzdCgnaTE4bk92ZXJyaWRlIHNob3VsZCB3b3JrIGFzIGV4cGVjdGVkJywgKCkgPT4ge1xuICAgICAgICAgICAgc2lub24uc3R1YihMb2dnZXIucHJvdG90eXBlLCAnd2FybicpO1xuICAgICAgICAgICAgY29uc3QgdGFyZ2V0SW5GUiA9IHtcbiAgICAgICAgICAgICAgICBuYW1lOiBTaGFyZWRTbG90VHlwZS5UQVJHRVQsXG4gICAgICAgICAgICAgICAgdmFsdWVzOiBbXG4gICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlkOiAnaXQnLFxuICAgICAgICAgICAgICAgICAgICAgICAgbmFtZToge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiAnbGEnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN5bm9ueW1zOiBbXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdpdCcsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiaWxcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJsZVwiXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIF1cbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBjb25zdCBpMThuT3ZlcnJpZGUgPSB7XG4gICAgICAgICAgICAgICAgZnI6IHtcbiAgICAgICAgICAgICAgICAgICAgdHJhbnNsYXRpb246IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIFNIQVJFRF9TTE9UX1RZUEVTX1RBUkdFVDogdGFyZ2V0SW5GUlxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIGNvbnN0IGludGVyYWN0aW9uTW9kZWwgPSBuZXcgQ29udHJvbEludGVyYWN0aW9uTW9kZWxHZW5lcmF0b3IoKVxuICAgICAgICAgICAgICAgIC5idWlsZENvcmVNb2RlbEZvckNvbnRyb2xzKG5ldyBUZXN0Q29udHJvbE1hbmFnZXIoeyBsb2NhbGU6ICdmci1GUicsIGkxOG5PdmVycmlkZSB9KSlcbiAgICAgICAgICAgICAgICAud2l0aEludm9jYXRpb25OYW1lKFRFU1RfSU5WT0NBVElPTl9OQU1FKVxuICAgICAgICAgICAgICAgIC5idWlsZCgpO1xuXG4gICAgICAgICAgICBjb25zdCBleHBlY3RlZEludGVyYWN0aW9uTW9kZWw6IEludGVyYWN0aW9uTW9kZWxEYXRhID0ganNvblByb3ZpZGVyLmxvYWRGcm9tTW9ja0NvbnRyb2xzKCk7XG4gICAgICAgICAgICBleHBlY3RlZEludGVyYWN0aW9uTW9kZWwuaW50ZXJhY3Rpb25Nb2RlbD8ubGFuZ3VhZ2VNb2RlbD8udHlwZXM/Lm1hcChzbG90VHlwZSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKHNsb3RUeXBlLm5hbWUgPT09IFNoYXJlZFNsb3RUeXBlLlRBUkdFVCkge1xuICAgICAgICAgICAgICAgICAgICBzbG90VHlwZS52YWx1ZXMgPSB0YXJnZXRJbkZSLnZhbHVlcztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIHNsb3RUeXBlO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGV4cGVjdChpbnRlcmFjdGlvbk1vZGVsKS5kZWVwLmVxdWFsKGV4cGVjdGVkSW50ZXJhY3Rpb25Nb2RlbCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHRlc3QoJ1doZW4gcHJvdmlkZWQgb3ZlcnJpZGUgaXMgaXMgbm90IGNvbXBsZXRlLCBzaG91bGQgdXNlIHRoZSBkZWZhdWx0IHJlc291cmNlJywgKCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgZW1wdHlSZXNvdXJjZUluRU46IFJlc291cmNlID0ge1xuICAgICAgICAgICAgICAgIGVuOiB7XG4gICAgICAgICAgICAgICAgICAgIHRyYW5zbGF0aW9uOiB7fVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBjb25zdCBpbnRlcmFjdGlvbk1vZGVsID0gbmV3IENvbnRyb2xJbnRlcmFjdGlvbk1vZGVsR2VuZXJhdG9yKClcbiAgICAgICAgICAgICAgICAuYnVpbGRDb3JlTW9kZWxGb3JDb250cm9scyhuZXcgVGVzdENvbnRyb2xNYW5hZ2VyKHsgaTE4bk92ZXJyaWRlOiBlbXB0eVJlc291cmNlSW5FTiB9KSlcbiAgICAgICAgICAgICAgICAud2l0aEludm9jYXRpb25OYW1lKFRFU1RfSU5WT0NBVElPTl9OQU1FKVxuICAgICAgICAgICAgICAgIC5idWlsZCgpO1xuICAgICAgICAgICAgY29uc3QgZXhwZWN0ZWRJbnRlcmFjdGlvbk1vZGVsOiBJbnRlcmFjdGlvbk1vZGVsRGF0YSA9IGpzb25Qcm92aWRlci5sb2FkRnJvbU1vY2tDb250cm9scygpO1xuXG4gICAgICAgICAgICBleHBlY3QoaW50ZXJhY3Rpb25Nb2RlbCkuZGVlcC5lcXVhbChleHBlY3RlZEludGVyYWN0aW9uTW9kZWwpO1xuICAgICAgICB9KTtcblxuICAgICAgICB0ZXN0KCczUCBjb250cm9scyB3aXRob3V0IGRlcGVuZGVuY3kgb24gQ29udHJvbEludGVudCBzaG91bGQgYmUgYWxsb3dlZCB0byB1cGRhdGUgSU0nLCAoKSA9PiB7XG4gICAgICAgICAgICBjbGFzcyBURVNUQ29udHJvbCBleHRlbmRzIENvbnRyb2wgaW1wbGVtZW50cyBJbnRlcmFjdGlvbk1vZGVsQ29udHJpYnV0b3Ige1xuICAgICAgICAgICAgICAgIGNhbkhhbmRsZSgpOiBib29sZWFuIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGhhbmRsZSgpOiB2b2lkIHt9XG4gICAgICAgICAgICAgICAgY2FuVGFrZUluaXRpYXRpdmUoKTogYm9vbGVhbiB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB0YWtlSW5pdGlhdGl2ZSgpOiB2b2lkIHt9XG4gICAgICAgICAgICAgICAgdXBkYXRlSW50ZXJhY3Rpb25Nb2RlbChnZW5lcmF0b3I6IENvbnRyb2xJbnRlcmFjdGlvbk1vZGVsR2VuZXJhdG9yKSB7XG4gICAgICAgICAgICAgICAgICAgIGdlbmVyYXRvci5hZGRJbnRlbnRzKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICd0ZXN0SW50ZW50JyxcbiAgICAgICAgICAgICAgICAgICAgICAgIHNhbXBsZXM6IFsnaGVsbG8gd29ybGQnXVxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZ2V0VGFyZ2V0SWRzKCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gW107XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY2xhc3MgU2ltcGxlQ29udHJvbE1hbmFnZXIgZXh0ZW5kcyBDb250cm9sTWFuYWdlciB7XG4gICAgICAgICAgICAgICAgY3JlYXRlQ29udHJvbFRyZWUoKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXcgVEVTVENvbnRyb2woJ3Rlc3QnKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjb25zdCBpbnRlcmFjdGlvbk1vZGVsID0gbmV3IENvbnRyb2xJbnRlcmFjdGlvbk1vZGVsR2VuZXJhdG9yKClcbiAgICAgICAgICAgICAgICAuYnVpbGRDb3JlTW9kZWxGb3JDb250cm9scyhuZXcgU2ltcGxlQ29udHJvbE1hbmFnZXIoKSlcbiAgICAgICAgICAgICAgICAud2l0aEludm9jYXRpb25OYW1lKFRFU1RfSU5WT0NBVElPTl9OQU1FKVxuICAgICAgICAgICAgICAgIC5idWlsZCgpO1xuXG4gICAgICAgICAgICBleHBlY3QoaW50ZXJhY3Rpb25Nb2RlbCkuZGVlcC5lcXVhbCh7XG4gICAgICAgICAgICAgICAgaW50ZXJhY3Rpb25Nb2RlbDoge1xuICAgICAgICAgICAgICAgICAgICBsYW5ndWFnZU1vZGVsOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpbnRlbnRzOiBbXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAndGVzdEludGVudCcsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNhbXBsZXM6IFsnaGVsbG8gd29ybGQnXVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIF0sXG4gICAgICAgICAgICAgICAgICAgICAgICBpbnZvY2F0aW9uTmFtZTogVEVTVF9JTlZPQ0FUSU9OX05BTUUsXG4gICAgICAgICAgICAgICAgICAgICAgICB0eXBlczogW10sXG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIHByb21wdHM6IFtdXG4gICAgICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgc3VpdGUoJ2J1aWxkIHRlc3RzJywgKCkgPT4ge1xuICAgICAgICB0ZXN0KCdidWlsZCBzaG91bGQgdGhyb3cgd2FybmluZyBtZXNzYWdlIGlmIHRhcmdldFNsb3RJZHMgYXJlIG1pc3NpbmcnLCAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBzcHkgPSBzaW5vbi5zdHViKExvZ2dlci5wcm90b3R5cGUsICd3YXJuJyk7XG4gICAgICAgICAgICBjb25zdCBpbnRlcmFjdGlvbk1vZGVsID0gbmV3IENvbnRyb2xJbnRlcmFjdGlvbk1vZGVsR2VuZXJhdG9yKClcbiAgICAgICAgICAgICAgICAuYnVpbGRDb3JlTW9kZWxGb3JDb250cm9scyhuZXcgVGVzdENvbnRyb2xNYW5hZ2VyKCkpXG4gICAgICAgICAgICAgICAgLndpdGhJbnZvY2F0aW9uTmFtZShURVNUX0lOVk9DQVRJT05fTkFNRSlcbiAgICAgICAgICAgICAgICAuYnVpbGQoKTtcblxuICAgICAgICAgICAgZXhwZWN0KHNweS5jYWxsZWRPbmNlV2l0aCgndGFyZ2V0IHNsb3Qgd2l0aCBpZCB0ZXN0IGlzIG5vdCBwcmVzZW50IGluIEludGVyYWN0aW9uTW9kZWwuJykpLmVxKHRydWUpO1xuICAgICAgICB9KTtcbiAgICB9KTtcbn0pO1xuIl19